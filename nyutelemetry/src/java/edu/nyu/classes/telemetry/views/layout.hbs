<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="{{{skinRepo}}}/tool_base.css" />

        {{{randomSakaiHeadStuff}}}
    </head>
    <body>
        <script src="/telemetry/js/apexcharts.js"></script>
        <script src="/telemetry/js/moment.min.js"></script>
        <script src="/telemetry/js/moment-timezone-with-data.js"></script>

        {{#lineCharts}}
            <h2>{{name}}</h2>
            <div id="{{name}}"></div>

            <script>
             var chart = new ApexCharts(document.querySelector('#{{name}}'), {
                 chart: {
                     type: 'line',
                     width: 1280,
                     height: 400,
                     zoom: {
                         enabled: true,
                         type: 'xy',
                     },
                 },

                 tooltip: {
                     x: {
                         show: false,
                     },
                 },

                 markers: {
                     size: 2,
                     strokeWidth: 0,
                     colors: '#0085ff',
                 },

                 xaxis: {
                     type: 'datetime',
                     labels: {
                         formatter: function (value, timestamp) {
                             return moment(new Date(timestamp)).tz('America/New_York').format('DD MMM');
                         },
                     },
                     tooltip: {
                         formatter: function (value, opts) {
                             return moment(new Date(value)).tz('America/New_York').format('ddd, YYYY-MM-DD HH:mm');
                         },
                     },
                 },

                 yaxis: {
                     min: 0,
                 },


                 series: [{
                     name: '{{name}}',
                     data: [
                         {{#each readings}}
                         [{{x}}, {{y}}],
                         {{/each}}
                     ],
                 }],
             });

             chart.render();
            </script>


            <section id="{{this.name}}_counts_by_day_section">
                <h2>{{this.name}} - counts by day</h2>

                <div id="{{this.name}}_counts_by_day"></div>
            </section>

            <script>
             var chart = new ApexCharts(
                 document.querySelector("#{{this.name}}_counts_by_day"),
                 {
                     chart: {
                         width: 1280,
                         height: 200,
                         type: 'bar',
                     },
                     xaxis: {
                         labels: {
                             rotate: -90,
                         },
                         categories: [
                             {{#each this.countsByDay}}
                             '{{@key}}',
                             {{/each}}
                         ],
                     },
                     yaxis: {
                         min: 0,
                     },
                     series: [
                         {
                             name: 'count',
                             data: [
                                 {{#each this.countsByDay}}
                                 {{this}},
                                 {{/each}}
                             ],
                         },
                     ],
                 });

             if ('{{this.name}}'.indexOf('count') < 0) {
                 chart.render();
             } else {
                 document.querySelector('#{{this.name}}_counts_by_day_section').style.display = 'none';
             }
            </script>

        {{/lineCharts}}


        {{#histogramCharts}}
            <h2>{{this.name}}</h2>

            <div id="{{this.name}}"></div>
            <script>
             var chart = new ApexCharts(
                 document.querySelector("#{{this.name}}"),
                 {
                     chart: {
                         width: 1280,
                         height: 200,
                         type: 'heatmap',
                         animations: {
                             enabled: false,
                             dynamicAnimation: {
                                 enabled: false,
                             }
                         }
                     },
                     stroke: {
                         width: 1,
                         colors: ['#a8d7fb'],
                     },

                     dataLabels: {
                         enabled: false
                     },
                     xaxis: {
                         type: 'category',
                         labels: {
                             show: false,
                             formatter: function (value, timestamp, index) {
                                 return moment(new Date(value)).tz('America/New_York').format('ddd, YYYY-MM-DD HH:mm');
                             },
                         },
                         axisTicks: {
                             show: false,
                         },
                     },

                     colors: ["#008FFB"],
                     series: [
                         {{#each this.bucketsMap}}
                         {
                             name: '{{@key}}',
                             data: [
                                 {{#each this}}
                                 {
                                     x: {{this.time}},
                                     y: {{this.count}},
                                 },
                                 {{/each}}
                             ],
                         },
                         {{/each}}
                     ],
                 });


             chart.render();

            </script>

            <h2>{{this.name}} - counts by day</h2>

            <div id="{{this.name}}_counts_by_day"></div>
            <script>
             var chart = new ApexCharts(
                 document.querySelector("#{{this.name}}_counts_by_day"),
                 {
                     chart: {
                         width: 1280,
                         height: 200,
                         type: 'bar',
                     },
                     xaxis: {
                         labels: {
                             rotate: -90,
                         },
                         categories: [
                             {{#each this.countsByDay}}
                             '{{@key}}',
                             {{/each}}
                         ],
                     },
                     yaxis: {
                         min: 0,
                     },
                     series: [
                         {
                             name: 'count',
                             data: [
                                 {{#each this.countsByDay}}
                                 {{this}},
                                 {{/each}}
                             ],
                         },
                     ],
                 });


             chart.render();

            </script>

        {{/histogramCharts}}


        <script>includeLatestJQuery('layout.hbs');</script>

    </body>
</html>
