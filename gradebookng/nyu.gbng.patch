diff --git a/gradebookng/pom.xml b/gradebookng/pom.xml
index 0e55cd69d3..50125c3fa2 100644
--- a/gradebookng/pom.xml
+++ b/gradebookng/pom.xml
@@ -9,7 +9,7 @@
 	<parent>
 		<groupId>org.sakaiproject</groupId>
 		<artifactId>master</artifactId>
-		<version>12-SNAPSHOT</version>
+		<version>11.2</version>
 		<relativePath>../master/pom.xml</relativePath>
 	</parent>
 	<properties>
diff --git a/gradebookng/tool/pom.xml b/gradebookng/tool/pom.xml
index 23a3c68621..7da0473da7 100644
--- a/gradebookng/tool/pom.xml
+++ b/gradebookng/tool/pom.xml
@@ -7,7 +7,7 @@
 	<parent>
 		<groupId>org.sakaiproject.gradebookng</groupId>
 		<artifactId>gradebookng</artifactId>
-		<version>12-SNAPSHOT</version>
+		<version>11.2</version>
 	</parent>
 	<packaging>war</packaging>
 	<dependencies>
@@ -82,6 +82,7 @@
 		<dependency>
 			<groupId>net.sf.opencsv</groupId>
 			<artifactId>opencsv</artifactId>
+                        <version>2.3</version>
 		</dependency>
 		<dependency>
 			<groupId>org.apache.poi</groupId>
@@ -96,6 +97,7 @@
 		<dependency>
 			<groupId>org.mockito</groupId>
 			<artifactId>mockito-core</artifactId>
+                        <version>2.7.22</version>
 			<scope>test</scope>
 		</dependency>
 		<dependency>
@@ -120,6 +122,16 @@
    			<groupId>org.apache.commons</groupId>
     		<artifactId>commons-math3</artifactId>
 		</dependency>
+		<dependency>
+			<groupId>com.fasterxml.jackson.core</groupId>
+			<artifactId>jackson-core</artifactId>
+			<scope>provided</scope>
+		</dependency>
+		<dependency>
+			<groupId>com.fasterxml.jackson.core</groupId>
+			<artifactId>jackson-databind</artifactId>
+			<scope>provided</scope>
+		</dependency>
 	</dependencies>
 	<build>
 		<resources>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.java
index 59a9acf041..52263cbcb2 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.java
@@ -2,7 +2,10 @@ package org.sakaiproject.gradebookng;
 
 import org.apache.wicket.core.request.handler.PageProvider;
 import org.apache.wicket.core.request.handler.RenderPageRequestHandler;
+import org.apache.wicket.RuntimeConfigurationType;
+import org.apache.wicket.Application;
 import org.apache.wicket.protocol.http.WebApplication;
+import org.apache.wicket.session.ISessionStore;
 import org.apache.wicket.request.IRequestHandler;
 import org.apache.wicket.request.cycle.AbstractRequestCycleListener;
 import org.apache.wicket.request.cycle.RequestCycle;
@@ -61,10 +64,18 @@ public class GradebookNgApplication extends WebApplication {
 		// for production, set to SHOW_NO_EXCEPTION_PAGE
 		getExceptionSettings().setUnexpectedExceptionDisplay(IExceptionSettings.SHOW_EXCEPTION_PAGE);
 
+		final ISessionStore sessionStore = getSessionStore();
+
 		// Intercept any unexpected error stacktrace and take to our page
 		getRequestCycleListeners().add(new AbstractRequestCycleListener() {
 			@Override
 			public IRequestHandler onException(final RequestCycle cycle, final Exception e) {
+                            // FIXME: Disable this for production
+				if (e instanceof ClassCastException) {
+					System.err.println("INVALIDATING DUD SESSION");
+					sessionStore.invalidate(cycle.getRequest());
+				}
+
 				return new RenderPageRequestHandler(new PageProvider(new ErrorPage(e)));
 			}
 		});
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.properties b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.properties
index 00913d5c56..1025eacdb4 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.properties
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication.properties
@@ -24,6 +24,7 @@ label.avg=Avg:
 label.total=Total:
 label.relativeweight=Relative weight:
 label.due=Due:
+label.category=Cat:
 label.noduedate=-
 label.percentage.valued={0}%
 label.percentage.plain=%
@@ -41,14 +42,18 @@ label.gradeitem.counted=Gradebook Item is included in the course grade calculati
 label.gradeitem.notcounted=Gradebook Item not included in course grade calculation.
 label.gradeitem.extracredit=This is an Extra Credit Gradebook Item
 label.gradeitem.extracreditcategory=This is an Extra Credit Category
-label.gradeitem.categoryaverage=Category Average for {0}
+label.gradeitem.categoryaverage={0} Weighted Average
+label.gradeitem.categoryaveragelabel=Weighted Average
 label.gradeitem.categoryheadertooltip=Category: {0}
+label.gradeitem.categoryweight=Category weight
 label.gradeitem.categoryandweightheadertooltip=Category: {0}, Weight: {1}
-label.toolbar.gradeitemsummary=Showing <span class='gb-item-summary-counts'><span class='visible'>{0}</span> of <span class='total'>{1}</span> items</span>
+label.toolbar.toggleitems=View Columns
+label.toolbar.togglecategories=Group By Category
+label.toolbar.sortgradeitems=Item Order
+label.toolbar.gradeitemsummary=Showing <span class='gb-item-summary-counts'><span class='visible'>{0}</span> of <span class='total'>{1}</span></span> columns
+label.toolbar.gradeitemsummary-tooltip=Showing {0} of {1} columns ({2} of {3} items, {4} of {5} category averages)
 label.toolbar.studentsummarypaginated=Showing {0} to {1} of {2} students
 label.toolbar.studentsummary=Showing <span class='gb-student-summary-counts'><span class="visible">{0}</span></span> students
-table.toolbar.categorytoggle=Group By Category
-label.toolbar.gradeitemstoggle=Show/Hide Items
 label.toolbar.gradeitemshowall=Show All
 label.toolbar.gradeitemhideall=Hide All
 label.toolbar.gradeitemshowthiscategory=Show this category
@@ -64,6 +69,7 @@ label.toolbar.gradeitemhidethiscategoryscore=Hide this column
 label.toolbar.categorygroup.menulabel=Open menu for this category column
 label.toolbar.gradeitem.menulabel=Open menu for this Gradebook Item column
 label.toolbar.categoryaverage.menulabel=Open menu for this category score column
+label.toolbar.togglehelp=Toggle grade table and keyboard navigation help
 
 label.concurrentuserwarning=Please be aware a colleague has just made some changes to this Gradebook.<br>Refresh your page often to ensure you have the latest values.
 error.concurrentedit=Concurrent edits have been detected. Refresh the tool to see the latest scores.
@@ -73,6 +79,7 @@ column.header.students = Students
 column.header.coursegrade = Course Grade
 
 filter.students = Filter students
+filter.studentsclear = Clear student filter
 filter.groups = Filter by group/section
 
 button.addgradeitem = Add Gradebook Item
@@ -287,7 +294,15 @@ message.addcoursegradeoverride.invalid = The course grade entered is invalid acc
 
 message.updateungradeditems.success=The ungraded items were updated.
 
-gradespage.caption = Rows of student names. Columns of gradebook items. Press enter key in a cell to add or edit a grade. Two tabs to move through each cell. Filter list with accesskey F.
+gradetable.wrapper.tooltip = This is the wrapper of the grades table data. Hit 'return' to enter the table data and 'escape' to return to this point.
+gradetable.caption.summaryheader = Table Summary
+gradetable.caption.summary = Rows of students. First column is student name. Second column is course grade. Other columns are gradebook items and category averages (if enabled). Press enter key in a cell to add or edit a grade. Filter list with accesskey F.
+gradetable.caption.keyboardnavigationheader = Keyboard Navigation
+gradetable.caption.keyboardnavigation = <p>Use the access key 'g' skip to the grades table and hit 'return' to enter table mode and begin navigating the grades data. Once in table mode, the tab key and arrow keys allow you to navigate the table cells. To edit a grade, hit the 'return' key or begin entering the student's score.  When editing a score, hit 'escape' to cancel your changes and 'return' to save your changes. When you have finished, hit 'escape' to exit table mode.<p> 
+gradetable.caption.keyboardshortcutsheader = Keyboard Shortcuts
+gradetable.caption.keyboardshortcuts = <p>Accesskey shortcuts (note: your AccessKeyShortcut this will depend on your browser and operating system - <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/accesskey" target="_blank" tabindex="-1">more information</a>)</p><dl class="dl-horizontal"><dt>Jump to the Grades Table</dt><dd>AccessKeyShortcut + g</dd><dt>Jump to Student Filter</dt><dd>AccessKeyShortcut + f</dd></dl><p>When the grades table is focused:</p><dl class="dl-horizontal"><dt>Enter table mode</dt><dd>Return</dd></dl>
+gradetable.caption.keyboardtablemodeshortcuts = <p>When in table mode:</p><dl class="dl-horizontal"><dt>Navigate cells</dt><dd>Arrow keys or Tab</dd><dt>Open cell menu</dt><dd>Space</dd><dt>Open cell header menu</dt><dd>Control + Space</dd><dt>Toggle cell summary</dt><dd>s</dd><dt>Exit table mode</dt><dd>ESC</dd></dl>
+gradetable.caption.keyboardeditingshortcuts = <p>When editing a score:</p><dl class="dl-horizontal"><dt>Cancel changes</dt><dd>ESC</dd><dt>Save changes</dt><dd>Return</dd></dl>
 
 grade.option.viewlog = Grade Log
 grade.log.entry = {0} - Score set to <b>{1}</b> by {2}
@@ -296,13 +311,17 @@ grade.outof = /{0}
 grade.menulabel = Open menu for student {0} and assignment {1} cell
 
 grade.notifications.hascomment = Gradebook item has comments
+grade.notifications.commentloading = Loading comment...
+grade.notifications.editcomment = Edit Comment
 grade.notifications.haserror = An error occurred saving this item score.
 grade.notifications.overlimit = Score is over item's maximum point value and is providing extra credit.
 grade.notifications.concurrentedit = A concurrent edit has been detected. Please refresh the tool to view the latest scores.
-grade.notifications.concurrenteditbyuser = <span class="gb-concurrent-edit-user">{0}</span> edited this score at <span class="gb-concurrent-edit-time">{1}</span>. Please refresh the tool to view the latest scores.
-grade.notifications.isexternal = Gradebook item has been imported from an external tool and can only be edited from within that tool.
+grade.notifications.concurrentedituser = Edited by:
+grade.notifications.concurrentedittime = At time:
+grade.notifications.isexternal = Go to {0} tool to edit scores for this item.
 grade.notifications.invalid = Item score must be a positive number/decimal with a maximum of 10 integers and 2 decimal places.
-grade.notifications.readonly = Insufficient privileges to edit this Gradebook item score
+grade.notifications.readonly = Item score is read only
+grade.notifications.privileges = Insufficient privileges to edit this Gradebook item score
 grade.notifications.revert = Revert to Previous Score
 grade.notifications.saved = All changes saved.
 grade.notifications.error = Errors were detected. See cell notifications below.
@@ -445,7 +464,7 @@ label.statistics.chart.xaxis = Percentage Scored
 label.statistics.chart.yaxis = Number of Students
 label.statistics.chart.tooltip = {2} score(s) in {1} range
 
-label.statistics.coursegrade.averagegpa = Course Average GPA
+label.statistics.coursegrade.averagegpa = Average GPA
 label.statistics.coursegrade.average = Average grade
 label.statistics.coursegrade.graded = Total graded students
 label.statistics.coursegrade.median = Median grade
@@ -478,11 +497,11 @@ column.header.coursegradeoverride.gradeoverride = Grade Override
 coursegrade.display.percentage-first = {0}
 coursegrade.display.percentage-second = ({0})
 coursegrade.display.points-first = {0}/{1}
-coursegrade.display.points-second = <br>[{0}/{1}]
+coursegrade.display.points-second = [{0}/{1}]
 coursegrade.display.points-none = -
 coursegrade.display.none = -
 coursegrade.option.showpoints = Show Points
-coursegrade.option.hidepoints = Hide points
+coursegrade.option.hidepoints = Hide Points
 
 link.coursegradeoverride.revert.tooltip = Removes the course grade override and reverts to the calculated course grade
 link.coursegradeoverride.reverttocalculated = Revert to calculated course grade
@@ -491,12 +510,13 @@ feedback.saving = Saving...
 feedback.saved = All changes saved.
 feedback.error = Errors were detected. See cell notifications below.
 feedback.connectiontimeout = Unable to connect. Changes cannot be saved while offline.
+feedback.reordercolumnsfailed = An error occurred while reordering columns.
 
 ta.nopermission = You do not have permission to view the gradebook. Please contact your instructor.
 ta.roleswapped = TA view of gradebook cannot be displayed.
 
 error.addeditgradeitem.categorypoints = This gradebook item is configured with a category that has drop highest/drop lowest/keep highest enabled. The points for this gradebook item must match the current maximum of {0}.
-error.addeditgradeitem.titlecharacters = Gradebook item names cannot contain *, #, [ or ] as they are reserved.
+error.addeditgradeitem.titlecharacters = Gradebook item names cannot contain characters '*', '[', ']' or start with a '#' as they are reserved.
 
 importExport.error.grade = An error occurred importing a grade. Please check the file.
 importExport.error.comment = An error occurred importing a comment. Please check the file.
@@ -516,3 +536,21 @@ error.role=Your role in this site is improperly configured. You must have one of
 
 ta.null=Select a grader
 
+sortgradeitems.heading=Sort Grade Items
+sortgradeitems.bycategory=By Category
+sortgradeitems.bygradeitem=By Grade Item
+sortgradeitems.submit=Update Sort Order
+sortgradeitems.submitbycategory=Update Categorized Sort Order
+sortgradeitems.success.byitem=Sort Order Updated
+sortgradeitems.success.bycategory=Categorized Sort Order Updated
+sortgradeitems.error=Unable to update sort order. Please contact your System Administrator.
+
+metadata.header=Current Cell Metadata
+metadata.student=Student:
+metadata.assignment=Assignment:
+metadata.score=Score:
+metadata.courseGrade=Course Grade:
+metadata.category=Category:
+metadata.categoryAverage=Category Average:
+metadata.flags=This score has the following flags:
+metadata.noflags=No notifications
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication_ja.properties b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication_ja.properties
index 0a12e8cdc0..11214b54d4 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication_ja.properties
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/GradebookNgApplication_ja.properties
@@ -1,7 +1,4 @@
 app.title=\u6210\u7e3e\u7c3f
-format.date=MM/dd/yyyy
-label.date=mm/dd/yyyy
-format.datetime=MM/dd/yyyy HH\:mm
 link.gradebook=\u6210\u7e3e
 link.gradebook.tooltip=\u6210\u7e3e
 link.settings=\u8a2d\u5b9a
@@ -94,7 +91,7 @@ label.addgradeitem.extracredit=\u7279\u5225\u70b9
 label.addgradeitem.due=\u7de0\u5207\u65e5\u6642
 label.addgradeitem.due.help=\u65e5\u6642\u3092\u9078\u629e
 label.addgradeitem.category=\u30ab\u30c6\u30b4\u30ea
-label.addgradeitem.nocategoryassigned=\u30ab\u30c6\u30b4\u30ea\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u306f\u30b3\u30fc\u30b9\u6210\u7e3e\u3068\u3057\u3066\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u305b\u3093\uff0e
+label.addgradeitem.nocategoryassigned=\u30ab\u30c6\u30b4\u30ea\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u306f\u30b3\u30fc\u30b9\u6210\u7e3e\u8a08\u7b97\u3067\u306f\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u305b\u3093\uff0e
 label.addgradeitem.release=\u30a2\u30a4\u30c6\u30e0\u3092\u53d7\u8b1b\u8005\u306b\u516c\u958b\u3057\u307e\u3059\u304b\uff1f
 label.addgradeitem.include=\u30b3\u30fc\u30b9\u6210\u7e3e\u8a08\u7b97\u306b\u30a2\u30a4\u30c6\u30e0\u3092\u542b\u3081\u307e\u3059\u304b\uff1f
 label.addgradeitem.nocategories=\u30ab\u30c6\u30b4\u30ea\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff0e
@@ -133,8 +130,7 @@ label.studentsummary.collapseall=\u3059\u3079\u3066\u6298\u308a\u7573\u3080
 label.studentsummary.previous=\u524d\u306e\u53d7\u8b1b\u8005
 label.studentsummary.next=\u6b21\u306e\u53d7\u8b1b\u8005
 label.studentsummary.coursegradenotreleased=\u672a\u516c\u958b
-label.studentsummary.coursegradenotreleasedflag=\u5b66\u751f*\u306b\u975e\u516c\u958b
-label.studentsummary.coursegradenotreleasedmessage=*\u5b66\u751f\u306b\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u516c\u958b\u3059\u308b\u306b\u306f\uff0c\u8a2d\u5b9a\u306b\u3059\u3059\u307f"\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u5b66\u751f\u306b\u8868\u793a"\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\uff0e 
+label.studentsummary.coursegradenotreleasedmessage=*\u6700\u7d42\u306e\u30b3\u30fc\u30b9\u6210\u7e3e\u306f\u53d7\u8b1b\u8005\u306b\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff0e\u6700\u7d42\u306e\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u53d7\u8b1b\u8005\u306b\u516c\u958b\u3059\u308b\u306b\u306f\uff0c\u8a2d\u5b9a\u306b\u3042\u308b"\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u5b66\u751f\u306b\u8868\u793a"\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\uff0e 
 label.studentsummary.categoryweight=({0})
 label.studentsummary.closeconfirmation.title=\u3042\u306a\u305f\u306f\u53d7\u8b1b\u751f\u30ec\u30d3\u30e5\u30fc\u30e2\u30fc\u30c9\u304b\u3089\u96e2\u308c\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\uff0e
 label.studentsummary.closeconfirmation.content=\u672a\u516c\u958b\u306e\u6210\u7e3e\u304a\u3088\u3073\u53d7\u8b1b\u751f\u306e\u30c7\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u307e\u3059\uff0e
@@ -146,24 +142,11 @@ column.header.studentsummary.grade=\u6210\u7e3e
 column.header.studentsummary.weight=\u52a0\u91cd
 column.header.studentsummary.comments=\u30b3\u30e1\u30f3\u30c8
 column.header.studentsummary.category=\u30ab\u30c6\u30b4\u30ea
-studentsummary.caption=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u6b04\uff0e\u5f97\u70b9\u3092\u542b\u3080\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u60c5\u5831\u5217\uff0e
-studentsummary.categoryrow=\u3053\u306e\u884c\u306f\u30ab\u30c6\u30b4\u30ea\u3092\u610f\u5473\u3057\u307e\u3059\uff0e\u76f4\u5f8c\u306e\u884c\u306f\u3053\u306e\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u3067\u3059\uff0e
-studentsummary.categoryaverage=\u3053\u306e\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u5f97\u70b9\u306b\u57fa\u3065\u304f\u8a08\u7b97\u3055\u308c\u305f\u5e73\u5747.
-studentsummary.categoryweight=\u3053\u306e\u91cd\u307f\u306f\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u3067\u3059\uff0e\u3053\u306e\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u5f97\u70b9\u306f\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u306b\u9069\u7528\u3055\u308c\u307e\u3059\uff0e
-studentsummary.categorytoggle=\u3053\u306e\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u8868\u793a/\u975e\u8868\u793a
-studentsummary.gradebookitem.score=\u3053\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306b\u5bfe\u3059\u308b\u5f97\u70b9
-studentsummary.gradebookitem.outof=\u5f97\u70b9\u304c\u3064\u3051\u3089\u308c\u308b\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u5408\u8a08\u70b9.
 importExport.export.heading=\u30a8\u30af\u30b9\u30dd\u30fc\u30c8
 importExport.export.description=\u6210\u7e3e/\u69cb\u9020\u3092\u304a\u597d\u304d\u306a\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u6210\u7e3e\u7c3f\u306b\u5165\u529b\u3059\u308b\u305f\u3081\u6210\u7e3e\u7c3f\u3092CSV\u30d5\u30a1\u30a4\u30eb\u3067\u30a8\u30ad\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff0e
-importExport.instructions.title=\u4f7f\u308f\u308c\u305f\u898f\u7d04
-importExport.instructions.summary=\u6b21\u306e\u898f\u7d04\u304c\u30a4\u30f3\u30dd\u30fc\u30c8/\u30a8\u30ad\u30b9\u30dd\u30fc\u30c8\u30d7\u30ed\u30bb\u30b9\u3067\u4f7f\u308f\u308c\u307e\u3059\uff1a
-importExport.instructions.1=\u5b66\u751fID\u304a\u3088\u3073\u5b66\u751f\u540d\u306f\u6700\u521d\u306e2\u5217\u3067\uff0c\u5c06\u6765\u7684\u306a\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u305f\u3081\u306b\u4fdd\u6301\u3055\u308c\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\uff0e
-importExport.instructions.2=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0/\u8ab2\u984c\u306f\u30bf\u30a4\u30c8\u30eb\u306b\u7d9a\u304f[ ] \u306b\u56f2\u307e\u308c\u305f\u70b9\u6570\u306b\u3088\u3063\u3066\u70b9\u6570\u3092\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff0e\u4f8b\uff1a"\u8ab2\u984c1[50]"
-importExport.instructions.3=\u30b3\u30e1\u30f3\u30c8\u306f\u6b04\u306b*\u3092\u63a5\u982d\u8f9e\u3068\u3057\u3066\u3064\u3051\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u307e\u3059\uff0e\u4f8b\uff1a"*\u8ab2\u984c1"\uff0e
-importExport.instructions.4=\u518d\u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u306a\u3044\u6b04\u306f\#\u3092\u63a5\u982d\u8f9e\u3068\u3057\u3066\u3064\u3051\u3089\u308c\u307e\u3059\uff0e
 importExport.import.heading=\u30a4\u30f3\u30dd\u30fc\u30c8
 importExport.import.description=\u4e0b\u306e\u6210\u7e3e\u7c3f\u306e\u7de8\u96c6\u6e08\u306eCSV\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u9078\u629e\u7684\u306b\u65b0\u305f\u306a\u6210\u7e3e/\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u3092\u6210\u7e3e\u7c3f\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff0e
-importExport.template.description=<strong>\u6ce8\u610f\:</strong> \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u5f62\u5f0f\u306f\u4e0b\u306b\u8a73\u7d30\u3092\u793a\u3059\u898f\u7d04\u306b\u5408\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\uff0e
+importExport.template.description=\u6ce8\u610f\uff1a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u5f62\u5f0f\u306f\u4e0a\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u53ef\u80fd\u306a\u6210\u7e3e\u7c3f\u30d5\u30a1\u30a4\u30eb\u306e\u898f\u7d04\u306b\u5408\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\uff0e
 importExport.template.button.fullGradebook=\u6210\u7e3e\u7c3f\u30a8\u30af\u30b9\u30dd\u30fc\u30c8
 importExport.template.button.customGradebook=\u30ab\u30b9\u30bf\u30e0\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9
 importExport.template.button.advancedOptions=\u30ab\u30b9\u30bf\u30e0\u30a8\u30af\u30b9\u30dd\u30fc\u30c8
@@ -178,20 +161,20 @@ importExport.selection.status=\u72b6\u614b
 importExport.selection.noneselected=\u3042\u306a\u305f\u306f\u5c11\u306a\u304f\u3068\u30821\u3064\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e
 importExport.createItem.heading=\u65b0\u305f\u306a\u30a2\u30a4\u30c6\u30e0\u4f5c\u6210({1}\u306e\u3046\u3061{0} )
 importExport.confirmation.heading=\u78ba\u8a8d
-importExport.confirmation.description=<strong>\u7d42\u4e86</strong>\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068, \u6b21\u306e\u64cd\u4f5c\u304c\u5b8c\u4e86\u3057\u307e\u3059\uff1a
-importExport.confirmation.update.heading=\u65e2\u5b58\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u4e2d\uff1a
+importExport.confirmation.description=<strong>\u7d42\u4e86</strong>\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068, \u6b21\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u64cd\u4f5c\u304c\u5b8c\u4e86\u3057\u307e\u3059\uff1a
+importExport.confirmation.update.heading=\u65e2\u5b58\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u30b9\u30b3\u30a2\u3092\u66f4\u65b0\u4e2d\uff1a
 importExport.confirmation.create.heading=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u3092\u4f5c\u6210\u4e2d\uff1a
 importExport.confirmation.modify.heading=\u65e2\u5b58\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u3092\u4fee\u6b63\u4e2d\uff1a
 importExport.confirmation.title=\u30bf\u30a4\u30c8\u30eb\:
 importExport.confirmation.points=\u70b9\u6570
-importExport.confirmation.commentsdisplay={0} (\u30b3\u30e1\u30f3\u30c8)
 importExport.confirmation.success=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u304c\u6b63\u5e38\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f\!
 importExport.confirmation.failure=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u4e2d\u306e\u30a8\u30e9\u30fc\uff0e
-importExport.status.UPDATE=\u66f4\u65b0
-importExport.status.NEW=\u65b0\u898f
-importExport.status.SKIP=\u5909\u66f4\u306a\u3057
-importExport.status.EXTERNAL=\u5916\u90e8
-importExport.status.MODIFIED=\u66f4\u65b0
+importExport.status.0=\u66f4\u65b0
+importExport.status.1=\u65b0\u898f
+importExport.status.2=\u5909\u66f4\u306a\u3057
+importExport.status.3=\u672a\u77e5
+importExport.status.4=\u958b\u59cb {0}
+importExport.status.5=\u66f4\u65b0
 importExport.button.continue=\u7d9a\u3051\u308b
 importExport.button.cancel=\u30ad\u30e3\u30f3\u30bb\u30eb
 importExport.button.back=\u623b\u308b
@@ -201,7 +184,7 @@ importExport.export.format.csv=CSV
 importExport.export.format.pdf=PDF
 importExport.export.format.excel=Excel
 importExport.export.advancedOption.description=\u6210\u7e3e\u7c3f\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u5834\u5408\u306f\u4e0b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304b\u3089\u9078\u629e\u3057\u307e\u3059\uff0e
-importExport.export.advancedOption.warning=\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3055\u308c\u305f\u30a8\u30ad\u30b9\u30dd\u30fc\u30c8\u306f\uff0c\u3082\u3057\u5b66\u751fID\u3068\u5b66\u751f\u540d\u304c1\u5217\u76ee\u30682\u5217\u76ee\u3067\u3042\u308a\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u898f\u7d04\u306b\u5f93\u3063\u3066\u3044\u308c\u3070\uff0c\u30b7\u30b9\u30c6\u30e0\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u623b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff0e
+importExport.export.advancedOption.warning=\u6ce8\u610f\uff1a\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u306f\u30b7\u30b9\u30c6\u30e0\u306b\u5165\u308c\u76f4\u3059\u3053\u3068\u304c<strong>\u3067\u304d\u307e\u305b\u3093\uff0e</strong> 
 importExport.export.advancedOption.exportFormat=\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8
 importExport.export.advancedOption.includeStudentName=\u53d7\u8b1b\u8005\u540d
 importExport.export.advancedOption.includePoints=\u5408\u8a08\u70b9
@@ -273,10 +256,7 @@ settingspage.gradeentry.heading=\u6210\u7e3e\u5165\u529b
 settingspage.graderelease.heading=\u6210\u7e3e\u767a\u8868\u30eb\u30fc\u30eb
 settingspage.categories.heading=\u30ab\u30c6\u30b4\u30ea\u53ca\u3073\u91cd\u307f\u4ed8\u3051
 settingspage.gradingschema.heading=\u6210\u7e3e\u30b9\u30ad\u30fc\u30de
-settingspage.gradingschema.chart.heading=\u30b3\u30fc\u30b9\u6210\u7e3e\u5206\u5e03
-settingspage.gradingschema.chart.xaxis=\u30b3\u30fc\u30b9\u6210\u7e3e
-settingspage.gradingschema.overrides=\u30b3\u30fc\u30b9\u6210\u7e3e\u306e\u4e0a\u66f8\u304d\u306f\u5206\u5e03\u56f3\u306b\u5f71\u97ff\u3059\u308b\u6b21\u306e\u5b66\u751f\u306b\u5b58\u5728\u3057\u307e\u3059\uff0e
-settingspage.gradeentry.instructions=\u6210\u7e3e\u3092\u3069\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u304b?
+settingspage.gradeentry.text=\u6210\u7e3e\u3092\u3069\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u304b?
 settingspage.gradeentry.points=\u70b9\u6570
 settingspage.gradeentry.percentages=\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8
 settingspage.graderelease.label=\u516c\u958b\u3055\u308c\u305f\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u3092\u5b66\u751f\u306b\u8868\u793a\u3059\u308b
@@ -299,9 +279,9 @@ settingspage.displaycoursegrade.incompatible=\u91cd\u307f\u4ed8\u3051\u30ab\u30c
 settingspage.categories.none=\u30ab\u30c6\u30b4\u30ea\u306a\u3057
 settingspage.categories.categoriesonly=\u30ab\u30c6\u30b4\u30ea\u3060\u3051
 settingspage.categories.categoriesweighting=\u30ab\u30c6\u30b4\u30ea\u53ca\u3073\u91cd\u307f\u4ed8\u3051
-settingspage.categories.drophighest=\u6700\u9ad8\u70b9\u3092\u9664\u5916
-settingspage.categories.droplowest=\u6700\u4f4e\u70b9\u3092\u9664\u5916
-settingspage.categories.keephighest=\u6700\u9ad8\u70b9\u3092\u63a1\u7528
+settingspage.categories.drophighest=\u6700\u9ad8\u70b9\u306e\u9664\u5916\u3092\u6709\u52b9\u5316
+settingspage.categories.droplowest=\u6700\u4f4e\u70b9\u306e\u9664\u5916\u3092\u6709\u52b9\u5316
+settingspage.categories.keephighest=\u6700\u9ad8\u70b9\u306e\u63a1\u7528\u3092\u6709\u52b9\u5316
 settingspage.categories.add=\u30ab\u30c6\u30b4\u30ea\u3092\u8ffd\u52a0
 settingspage.categories.items={0} \u4ef6
 settingspage.categories.categorycolhead=\u30ab\u30c6\u30b4\u30ea
@@ -313,17 +293,16 @@ settingspage.categories.droplowestcolhead=\u6700\u4f4e\u70b9\u3092\u9664\u5916
 settingspage.categories.keephighestcolhead=\u6700\u9ad8\u70b9\u3092\u63a1\u7528
 settingspage.categories.removecolhead=\u524a\u9664
 settingspage.categories.total=\u5408\u8a08\uff1a
-settingspage.categories.instructions.categoryvisibility=\u5c11\u306a\u304f\u3068\u3082\u3072\u3068\u3064\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u304c\u30ab\u30c6\u30b4\u30ea\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308c\u3070\uff0c\u30ab\u30c6\u30b4\u30ea\u306f\u8868\u793a\u3055\u308c\u307e\u3059\uff0e
-settingspage.categories.instructions.uncounteditems='\u30ab\u30c6\u30b4\u30ea\u53ca\u3073\u91cd\u307f\u4ed8\u3051'\u304c\u6709\u52b9\u3067\u3042\u308c\u3070\uff0c\u30ab\u30c6\u30b4\u30ea\u5316\u3055\u308c\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u306f\u30b3\u30fc\u30b9\u6210\u7e3e\u306b\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u305b\u3093\uff0e
-settingspage.categories.instructions.applydropkeep=\u6700\u9ad8\u70b9\u306e\u9664\u5916\uff0c\u6700\u4f4e\u70b9\u306e\u9664\u5916\uff0c\u304a\u3088\u3073\u6700\u9ad8\u70b9\u306e\u63a1\u7528\u3092\u9069\u7528\u3059\u308b\u306b\u306f\uff0c\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u3059\u3079\u3066\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u70b9\u6570\u306e\u5024\u304c\u540c\u3058\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e
-settingspage.categories.hover.dropkeepusage='\u6700\u9ad8\u70b9\u306e\u9664\u5916'/'\u6700\u4f4e\u70b9\u306e\u9664\u5916'\u306f'\u6700\u9ad8\u70b9\u306e\u63a1\u7528'\u3092\u3059\u308b\u540c\u3058\u30ab\u30c6\u30b4\u30ea\u3067\u306f\u4f7f\u3048\u307e\u305b\u3093\uff0e
-settingspage.categories.hover.categoriesweightingpoints='\u30ab\u30c6\u30b4\u30ea\u53ca\u3073\u91cd\u307f\u4ed8\u3051'\u306f'\u70b9\u6570'\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u8868\u793a\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u306e\u4e92\u63db\u6027\u304c\u3042\u308a\u307e\u305b\u3093\uff0e
+settingspage.categories.instructions.1=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u304c\u30ab\u30c6\u30b4\u30ea\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308c\u3070\uff0c\u30ab\u30c6\u30b4\u30ea\u306f\u8868\u793a\u3055\u308c\u307e\u3059\uff0e
+settingspage.categories.instructions.2=\u6700\u9ad8\u70b9\u306e\u9664\u5916\uff0c\u6700\u4f4e\u70b9\u306e\u9664\u5916\uff0c\u304a\u3088\u3073\u6700\u9ad8\u70b9\u306e\u63a1\u7528\u3092\u6709\u52b9\u5316\u3059\u308b\u306b\u306f\uff0c\u30ab\u30c6\u30b4\u30ea\u5185\u306e\u3059\u3079\u3066\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306e\u70b9\u6570\u306e\u5024\u304c\u540c\u3058\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e
+settingspage.categories.instructions.3=\u6700\u9ad8\u70b9\u306e\u9664\u5916\u3068\u6700\u9ad8\u70b9\u306e\u63a1\u7528\uff0c\u6700\u4f4e\u70b9\u306e\u9664\u5916\u3068\u6700\u9ad8\u70b9\u306e\u63a1\u7528\u306f\u76f8\u4e92\u306b\u6392\u4ed6\u7684\u3067\u4f75\u7528\u3067\u304d\u307e\u305b\u3093\uff0e
+settingspage.categories.instructions.4=\u7279\u5225\u70b9\u306e\u30ab\u30c6\u30b4\u30ea\u306f\u5168\u4f53\u306e\u91cd\u307f\u4ed8\u3051\u306b\u95a2\u4fc2\u3057\u307e\u305b\u3093\uff0e
+settingspage.categories.instructions.5=\u6700\u7d42\u30b3\u30fc\u30b9\u6210\u7e3e\u304c '\u70b9\u6570'\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408 '\u30ab\u30c6\u30b4\u30ea\u304a\u3088\u3073\u91cd\u307f\u4ed8\u3051' \u306f\u9078\u629e\u3067\u304d\u307e\u305b\u3093\uff0e 
+settingspage.categories.instructions.6='\u30ab\u30c6\u30b4\u30ea\u53ca\u3073\u91cd\u307f\u4ed8\u3051'\u304c\u6709\u52b9\u3067\u3042\u308c\u3070\uff0c\u30ab\u30c6\u30b4\u30ea\u5316\u3055\u308c\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u306f\u81ea\u52d5\u7684\u306b\u30b3\u30fc\u30b9\u6210\u7e3e\u304b\u3089\u9664\u5916\u3055\u308c\u307e\u3059\uff0e
 settingspage.categories.runningtotalerror=\u30ab\u30c6\u30b4\u30ea\u306e\u91cd\u307f\u4ed8\u3051\u306f100%\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093
 settingspage.gradingschema.type=\u8a55\u5b9a\u30bf\u30a4\u30d7
 settingspage.gradingschema.grade=\u6210\u7e3e
 settingspage.gradingschema.minpercent=\u6700\u4f4e %
-settingspage.gradingschema.refresh=\u6210\u7e3e\u7c3f\u30bf\u30a4\u30d7\u304b\u6700\u4f4e%\u306b\u5909\u66f4\u3092\u52a0\u3048\u308b\u3068\uff0c'\u5909\u66f4\u3092\u4fdd\u5b58'\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u5f8c\uff0c\u56f3\u304c\u66f4\u65b0\u3055\u308c\u307e\u3059\uff0e
-settingspage.gradingschema.emptychart=\u30b3\u30fc\u30b9\u6210\u7e3e\u306b\u5b66\u751f\u304c\u3044\u307e\u305b\u3093\uff0e
 settingspage.update.success=\u8a2d\u5b9a\u304c\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\uff0e
 settingspage.update.failure.categorymissingweight=\u30ab\u30c6\u30b4\u30ea\u306b\u91cd\u307f\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u304c\uff0c\u91cd\u307f\u4ed8\u3051\u306f\u6709\u52b9\u3067\u3059
 settingspage.update.failure.categoryweighttotals=\u30ab\u30c6\u30b4\u30ea\u306e\u91cd\u307f\u4ed8\u3051\u306f100%\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093
@@ -346,7 +325,6 @@ permissionspage.function.view=\u8868\u793a\:
 permissionspage.function.grade=\u6210\u7e3e
 permissionspage.allgradeitems=\u3059\u3079\u3066\u306e\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0
 permissionspage.update.success=\u6a29\u9650\u304c\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\uff0e
-permissionspage.update.dupes=\u6ce8\u610f\uff1a\u4e00\u3064\u4ee5\u4e0a\u306e\u91cd\u8907\u3057\u305f\u6a29\u9650\u304c\u691c\u77e5\u3055\u308c\uff0c\u524a\u9664\u3055\u308c\u307e\u3057\u305f\uff0e
 no-assignments.label=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\uff0e
 no-students.label=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u306b\u53d7\u8b1b\u751f\u304c\u3044\u307e\u305b\u3093\uff0e
 gradebookpage.uncategorised=\u30ab\u30c6\u30b4\u30ea\u5316\u3055\u308c\u3066\u3044\u307e\u305b\u3093
@@ -364,14 +342,7 @@ label.statistics.deviation=\u6a19\u6e96\u504f\u5dee
 label.statistics.chart.extracredit=EC
 label.statistics.chart.xaxis=\u63a1\u70b9\u6e08\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8
 label.statistics.chart.yaxis=\u5b66\u751f\u6570
-label.statistics.chart.tooltip=\ {1} \u7bc4\u56f2\u5185\u306b\u3042\u308b\u5f97\u70b9{2}
-label.statistics.coursegrade.averagegpa=\u5e73\u5747GPA
-label.statistics.coursegrade.average=\u5e73\u5747\u6210\u7e3e
-label.statistics.coursegrade.graded=\u5168\u63a1\u70b9\u6e08\u5b66\u751f
-label.statistics.coursegrade.median=\u4e2d\u592e\u306e\u6210\u7e3e
-label.statistics.coursegrade.lowest=\u6700\u4f4e\u5f97\u70b9
-label.statistics.coursegrade.highest=\u6700\u9ad8\u5f97\u70b9
-label.statistics.coursegrade.deviation=\u6a19\u6e96\u504f\u5dee
+label.statistics.chart.tooltip=\ {1}%\u7bc4\u56f2\u5185\u306b\u3042\u308b\u5f97\u70b9{2}
 coursegrade.option.override=\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u4e0a\u66f8\u304d
 coursegrade.option.overridelog=\u30b3\u30fc\u30b9\u6210\u7e3e\u3092\u4e0a\u66f8\u304d\u3057\u305f\u30ed\u30b0
 coursegrade.option.setungraded=\u7a7a\u767d\u306e\u30bb\u30eb\u306b\u96f6\u70b9\u3092\u8a2d\u5b9a
@@ -416,8 +387,7 @@ importExport.error.empty=\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\
 importExport.error.commentnoitem=\u30b3\u30e1\u30f3\u30c8\u6b04\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u304c\u5bfe\u5fdc\u3059\u308b\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff0e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\uff0e
 importExport.error.pointsmodification=\u6210\u7e3e\u7c3f\u30a2\u30a4\u30c6\u30e0''{0}''\u306e\u70b9\u6570\u3092\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\uff0e
 importExport.error.unknown=\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u3042\u308a\u307e\u3057\u305f\uff0e\u518d\u5ea6\u8a66\u3059\u304bIT\u30b5\u30dd\u30fc\u30c8\u306b\u9023\u7d61\u3057\u3066\u4e0b\u3055\u3044\uff0e
+importExport.error.unknownstudent=\u53d7\u8b1b\u8005\u304c\u30a4\u30f3\u30dd\u30fc\u30c8\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u304c\u30b5\u30a4\u30c8\u306b\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff0e
 importExport.error.duplicatecolumn=\u91cd\u8907\u3059\u308b\u30ab\u30e9\u30e0\u304c\u30d5\u30a1\u30a4\u30eb\u306b\u898b\u3064\u304b\u308a\u307e\u3057\u305f\uff0e
 importExport.selection.hideitems=\u5909\u66f4\u306e\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u3092\u975e\u8868\u793a
 importExport.selection.hideitemsallhidden=\u5909\u66f4\u306e\u3042\u308b\u30a4\u30f3\u30dd\u30fc\u30c8\u3055\u308c\u305f\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\uff0e
-error.role=\u3053\u306e\u30b5\u30a4\u30c8\u306e\u6a29\u9650\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff0e \u3053\u306e\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u524d\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u305f section.role.x permissions \u306e\u3072\u3068\u3064\u3092\u3082\u3063\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e
-ta.null=\u63a1\u70b9\u8005\u3092\u9078\u629e
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/GradebookNgBusinessService.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/GradebookNgBusinessService.java
index 60f9eec852..8297466a15 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/GradebookNgBusinessService.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/GradebookNgBusinessService.java
@@ -60,12 +60,17 @@ import org.sakaiproject.service.gradebook.shared.SortType;
 import org.sakaiproject.site.api.Group;
 import org.sakaiproject.site.api.Site;
 import org.sakaiproject.site.api.SiteService;
+import org.sakaiproject.tool.api.Tool;
 import org.sakaiproject.tool.api.ToolManager;
 import org.sakaiproject.tool.gradebook.Gradebook;
 import org.sakaiproject.tool.gradebook.GradingEvent;
 import org.sakaiproject.user.api.User;
+import org.sakaiproject.user.api.UserAlreadyDefinedException;
 import org.sakaiproject.user.api.UserDirectoryService;
+import org.sakaiproject.user.api.UserEdit;
+import org.sakaiproject.user.api.UserLockedException;
 import org.sakaiproject.user.api.UserNotDefinedException;
+import org.sakaiproject.user.api.UserPermissionException;
 import org.sakaiproject.util.ResourceLoader;
 
 import lombok.Setter;
@@ -119,7 +124,7 @@ public class GradebookNgBusinessService {
 	private ServerConfigurationService serverConfigurationService;
 
 	public static final String ASSIGNMENT_ORDER_PROP = "gbng_assignment_order";
-	public static final String ICON_SAKAI = "icon-sakai--";
+	public static final String ICON_SAKAI = "icon-"; // FIXME this is different in 11.x vs 12.x!
 
 	/**
 	 * Get a list of all users in the current site that can have grades
@@ -248,21 +253,13 @@ public class GradebookNgBusinessService {
 	 * @return the gradebook for the site
 	 */
 	private Gradebook getGradebook(final String siteId) {
-		Gradebook gradebook = null;
 		try {
-			gradebook = (Gradebook) this.gradebookService.getGradebook(siteId);
+			final Gradebook gradebook = (Gradebook) this.gradebookService.getGradebook(siteId);
+			return gradebook;
 		} catch (final GradebookNotFoundException e) {
-			log.debug("Request made for inaccessible, adding gradebookUid=" + siteId);
-			this.gradebookFrameworkService.addGradebook(siteId,siteId);
-			try {
-				gradebook = (Gradebook) this.gradebookService.getGradebook(siteId);
-			} catch (GradebookNotFoundException e2) {
-				log.error("Request made and could not add inaccessible gradebookUid=" + siteId);
-			}
+			log.error("No gradebook in site: " + siteId);
+			return null;
 		}
-
-		log.error("No gradebook in site: " + siteId);
-		return gradebook;
 	}
 
 	/**
@@ -514,9 +511,12 @@ public class GradebookNgBusinessService {
 		String newGradeAdjusted = newGrade;
 		String oldGradeAdjusted = oldGrade;
 		String storedGradeAdjusted = storedGrade;
-		if(StringUtils.isNotBlank(storedGradeAdjusted)){
-			//Fix a problem when the grades comes from the old Gradebook API with locale separator, always compare the values using the same separator
+
+		//Fix a problem when the grades comes from the old Gradebook API with locale separator, always compare the values using the same separator
+		if (StringUtils.isNotBlank(oldGradeAdjusted)) {
 			oldGradeAdjusted = oldGradeAdjusted.replace(newGradeAdjusted.contains(",") ? "." : ",", newGradeAdjusted.contains(",") ? "," : ".");
+		}
+		if(StringUtils.isNotBlank(storedGradeAdjusted)){
 			storedGradeAdjusted = storedGradeAdjusted.replace(newGradeAdjusted.contains(",") ? "." : ",", newGradeAdjusted.contains(",") ? "," : ".");
 		}
 
@@ -1194,12 +1194,11 @@ public class GradebookNgBusinessService {
 	 *
 	 * @param assignmentId the assignment we are reordering
 	 * @param order the new order
-	 * @throws JAXBException
 	 * @throws IdUnusedException
 	 * @throws PermissionException
 	 */
 	public void updateAssignmentCategorizedOrder(final long assignmentId, final int order)
-			throws JAXBException, IdUnusedException, PermissionException {
+			throws IdUnusedException, PermissionException {
 		final String siteId = getCurrentSiteId();
 		updateAssignmentCategorizedOrder(siteId, assignmentId, order);
 	}
@@ -1524,8 +1523,19 @@ public class GradebookNgBusinessService {
 	 * @return the comment or null if none
 	 */
 	public String getAssignmentGradeComment(final long assignmentId, final String studentUuid) {
+		return getAssignmentGradeComment(getCurrentSiteId(), assignmentId, studentUuid);
+	}
 
-		final String siteId = getCurrentSiteId();
+
+	/**
+	 * Get the comment for a given student assignment grade
+	 *
+	 * @param siteId site id
+	 * @param assignmentId id of assignment
+	 * @param studentUuid uuid of student
+	 * @return the comment or null if none
+	 */
+	public String getAssignmentGradeComment(final String siteId, final long assignmentId, final String studentUuid) {
 		final Gradebook gradebook = getGradebook(siteId);
 
 		try {
@@ -1540,6 +1550,7 @@ public class GradebookNgBusinessService {
 		return null;
 	}
 
+
 	/**
 	 * Update (or set) the comment for a student's assignment
 	 *
@@ -1931,12 +1942,22 @@ public class GradebookNgBusinessService {
 	 * @return true if ja, false if nay.
 	 */
 	public boolean isUserRoleSwapped() {
+
+		final String siteId = getCurrentSiteId();
+
 		try {
-			return securityService.isUserRoleSwapped();
+			final Site site = this.siteService.getSite(siteId);
+
+			// they are roleswapped if they have an 'effective role'
+			final String effectiveRole = this.securityService.getUserEffectiveRole(site.getReference());
+			if (StringUtils.isNotBlank(effectiveRole)) {
+				return true;
+			}
 		} catch (final IdUnusedException e) {
 			// something has happened between getting the siteId and getting the site.
 			throw new GbException("An error occurred checking some bits and pieces, please try again.", e);
 		}
+		return false;
 	}
 
 	/**
@@ -1946,15 +1967,65 @@ public class GradebookNgBusinessService {
 	 */
 	public String getIconClass(final Assignment assignment) {
 		final String externalAppName = assignment.getExternalAppName();
-		String iconClass = ICON_SAKAI + "default-tool";
+		String iconClass = getDefaultIconClass();
 		if (StringUtils.equals(externalAppName, "Assignments")) {
-			iconClass = ICON_SAKAI + "sakai-assignment-grades";
+			iconClass = getAssignmentsIconClass();
 		} else if (StringUtils.equals(externalAppName, "Tests & Quizzes")) {
-			iconClass = ICON_SAKAI + "sakai-samigo";
+			iconClass = getSamigoIconClass();
 		} else if (StringUtils.equals(externalAppName, "Lesson Builder")) {
-			iconClass = ICON_SAKAI + "sakai-lessonbuildertool";
+			iconClass = getLessonBuilderIconClass();
 		}
 		return iconClass;
 	}
 
+
+	/**
+	 * Helper to determine the icon class for possible external app names
+	 * @return
+	 */
+	public Map<String, String> getIconClassMap() {
+		Map<String, String> mapping = new HashMap<>();
+
+		Tool assignment = toolManager.getTool("sakai.assignment.grades");
+		if (assignment != null) {
+			mapping.put(assignment.getTitle(), getAssignmentsIconClass());
+		}
+
+		Tool samigo = toolManager.getTool("sakai.samigo");
+		if (samigo != null) {
+			mapping.put(samigo.getTitle(), getSamigoIconClass());
+		}
+
+		mapping.put("Lesson Builder", getLessonBuilderIconClass());
+
+		return mapping;
+	}
+
+
+	public String getDefaultIconClass() {
+		return ICON_SAKAI + "default-tool fa fa-globe";
+	}
+
+	private String getAssignmentsIconClass() {
+		return ICON_SAKAI + "sakai-assignment-grades";
+	}
+
+	private String getSamigoIconClass() {
+		return ICON_SAKAI + "sakai-samigo";
+	}
+
+	private String getLessonBuilderIconClass() {
+		return ICON_SAKAI + "sakai-lessonbuildertool";
+	}
+
+	// NYU Methods
+	public UserEdit editCurrentUser() throws UserNotDefinedException, UserPermissionException, UserLockedException {
+		return this.userDirectoryService.editUser(getCurrentUser().getId());
+	}
+
+	public void saveUser(UserEdit user) throws UserAlreadyDefinedException {
+		if (user.getId().equals(getCurrentUser().getId())) {
+			this.userDirectoryService.commitEdit(user);
+		}
+	}
 }
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java
index 626b2fd116..7550e156a7 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/FormatHelper.java
@@ -4,8 +4,11 @@ import java.math.BigDecimal;
 import java.math.RoundingMode;
 import java.text.DecimalFormat;
 import java.text.NumberFormat;
+import java.text.ParseException;
 import java.text.SimpleDateFormat;
+import java.util.ArrayList;
 import java.util.Date;
+import java.util.List;
 
 import lombok.extern.slf4j.Slf4j;
 import org.apache.commons.lang.StringUtils;
@@ -37,13 +40,23 @@ public class FormatHelper {
 	 * @return double to n decimal places
 	 */
 	private static String formatDoubleToDecimal(final Double score, final int n) {
-		final NumberFormat df = NumberFormat.getInstance();
-		df.setMinimumFractionDigits(0);
-		df.setMaximumFractionDigits(n);
-		df.setGroupingUsed(false);
-		df.setRoundingMode(RoundingMode.HALF_DOWN);
-
-		return formatGrade(df.format(score));
+		// Rounding is problematic due to the use of Doubles in
+		// Gradebook.  A number like 89.065 (which can be produced by
+		// weighted categories, for example) is stored as the double
+		// 89.06499999999999772626324556767940521240234375.  If you
+		// naively round this to two decimal places, you get 89.06 when
+		// you wanted 89.07
+		//
+		// Payten devised a clever trick of rounding to some larger
+		// decimal places first, which rounds these numbers up to
+		// something more manageable.  For example, if you round the
+		// above to 10 places, you get 89.0650000000, which rounds
+		// correctly when rounded up to 2 places.
+
+		return formatGrade(new BigDecimal(score)
+				.setScale(10, RoundingMode.HALF_UP)
+				.setScale(n, RoundingMode.HALF_UP)
+				.toString());
 	}
 
 	/**
@@ -86,7 +99,7 @@ public class FormatHelper {
 			return null;
 		}
 
-		final BigDecimal decimal = new BigDecimal(string).setScale(2, RoundingMode.HALF_DOWN);
+		final BigDecimal decimal = new BigDecimal(string).setScale(2, RoundingMode.HALF_UP);
 
 		return formatDoubleAsPercentage(decimal.doubleValue());
 	}
@@ -104,9 +117,9 @@ public class FormatHelper {
 
 		String s = null;
 		try {
-			final Double d = Double.parseDouble(grade);
-
 			final DecimalFormat df = (DecimalFormat) NumberFormat.getInstance(rl.getLocale());
+			final Double d = df.parse(grade).doubleValue();
+
 			df.setMinimumFractionDigits(0);
 			df.setGroupingUsed(false);
 
@@ -114,6 +127,9 @@ public class FormatHelper {
 		} catch (final NumberFormatException e) {
 			log.debug("Bad format, returning original string: " + grade);
 			s = grade;
+		} catch (final ParseException e) {
+			log.debug("Bad format, returning original string: " + grade);
+			s = grade;
 		}
 
 		return StringUtils.removeEnd(s, ".0");
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/ImportGradesHelper.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/ImportGradesHelper.java
index 6eea01ef20..8ed952c9cd 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/ImportGradesHelper.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/business/util/ImportGradesHelper.java
@@ -52,8 +52,11 @@ public class ImportGradesHelper {
 	public final static int USER_NAME_POS = 1;
 
 	// patterns for detecting column headers and their types
-	final static Pattern ASSIGNMENT_COMMENT_PATTERN = Pattern.compile("\\* (.*)$");
-	final static Pattern ASSIGNMENT_WITH_POINTS_PATTERN = Pattern.compile("^(.*) \\[([0-9]+(\\.[0-9][0-9]?)?)\\] *$");
+	final static Pattern ASSIGNMENT_WITH_POINTS_PATTERN = Pattern.compile("([^\\*\\[\\]\\*]+\\[[0-9]+(\\.[0-9][0-9]?)?\\])");
+	final static Pattern ASSIGNMENT_COMMENT_PATTERN = Pattern.compile("(\\* .*)");
+	final static Pattern STANDARD_HEADER_PATTERN = Pattern.compile("([^\\*\\$\\[\\]\\*]+)");
+	final static Pattern POINTS_PATTERN = Pattern.compile("(\\d+)(\\.\\d+)?(?=]$)");
+	final static Pattern IGNORE_PATTERN = Pattern.compile("^(\\#.+)");
 
 	// list of mimetypes for each category. Must be compatible with the parser
 	private static final String[] XLS_MIME_TYPES = { "application/vnd.ms-excel", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" };
@@ -561,58 +564,60 @@ public class ImportGradesHelper {
 
 		final ImportedColumn column = new ImportedColumn();
 
-		if (headerValue.startsWith("#")) {
+		final Matcher m3 = IGNORE_PATTERN.matcher(headerValue);
+		if (m3.matches()) {
 			log.info("Found header: " + headerValue + " but ignoring it as it is prefixed with a #.");
 			column.setType(ImportedColumn.Type.IGNORE);
 			return column;
 		}
 
-		// Comment lines start with a "* "
-		Matcher m = ASSIGNMENT_COMMENT_PATTERN.matcher(headerValue);
-		if (m.matches()) {
+		// assignment with points header
+		final Matcher m1 = ASSIGNMENT_WITH_POINTS_PATTERN.matcher(headerValue);
+		if (m1.matches()) {
+
+			// extract title and score
+			final Matcher titleMatcher = STANDARD_HEADER_PATTERN.matcher(headerValue);
+			final Matcher pointsMatcher = POINTS_PATTERN.matcher(headerValue);
+
+			if (titleMatcher.find()) {
+				column.setColumnTitle(trim(titleMatcher.group()));
+			}
+			if (pointsMatcher.find()) {
+				column.setPoints(pointsMatcher.group());
+			}
+
+			column.setType(ImportedColumn.Type.GB_ITEM_WITH_POINTS);
+
+			return column;
+		}
+
+		final Matcher m2 = ASSIGNMENT_COMMENT_PATTERN.matcher(headerValue);
+		if (m2.matches()) {
 
 			// extract title
-			columnSetColumnTitle(headerValue, m.group(1), column);
+			final Matcher titleMatcher = STANDARD_HEADER_PATTERN.matcher(headerValue);
+
+			if (titleMatcher.find()) {
+				column.setColumnTitle(trim(titleMatcher.group()));
+			}
 			column.setType(ImportedColumn.Type.COMMENTS);
 
 			return column;
 		}
 
-		// assignment with points header - ends with a "[nn.nn]"
-		m = ASSIGNMENT_WITH_POINTS_PATTERN.matcher(headerValue);
-		if (m.matches()) {
+		final Matcher m4 = STANDARD_HEADER_PATTERN.matcher(headerValue);
+		if (m4.matches()) {
 
-			// extract title and score
-			columnSetColumnTitle(headerValue, m.group(1), column);
-			column.setPoints(m.group(2));
-			column.setType(ImportedColumn.Type.GB_ITEM_WITH_POINTS);
+			column.setColumnTitle(headerValue);
+			column.setType(ImportedColumn.Type.GB_ITEM_WITHOUT_POINTS);
 
 			return column;
 		}
 
 
-		// It's a standard columm
-		columnSetColumnTitle(headerValue, headerValue, column);
-		column.setType(ImportedColumn.Type.GB_ITEM_WITHOUT_POINTS);
+		// if we got here, couldn't parse the column header, throw an error
+		throw new GbImportExportInvalidColumnException("Invalid column header: " + headerValue);
 
-		return column;
-	}
-
-	/**
-	 * Helper to set a column title or raise an exception if empty
-	 * @param headerValue
-	 * @param title
-	 * @param column
-	 */
-	private static void columnSetColumnTitle(String headerValue, String title, ImportedColumn column)
-	{
-		title = trim(title);
-		if(title == null)
-		{
-			// Empty column title is invalid
-			throw new GbImportExportInvalidColumnException("Invalid column header: " + headerValue);
-		}
-		column.setColumnTitle(title);
 	}
 
 	/**
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/rest/GradebookNgEntityProvider.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/rest/GradebookNgEntityProvider.java
index 65ea9ea2f7..096700e973 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/rest/GradebookNgEntityProvider.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/rest/GradebookNgEntityProvider.java
@@ -7,6 +7,8 @@ import java.util.Map;
 import org.apache.commons.lang.StringUtils;
 import org.apache.commons.lang.math.NumberUtils;
 import org.sakaiproject.authz.api.SecurityService;
+import org.sakaiproject.entity.api.ResourceProperties;
+import org.sakaiproject.entity.api.ResourcePropertiesEdit;
 import org.sakaiproject.entitybroker.EntityReference;
 import org.sakaiproject.entitybroker.EntityView;
 import org.sakaiproject.entitybroker.entityprovider.annotations.EntityCustomAction;
@@ -17,6 +19,7 @@ import org.sakaiproject.entitybroker.entityprovider.capabilities.Outputable;
 import org.sakaiproject.entitybroker.entityprovider.extension.Formats;
 import org.sakaiproject.entitybroker.util.AbstractEntityProvider;
 import org.sakaiproject.exception.IdUnusedException;
+import org.sakaiproject.exception.InUseException;
 import org.sakaiproject.exception.PermissionException;
 import org.sakaiproject.gradebookng.business.GbRole;
 import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
@@ -26,6 +29,11 @@ import org.sakaiproject.site.api.SiteService;
 import org.sakaiproject.tool.api.SessionManager;
 
 import lombok.Setter;
+import org.sakaiproject.user.api.Preferences;
+import org.sakaiproject.user.api.PreferencesEdit;
+import org.sakaiproject.user.api.User;
+import org.sakaiproject.user.api.UserEdit;
+import org.sakaiproject.user.cover.PreferencesService;
 
 /**
  * This entity provider is to support some of the Javascript front end pieces. It never was built to support third party access, and never
@@ -40,6 +48,10 @@ public class GradebookNgEntityProvider extends AbstractEntityProvider implements
 		AutoRegisterEntityProvider, ActionsExecutable,
 		Outputable, Describeable {
 
+	private static final String PREF_GRADEBOOK_PROPERTY = "sakai:gradebookng";
+	private static final String PREF_GRADEBOOK_WELCOME_DISMISSED_PROPERTY = "gradebookng-help-popup-dismissed";
+	private static final String PREF_GRADEBOOK_WELCOME_DISMISSED_VALUE = "true";
+
 	@Override
 	public String[] getHandledOutputFormats() {
 		return new String[] { Formats.JSON };
@@ -149,6 +161,27 @@ public class GradebookNgEntityProvider extends AbstractEntityProvider implements
 		return "pong";
 	}
 
+
+	@EntityCustomAction(action = "comments", viewKey = EntityView.VIEW_LIST)
+	public String getComments(final EntityView view, final Map<String, Object> params) {
+		// get params
+		final String siteId = (String) params.get("siteId");
+		final long assignmentId = NumberUtils.toLong((String) params.get("assignmentId"));
+		final String studentUuid = (String) params.get("studentUuid");
+
+		// check params supplied are valid
+		if (StringUtils.isBlank(siteId) || assignmentId == 0 || StringUtils.isBlank(studentUuid)) {
+			throw new IllegalArgumentException(
+				"Request data was missing / invalid");
+		}
+
+		checkValidSite(siteId);
+		checkInstructorOrTA(siteId);
+
+		return this.businessService.getAssignmentGradeComment(siteId, assignmentId, studentUuid);
+	}
+
+
 	/**
 	 * Helper to check if the user is an instructor. Throws IllegalArgumentException if not. We don't currently need the value that this
 	 * produces so we don't return it.
@@ -245,4 +278,73 @@ public class GradebookNgEntityProvider extends AbstractEntityProvider implements
 	@Setter
 	private GradebookNgBusinessService businessService;
 
-}
+
+	// CLASSES-2716 endpoints to support a instructional popover
+	@EntityCustomAction(action = "show-help-popup", viewKey = EntityView.VIEW_LIST)
+	public String shouldShowHelpPopup(final EntityView view, final Map<String, Object> params) {
+		final String siteId = (String) params.get("siteId");
+
+		if (StringUtils.isBlank(siteId)) {
+			throw new IllegalArgumentException("Site ID must be set");
+		}
+
+		checkValidSite(siteId);
+		checkInstructorOrTA(siteId);
+
+		User user = this.businessService.getCurrentUser();
+
+		// nothing for the admin user please
+		if ("admin".equals(user.getId())) {
+			return "false";
+		}
+
+		Preferences prefs = PreferencesService.getPreferences(user.getId());
+		ResourceProperties properties = prefs.getProperties(PREF_GRADEBOOK_PROPERTY);
+
+		String dismissed = (String) properties.get(PREF_GRADEBOOK_WELCOME_DISMISSED_PROPERTY);
+		if (PREF_GRADEBOOK_WELCOME_DISMISSED_VALUE.equals(dismissed)) {
+			return "false";
+		} else {
+			return "true";
+		}
+	}
+
+	@EntityCustomAction(action = "dismiss-help-popup", viewKey = EntityView.VIEW_NEW)
+	public void dismissHelpPopup(final EntityReference ref, final Map<String, Object> params) {
+		final String siteId = (String) params.get("siteId");
+
+		if (StringUtils.isBlank(siteId)) {
+			throw new IllegalArgumentException("Site ID must be set");
+		}
+
+		checkValidSite(siteId);
+		checkInstructorOrTA(siteId);
+
+		try {
+			User user = this.businessService.getCurrentUser();
+
+			// we don't do this for the admin user
+			if (!"admin".equals(user.getId())) {
+				PreferencesEdit edit = getOrCreatePreferences(user.getId());
+				ResourcePropertiesEdit properties = edit.getPropertiesEdit(PREF_GRADEBOOK_PROPERTY);
+				properties.addProperty(PREF_GRADEBOOK_WELCOME_DISMISSED_PROPERTY, PREF_GRADEBOOK_WELCOME_DISMISSED_VALUE);
+				PreferencesService.commit(edit);
+			}
+		} catch (Exception e) {
+			e.printStackTrace();
+			throw new RuntimeException("Unable to set popup dismissal for user");
+		}
+	}
+
+	private static PreferencesEdit getOrCreatePreferences(String userId) throws PermissionException, InUseException {
+		try {
+			return PreferencesService.edit(userId);
+		} catch (IdUnusedException e) {
+			try {
+				return PreferencesService.add(userId);
+			} catch (Exception e2) {
+				throw new RuntimeException("Unable to get preferences for user: " + userId);
+			}
+		}
+	}
+}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/Action.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/Action.java
new file mode 100644
index 0000000000..23a210936c
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/Action.java
@@ -0,0 +1,8 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+
+public interface Action {
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target);
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ActionResponse.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ActionResponse.java
new file mode 100644
index 0000000000..b36f38ab88
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ActionResponse.java
@@ -0,0 +1,7 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+public interface ActionResponse {
+    public String getStatus();
+
+    public String toJson();
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ArgumentErrorResponse.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ArgumentErrorResponse.java
new file mode 100644
index 0000000000..91517c92dc
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ArgumentErrorResponse.java
@@ -0,0 +1,17 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+public class ArgumentErrorResponse implements ActionResponse {
+    private String msg;
+
+    public ArgumentErrorResponse(final String msg) {
+            this.msg = msg;
+        }
+
+    public String getStatus() {
+            return "error";
+        }
+
+    public String toJson() {
+            return String.format("{\"msg\": \"%s\"}", msg);
+        }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/DeleteAssignmentAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/DeleteAssignmentAction.java
new file mode 100644
index 0000000000..2a00bf13ba
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/DeleteAssignmentAction.java
@@ -0,0 +1,38 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.DeleteItemPanel;
+
+import java.io.Serializable;
+
+public class DeleteAssignmentAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public DeleteAssignmentAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String assignmentId = params.get("assignmentId").asText();
+
+        final GradebookPage gradebookPage = (GradebookPage)target.getPage();
+        final GbModalWindow window = gradebookPage.getDeleteItemWindow();
+
+        window.setTitle(gradebookPage.getString("delete.label"));
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setContent(new DeleteItemPanel(
+            window.getContentId(),
+            Model.of(Long.valueOf(assignmentId)),
+            window));
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditAssignmentAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditAssignmentAction.java
new file mode 100644
index 0000000000..82c2b4ccc1
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditAssignmentAction.java
@@ -0,0 +1,41 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.AddOrEditGradeItemPanel;
+
+import java.io.Serializable;
+
+public class EditAssignmentAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    @SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+    private GradebookNgBusinessService businessService;
+
+    public EditAssignmentAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String assignmentId = params.get("assignmentId").asText();
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getAddOrEditGradeItemWindow();
+        window.setTitle(gradebookPage.getString("heading.editgradeitem"));
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setContent(new AddOrEditGradeItemPanel(window.getContentId(),
+                                                      window,
+                                                      Model.of(Long.valueOf(assignmentId))));
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditCommentAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditCommentAction.java
new file mode 100644
index 0000000000..54a53d9d04
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditCommentAction.java
@@ -0,0 +1,76 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.EditGradeCommentPanel;
+
+import java.io.Serializable;
+import java.util.HashMap;
+import java.util.Map;
+
+public class EditCommentAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public EditCommentAction() {
+    }
+
+    private class EmptyOkResponse implements ActionResponse {
+        public EmptyOkResponse() {
+        }
+
+        public String getStatus() {
+            return "OK";
+        }
+
+        public String toJson() {
+            return "{}";
+        }
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String assignmentId = params.get("assignmentId").asText();
+        String studentUuid = params.get("studentId").asText();
+
+        Map<String, Object> model = new HashMap<>();
+        model.put("assignmentId", Long.valueOf(assignmentId));
+        model.put("studentUuid", studentUuid);
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getGradeCommentWindow();
+
+        final EditGradeCommentPanel panel = new EditGradeCommentPanel(
+            window.getContentId(),
+            Model.ofMap(model),
+            window);
+
+        window.setContent(panel);
+        window.showUnloadConfirmation(false);
+        window.clearWindowClosedCallbacks();
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setStudentToReturnFocusTo(studentUuid);
+        window.addWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
+            private static final long serialVersionUID = 1L;
+
+            @Override
+            public void onClose(final AjaxRequestTarget target) {
+                String comment = panel.getComment();
+
+                target.appendJavaScript(
+                    String.format("GbGradeTable.updateComment('%s', '%s', '%s');",
+                        assignmentId,
+                        studentUuid,
+                        comment == null ? "" : comment));
+            }
+        });
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditSettingsAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditSettingsAction.java
new file mode 100644
index 0000000000..916760eed7
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EditSettingsAction.java
@@ -0,0 +1,36 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.tool.pages.SettingsPage;
+
+import java.io.Serializable;
+
+public class EditSettingsAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public EditSettingsAction() {
+    }
+
+    private class EmptyOkResponse implements ActionResponse {
+        public EmptyOkResponse() {
+        }
+
+        public String getStatus() {
+            return "OK";
+        }
+
+        public String toJson() {
+            return "{}";
+        }
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        target.getPage().setResponsePage(SettingsPage.class);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EmptyOkResponse.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EmptyOkResponse.java
new file mode 100644
index 0000000000..3eb5187945
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/EmptyOkResponse.java
@@ -0,0 +1,16 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+class EmptyOkResponse implements ActionResponse {
+    public EmptyOkResponse() {
+    }
+
+    @Override
+    public String getStatus() {
+        return "OK";
+    }
+
+    @Override
+    public String toJson() {
+        return "{}";
+    }
+}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/GradeUpdateAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/GradeUpdateAction.java
new file mode 100644
index 0000000000..8d44842423
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/GradeUpdateAction.java
@@ -0,0 +1,170 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import java.io.Serializable;
+import com.fasterxml.jackson.databind.JsonNode;
+
+import org.apache.commons.lang.StringUtils;
+import org.apache.commons.validator.routines.DoubleValidator;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.markup.html.panel.FeedbackPanel;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GbRole;
+import org.sakaiproject.gradebookng.business.GradeSaveResponse;
+import org.sakaiproject.gradebookng.business.util.CourseGradeFormatter;
+import org.sakaiproject.gradebookng.business.util.FormatHelper;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.service.gradebook.shared.CourseGrade;
+import org.sakaiproject.tool.gradebook.Gradebook;
+
+public class GradeUpdateAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    @SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+    private GradebookNgBusinessService businessService;
+
+    public GradeUpdateAction() {
+    }
+
+    // FIXME: We'll use a proper ObjectMapper for these soon.
+    private class GradeUpdateResponse implements ActionResponse {
+        private String courseGrade;
+        private String points;
+        private String categoryScore;
+        private boolean extraCredit;
+
+        public GradeUpdateResponse(boolean extraCredit, String courseGrade, String points, String categoryScore) {
+            this.courseGrade = courseGrade;
+            this.categoryScore = categoryScore;
+            this.points = points;
+            this.extraCredit = extraCredit;
+        }
+
+        public String getStatus() {
+            return "OK";
+        }
+
+        public String toJson() {
+            return "{" +
+                        "\"courseGrade\": [\"" + courseGrade + "\"," + "\"" + points + "\"]," +
+                        "\"categoryScore\": \"" + categoryScore + "\"," +
+                        "\"extraCredit\": " + extraCredit +
+                    "}";
+        }
+    }
+
+    private class SaveGradeErrorResponse implements ActionResponse {
+        private GradeSaveResponse serverResponse;
+        public SaveGradeErrorResponse(GradeSaveResponse serverResponse) {
+            this.serverResponse = serverResponse;
+        }
+
+        public String getStatus() {
+            return "error";
+        }
+
+        public String toJson() {
+            // TODO map to a reasonable message based on server response
+            return String.format("{\"msg\": \"%s\"}", serverResponse.toString());
+        }
+    }
+
+    private class SaveGradeNoChangeResponse extends EmptyOkResponse {
+        public SaveGradeNoChangeResponse() {
+        }
+
+        @Override
+        public String getStatus() {
+            return "nochange";
+        }
+    }
+
+    @Override
+    public ActionResponse handleEvent(final JsonNode params, final AjaxRequestTarget target) {
+        final GradebookPage page = (GradebookPage) target.getPage();
+
+        // clear the feedback message at the top of the page
+        target.addChildren(page, FeedbackPanel.class);
+
+        final String rawOldGrade = params.get("oldScore").textValue();
+        final String rawNewGrade = params.get("newScore").textValue();
+
+        if (StringUtils.isNotBlank(rawNewGrade) && (!FormatHelper.isValidDouble(rawNewGrade) || FormatHelper.validateDouble(rawNewGrade) < 0)) {
+            target.add(page.updateLiveGradingMessage(page.getString("feedback.error")));
+
+            return new ArgumentErrorResponse("Grade not valid");
+        }
+
+        final String oldGrade = FormatHelper.formatGrade(rawOldGrade);
+        final String newGrade = FormatHelper.formatGrade(rawNewGrade);
+
+        final String assignmentId = params.get("assignmentId").asText();
+        final String studentUuid = params.get("studentId").asText();
+        final String categoryId = params.has("categoryId") ? params.get("categoryId").asText() : null;
+
+        // We don't pass the comment from the use interface,
+        // but the service needs it otherwise it will assume 'null'
+        // so pull it back from the service and poke it in there!
+        final String comment = businessService.getAssignmentGradeComment(Long.valueOf(assignmentId), studentUuid);
+
+        // for concurrency, get the original grade we have in the UI and pass it into the service as a check
+        final GradeSaveResponse result = businessService.saveGrade(Long.valueOf(assignmentId),
+                                                                   studentUuid,
+                                                                   oldGrade,
+                                                                   newGrade,
+                                                                   comment);
+
+        if (result.equals(GradeSaveResponse.NO_CHANGE)) {
+            target.add(page.updateLiveGradingMessage(page.getString("feedback.saved")));
+
+            return new SaveGradeNoChangeResponse();
+        }
+
+        if (!result.equals(GradeSaveResponse.OK) && !result.equals(GradeSaveResponse.OVER_LIMIT)) {
+            target.add(page.updateLiveGradingMessage(page.getString("feedback.error")));
+
+            return new SaveGradeErrorResponse(result);
+        }
+
+        final CourseGrade studentCourseGrade = businessService.getCourseGrade(studentUuid);
+
+        String grade = "-";
+        String points = "0";
+
+        if (studentCourseGrade != null) {
+            final GradebookUiSettings uiSettings = page.getUiSettings();
+            final Gradebook gradebook = businessService.getGradebook();
+            final CourseGradeFormatter courseGradeFormatter = new CourseGradeFormatter(
+                gradebook,
+                GbRole.INSTRUCTOR,
+                true,
+                uiSettings.getShowPoints(),
+                true);
+
+            grade = courseGradeFormatter.format(studentCourseGrade);
+            if (studentCourseGrade.getPointsEarned() != null) {
+                points = FormatHelper.formatDoubleToDecimal(studentCourseGrade.getPointsEarned());
+            }
+        }
+
+        String categoryScore = "-";
+
+        if (categoryId != null) {
+            final Double average = businessService.getCategoryScoreForStudent(Long.valueOf(categoryId), studentUuid);
+            if (average != null) {
+                categoryScore = FormatHelper.formatDoubleToDecimal(average);
+            }
+        }
+
+        target.add(page.updateLiveGradingMessage(page.getString("feedback.saved")));
+
+        return new GradeUpdateResponse(
+            result.equals(GradeSaveResponse.OVER_LIMIT),
+            grade,
+            points,
+            categoryScore);
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/InjectableAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/InjectableAction.java
new file mode 100644
index 0000000000..1cc0e62049
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/InjectableAction.java
@@ -0,0 +1,10 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+import org.apache.wicket.injection.Injector;
+
+abstract public class InjectableAction implements Action {
+    public InjectableAction() {
+        //inject Spring dependencies into this class and derived instances
+        Injector.get().inject(this);
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentAction.java
new file mode 100644
index 0000000000..539b734ab5
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentAction.java
@@ -0,0 +1,46 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.service.gradebook.shared.Assignment;
+
+import java.io.Serializable;
+import java.util.List;
+import java.util.stream.Collectors;
+
+abstract public class MoveAssignmentAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    @SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+    protected GradebookNgBusinessService businessService;
+
+    public MoveAssignmentAction() {
+    }
+    /**
+     * Get the assignment's current sort index within its category. If this value is null in the database, best calculate this index from
+     * the assignments.
+     *
+     * @param assignmentId the id of the assignment
+     * @return the current sort index of the assignment within their category
+     */
+    protected Integer calculateCurrentCategorizedSortOrder(final Long assignmentId) {
+        final Assignment assignment = MoveAssignmentAction.this.businessService.getAssignment(assignmentId.longValue());
+        Integer order = assignment.getCategorizedSortOrder();
+
+        if (order == null) {
+            // if no categorized order for assignment, calculate one based on the default sort order
+            final List<Assignment> assignments = MoveAssignmentAction.this.businessService.getGradebookAssignments();
+            final List<Long> assignmentIdsInCategory = assignments.stream()
+                .filter(a -> (a.getCategoryId() != null) && a.getCategoryId().equals(assignment.getCategoryId()))
+                .map(Assignment::getId)
+                .collect(Collectors.toList());
+
+            order = assignmentIdsInCategory.indexOf(assignmentId);
+        }
+
+        return order;
+    }
+
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentLeftAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentLeftAction.java
new file mode 100644
index 0000000000..1169b8dd55
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentLeftAction.java
@@ -0,0 +1,50 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+
+import java.io.Serializable;
+
+public class MoveAssignmentLeftAction extends MoveAssignmentAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public MoveAssignmentLeftAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+
+        final Long assignmentId = Long.valueOf(params.get("assignmentId").asText());
+
+        GradebookUiSettings settings = gradebookPage.getUiSettings();
+
+        if (settings == null) {
+            settings = new GradebookUiSettings();
+            gradebookPage.setUiSettings(settings);
+        }
+
+        if (settings.isCategoriesEnabled() && settings.isGroupedByCategory()) {
+            try {
+                final Integer order = calculateCurrentCategorizedSortOrder(assignmentId);
+                MoveAssignmentLeftAction.this.businessService.updateAssignmentCategorizedOrder(assignmentId,
+                    (order.intValue() - 1));
+            } catch (final Exception e) {
+                return new ArgumentErrorResponse("Error reordering within category: " + e.getMessage());
+            }
+        } else {
+            final int order = MoveAssignmentLeftAction.this.businessService.getAssignmentSortOrder(assignmentId.longValue());
+            MoveAssignmentLeftAction.this.businessService.updateAssignmentOrder(assignmentId.longValue(), (order - 1));
+        }
+
+        // refresh the page
+        target.appendJavaScript("location.reload();");
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentRightAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentRightAction.java
new file mode 100644
index 0000000000..55fdccbff4
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/MoveAssignmentRightAction.java
@@ -0,0 +1,50 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+
+import java.io.Serializable;
+
+public class MoveAssignmentRightAction extends MoveAssignmentAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public MoveAssignmentRightAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+
+        final Long assignmentId = Long.valueOf(params.get("assignmentId").asText());
+
+        GradebookUiSettings settings = gradebookPage.getUiSettings();
+
+        if (settings == null) {
+            settings = new GradebookUiSettings();
+            gradebookPage.setUiSettings(settings);
+        }
+
+        if (settings.isCategoriesEnabled() && settings.isGroupedByCategory()) {
+            try {
+                final Integer order = calculateCurrentCategorizedSortOrder(assignmentId);
+                MoveAssignmentRightAction.this.businessService.updateAssignmentCategorizedOrder(assignmentId,
+                    (order.intValue() + 1));
+            } catch (final Exception e) {
+                return new ArgumentErrorResponse("Error reordering within category: " + e.getMessage());
+            }
+        } else {
+            final int order = MoveAssignmentRightAction.this.businessService.getAssignmentSortOrder(assignmentId.longValue());
+            MoveAssignmentRightAction.this.businessService.updateAssignmentOrder(assignmentId.longValue(), (order + 1));
+        }
+
+        // refresh the page
+        target.appendJavaScript("location.reload();");
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/OverrideCourseGradeAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/OverrideCourseGradeAction.java
new file mode 100644
index 0000000000..09bd9cfce9
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/OverrideCourseGradeAction.java
@@ -0,0 +1,36 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.CourseGradeOverridePanel;
+
+import java.io.Serializable;
+
+public class OverrideCourseGradeAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public OverrideCourseGradeAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String studentUuid = params.get("studentId").asText();
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getUpdateCourseGradeDisplayWindow();
+        window.setStudentToReturnFocusTo(studentUuid);
+        window.setReturnFocusToCourseGrade();
+        window.setContent(new CourseGradeOverridePanel(window.getContentId(),
+                                                       Model.of(studentUuid),
+                                                       window));
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetScoreForUngradedAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetScoreForUngradedAction.java
new file mode 100644
index 0000000000..76a2cfff80
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetScoreForUngradedAction.java
@@ -0,0 +1,42 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.UpdateUngradedItemsPanel;
+
+import java.io.Serializable;
+
+public class SetScoreForUngradedAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public SetScoreForUngradedAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final String assignmentId = params.get("assignmentId").asText();
+
+        final GradebookPage gradebookPage = (GradebookPage)target.getPage();
+        final GbModalWindow window = gradebookPage.getUpdateUngradedItemsWindow();
+        final UpdateUngradedItemsPanel panel = new UpdateUngradedItemsPanel(
+            window.getContentId(),
+            Model.of(Long.valueOf(assignmentId)),
+            window);
+
+        window.setTitle(gradebookPage.getString("heading.updateungradeditems"));
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setContent(panel);
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        panel.setOutputMarkupId(true);
+        target.appendJavaScript("new GradebookUpdateUngraded($(\"#" + panel.getMarkupId() + "\"));");
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetStudentNameOrderAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetStudentNameOrderAction.java
new file mode 100644
index 0000000000..70c6aede15
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetStudentNameOrderAction.java
@@ -0,0 +1,37 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.business.model.GbStudentNameSortOrder;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+
+import java.io.Serializable;
+
+public class SetStudentNameOrderAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public SetStudentNameOrderAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final String orderParam = params.get("orderby").asText();
+        final GbStudentNameSortOrder nameSortOrder = GbStudentNameSortOrder.valueOf(orderParam.toUpperCase());
+
+        final GradebookPage gradebookPage = (GradebookPage)target.getPage();
+
+        final GradebookUiSettings settings = gradebookPage.getUiSettings();
+        settings.setNameSortOrder(nameSortOrder);
+
+        // save settings
+        gradebookPage.setUiSettings(settings);
+
+        // refresh the page
+        target.appendJavaScript("location.reload();");
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetZeroScoreAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetZeroScoreAction.java
new file mode 100644
index 0000000000..81029173c7
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/SetZeroScoreAction.java
@@ -0,0 +1,33 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.ZeroUngradedItemsPanel;
+
+import java.io.Serializable;
+
+public class SetZeroScoreAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public SetZeroScoreAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+
+        final GbModalWindow window = gradebookPage.getUpdateUngradedItemsWindow();
+
+        window.setTitle(gradebookPage.getString("heading.zeroungradeditems"));
+        window.setReturnFocusToCourseGrade();
+        window.setContent(new ZeroUngradedItemsPanel(window.getContentId(), window));
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ToggleCourseGradePoints.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ToggleCourseGradePoints.java
new file mode 100644
index 0000000000..e86bcb01de
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ToggleCourseGradePoints.java
@@ -0,0 +1,40 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+
+import java.io.Serializable;
+
+public class ToggleCourseGradePoints extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public ToggleCourseGradePoints() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+
+        // get current settings
+        final GradebookUiSettings settings = gradebookPage.getUiSettings();
+        final Boolean currentSetting = settings.getShowPoints();
+
+        // toggle it
+        final Boolean nextSetting = !currentSetting;
+
+        // set it
+        settings.setShowPoints(nextSetting);
+
+        // save settings
+        gradebookPage.setUiSettings(settings);
+        
+        // refresh the page
+        target.appendJavaScript("location.reload();");
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewAssignmentStatisticsAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewAssignmentStatisticsAction.java
new file mode 100644
index 0000000000..3a75d11927
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewAssignmentStatisticsAction.java
@@ -0,0 +1,34 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.GradeStatisticsPanel;
+
+import java.io.Serializable;
+
+public class ViewAssignmentStatisticsAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public ViewAssignmentStatisticsAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String assignmentId = params.get("assignmentId").asText();
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getGradeStatisticsWindow();
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setContent(new GradeStatisticsPanel(window.getContentId(),
+                                                   Model.of(Long.valueOf(assignmentId)),
+                                                   window));
+        window.show(target);
+        
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewCourseGradeLogAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewCourseGradeLogAction.java
new file mode 100644
index 0000000000..57c72c049f
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewCourseGradeLogAction.java
@@ -0,0 +1,35 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.CourseGradeOverrideLogPanel;
+
+import java.io.Serializable;
+
+public class ViewCourseGradeLogAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public ViewCourseGradeLogAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String studentUuid = params.get("studentId").asText();
+
+        final GradebookPage page = (GradebookPage)target.getPage();
+        final GbModalWindow window = page.getUpdateCourseGradeDisplayWindow();
+
+        window.setStudentToReturnFocusTo(studentUuid);
+        window.setReturnFocusToCourseGrade();
+        window.setContent(new CourseGradeOverrideLogPanel(window.getContentId(), Model.of(studentUuid), window));
+        window.showUnloadConfirmation(false);
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeLogAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeLogAction.java
new file mode 100644
index 0000000000..c2b80df31e
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeLogAction.java
@@ -0,0 +1,41 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.GradeLogPanel;
+
+import java.io.Serializable;
+import java.util.HashMap;
+import java.util.Map;
+
+public class ViewGradeLogAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    public ViewGradeLogAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String assignmentId = params.get("assignmentId").asText();
+        String studentUuid = params.get("studentId").asText();
+
+        Map<String, Object> model = new HashMap<>();
+        model.put("assignmentId", Long.valueOf(assignmentId));
+        model.put("studentUuid", studentUuid);
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getGradeLogWindow();
+
+        window.setAssignmentToReturnFocusTo(assignmentId);
+        window.setStudentToReturnFocusTo(studentUuid);
+        window.setContent(new GradeLogPanel(window.getContentId(), Model.ofMap(model), window));
+        window.show(target);
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeSummaryAction.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeSummaryAction.java
new file mode 100644
index 0000000000..62dfc3bd99
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/actions/ViewGradeSummaryAction.java
@@ -0,0 +1,72 @@
+package org.sakaiproject.gradebookng.tool.actions;
+
+
+import com.fasterxml.jackson.databind.JsonNode;
+import org.apache.wicket.Component;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.model.Model;
+import org.apache.wicket.model.StringResourceModel;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.business.model.GbUser;
+import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.tool.panels.StudentGradeSummaryPanel;
+
+import java.io.Serializable;
+import java.util.HashMap;
+import java.util.Map;
+
+public class ViewGradeSummaryAction extends InjectableAction implements Serializable {
+
+    private static final long serialVersionUID = 1L;
+
+    @SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+    private GradebookNgBusinessService businessService;
+
+    public ViewGradeSummaryAction() {
+    }
+
+    @Override
+    public ActionResponse handleEvent(JsonNode params, AjaxRequestTarget target) {
+        String studentUuid = params.get("studentId").asText();
+
+        GradebookUiSettings settings = ((GradebookPage) target.getPage()).getUiSettings();
+
+        GbUser student = businessService.getUser(studentUuid);
+
+        Map<String, Object> model = new HashMap<>();
+        model.put("studentUuid", studentUuid);
+        model.put("groupedByCategoryByDefault", settings.isCategoriesEnabled());
+
+        final GradebookPage gradebookPage = (GradebookPage) target.getPage();
+        final GbModalWindow window = gradebookPage.getStudentGradeSummaryWindow();
+
+        Component content = new StudentGradeSummaryPanel(window.getContentId(), Model.ofMap(model), window);
+
+        if (window.isShown() && window.isVisible()) {
+            window.replace(content);
+            content.setVisible(true);
+            target.add(content);
+        } else {
+            window.setContent(content);
+            window.show(target);
+        }
+
+        window.setStudentToReturnFocusTo(studentUuid);
+        content.setOutputMarkupId(true);
+
+        String modalTitle = (new StringResourceModel("heading.studentsummary",
+            null, new Object[]{student.getDisplayName(), student.getDisplayId()})).getString();
+
+        window.setTitle(modalTitle);
+        window.show(target);
+
+        target.appendJavaScript(String.format(
+            "new GradebookGradeSummary($(\"#%s\"), false, \"%s\");",
+            content.getMarkupId(), modalTitle));
+
+        return new EmptyOkResponse();
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.html
new file mode 100644
index 0000000000..d8c86df6a3
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.html
@@ -0,0 +1,421 @@
+<html>
+    <wicket:panel xmlns:wicket="http://wicket.apache.org">
+        <div id="gradeTableWrapper">
+            <div wicket:id="gradeTable" id="gradeTable" accesskey="g" wicket:message="aria-label:gradetable.wrapper.tooltip" aria-describedby="gradeTableCaption"></div>
+        </div>
+
+        <script id="courseGradeHeaderTemplate" type="text/template">
+            <span class="colHeader hide">${col}</span>
+            <div class="relative">
+                <a class="gb-title">
+                    <wicket:message key="column.header.coursegrade"/>
+                </a>
+                <div class="gb-grade-item-flags">
+                    {if settings.isCourseGradeReleased}
+                    <span class="gb-flag-released" wicket:message="title:label.coursegrade.released">
+                        <span aria-hidden="true" style="display:none;" class="gb-tooltip-extras">
+                            <div>
+                                <a href="javascript:void(0);" class="gb-gradebook-settings"><wicket:message key="label.coursegrade.editsettings"/></a>
+                            </div>
+                        </span>
+                    </span>
+                    {else}
+                    <span class="gb-flag-not-released" wicket:message="title:label.coursegrade.notreleased">
+                        <span aria-hidden="true" style="display:none;" class="gb-tooltip-extras">
+                            <div>
+                                <a href="javascript:void(0);" class="gb-gradebook-settings"><wicket:message key="label.coursegrade.editsettings"/></a>
+                            </div>
+                        </span>
+                    </span>
+                    {/if}
+                </div>
+                {if settings.instructor}
+                    <div class="btn-group">
+                        <a class="btn btn-sm btn-default dropdown-toggle"
+                           data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
+                           wicket:message="title:coursegrade.header.menulabel"
+                           tabindex="-1">
+                            <span class="caret"></span>
+                        </a>
+                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
+                            <li><a href="javascript:void(0);" class="gb-set-zero-score" role="menuitem"><wicket:message key="coursegrade.option.setungraded" /></a></li>
+                            {if !settings.isCategoryTypeWeighted}
+                                <li>
+                                    <a href="javascript:void(0);" class="gb-toggle-points" role="menuitem">
+                                    {if settings.showPoints}
+                                        <wicket:message key="coursegrade.option.hidepoints" />
+                                    {else}
+                                        <wicket:message key="coursegrade.option.showpoints" />
+                                    {/if}
+                                    </a>
+                                </li>
+                            {/if}
+                        </ul>
+                    </div>
+                {/if}
+            </div>
+        </script>
+        <script id="assignmentHeaderTemplate" type="text/template">
+            <span class="colHeader hide">${col}</span>
+            <div class="relative">
+                {if extraCredit}
+                    <span class="gb-flag-extra-credit" wicket:message="title:label.gradeitem.extracredit"></span>
+                {/if}
+                {if externallyMaintained}
+                    <span class="gb-external-app ${externalAppIconCSS}"
+                          wicket:message="title:label.gradeitem.externalapplabel">
+                    </span>
+                {/if}
+                {var tooltip = title.replace(/"/g, '&quot;')}
+                <a class="gb-title" title="${tooltip}">
+                    ${abbrevTitle}
+                </a>
+                {if settings.isCategoriesEnabled}
+                    {if categoryId}
+                        <div class="gb-category">
+                            <wicket:message key="label.category"/>
+                            {if categoryExtraCredit}
+                                <span class="gb-flag-extra-credit" wicket:message="title:label.gradeitem.extracreditcategory"></span>
+                            {/if}
+                            <span>${categoryName}</span>
+                            {if settings.isCategoryTypeWeighted}
+                                <span class="gb-category-weight">[${categoryWeight}]</span>
+                            {/if}
+                        </div>
+                    {else}
+                        <div class="gb-uncategorized">
+                            <wicket:message key="gradebookpage.uncategorised"/>
+                        </div>
+                    {/if}
+                {/if}
+                <div class="gb-grade-section">
+                    {if settings.isPercentageGradeEntry}
+                        <wicket:message key="label.relativeweight"/>
+                    {else}
+                        <wicket:message key="label.total"/>
+                    {/if}
+                    <span class="gb-total-points">
+                        ${points}
+                    </span>
+                </div>
+                <div class="gb-due-date">
+                    <wicket:message key="label.due"/> 
+                    <span>${dueDate}</span>
+                </div>
+                <div class="gb-grade-item-flags">
+                    {if released}
+                        <span class="gb-flag-released" wicket:message="title:label.gradeitem.released"></span>
+                    {else}
+                        <span class="gb-flag-not-released" wicket:message="title:label.gradeitem.notreleased"></span>
+                    {/if}
+                    {if includedInCourseGrade}
+                        <span class="gb-flag-counted" wicket:message="title:label.gradeitem.counted"></span>
+                    {else}
+                        <span class="gb-flag-not-counted" wicket:message="title:label.gradeitem.notcounted"></span>
+                    {/if}
+                </div>
+                <div class="btn-group">
+                    <a class="btn btn-sm btn-default dropdown-toggle"
+                       data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
+                       tabindex="-1">
+                        <span class="caret"></span>
+                    </a>
+                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
+                        {if settings.instructor}
+                            <li><a href="javascript:void(0);" class="edit-assignment-details" role="menuitem"><wicket:message key="assignment.option.edit" /></a></li>
+                        {/if}
+                        <li><a href="javascript:void(0);" class="gb-view-statistics" role="menuitem"><wicket:message key="assignment.option.viewgradestatistics" /></a></li>
+                        {if settings.instructor}
+                            <li><a href="javascript:void(0);" class="gb-move-left" role="menuitem"><wicket:message key="assignment.option.moveleft" /></a></li>
+                            <li><a href="javascript:void(0);" class="gb-move-right" role="menuitem"><wicket:message key="assignment.option.moveright" /></a></li>
+                        {/if}
+                        {if !externallyMaintained && settings.instructor}
+                            <li><a href="javascript:void(0);" class="gb-set-ungraded" role="menuitem"><wicket:message key="assignment.option.setungraded" /></a></li>
+                            <li><a href="javascript:void(0);" class="gb-delete-item" role="menuitem"><span class="text-danger"><wicket:message key="delete.label" /></span></a></li>
+                        {/if}
+                    </ul>
+                </div>
+            </div>
+        </script>
+        <script id="categoryScoreHeaderTemplate" type="text/template">
+            <span class="colHeader hide">${col}</span>
+            <div class="relative">
+                {if extraCredit}
+                    <span class="gb-flag-extra-credit" wicket:message="title:label.gradeitem.extracreditcategory"></span>
+                {/if}
+                {var tooltip = title.replace(/"/g, '&quot;')}
+                <a class="gb-title" title="${tooltip}">
+                    <span class="gb-category">
+                        <span class="swatch" style="background-color: #${color}"></span>
+                        ${categoryName}
+                        {if settings.isCategoryTypeWeighted}
+                            <div class="gb-category-weight-label">
+                                <wicket:message key="label.gradeitem.categoryaveragelabel"/>
+                                <span class="gb-category-weight" wicket:message="title:label.gradeitem.categoryweight">
+                                    [${weight}]
+                                </span>
+                            </div>
+                        {/if}
+                    </span>
+                </a>
+            </div>
+        </script>
+        <script id="studentHeaderTemplate" type="text/template">
+            <div class="relative">
+                <div class="colHeader">
+                    <a class="gb-title">
+                        <wicket:message key="column.header.students"/>
+                    </a>
+                    <div class="btn-group">
+                        <a class="btn btn-sm btn-default dropdown-toggle"
+                           data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
+                           wicket:message="title:students.menulabel"
+                           tabindex="-1">
+                            <span class="caret"></span>
+                        </a>
+                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
+                            {if !settings.isStudentOrderedByLastName}
+                                <li><a class="gb-student-name-order-toggle" data-order-by="last_name" href="#"><wicket:message key="sortbyname.option.last"/></a></li>
+                            {/if}
+                            {if !settings.isStudentOrderedByFirstName}
+                                <li><a class="gb-student-name-order-toggle" data-order-by="first_name" href="#"><wicket:message key="sortbyname.option.first"/></a></li>
+                            {/if}
+                        </ul>
+                    </div>
+                </div>
+            </div>
+        </script>
+        <script id="cellTemplate" type="text/template">
+            <div class="relative">
+                <span class="gb-value">${value}</span>
+                <span class="gb-notification"></span>
+                <span class="gb-comment-notification"></span>
+                <div class="btn-group">
+                    <a class="btn btn-sm btn-default dropdown-toggle"
+                       data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
+                       tabindex="-1">
+                        <span class="caret"></span>
+                    </a>
+                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
+                        <li><a class="gb-view-log" href="#" role="menuitem"><wicket:message key="grade.option.viewlog" /></a></li>
+                        <li><a class="gb-edit-comments" href="#" role="menuitem"><wicket:message key="comment.option.edit" /></a></li>
+                    </ul>
+                </div>
+            </div>
+        </script>
+        <script id="courseGradeCellTemplate" type="text/template">
+            <div class="relative">
+                <span class="gb-value {if isOverridden} gb-overridden {/if}">
+                    ${value}
+                </span>
+                {if GbGradeTable.settings.instructor}
+                    <div class="btn-group">
+                        <a class="btn btn-sm btn-default dropdown-toggle"
+                           data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
+                           wicket:message="title:coursegrade.cell.menulabel"
+                           tabindex="-1">
+                            <span class="caret"></span>
+                        </a>
+                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
+                            <li><a href="javascript:void(0);" class="gb-course-grade-override" role="menuitem"><wicket:message key="coursegrade.option.override"/></a></li>
+                            <li><a href="javascript:void(0);" class="gb-course-grade-override-log" role="menuitem"><wicket:message key="coursegrade.option.overridelog"/></a></li>
+                        </ul>
+                    </div>
+                {/if}
+            </div>
+        </script>
+        <script id="studentCellTemplate" type="text/template">
+            {if settings.isStudentOrderedByLastName}
+                {var tooltip = lastName + ", " + firstName + " (" + eid + ")"}
+            {else}
+                {var tooltip = firstName + " " + lastName + " (" + eid + ")"}
+            {/if}
+            {var tooltip = tooltip.replace(/"/g, '&quot;')}
+            <div class="relative gb-student-cell" title="${tooltip}">
+                <div class="gb-value">
+                    <div class="rowHeader">
+                        <a href="javascript:void(0);" class="gb-view-grade-summary" tabindex="-1">
+                            {if settings.isStudentOrderedByLastName}
+                                <div>
+                                    <span class="gb-last-name">${lastName}</span>,
+                                    <span class="gb-first-name">${firstName}</span>
+                                </div>
+                                <div>
+                                    (<span class="gb-eid">${eid}</span>)
+                                </div>
+                            {else}
+                                <div>
+                                    <span class="gb-first-name">${firstName}</span>
+                                    <span class="gb-last-name">${lastName}</span>
+                                </div>
+                                <div>
+                                    (<span class="gb-eid">${eid}</span>)
+                                </div>
+                            {/if}
+                        </a>
+                    </div>
+                </div>
+            </div>
+        </script>
+        <script id="metadataTemplate" type="text/template">
+            <div id="${id}" class="gb-metadata">
+                <a href="javascript:void(0);" class="gb-metadata-close"></a>
+                <div class="gb-metadata-summary">
+                    <h4 class="sr-only"><wicket:message key="metadata.header" /></h4>
+                    <dl class="sr-only dl-horizontal">
+                        <dt><wicket:message key="metadata.student" /></dt>
+                        <dd>${student.lastName}, ${student.firstName} (${student.eid})</dd>
+                        {if defined('assignment')}
+                        <dt><wicket:message key="metadata.assignment" /></dt>
+                        <dd>${assignment.title}</dd>
+                        {/if}
+                        {if defined('value')}
+                        <dt><wicket:message key="metadata.score" /></dt>
+                        <dd>${value}</dd>
+                        {/if}
+                        {if defined('courseGrade')}
+                        <dt><wicket:message key="metadata.courseGrade" /></dt>
+                        <dd>${courseGrade}</dd>
+                        {/if}
+                        {if defined('category')}
+                        <dt><wicket:message key="metadata.category" /></dt>
+                        <dd>${category.categoryName}</dd>
+                        {/if}
+                        {if defined('categoryAverage')}
+                        <dt><wicket:message key="metadata.categoryAverage" /></dt>
+                        <dd>${categoryAverage}</dd>
+                        {/if}
+                    </dl>
+                </div>
+                <div class="gb-metadata-notifications">
+                    {if defined('notifications') && notifications.length > 0}
+                        <p class="sr-only"><wicket:message key="metadata.flags" /></p>
+                        <ul>
+                            {for notification in notifications}
+                                {if notification.type == 'comment'}
+                                    <li class="gb-metadata-comment-notification">
+                                        <span class="gb-flag-comment"></span> <wicket:message key="grade.notifications.hascomment"/>
+                                        <blockquote><wicket:message key="grade.notifications.commentloading"/></blockquote>
+                                        {if defined('readonly') && !readonly} 
+                                            <div>
+                                                <a href="javascript:void(0);" class="gb-edit-comments"><wicket:message key="grade.notifications.editcomment"/></a>
+                                            </div>
+                                        {/if}
+                                    </li>
+                                {elseif notification.type == 'extra-credit'}
+                                    <li>
+                                        <span class="gb-flag-extra-credit"></span> <wicket:message key="grade.notifications.overlimit"/>
+                                    </li>
+                                {elseif notification.type == 'save-error'}
+                                    <li>
+                                        <span class="gb-flag-save-error"></span> <wicket:message key="grade.notifications.haserror"/>
+                                    </li>
+                                    <li>
+                                        <span class="gb-flag-save-invalid"></span> <wicket:message key="grade.notifications.invalid"/>
+                                    </li>
+                                    <li>
+                                        <a href="javascript:void(0);" class="gb-revert-score"><wicket:message key="grade.notifications.revert"/></a>
+                                    </li>
+                                {elseif notification.type == 'save-invalid'}
+                                    <li>
+                                        <span class="gb-flag-save-invalid"></span> <wicket:message key="grade.notifications.invalid"/>
+                                    </li>
+                                {elseif notification.type == 'concurrent-edit'}
+                                    {if notification.showSaveError}
+                                        <li>
+                                            <span class="gb-flag-save-error"></span> <wicket:message key="grade.notifications.haserror"/>
+                                        </li>
+                                    {/if}
+                                    <li>
+                                        <span class="gb-flag-concurrent-edit"></span> <wicket:message key="grade.notifications.concurrentedit"/>
+                                        {if notification.conflict}
+                                            <dl class="dl-horizontal">
+                                                <dt><wicket:message key="grade.notifications.concurrentedituser"/></dt>
+                                                <dd>${notification.conflict.lastUpdatedBy}</dd>
+                                                <dt><wicket:message key="grade.notifications.concurrentedittime"/></dt>
+                                                <dd>${new Date(notification.conflict.lastUpdated).toLocaleTimeString()}</dd>
+                                            </dl>
+                                        {/if}
+                                    </li>
+                                {elseif notification.type == 'external'}
+                                    <li class="gb-external-app-wrapper">
+                                        <span class="gb-flag-external"></span> <wicket:message key="grade.notifications.isexternal"/>
+                                    </li>
+                                {elseif notification.type == 'readonly'}
+                                    <li>
+                                        <span class="gb-flag-read-only"></span> <wicket:message key="grade.notifications.readonly"/>
+                                    </li>
+                                    <li>
+                                        <span class="gb-flag-read-only"></span> <wicket:message key="grade.notifications.privileges"/>
+                                    </li>
+                                {else}
+                                    <li>
+                                        <span class="gb-flag-${notification.type}"></span> ${notification.type}
+                                    </li>
+                                {/if}
+                            {/for}
+                        </ul>
+                    {else}
+                        <p><wicket:message key="metadata.noflags"/></p>
+                    {/if}
+                </div>
+            </div>
+        </script>
+        <script id="tooltipTemplate" type="text/template">
+            <div id="gbTooltip" class="gb-metadata">
+                <a href="javascript:void(0);" class="gb-metadata-close"></a>
+                <p>
+                    {if defined('icon')}
+                        <span class="${icon}"></span>
+                    {/if}
+                    ${tooltip}
+                </p>
+            </div>
+        </script>
+        <script id="studentSummaryTemplate" type="text/template">
+            <wicket:message key="label.toolbar.studentsummary"/>
+        </script>
+        <script id="gradeItemSummaryTemplate" type="text/template">
+            <wicket:message key="label.toolbar.gradeitemsummary"/>
+        </script>
+        <script id="gradeItemSummaryTooltipTemplate" type="text/template">
+            <wicket:message key="label.toolbar.gradeitemsummary-tooltip"/>
+        </script>
+        <script id="gradeMenuTooltip" type="text/template">
+            <wicket:message key="grade.menulabel"/>
+        </script>
+        <script id="gradeHeaderMenuTooltip" type="text/template">
+            <wicket:message key="assignment.menulabel"/>
+        </script>
+        <script id="captionTemplate" type="text/template">
+            <div id="gradeTableCaption">
+                <div class="container-fluid">
+                    <div class="sr-only row">
+                        <h4><wicket:message key="gradetable.caption.summaryheader"/></h4>
+                        <p><wicket:message key="gradetable.caption.summary"/></p>
+                    </div>
+                    <div class="row">
+                        <div class="col-sm-12">
+                            <h4><wicket:message key="gradetable.caption.keyboardnavigationheader"/></h4>
+                            <wicket:message key="gradetable.caption.keyboardnavigation"/>
+                        </div>
+                    </div>
+                    <div class="row">
+                        <div class="col-sm-12">
+                            <h4><wicket:message key="gradetable.caption.keyboardshortcutsheader"/></h4>
+                            <wicket:message key="gradetable.caption.keyboardshortcuts"/>
+                        </div>
+                    </div>
+                    <div class="row">
+                        <div class="col-sm-5">
+                            <wicket:message key="gradetable.caption.keyboardtablemodeshortcuts"/>
+                        </div>
+                        <div class="col-sm-5">
+                            <wicket:message key="gradetable.caption.keyboardeditingshortcuts"/>
+                        </div>
+                    </div>
+                </div>
+            </div>
+        </script>
+    </wicket:panel>
+</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.java
new file mode 100644
index 0000000000..970f94f9ee
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbGradeTable.java
@@ -0,0 +1,123 @@
+package org.sakaiproject.gradebookng.tool.component;
+
+import java.io.IOException;
+
+import org.apache.wicket.Component;
+import org.apache.wicket.ajax.AjaxEventBehavior;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.ajax.attributes.AjaxRequestAttributes;
+import org.apache.wicket.markup.html.IHeaderContributor;
+import org.apache.wicket.markup.html.WebMarkupContainer;
+import org.apache.wicket.markup.head.CssHeaderItem;
+import org.apache.wicket.markup.head.IHeaderResponse;
+import org.apache.wicket.markup.head.JavaScriptHeaderItem;
+import org.apache.wicket.markup.head.OnDomReadyHeaderItem;
+import org.apache.wicket.markup.html.panel.Panel;
+
+import org.apache.wicket.model.IModel;
+import org.sakaiproject.gradebookng.tool.model.GbGradeTableData;
+import org.sakaiproject.component.cover.ServerConfigurationService;
+
+import com.fasterxml.jackson.databind.ObjectMapper;
+import com.fasterxml.jackson.databind.JsonNode;
+
+import java.util.Map;
+import org.sakaiproject.gradebookng.tool.model.GbGradebookData;
+import org.sakaiproject.gradebookng.tool.actions.Action;
+import java.util.HashMap;
+import org.sakaiproject.gradebookng.tool.actions.ActionResponse;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+
+
+public class GbGradeTable extends Panel implements IHeaderContributor {
+
+	private Component component;
+
+	/*
+	    - Students: id, first name, last name, netid
+	    - Course grades column: is released?, course grade
+	    - course grade value for each student (letter, percentage, points)
+	    - assignment header: id, points, due date, category {id, name, color}, included in course grade?, external?
+	      - categories: enabled?  weighted categories?  normal categories?  handle uncategorized
+	    - scores: number, has comments?, extra credit? (> total points), read only?
+	 */
+
+	private Map<String, Action> listeners = new HashMap<String, Action>();
+
+	public void addEventListener(String event, Action listener) {
+		listeners.put(event, listener);
+	}
+
+	public ActionResponse handleEvent(String event, JsonNode params, AjaxRequestTarget target) {
+		if (!listeners.containsKey(event)) {
+			throw new RuntimeException("Missing AJAX handler");
+		}
+
+		return listeners.get(event).handleEvent(params, target);
+	}
+
+	public GbGradeTable(String id, IModel model) {
+		super(id);
+		
+		setDefaultModel(model);
+
+		component = new WebMarkupContainer("gradeTable").setOutputMarkupId(true);
+
+		component.add(new AjaxEventBehavior("gbgradetable.action") {
+			@Override
+			protected void updateAjaxAttributes(AjaxRequestAttributes attributes) {
+				super.updateAjaxAttributes(attributes);
+				attributes.getDynamicExtraParameters().add("return [{\"name\": \"ajaxParams\", \"value\": JSON.stringify(attrs.event.extraData)}]");
+			}
+
+			@Override
+			protected void onEvent(AjaxRequestTarget target) {
+				try {
+					ObjectMapper mapper = new ObjectMapper();
+					JsonNode params = mapper.readTree(getRequest().getRequestParameters().getParameterValue("ajaxParams").toString());
+
+					ActionResponse response = handleEvent(params.get("action").asText(), params, target);
+
+					target.appendJavaScript(String.format("GbGradeTable.ajaxComplete(%d, '%s', %s);",
+									      params.get("_requestId").intValue(), response.getStatus(), response.toJson()));
+				} catch (IOException e) {
+					throw new RuntimeException(e);
+				}
+			}
+		});
+
+		add(component);
+	}
+
+	public void renderHead(IHeaderResponse response) {
+		GbGradeTableData gbGradeTableData = (GbGradeTableData)getDefaultModelObject();
+
+		final String version = ServerConfigurationService.getString("portal.cdn.version", "");
+
+		response.render(
+			JavaScriptHeaderItem.forUrl(String.format("/gradebookng-tool/scripts/gradebook-gbgrade-table.js?version=%s", version)));
+
+		response.render(
+			JavaScriptHeaderItem.forUrl(String.format("/gradebookng-tool/scripts/handsontable.full.min.js?version=%s", version)));
+
+		response.render(CssHeaderItem.forUrl(String.format("/gradebookng-tool/styles/handsontable.full.min.css?version=%s", version)));
+
+		GbGradebookData gradebookData = new GbGradebookData(
+				gbGradeTableData.getGrades(),
+				gbGradeTableData.getAssignments(),
+				gbGradeTableData.getCategories(),
+				gbGradeTableData.getGradebookInformation(),
+				gbGradeTableData.getUiSettings(),
+				gbGradeTableData.getRole(),
+				gbGradeTableData.getToolNameToIconCSS(),
+				gbGradeTableData.getDefaultIconCSS(),
+				gbGradeTableData.getCourseGradeMap(),
+				this);
+
+		response.render(OnDomReadyHeaderItem.forScript(String.format("var tableData = %s", gradebookData.toScript())));
+
+		response.render(OnDomReadyHeaderItem.forScript(String.format("GbGradeTable.renderTable('%s', tableData)",
+									     component.getMarkupId())));
+	}
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.html
deleted file mode 100644
index 1541bcba6a..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.html
+++ /dev/null
@@ -1,26 +0,0 @@
-<wicket:panel xmlns:wicket="http://wicket.apache.org">
-	<tr wicket:id="categoriesRow" class="gb-categories-row" role="row">
-		<th colspan="3"><!-- empty --></th>
-		<th wicket:id="categories" scope="col" role="columnheader">
-			<span class="gb-category-label">
-				<span wicket:id="extraCreditCategoryFlag" class="gb-category-extra-credit"></span>
-				<span wicket:id="name" class="gb-category-name"></span>
-				<span wicket:id="weight" class="gb-category-weight"></span>
-			</span>
-		</th>
-		<th wicket:id="uncategorized" class="gb-uncategorized" scope="col" role="columnheader">
-			<span class="gb-category-label">
-				<span class="gb-category-name">
-					<wicket:message key="gradebookpage.uncategorised"></wicket:message>
-				</span>
-			</span>
-		</th>
-	</tr>
-	<tr role="row" class="gb-headers headers">
-		<wicket:container wicket:id="headers">
-			<th wicket:id="header" scope="col" role="columnheader" tabindex="0">
-				<div wicket:id="label"></div>
-			</th>
-		</wicket:container>
-	</tr>
-</wicket:panel>
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.java
deleted file mode 100644
index 23680dac7e..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/component/GbHeadersToolbar.java
+++ /dev/null
@@ -1,118 +0,0 @@
-package org.sakaiproject.gradebookng.tool.component;
-
-import java.util.Collections;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.stream.Collectors;
-
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.extensions.markup.html.repeater.data.sort.ISortStateLocator;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.DataTable;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.HeadersToolbar;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.list.ListItem;
-import org.apache.wicket.markup.html.list.ListView;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.StringResourceModel;
-import org.sakaiproject.gradebookng.business.GbCategoryType;
-import org.sakaiproject.gradebookng.business.util.FormatHelper;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.service.gradebook.shared.Assignment;
-import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
-
-public class GbHeadersToolbar extends HeadersToolbar {
-
-	private final IModel<Map<String, Object>> model;
-
-	public GbHeadersToolbar(final DataTable table, final ISortStateLocator stateLocator, final IModel<Map<String, Object>> model) {
-		super(table, stateLocator);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		final GradebookPage page = (GradebookPage) getPage();
-		final GradebookUiSettings settings = page.getUiSettings();
-
-		final Map<String, Object> modelData = this.model.getObject();
-		final boolean categoriesEnabled = (boolean) modelData.get("categoriesEnabled");
-
-		if (categoriesEnabled && settings.isCategoriesEnabled()) {
-			final WebMarkupContainer categoriesRow = new WebMarkupContainer("categoriesRow");
-
-			final List<Assignment> assignments = (List<Assignment>) modelData.get("assignments");
-			List<CategoryDefinition> categories = (List<CategoryDefinition>) modelData.get("categories");
-			final GbCategoryType categoryType = (GbCategoryType) modelData.get("categoryType");
-
-			Collections.sort(categories, CategoryDefinition.orderComparator);
-
-			final Map<Long, Integer> categoryCounts = new HashMap<Long, Integer>();
-
-			for (final CategoryDefinition category : categories) {
-				categoryCounts.put(category.getId(), 0);
-			}
-			// take into account assignments without a category
-			categoryCounts.put(null, 0);
-
-			for (final Assignment assignment : assignments) {
-				if (categoryCounts.containsKey(assignment.getCategoryId())) {
-					final Integer increment = categoryCounts.get(assignment.getCategoryId()) + 1;
-					categoryCounts.put(assignment.getCategoryId(), increment);
-				}
-			}
-
-			categories = categories.stream().filter(c -> categoryCounts.get(c.getId()) > 0).collect(Collectors.toList());
-
-			categoriesRow.add(new ListView<CategoryDefinition>("categories", categories) {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void populateItem(final ListItem<CategoryDefinition> categoryItem) {
-					final CategoryDefinition category = categoryItem.getModelObject();
-					// add colspan attribute + 1 to accound for the category average column
-					categoryItem.add(new AttributeModifier("colspan", categoryCounts.get(category.getId()) + 1));
-					categoryItem.add(new AttributeModifier("data-category-id", category.getId()));
-					final String color = settings.getCategoryColor(category.getName());
-					categoryItem.add(new AttributeModifier("style",
-							String.format("background-color: %s;", color)));
-					categoryItem.add(new Label("name", category.getName()));
-					categoryItem.add(page.buildFlagWithPopover("extraCreditCategoryFlag",
-							getString("label.gradeitem.extracreditcategory")).setVisible(category.isExtraCredit()));
-
-					if (GbCategoryType.WEIGHTED_CATEGORY.equals(categoryType) && category.getWeight() != null) {
-						final String weight = FormatHelper.formatDoubleAsPercentage(category.getWeight() * 100);
-						categoryItem.add(new Label("weight", weight));
-						categoryItem.add(new AttributeModifier("title",
-							new StringResourceModel("label.gradeitem.categoryandweightheadertooltip", null,
-								new Object[] {category.getName(), weight})));
-					} else {
-						categoryItem.add(new WebMarkupContainer("weight").setVisible(false));
-						categoryItem.add(new AttributeModifier("title",
-							new StringResourceModel("label.gradeitem.categoryheadertooltip", null,
-								new Object[] {category.getName()})));
-
-					}
-				}
-			});
-
-			if (categoryCounts.get(null) > 0) {
-				final WebMarkupContainer uncategorizedHeader = new WebMarkupContainer("uncategorized");
-				uncategorizedHeader.add(new AttributeModifier("colspan", categoryCounts.get(null)));
-				uncategorizedHeader.add(new AttributeModifier("title",
-					getString("gradebookpage.uncategorised")));
-				categoriesRow.add(uncategorizedHeader);
-			} else {
-				categoriesRow.add(new WebMarkupContainer("uncategorized").setVisible(false));
-			}
-
-			add(categoriesRow);
-		} else {
-			add(new WebMarkupContainer("categoriesRow").setVisible(false));
-		}
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradeTableData.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradeTableData.java
new file mode 100644
index 0000000000..d0eca89e02
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradeTableData.java
@@ -0,0 +1,106 @@
+package org.sakaiproject.gradebookng.tool.model;
+
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import org.sakaiproject.gradebookng.business.GbRole;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.business.exception.GbAccessDeniedException;
+import org.sakaiproject.gradebookng.business.model.GbStudentGradeInfo;
+import org.sakaiproject.gradebookng.business.util.GbStopWatch;
+import org.sakaiproject.service.gradebook.shared.Assignment;
+import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
+import org.sakaiproject.service.gradebook.shared.GradebookInformation;
+import org.sakaiproject.service.gradebook.shared.SortType;
+import org.sakaiproject.tool.gradebook.Gradebook;
+
+public class GbGradeTableData {
+    private List<Assignment> assignments;
+    private List<GbStudentGradeInfo> grades;
+    private List<CategoryDefinition> categories;
+    private GradebookInformation gradebookInformation;
+    private GradebookUiSettings uiSettings;
+    private GbRole role;
+    private Map<String, String> toolNameToIconCSS;
+    private String defaultIconCSS;
+    private Map<String, Double> courseGradeMap;
+
+    public GbGradeTableData(GradebookNgBusinessService businessService,
+                            GradebookUiSettings settings) {
+        final GbStopWatch stopwatch = new GbStopWatch();
+        stopwatch.time("GbGradeTableData init", stopwatch.getTime());
+
+        uiSettings = settings;
+
+        SortType sortBy = SortType.SORT_BY_SORTING;
+        if (settings.isCategoriesEnabled() && settings.isGroupedByCategory()) {
+            // Pre-sort assignments by the categorized sort order
+            sortBy = SortType.SORT_BY_CATEGORY;
+        }
+
+        try {
+            role = businessService.getUserRole();
+        } catch (GbAccessDeniedException e) {
+            // FIXME handle with error message?
+            throw new RuntimeException(e);
+        }
+
+        assignments = businessService.getGradebookAssignments(sortBy);
+        stopwatch.time("getGradebookAssignments", stopwatch.getTime());
+
+        grades = businessService.buildGradeMatrix(
+            assignments,
+            settings);
+        stopwatch.time("buildGradeMatrix", stopwatch.getTime());
+
+        categories = businessService.getGradebookCategories();
+        stopwatch.time("getGradebookCategories", stopwatch.getTime());
+
+        gradebookInformation = businessService.getGradebookSettings();
+        stopwatch.time("getGradebookSettings", stopwatch.getTime());
+
+        toolNameToIconCSS = businessService.getIconClassMap();
+        defaultIconCSS = businessService.getDefaultIconClass();
+        stopwatch.time("toolNameToIconCSS", stopwatch.getTime());
+
+        Gradebook gradebook = businessService.getGradebook();
+        courseGradeMap = gradebook.getSelectedGradeMapping().getGradeMap();
+    }
+
+    public List<Assignment> getAssignments() {
+        return assignments;
+    }
+
+    public List<GbStudentGradeInfo> getGrades() {
+        return grades;
+    }
+
+    public List<CategoryDefinition> getCategories() {
+        return categories;
+    }
+
+    public GradebookInformation getGradebookInformation() {
+        return gradebookInformation;
+    }
+
+    public GradebookUiSettings getUiSettings() {
+        return uiSettings;
+    }
+
+    public GbRole getRole() {
+        return role;
+    }
+
+    public Map<String, String> getToolNameToIconCSS() {
+        return toolNameToIconCSS;
+    }
+
+    public String getDefaultIconCSS() {
+        return defaultIconCSS;
+    }
+
+    public Map<String, Double> getCourseGradeMap() {
+        return courseGradeMap;
+    }
+}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradebookData.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradebookData.java
new file mode 100644
index 0000000000..248012ce2f
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbGradebookData.java
@@ -0,0 +1,608 @@
+package org.sakaiproject.gradebookng.tool.model;
+
+import lombok.Data;
+import lombok.Setter;
+import lombok.Value;
+import org.apache.commons.collections.map.HashedMap;
+import org.apache.commons.lang.StringUtils;
+import org.apache.commons.lang.builder.CompareToBuilder;
+import org.apache.wicket.model.StringResourceModel;
+import org.sakaiproject.gradebookng.business.GbCategoryType;
+import org.sakaiproject.gradebookng.business.GbRole;
+import org.sakaiproject.gradebookng.business.model.GbCourseGrade;
+import org.sakaiproject.gradebookng.business.model.GbStudentNameSortOrder;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
+import org.sakaiproject.gradebookng.business.model.GbStudentGradeInfo;
+
+import org.apache.wicket.Component;
+import org.sakaiproject.gradebookng.business.util.FormatHelper;
+import org.sakaiproject.gradebookng.business.model.GbGradeInfo;
+import java.io.UnsupportedEncodingException;
+
+import com.fasterxml.jackson.databind.ObjectMapper;
+import com.fasterxml.jackson.core.JsonProcessingException;
+import org.sakaiproject.service.gradebook.shared.Assignment;
+import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
+import org.sakaiproject.service.gradebook.shared.CourseGrade;
+import org.sakaiproject.service.gradebook.shared.GradebookInformation;
+import org.sakaiproject.service.gradebook.shared.GradingType;
+
+import java.util.ArrayList;
+import java.util.Base64;
+import java.util.Comparator;
+import java.util.List;
+import java.util.Map;
+import java.util.stream.Collectors;
+
+public class GbGradebookData {
+
+    private int NULL_SENTINEL = 127;
+
+    @Data
+    private class StudentDefinition {
+        private String eid;
+        private String userId;
+        private String firstName;
+        private String lastName;
+
+        private String hasComments;
+        private String hasConcurrentEdit;
+        private String readonly;
+    }
+
+    private interface ColumnDefinition {
+        public String getType();
+        public Score getValueFor(GbStudentGradeInfo studentGradeInfo, boolean isInstructor);
+    }
+
+    @Value
+    private class AssignmentDefinition implements ColumnDefinition {
+        private Long assignmentId;
+        private String title;
+        private String abbrevTitle;
+        private String points;
+        private String dueDate;
+
+        private boolean isReleased;
+        private boolean isIncludedInCourseGrade;
+        private boolean isExtraCredit;
+        private boolean isExternallyMaintained;
+        private String externalId;
+        private String externalAppName;
+        private String externalAppIconCSS;
+
+        private String categoryId;
+        private String categoryName;
+        private String categoryColor;
+        private String categoryWeight;
+        private boolean isCategoryExtraCredit;
+
+        private boolean hidden;
+
+        @Override
+        public String getType() {
+            return "assignment";
+        }
+
+        @Override
+        public Score getValueFor(GbStudentGradeInfo studentGradeInfo, boolean isInstructor) {
+            Map<Long, GbGradeInfo> studentGrades = studentGradeInfo.getGrades();
+
+            GbGradeInfo gradeInfo = studentGrades.get(assignmentId);
+
+            if (gradeInfo == null) {
+                return new ReadOnlyScore(null);
+            } else {
+                String grade = gradeInfo.getGrade();
+
+                if (isInstructor || gradeInfo.isGradeable()) {
+                    return new EditableScore(grade);
+                } else {
+                    return new ReadOnlyScore(grade);
+                }
+            }
+        }
+    }
+
+    @Value
+    private class CategoryAverageDefinition implements ColumnDefinition {
+        private Long categoryId;
+        private String categoryName;
+        private String title;
+        private String weight;
+        private boolean isExtraCredit; 
+        private String color;
+        private boolean hidden;
+
+        @Override
+        public String getType() {
+            return "category";
+        }
+
+        @Override
+        public Score getValueFor(GbStudentGradeInfo studentGradeInfo, boolean isInstructor) {
+            Map<Long, Double> categoryAverages = studentGradeInfo.getCategoryAverages();
+
+            Double average = categoryAverages.get(categoryId);
+
+            if (average == null) {
+                return new ReadOnlyScore(null);
+            } else {
+                return new ReadOnlyScore(FormatHelper.formatDoubleToDecimal(average));
+            }
+        }
+    }
+
+    @Value
+    private class DataSet {
+        private List<StudentDefinition> students;
+        private List<ColumnDefinition> columns;
+        private List<String[]> courseGrades;
+        private String serializedGrades;
+        private Map<String, Object> settings;
+
+        private int rowCount;
+        private int columnCount;
+
+        public DataSet(List<StudentDefinition> students,
+                       List<ColumnDefinition> columns,
+                       List<String[]> courseGrades,
+                       String serializedGrades,
+                       Map<String, Object> settings) {
+            this.students = students;
+            this.columns = columns;
+            this.courseGrades = courseGrades;
+            this.serializedGrades = serializedGrades;
+            this.settings = settings;
+
+            this.rowCount = students.size();
+            this.columnCount = columns.size();
+        }
+    }
+
+    private List<StudentDefinition> students;
+    private List<ColumnDefinition> columns;
+    private List<GbStudentGradeInfo> studentGradeInfoList;
+    private List<CategoryDefinition> categories;
+    private GradebookInformation settings;
+    private GradebookUiSettings uiSettings;
+    private GbRole role;
+    private Map<String, String> toolNameIconCSSMap;
+    private String defaultIconCSS;
+    private Map<String, Double> courseGradeMap;
+
+    private Component parent;
+
+    public GbGradebookData(List<GbStudentGradeInfo> studentGradeInfoList,
+                           List<Assignment> assignments,
+                           List<CategoryDefinition> categories,
+                           GradebookInformation settings,
+                           GradebookUiSettings uiSettings,
+                           GbRole role,
+                           Map<String, String> toolNameIconCSSMap,
+                           String defaultIconCSS,
+                           Map<String, Double> courseGradeMap,
+                           Component parentComponent) {
+        this.parent = parentComponent;
+        this.categories = categories;
+        this.settings = settings;
+        this.uiSettings = uiSettings;
+        this.role = role;
+
+        this.courseGradeMap = courseGradeMap;
+
+        this.studentGradeInfoList = studentGradeInfoList;
+
+        this.toolNameIconCSSMap = toolNameIconCSSMap;
+        this.defaultIconCSS = defaultIconCSS;
+
+        this.columns = loadColumns(assignments);
+        this.students = loadStudents(studentGradeInfoList);
+    }
+
+    public String toScript() {
+        ObjectMapper mapper = new ObjectMapper();
+
+        List<Score> grades = gradeList();
+
+        // if we can't edit one of the items,
+        // we need to serialize this into the data
+        if (!isInstructor() && grades.stream().anyMatch(g -> !g.canEdit())) {
+            int i = 0;
+            for(StudentDefinition student : this.students) {
+                String readonly = "";
+                for (ColumnDefinition column : this.columns) {
+                    Score score = grades.get(i);
+                    readonly += score.canEdit() ? "0" : "1";
+                    i = i + 1;
+                }
+                student.setReadonly(readonly);
+            }
+        }
+
+        DataSet dataset = new DataSet(
+            this.students, 
+            this.columns,
+            courseGrades(),
+            serializeGrades(grades),
+            serializeSettings());
+
+        try {
+            return mapper.writeValueAsString(dataset);
+        } catch (JsonProcessingException e) {
+            throw new RuntimeException(e);
+        }
+    }
+
+    private String serializeGrades(List<Score> gradeList) {
+        if (gradeList.stream().anyMatch(score -> score.isLarge())) {
+            return "json:" + serializeLargeGrades(gradeList);
+        } else {
+            return "packed:" + serializeSmallGrades(gradeList);
+        }
+    }
+
+    private String serializeLargeGrades(List<Score> gradeList) {
+        List<Double> scores = gradeList.stream().map(score -> score.isNull() ? -1 : score.getScore()).collect(Collectors.toList());
+
+        try {
+            ObjectMapper mapper = new ObjectMapper();
+            return mapper.writeValueAsString(scores);
+        } catch (JsonProcessingException e) {
+            throw new RuntimeException(e);
+        }
+    }
+
+    ///
+    // Pack our list of scores into as little space as possible.
+    //
+    // Most scores will be between 0 - 100, so we store small numbers in a
+    // single byte.  Larger scores will be stored in two bytes, and scores with
+    // fractional parts in three bytes.
+    //
+    // We go to all of this effort because grade tables can be very large.  A
+    // site with 2,000 students and 100 gradeable items will have 200,000
+    // scores.  Even if all of those scores were between 0 and 100, encoding
+    // them as a JSON array would use around 3 bytes per score (two digits plus
+    // a comma separator), for a total of 600KB.  We can generally at least
+    // halve that number by byte packing the numbers ourselves and unpacking
+    // them using JavaScript on the client.
+    //
+    // Why not just use AJAX and send them a chunk at a time?  The GradebookNG
+    // design is built around having a single large table of all grades, and
+    // firing AJAX requests on scroll events ends up being prohibitively slow.
+    // Having all the data available up front helps keep the scroll performance
+    // fast.
+    //
+    private String serializeSmallGrades(List<Score> gradeList) {
+        StringBuilder sb = new StringBuilder();
+
+        for (Score score : gradeList) {
+            if (score == null || score.isNull()) {
+                // No grade set.  Use a sentinel value.
+                sb.appendCodePoint(NULL_SENTINEL);
+                continue;
+            }
+
+            double grade = score.getScore();
+
+            boolean hasFraction = ((int)grade != grade);
+
+            if (grade < 127 && !hasFraction) {
+                // single byte, no fraction
+                //
+                // input number like 0nnnnnnn serialized as 0nnnnnnn
+                sb.appendCodePoint((int)grade & 0xFF);
+            } else if (grade < 16384 && !hasFraction) {
+                // two byte, no fraction
+                //
+                // input number like 00nnnnnn nnnnnnnn serialized as 10nnnnnn nnnnnnnn
+                //
+                // where leading '10' means 'two bytes, no fraction part'
+                sb.appendCodePoint(((int)grade >> 8) | 0b10000000);
+                sb.appendCodePoint(((int)grade & 0xFF));
+            } else if (grade < 16384) {
+                // three byte encoding, fraction
+                //
+                // input number like 00nnnnnn nnnnnnnn.25 serialized as 11nnnnnn nnnnnnnn 00011001
+                //
+                // where leading '11' means 'two bytes plus a fraction part',
+                // and the fraction part is stored as an integer between 0-99,
+                // where 50 represents 0.5, 25 represents .25, etc.
+
+                sb.appendCodePoint(((int)grade >> 8) | 0b11000000);
+                sb.appendCodePoint((int)grade & 0xFF);
+                sb.appendCodePoint((int)Math.round((grade * 100) - ((int)grade * 100)));
+            } else {
+                throw new RuntimeException("Grade too large: " + grade);
+            }
+        }
+
+        try {
+            return Base64.getEncoder().encodeToString(sb.toString().getBytes("ISO-8859-1"));
+        } catch (UnsupportedEncodingException e) {
+            throw new RuntimeException(e);
+        }
+    }
+
+    private Map<String, Object> serializeSettings() {
+        Map<String, Object> result = new HashedMap();
+
+        result.put("isCourseLetterGradeDisplayed", settings.isCourseLetterGradeDisplayed());
+        result.put("isCourseAverageDisplayed", settings.isCourseAverageDisplayed());
+        result.put("isCoursePointsDisplayed", settings.isCoursePointsDisplayed());
+        result.put("isPointsGradeEntry", GradingType.valueOf(settings.getGradeType()).equals(GradingType.POINTS));
+        result.put("isPercentageGradeEntry", GradingType.valueOf(settings.getGradeType()).equals(GradingType.PERCENTAGE));
+        result.put("isCategoriesEnabled", GbCategoryType.valueOf(settings.getCategoryType()) != GbCategoryType.NO_CATEGORY);
+        result.put("isCategoryTypeWeighted", GbCategoryType.valueOf(settings.getCategoryType()) == GbCategoryType.WEIGHTED_CATEGORY);
+        result.put("isStudentOrderedByLastName", uiSettings.getNameSortOrder() == GbStudentNameSortOrder.LAST_NAME);
+        result.put("isStudentOrderedByFirstName", uiSettings.getNameSortOrder() == GbStudentNameSortOrder.FIRST_NAME);
+        result.put("isGroupedByCategory", uiSettings.isGroupedByCategory());
+        result.put("isCourseGradeReleased", settings.isCourseGradeDisplayed());
+        result.put("showPoints", uiSettings.getShowPoints());
+        result.put("instructor", isInstructor());
+
+        return result;
+    };
+
+    private List<String[]> courseGrades() {
+        List<String[]> result = new ArrayList<String[]>();
+
+
+        final Map<String, Double> gradeMap = settings.getSelectedGradingScaleBottomPercents();
+        final List<String> ascendingGrades = new ArrayList<>(gradeMap.keySet());
+        ascendingGrades.sort(new Comparator<String>() {
+            @Override
+            public int compare(final String a, final String b) {
+                return new CompareToBuilder()
+                    .append(gradeMap.get(a), gradeMap.get(b))
+                    .toComparison();
+            }
+        });
+
+        for (GbStudentGradeInfo studentGradeInfo : this.studentGradeInfoList) {
+            // String[0] = A+ (95%) [133/140] -- display string
+            // String[1] = 95 -- raw percentage for sorting
+            // String[2] = 1 -- '1' if an override, '0' if calculated
+            String[] gradeData = new String[3];
+
+            GbCourseGrade gbCourseGrade = studentGradeInfo.getCourseGrade();
+            CourseGrade courseGrade = gbCourseGrade.getCourseGrade();
+
+            gradeData[0] = gbCourseGrade.getDisplayString();
+
+            if (StringUtils.isNotBlank(courseGrade.getEnteredGrade())) {
+                gradeData[2] = "1";
+            } else {
+                gradeData[2] = "0";
+            }
+
+            if (StringUtils.isNotBlank(courseGrade.getEnteredGrade())) {
+                Double mappedGrade = courseGradeMap.get(courseGrade.getEnteredGrade());
+                if(mappedGrade == null) {
+                    mappedGrade = new Double(0);
+                }
+                gradeData[1] = FormatHelper.formatDoubleToDecimal(mappedGrade);
+            } else {
+                if (courseGrade.getPointsEarned() == null) {
+                    gradeData[1] = "0";
+                } else {
+                    gradeData[1] = courseGrade.getCalculatedGrade();
+                }
+            }
+
+            result.add(gradeData);
+        }
+
+        return result;
+    }
+
+
+    private List<Score> gradeList() {
+        List<Score> result = new ArrayList<Score>();
+
+        for (GbStudentGradeInfo studentGradeInfo : this.studentGradeInfoList) {
+            for (ColumnDefinition column : this.columns) {
+                Score grade = column.getValueFor(studentGradeInfo, isInstructor());
+                result.add(grade);
+            }
+        }
+
+        return result;
+
+    }
+
+    private String getString(String key) {
+        return parent.getString(key);
+    }
+
+    private List<StudentDefinition> loadStudents(List<GbStudentGradeInfo> studentInfo) {
+        List<StudentDefinition> result = new ArrayList<StudentDefinition>();
+
+        for (GbStudentGradeInfo student : studentInfo) {
+            StudentDefinition studentDefinition = new StudentDefinition();
+            studentDefinition.setEid(student.getStudentEid());
+            studentDefinition.setUserId(student.getStudentUuid());
+            studentDefinition.setFirstName(student.getStudentFirstName());
+            studentDefinition.setLastName(student.getStudentLastName());
+            studentDefinition.setHasComments(formatCommentData(student));
+
+            // The JavaScript will ultimately set this when it detects
+            // concurrent edits.  Initialize to zeroo.
+            StringBuilder zeroes = new StringBuilder();
+            for (ColumnDefinition column : this.columns) {
+                zeroes.append("0");
+            }
+            studentDefinition.setHasConcurrentEdit(zeroes.toString());
+
+            result.add(studentDefinition);
+        }
+
+        return result;
+    }
+
+    private List<ColumnDefinition> loadColumns(List<Assignment> assignments) {
+        GradebookUiSettings userSettings = ((GradebookPage) parent.getPage()).getUiSettings();
+
+        List<ColumnDefinition> result = new ArrayList<ColumnDefinition>();
+
+        if (assignments.isEmpty()) {
+            return result;
+        }
+
+        for (int i = 0; i < assignments.size(); i++) {
+            Assignment a1 = assignments.get(i);
+            Assignment a2 = ((i + 1) < assignments.size()) ? assignments.get(i + 1) : null;
+
+            String categoryWeight = null;
+            if (a1.getWeight() != null) {
+                categoryWeight = FormatHelper.formatDoubleAsPercentage(a1.getWeight() * 100);
+            }
+
+            result.add(new AssignmentDefinition(a1.getId(),
+                                                a1.getName(),
+                                                FormatHelper.abbreviateMiddle(a1.getName()),
+                                                FormatHelper.formatDoubleToDecimal(a1.getPoints()),
+                                                FormatHelper.formatDate(a1.getDueDate(), getString("label.studentsummary.noduedate")),
+
+                                                a1.isReleased(),
+                                                a1.isCounted(),
+                                                a1.isExtraCredit(),
+                                                a1.isExternallyMaintained(),
+                                                a1.getExternalId(),
+                                                a1.getExternalAppName(),
+                                                getIconCSSForExternalAppName(a1.getExternalAppName()),
+
+                                                nullable(a1.getCategoryId()),
+                                                a1.getCategoryName(),
+                                                userSettings.getCategoryColor(a1.getCategoryName()),
+                                                nullable(categoryWeight),
+                                                a1.isCategoryExtraCredit(),
+
+                                                !uiSettings.isAssignmentVisible(a1.getId())));
+
+
+            // If we're at the end of the assignment list, or we've just changed
+            // categories, put out a total.
+            if (userSettings.isGroupedByCategory() &&
+                a1.getCategoryId() != null &&
+                (a2 == null || !a1.getCategoryId().equals(a2.getCategoryId()))) {
+                result.add(new CategoryAverageDefinition(a1.getCategoryId(),
+                                                         a1.getCategoryName(),
+                                                        (new StringResourceModel("label.gradeitem.categoryaverage", null, new Object[] { a1.getCategoryName() })).getString(),
+                                                         nullable(categoryWeight),
+                                                         a1.isCategoryExtraCredit(),
+                                                         userSettings.getCategoryColor(a1.getCategoryName()),
+                                                         !uiSettings.isCategoryScoreVisible(a1.getCategoryName())));
+            }
+        }
+
+        // if group by categories is disabled, then show all catagory scores
+        // at the end of the table
+        if (!userSettings.isGroupedByCategory()) {
+            for (CategoryDefinition category : categories) {
+                if (!category.getAssignmentList().isEmpty()) {
+                    String categoryWeight = null;
+                    if (category.getWeight() != null) {
+                        categoryWeight = FormatHelper.formatDoubleAsPercentage(category.getWeight() * 100);
+                    }
+                    result.add(new CategoryAverageDefinition(
+                        category.getId(),
+                        category.getName(),
+                        (new StringResourceModel("label.gradeitem.categoryaverage", null, new Object[] { category.getName() })).getString(),
+                        nullable(categoryWeight),
+                        category.isExtraCredit(),
+                        userSettings.getCategoryColor(category.getName()),
+                        !uiSettings.isCategoryScoreVisible(category.getName())));
+                }
+            }
+        }
+
+        return result;
+    }
+
+    private String formatCommentData(GbStudentGradeInfo student) {
+        StringBuilder sb = new StringBuilder();
+
+        for (ColumnDefinition column : this.columns) {
+            if (column instanceof AssignmentDefinition) {
+                AssignmentDefinition assignmentColumn = (AssignmentDefinition) column;
+                GbGradeInfo gradeInfo = student.getGrades().get(assignmentColumn.getAssignmentId());
+                if (gradeInfo != null && !StringUtils.isBlank(gradeInfo.getGradeComment())) {
+                    sb.append('1');
+                } else {
+                    sb.append('0');
+                }
+            } else {
+                sb.append('0');
+            }
+        }
+
+        return sb.toString();
+    }
+
+    private String nullable(Object value) {
+        if (value == null) {
+            return null;
+        } else {
+            return value.toString();
+        }
+    }
+
+    private boolean isInstructor() {
+        return GbRole.INSTRUCTOR.equals(role);
+    }
+
+    private abstract class Score {
+        private String score;
+
+        public Score(String score) {
+            this.score = score;
+        }
+
+        abstract boolean canEdit();
+
+        // We assume you'll check isNull() prior to calling this
+        public double getScore() {
+            return Double.valueOf(score);
+        };
+
+        public boolean isNull() {
+            return score == null;
+        }
+
+        public boolean isLarge() {
+            return score != null && Double.valueOf(score) > 16384;
+        }
+    }
+
+    private class EditableScore extends Score {
+        public EditableScore(String score) {
+            super(score);
+        }
+
+        @Override
+        public boolean canEdit() {
+            return true;
+        }
+    }
+
+    private class ReadOnlyScore extends Score {
+        public ReadOnlyScore(String score) {
+            super(score);
+        }
+
+        @Override
+        public boolean canEdit() {
+            return false;
+        }
+    }
+
+    private String getIconCSSForExternalAppName(String externalAppName) {
+        if (toolNameIconCSSMap.containsKey(externalAppName)) {
+            return toolNameIconCSSMap.get(externalAppName);
+        }
+
+        return defaultIconCSS;
+    }
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbModalWindow.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbModalWindow.java
index ff34bb3fec..0ed41607c5 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbModalWindow.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GbModalWindow.java
@@ -15,6 +15,9 @@ public class GbModalWindow extends ModalWindow {
 	private static final long serialVersionUID = 1L;
 
 	private Component componentToReturnFocusTo;
+	private String assignmentIdToReturnFocusTo;
+	private String studentUuidToReturnFocusTo;
+	private boolean returnFocusToCourseGrade = false;
 	private List<WindowClosedCallback> closeCallbacks;
 	private boolean positionAtTop = false;
 
@@ -52,13 +55,13 @@ public class GbModalWindow extends ModalWindow {
 
 		// focus the first input field in the content pane
 		extraJavascript.append(String.format("setTimeout(function() {$('#%s :input:first:visible').focus();});",
-				getContent().getMarkupId()));
+			getContent().getMarkupId()));
 
 		// position at the top of the page
 		if (this.positionAtTop) {
 			extraJavascript.append(
-					String.format("setTimeout(function() {sakai.gradebookng.spreadsheet.positionModalAtTop($('#%s').closest('.wicket-modal'));});",
-							getContent().getMarkupId()));
+				String.format("setTimeout(function() {sakai.gradebookng.spreadsheet.positionModalAtTop($('#%s').closest('.wicket-modal'));});",
+					getContent().getMarkupId()));
 		}
 
 		return super.getShowJavaScript().toString() + extraJavascript.toString();
@@ -81,6 +84,28 @@ public class GbModalWindow extends ModalWindow {
 		this.componentToReturnFocusTo = component;
 	}
 
+	/**
+	 * Set the student to return focus to upon closing the window.
+	 *
+	 * @param component
+	 */
+	public void setStudentToReturnFocusTo(final String studentUuid) {
+		this.studentUuidToReturnFocusTo = studentUuid;
+	}
+
+	/**
+	 * Set the assignment to return focus to upon closing the window.
+	 *
+	 * @param component
+	 */
+	public void setAssignmentToReturnFocusTo(final String assignmentId) {
+		this.assignmentIdToReturnFocusTo = assignmentId;
+	}
+
+	public void setReturnFocusToCourseGrade() {
+		this.returnFocusToCourseGrade = true;
+	}
+
 	public void addWindowClosedCallback(final WindowClosedCallback callback) {
 		this.closeCallbacks.add(callback);
 	}
@@ -114,7 +139,25 @@ public class GbModalWindow extends ModalWindow {
 				// Return focus to defined component
 				if (GbModalWindow.this.componentToReturnFocusTo != null) {
 					target.appendJavaScript(String.format("setTimeout(function() {$('#%s').focus();});",
-							GbModalWindow.this.componentToReturnFocusTo.getMarkupId()));
+						GbModalWindow.this.componentToReturnFocusTo.getMarkupId()));
+				} else if (GbModalWindow.this.assignmentIdToReturnFocusTo != null &&
+					GbModalWindow.this.studentUuidToReturnFocusTo != null) {
+					target.appendJavaScript(String.format("setTimeout(function() {GbGradeTable.selectCell('%s', '%s');});",
+						GbModalWindow.this.assignmentIdToReturnFocusTo,
+						GbModalWindow.this.studentUuidToReturnFocusTo));
+				} else if (GbModalWindow.this.assignmentIdToReturnFocusTo != null) {
+					target.appendJavaScript(String.format("setTimeout(function() {GbGradeTable.selectCell('%s', null);});",
+						GbModalWindow.this.assignmentIdToReturnFocusTo));
+				} else if (GbModalWindow.this.studentUuidToReturnFocusTo != null) {
+					if (GbModalWindow.this.returnFocusToCourseGrade) {
+						target.appendJavaScript(String.format("setTimeout(function() {GbGradeTable.selectCourseGradeCell('%s');});",
+							GbModalWindow.this.studentUuidToReturnFocusTo));
+					} else {
+						target.appendJavaScript(String.format("setTimeout(function() {GbGradeTable.selectCell(null, '%s');});",
+							GbModalWindow.this.studentUuidToReturnFocusTo));
+					}
+				} else if (GbModalWindow.this.returnFocusToCourseGrade) {
+					target.appendJavaScript("setTimeout(function() {GbGradeTable.selectCourseGradeCell();});");
 				}
 			}
 		});
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GradebookUiSettings.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GradebookUiSettings.java
index 35ec308270..94221ac27a 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GradebookUiSettings.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/model/GradebookUiSettings.java
@@ -46,6 +46,9 @@ public class GradebookUiSettings implements Serializable {
 	@Getter
 	private boolean categoriesEnabled;
 
+	@Getter
+	private boolean groupedByCategory;
+
 	private final Map<Long, Boolean> assignmentVisibility;
 	private final Map<String, Boolean> categoryScoreVisibility;
 	private final Map<String, String> categoryColors;
@@ -134,29 +137,30 @@ public class GradebookUiSettings implements Serializable {
 		if (!this.categoryColors.containsKey(categoryName)) {
 			setCategoryColor(categoryName, generateRandomRGBColorString());
 		}
-
 		return this.categoryColors.get(categoryName);
 	}
 
-	public void setCategoryColors(final List<CategoryDefinition> categories) {
-		if (categories != null) {
-			for (CategoryDefinition category : categories) {
-				if (!this.categoryColors.containsKey(category.getName())) {
-					setCategoryColor(category.getName(), generateRandomRGBColorString());
-				}
-			}
+	public void initializeCategoryColors(final List<CategoryDefinition> categories) {
+		for (CategoryDefinition category : categories) {
+			setCategoryColor(category.getName(), generateRandomRGBColorString());
 		}
 	}
 
 	public void setCategoriesEnabled(final boolean categoriesEnabled){
 		this.categoriesEnabled = categoriesEnabled;
+		this.groupedByCategory = categoriesEnabled;
+		this.gradeSummaryGroupedByCategory = categoriesEnabled;
+	}
+
+	public void  setGroupedByCategory(final boolean groupedByCategory) {
+		this.groupedByCategory = groupedByCategory;
 		this.gradeSummaryGroupedByCategory = categoriesEnabled;
 	}
 
 	/**
 	 * Helper to generate a RGB CSS color string with values between 180-250 to ensure a lighter color e.g. rgb(181,222,199)
 	 */
-	private String generateRandomRGBColorString() {
+	public static String generateRandomRGBColorString() {
 		final Random rand = new Random();
 		final int min = 180;
 		final int max = 250;
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/BasePage.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/BasePage.java
index 5a55695c61..5fcd36aa97 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/BasePage.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/BasePage.java
@@ -204,7 +204,7 @@ public class BasePage extends WebPage {
 		response.render(
 			new PriorityHeaderItem(
 				JavaScriptHeaderItem
-					.forUrl(String.format("/library/webjars/bootstrap/3.3.7/js/bootstrap.min.js?version=%s", version))));
+					.forUrl(String.format("/library/webjars/bootstrap/3.3.6/js/bootstrap.min.js?version=%s", version))));
 		// Some global gradebookng styles
 		response.render(CssHeaderItem
 			.forUrl(String.format("/gradebookng-tool/styles/gradebook-shared.css?version=%s", version)));
@@ -270,4 +270,8 @@ public class BasePage extends WebPage {
 		log.debug("Redirecting to AccessDeniedPage: " + message);
 		throw new RestartResponseException(AccessDeniedPage.class, params);
 	}
+
+	public GbRole getCurrentRole() {
+		return BasePage.this.role;
+	}
 }
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.html
index 3cbf17490b..cbe916f766 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.html
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.html
@@ -10,17 +10,33 @@
     <div id="gbConnectionTimeoutFeedback" class="messageWarning" style="display:none;">
         <wicket:message key="feedback.connectiontimeout" />
     </div>
+    <div id="gbReorderColumnsFailed" class="messageWarning" style="display:none;">
+        <wicket:message key="feedback.reordercolumnsfailed" />
+    </div>
 
     <div class="row">
         <div class="col-sm-12">
-            <div class="pull-left">
+            <div class="col-sm-6">
                 <button wicket:id="addGradeItem" class="button_color gb-add-gradebook-item-button">
                     <wicket:message key="button.addgradeitem" />
                 </button>
-            </div>
-            <div class="pull-left">
+
                 <div wicket:id="liveGradingFeedback" class="gb-live-feedback"></div>
             </div>
+            <div class="col-sm-6 text-right">
+                <wicket:enclosure>
+                    <label for="filterByGroup" class="sr-only"><wicket:message key="filter.groups" /></label>
+                    <select id="filterByGroup" wicket:id="groupFilter">
+                        <option value="1">Section 1</option>
+                        <option value="2">Section 2</option>
+                    </select>
+                </wicket:enclosure>
+                <a wicket:id="captionToggle" href="javascript:void(0);" id="captionToggle" aria-popup="true" aria-controls="gradeTableCaption">
+                    <span class="sr-only">
+                        <wicket:message key="label.toolbar.togglehelp"/>
+                    </span>
+                </a>
+            </div>
         </div>
     </div>
 
@@ -32,60 +48,46 @@
 	<div wicket:id="deleteItemWindow" />
 	<div wicket:id="gradeStatisticsWindow" />
 	<div wicket:id="updateCourseGradeDisplayWindow" />
+	<div wicket:id="sortGradeItemsWindow" />
 
-    <div wicket:id="toolbar" id="gradebookGradesToolbar">
+    <div wicket:id="toolbar" id="gradebookGradesToolbar" class="btn-toolbar">
       <ul class="gb-toolbar-left">
         <li>
-          <label for="filterByGroup" style="display:none" aria-hidden="true"><wicket:message key="filter.groups" /></label>
-          <select id="filterByGroup" wicket:id="groupFilter">
-            <option value="1">Section 1</option>
-            <option value="2">Section 2</option>
-          </select>
+            <div class="gb-student-filter">
+                <label for="studentFilterInput" class="sr-only"><wicket:message key="filter.students"/></label>
+                <input type="text" id="studentFilterInput" class="form-control" aria-controls="gradeTable" wicket:message="placeholder:filter.students" accesskey="f">
+                <a class="gb-student-filter-clear-button" wicket:message="title:filter.studentsclear" href="javascript:void(0)">
+                    <i class="fa fa-times-circle" aria-hidden="true"></i>
+                </a>
+            </div>
         </li>
         <wicket:enclosure>
-        	<li><span wicket:id="groupFilterOnlyOne" class="gb-group-title" role="status">Section 001</span></li>
+            <li><span wicket:id="groupFilterOnlyOne" class="gb-group-title" role="status">Section 001</span></li>
         </wicket:enclosure>
-        <li><span wicket:id="studentSummary" class="gradebook-student-summary" role="status">Showing 20 of 25 Students</span></li>
+        <li class="gb-student-summary"><!-- Populated by JavaScript --></li>
       </ul>
       <ul class="gb-toolbar-right">
-        <li><span wicket:id="gradeItemSummary" class="gb-item-summary" role="status" aria-live="polite">Viewing <span class="counts"><strong class="visible">8</strong> out of <strong class="total">8</strong></span> Grade Items</span></li>
+        <li class="gb-grade-item-summary"><!-- Populated by JavaScript --></li>
         <li>
-          <button wicket:id="toggleGradeItemsToolbarItem" id="toggleGradeItemsToolbarItem" class="button" aria-popup="true" aria-controls="gradeItemsTogglePanel"><wicket:message key="label.toolbar.gradeitemstoggle"/></button>
+          <button wicket:id="toggleGradeItemsToolbarItem" id="toggleGradeItemsToolbarItem" class="button" aria-popup="true" aria-controls="gradeItemsTogglePanel"><wicket:message key="label.toolbar.toggleitems"/></button>
         </li>
         <li>
-          <button wicket:id="toggleCategoriesToolbarItem" id="toggleCategoriesToolbarItem" class="button" aria-controls="gradebookGradesTable"><wicket:message key="table.toolbar.categorytoggle"/></button>
+          <button wicket:id="sortGradeItemsToolbarItem" id="sortGradeItemsToolbarItem" class="button" aria-popup="true"><wicket:message key="label.toolbar.sortgradeitems"/></button>
         </li>
+        <wicket:enclosure>
+            <li>
+              <button wicket:id="toggleCategoriesToolbarItem" id="toggleCategoriesToolbarItem" class="button" aria-controls="gradeTable"><wicket:message key="label.toolbar.togglecategories"/></button>
+            </li>
+        </wicket:enclosure>
       </ul>
     </div>
-    <div id="gradebookGrades">
-      <div id="gradebookHorizontalOverflowWrapper">
-          <div id="gradebookVerticalOverflowWrapper">
-              <table wicket:id="table" id="gradebookGradesTable" class="table-striped table-bordered table-hover" role="grid"></table>
-          </div>
-      </div>
-    </div>
+
+    <!-- Here we go... -->
+    <div wicket:id="gradeTable" />
+
   </form>
 
   <div wicket:id="gradeItemsTogglePanel" id="gradeItemsTogglePanel" style="display: none;"/>
-  <div id="gradeItemsConcurrentUserWarning" style="display: none;">
-    <ul class="gb-popover-notifications">
-      <li class="gb-popover-notification-concurrentedit text-danger">
-        <wicket:message key="grade.notifications.concurrenteditbyuser" />
-      </li>
-    </ul>
-  </div>
-
-	<div id="gradeItemCellDropdownMenu" style="display:none">
-		<div class="btn-group">
-			<a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" wicket:message="title:grade.menulabel">
-				<span class="caret"></span>
-			</a>
-			<ul class="dropdown-menu dropdown-menu-right" role="menu">
-				<li><a class="gb-view-log" href="#" role="menuitem"><wicket:message key="grade.option.viewlog" /></a></li>
-				<li><a class="gb-edit-comments" href="#" role="menuitem"><wicket:message key="comment.option.edit" /></a></li>
-			</ul>
-		</div>
-	</div>
 </wicket:extend>
 
 </body>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.java
index 79db2c139e..a952766032 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/GradebookPage.java
@@ -1,14 +1,5 @@
 package org.sakaiproject.gradebookng.tool.pages;
 
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.Comparator;
-import java.util.Date;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.Random;
-
 import org.apache.commons.lang.StringUtils;
 import org.apache.wicket.AttributeModifier;
 import org.apache.wicket.Component;
@@ -17,15 +8,9 @@ import org.apache.wicket.Session;
 import org.apache.wicket.ajax.AjaxRequestTarget;
 import org.apache.wicket.ajax.form.AjaxFormComponentUpdatingBehavior;
 import org.apache.wicket.behavior.AttributeAppender;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.AbstractColumn;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.DataTable;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.IColumn;
-import org.apache.wicket.extensions.markup.html.repeater.data.table.NavigationToolbar;
-import org.apache.wicket.markup.ComponentTag;
 import org.apache.wicket.markup.head.CssHeaderItem;
 import org.apache.wicket.markup.head.IHeaderResponse;
 import org.apache.wicket.markup.head.JavaScriptHeaderItem;
-import org.apache.wicket.markup.html.WebComponent;
 import org.apache.wicket.markup.html.WebMarkupContainer;
 import org.apache.wicket.markup.html.basic.Label;
 import org.apache.wicket.markup.html.form.Button;
@@ -33,41 +18,47 @@ import org.apache.wicket.markup.html.form.ChoiceRenderer;
 import org.apache.wicket.markup.html.form.DropDownChoice;
 import org.apache.wicket.markup.html.form.Form;
 import org.apache.wicket.markup.html.panel.EmptyPanel;
-import org.apache.wicket.markup.repeater.Item;
-import org.apache.wicket.markup.repeater.data.ListDataProvider;
-import org.apache.wicket.model.IModel;
+import org.apache.wicket.model.LoadableDetachableModel;
 import org.apache.wicket.model.Model;
-import org.apache.wicket.model.StringResourceModel;
 import org.apache.wicket.util.string.StringValue;
 import org.sakaiproject.component.cover.ServerConfigurationService;
 import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.business.model.GbGradeInfo;
 import org.sakaiproject.gradebookng.business.model.GbGroup;
-import org.sakaiproject.gradebookng.business.model.GbStudentGradeInfo;
 import org.sakaiproject.gradebookng.business.util.GbStopWatch;
-import org.sakaiproject.gradebookng.business.util.MessageHelper;
+import org.sakaiproject.gradebookng.tool.actions.DeleteAssignmentAction;
+import org.sakaiproject.gradebookng.tool.actions.EditAssignmentAction;
+import org.sakaiproject.gradebookng.tool.actions.EditCommentAction;
+import org.sakaiproject.gradebookng.tool.actions.EditSettingsAction;
+import org.sakaiproject.gradebookng.tool.actions.GradeUpdateAction;
+import org.sakaiproject.gradebookng.tool.actions.MoveAssignmentLeftAction;
+import org.sakaiproject.gradebookng.tool.actions.MoveAssignmentRightAction;
+import org.sakaiproject.gradebookng.tool.actions.OverrideCourseGradeAction;
+import org.sakaiproject.gradebookng.tool.actions.SetScoreForUngradedAction;
+import org.sakaiproject.gradebookng.tool.actions.SetStudentNameOrderAction;
+import org.sakaiproject.gradebookng.tool.actions.SetZeroScoreAction;
+import org.sakaiproject.gradebookng.tool.actions.ToggleCourseGradePoints;
+import org.sakaiproject.gradebookng.tool.actions.ViewAssignmentStatisticsAction;
+import org.sakaiproject.gradebookng.tool.actions.ViewCourseGradeLogAction;
+import org.sakaiproject.gradebookng.tool.actions.ViewGradeLogAction;
+import org.sakaiproject.gradebookng.tool.actions.ViewGradeSummaryAction;
 import org.sakaiproject.gradebookng.tool.component.GbAjaxButton;
-import org.sakaiproject.gradebookng.tool.component.GbHeadersToolbar;
+import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
+import org.sakaiproject.gradebookng.tool.component.GbGradeTable;
+import org.sakaiproject.gradebookng.tool.model.GbGradeTableData;
 import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
 import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
 import org.sakaiproject.gradebookng.tool.panels.AddOrEditGradeItemPanel;
-import org.sakaiproject.gradebookng.tool.panels.AssignmentColumnHeaderPanel;
-import org.sakaiproject.gradebookng.tool.panels.CategoryColumnCellPanel;
-import org.sakaiproject.gradebookng.tool.panels.CategoryColumnHeaderPanel;
-import org.sakaiproject.gradebookng.tool.panels.CourseGradeColumnHeaderPanel;
-import org.sakaiproject.gradebookng.tool.panels.CourseGradeItemCellPanel;
-import org.sakaiproject.gradebookng.tool.panels.GradeItemCellPanel;
-import org.sakaiproject.gradebookng.tool.panels.StudentNameCellPanel;
-import org.sakaiproject.gradebookng.tool.panels.StudentNameColumnHeaderPanel;
+import org.sakaiproject.gradebookng.tool.panels.SortGradeItemsPanel;
 import org.sakaiproject.gradebookng.tool.panels.ToggleGradeItemsToolbarPanel;
 import org.sakaiproject.service.gradebook.shared.Assignment;
-import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
 import org.sakaiproject.service.gradebook.shared.GraderPermission;
 import org.sakaiproject.service.gradebook.shared.GradingType;
 import org.sakaiproject.service.gradebook.shared.PermissionDefinition;
 import org.sakaiproject.service.gradebook.shared.SortType;
 import org.sakaiproject.tool.gradebook.Gradebook;
 
+import java.util.*;
+
 /**
  * Grades page. Instructors and TAs see this one. Students see the {@link StudentPage}.
  *
@@ -75,10 +66,9 @@ import org.sakaiproject.tool.gradebook.Gradebook;
  *
  */
 public class GradebookPage extends BasePage {
-
 	private static final long serialVersionUID = 1L;
 
-	public static final String CREATED_ASSIGNMENT_ID_PARAM = "createdAssignmentId";
+	public static final String FOCUS_ASSIGNMENT_ID_PARAM = "focusAssignmentId";
 
 	// flag to indicate a category is uncategorised
 	// doubles as a translation key
@@ -92,6 +82,7 @@ public class GradebookPage extends BasePage {
 	GbModalWindow deleteItemWindow;
 	GbModalWindow gradeStatisticsWindow;
 	GbModalWindow updateCourseGradeDisplayWindow;
+	GbModalWindow sortGradeItemsWindow;
 
 	Label liveGradingFeedback;
 	boolean hasAssignmentsAndGrades;
@@ -100,6 +91,7 @@ public class GradebookPage extends BasePage {
 
 	List<PermissionDefinition> permissions = new ArrayList<>();
 	boolean showGroupFilter = true;
+	private GbGradeTable gradeTable;
 
 	@SuppressWarnings({ "rawtypes", "unchecked", "serial" })
 	public GradebookPage() {
@@ -136,6 +128,9 @@ public class GradebookPage extends BasePage {
 		this.form = new Form<Void>("form");
 		add(this.form);
 
+		form.add(new AttributeModifier("data-siteid", businessService.getCurrentSiteId()));
+		form.add(new AttributeModifier("data-gradestimestamp", new Date().getTime()));
+
 		/**
 		 * Note that SEMI_TRANSPARENT has a 100% black background and TRANSPARENT is overridden to 10% opacity
 		 */
@@ -157,6 +152,10 @@ public class GradebookPage extends BasePage {
 		this.gradeCommentWindow = new GbModalWindow("gradeCommentWindow");
 		this.form.add(this.gradeCommentWindow);
 
+		this.sortGradeItemsWindow = new GbModalWindow("sortGradeItemsWindow");
+		this.sortGradeItemsWindow.showUnloadConfirmation(false);
+		this.form.add(this.sortGradeItemsWindow);
+
 		this.deleteItemWindow = new GbModalWindow("deleteItemWindow");
 		this.form.add(this.deleteItemWindow);
 
@@ -193,7 +192,7 @@ public class GradebookPage extends BasePage {
 		final GradebookUiSettings settings = getUiSettings();
 
 		SortType sortBy = SortType.SORT_BY_SORTING;
-		if (settings.isCategoriesEnabled()) {
+		if (settings.isCategoriesEnabled() && settings.isGroupedByCategory()) {
 			// Pre-sort assignments by the categorized sort order
 			sortBy = SortType.SORT_BY_CATEGORY;
 			this.form.add(new AttributeAppender("class", "gb-grouped-by-category"));
@@ -202,21 +201,10 @@ public class GradebookPage extends BasePage {
 		// get Gradebook to save additional calls later
 		final Gradebook gradebook = this.businessService.getGradebook();
 
-		// get list of assignments. this allows us to build the columns and then
-		// fetch the grades for each student for each assignment from
-		// the map
 		final List<Assignment> assignments = this.businessService.getGradebookAssignments(sortBy);
-		stopwatch.time("getGradebookAssignments", stopwatch.getTime());
-
-		// get the grade matrix. It should be sorted if we have that info
-		final List<GbStudentGradeInfo> grades = this.businessService.buildGradeMatrix(assignments, settings);
+		final List<String> students = this.businessService.getGradeableUsers();
 
-		this.hasAssignmentsAndGrades = !assignments.isEmpty() && !grades.isEmpty();
-
-		// mark the current timestamp so we can use this date to check for any changes since now
-		final Date gradesTimestamp = new Date();
-
-		stopwatch.time("buildGradeMatrix", stopwatch.getTime());
+		hasAssignmentsAndGrades = !assignments.isEmpty() && !students.isEmpty(); 
 
 		// categories enabled?
 		final boolean categoriesEnabled = this.businessService.categoriesAreEnabled();
@@ -224,339 +212,60 @@ public class GradebookPage extends BasePage {
 		// grading type?
 		final GradingType gradingType = GradingType.valueOf(gradebook.getGrade_type());
 
-		// this could potentially be a sortable data provider
-		final ListDataProvider<GbStudentGradeInfo> studentGradeMatrix = new ListDataProvider<GbStudentGradeInfo>(grades);
-		final List<IColumn> cols = new ArrayList<IColumn>();
-
-		// add an empty column that we can use as a handle for selecting the row
-		final AbstractColumn handleColumn = new AbstractColumn(new Model("")) {
-
-			@Override
-			public void populateItem(final Item cellItem, final String componentId, final IModel rowModel) {
-				cellItem.add(new EmptyPanel(componentId));
-			}
-
-			@Override
-			public String getCssClass() {
-				return "gb-row-selector";
-			}
-		};
-		cols.add(handleColumn);
-
-		// student name column
-		final AbstractColumn studentNameColumn = new AbstractColumn(new Model("studentColumn")) {
-
-			@Override
-			public Component getHeader(final String componentId) {
-				return new StudentNameColumnHeaderPanel(componentId, Model.of(settings.getNameSortOrder()));
-			}
-
-			@Override
-			public void populateItem(final Item cellItem, final String componentId, final IModel rowModel) {
-				final GbStudentGradeInfo studentGradeInfo = (GbStudentGradeInfo) rowModel.getObject();
-
-				final Map<String, Object> modelData = new HashMap<>();
-				modelData.put("userId", studentGradeInfo.getStudentUuid());
-				modelData.put("eid", studentGradeInfo.getStudentEid());
-				modelData.put("firstName", studentGradeInfo.getStudentFirstName());
-				modelData.put("lastName", studentGradeInfo.getStudentLastName());
-				modelData.put("displayName", studentGradeInfo.getStudentDisplayName());
-				modelData.put("nameSortOrder", settings.getNameSortOrder());
-
-				cellItem.add(new StudentNameCellPanel(componentId, Model.ofMap(modelData)));
-				cellItem.add(new AttributeModifier("data-studentUuid", studentGradeInfo.getStudentUuid()));
-				cellItem.add(new AttributeModifier("abbr", studentGradeInfo.getStudentDisplayName()));
-				cellItem.add(new AttributeModifier("aria-label", studentGradeInfo.getStudentDisplayName()));
-
-				// TODO may need a subclass of Item that does the onComponentTag
-				// override and then tag.setName("th");
-			}
-
-			@Override
-			public String getCssClass() {
-				return "gb-student-cell";
-			}
-
-		};
-		cols.add(studentNameColumn);
-
-		// course grade column
-		final boolean courseGradeVisible = this.businessService.isCourseGradeVisible(this.currentUserUuid);
-		final AbstractColumn courseGradeColumn = new AbstractColumn(new Model("")) {
-			@Override
-			public Component getHeader(final String componentId) {
-				return new CourseGradeColumnHeaderPanel(componentId, Model.of(settings.getShowPoints()));
-			}
-
-			@Override
-			public String getCssClass() {
-				final String cssClass = "gb-course-grade";
-				if (settings.getShowPoints()) {
-					return cssClass + " points";
-				} else {
-					return cssClass;
-				}
-			}
-
-			@Override
-			public void populateItem(final Item cellItem, final String componentId, final IModel rowModel) {
-				final GbStudentGradeInfo studentGradeInfo = (GbStudentGradeInfo) rowModel.getObject();
-
-				cellItem.add(new AttributeModifier("tabindex", 0));
-
-				// setup model
-				// TODO we may not need to pass everything into this panel since we now use a display string
-				// however we do requre that the label can receive events and update itself, although this could be recalculated for each
-				// event
-				final Map<String, Object> modelData = new HashMap<>();
-				modelData.put("courseGradeDisplay", studentGradeInfo.getCourseGrade().getDisplayString());
-				modelData.put("hasCourseGradeOverride", studentGradeInfo.getCourseGrade().getCourseGrade().getEnteredGrade() != null);
-				modelData.put("studentUuid", studentGradeInfo.getStudentUuid());
-				modelData.put("currentUserUuid", GradebookPage.this.currentUserUuid);
-				modelData.put("currentUserRole", GradebookPage.this.role);
-				modelData.put("gradebook", gradebook);
-				modelData.put("showPoints", settings.getShowPoints());
-				modelData.put("showOverride", true);
-				modelData.put("courseGradeVisible", courseGradeVisible);
-
-				cellItem.add(new CourseGradeItemCellPanel(componentId, Model.ofMap(modelData)));
-				cellItem.setOutputMarkupId(true);
-			}
-		};
-		cols.add(courseGradeColumn);
-
-		// build the rest of the columns based on the assignment list
-		for (final Assignment assignment : assignments) {
-
-			final AbstractColumn column = new AbstractColumn(new Model(assignment)) {
-
-				@Override
-				public Component getHeader(final String componentId) {
-					final AssignmentColumnHeaderPanel panel = new AssignmentColumnHeaderPanel(componentId,
-							new Model<Assignment>(assignment), gradingType);
-
-					panel.add(new AttributeModifier("data-category", assignment.getCategoryName()));
-					panel.add(new AttributeModifier("data-category-id", assignment.getCategoryId()));
-
-					final StringValue createdAssignmentId = getPageParameters().get(CREATED_ASSIGNMENT_ID_PARAM);
-					if (!createdAssignmentId.isNull() && assignment.getId().equals(createdAssignmentId.toLong())) {
-						panel.add(new AttributeModifier("class", "gb-just-created"));
-						getPageParameters().remove(CREATED_ASSIGNMENT_ID_PARAM);
-					}
-
-					return panel;
-				}
-
-				@Override
-				public String getCssClass() {
-					return "gb-grade-item-column-cell";
-				}
-
-				@Override
-				public void populateItem(final Item cellItem, final String componentId, final IModel rowModel) {
-					final GbStudentGradeInfo studentGrades = (GbStudentGradeInfo) rowModel.getObject();
-
-					final GbGradeInfo gradeInfo = studentGrades.getGrades().get(assignment.getId());
-
-					final Map<String, Object> modelData = new HashMap<>();
-					modelData.put("assignmentId", assignment.getId());
-					modelData.put("assignmentName", assignment.getName());
-					modelData.put("assignmentPoints", assignment.getPoints());
-					modelData.put("studentUuid", studentGrades.getStudentUuid());
-					modelData.put("studentName", studentGrades.getStudentDisplayName());
-					modelData.put("categoryId", assignment.getCategoryId());
-					modelData.put("isExternal", assignment.isExternallyMaintained());
-					modelData.put("externalAppName", assignment.getExternalAppName());
-					modelData.put("gradeInfo", gradeInfo);
-					modelData.put("role", GradebookPage.this.role);
-					modelData.put("gradingType", gradingType);
-
-					cellItem.add(new GradeItemCellPanel(componentId, Model.ofMap(modelData)));
-
-					cellItem.setOutputMarkupId(true);
-				}
-
-			};
-
-			cols.add(column);
-		}
-
-		// render the categories
-		// Display rules:
-		// 1. only show categories if the global setting is enabled
-		// 2. only show categories if they have items
-		// TODO may be able to pass this list into the matrix to save another
-		// lookup in there)
-
-		List<CategoryDefinition> categories = new ArrayList<>();
-
-		if (categoriesEnabled) {
-
-			// only work with categories if enabled
-			categories = this.businessService.getGradebookCategories();
-
-			// remove those that have no assignments
-			categories.removeIf(cat -> cat.getAssignmentList().isEmpty());
-
-			Collections.sort(categories, CategoryDefinition.orderComparator);
-
-			int currentColumnIndex = 3; // take into account first three header
-										// columns
-
-			for (final CategoryDefinition category : categories) {
-
-				if (category.getAssignmentList().isEmpty()) {
-					continue;
-				}
-
-				final AbstractColumn column = new AbstractColumn(new Model(category)) {
-
-					@Override
-					public Component getHeader(final String componentId) {
-						final CategoryColumnHeaderPanel panel = new CategoryColumnHeaderPanel(componentId,
-								new Model<CategoryDefinition>(category));
-
-						panel.add(new AttributeModifier("data-category", category.getName()));
-
-						return panel;
-					}
-
-					@Override
-					public void populateItem(final Item cellItem, final String componentId, final IModel rowModel) {
-						final GbStudentGradeInfo studentGrades = (GbStudentGradeInfo) rowModel.getObject();
-
-						final Double score = studentGrades.getCategoryAverages().get(category.getId());
-
-						final Map<String, Object> modelData = new HashMap<>();
-						modelData.put("score", score);
-						modelData.put("studentUuid", studentGrades.getStudentUuid());
-						modelData.put("categoryId", category.getId());
-
-						cellItem.add(new CategoryColumnCellPanel(componentId, Model.ofMap(modelData)));
-						cellItem.setOutputMarkupId(true);
-					}
-
-					@Override
-					public String getCssClass() {
-						return "gb-category-item-column-cell";
-					}
-
-				};
-
-				if (settings.isCategoriesEnabled()) {
-					// insert category column after assignments in that category
-					currentColumnIndex = currentColumnIndex + category.getAssignmentList().size();
-					cols.add(currentColumnIndex, column);
-					currentColumnIndex = currentColumnIndex + 1;
-				} else {
-					// add to the end of the column list
-					cols.add(column);
-				}
-			}
-		}
-
-		stopwatch.time("all Columns added", stopwatch.getTime());
-
-		// TODO make this AjaxFallbackDefaultDataTable
-		final DataTable table = new DataTable("table", cols, studentGradeMatrix, 100) {
-			@Override
-			protected Item newCellItem(final String id, final int index, final IModel model) {
-				return new Item(id, index, model) {
-					@Override
-					protected void onComponentTag(final ComponentTag tag) {
-						super.onComponentTag(tag);
-
-						final Object modelObject = model.getObject();
-
-						if (modelObject instanceof AbstractColumn && "studentColumn"
-								.equals(((AbstractColumn) modelObject).getDisplayModel().getObject())) {
-							tag.setName("th");
-							tag.getAttributes().put("role", "rowheader");
-							tag.getAttributes().put("scope", "row");
-						} else {
-							tag.getAttributes().put("role", "gridcell");
-						}
-						tag.getAttributes().put("tabindex", "0");
-					}
-				};
-			}
-
-			@Override
-			protected Item newRowItem(final String id, final int index, final IModel model) {
-				return new Item(id, index, model) {
-					@Override
-					protected void onComponentTag(final ComponentTag tag) {
-						super.onComponentTag(tag);
-
-						tag.getAttributes().put("role", "row");
-					}
-				};
-			}
-
-			@Override
-			protected IModel<String> getCaptionModel() {
-				return Model.of(MessageHelper.getString("gradespage.caption"));
-			}
-		};
-		table.addBottomToolbar(new NavigationToolbar(table) {
-			@Override
-			protected WebComponent newNavigatorLabel(final String navigatorId, final DataTable<?, ?> table) {
-				return constructTablePaginationLabel(navigatorId, table);
-			}
-		});
-
-		final Map<String, Object> modelData = new HashMap<>();
-		modelData.put("assignments", assignments);
-		modelData.put("categories", categories);
-		modelData.put("categoryType", this.businessService.getGradebookCategoryType());
-		modelData.put("categoriesEnabled", categoriesEnabled);
-
-		table.addTopToolbar(new GbHeadersToolbar(table, null, Model.ofMap(modelData)));
-		table.add(new AttributeModifier("data-siteid", this.businessService.getCurrentSiteId()));
-		table.add(new AttributeModifier("data-gradestimestamp", gradesTimestamp.getTime()));
-
-		// enable drag and drop based on user role (note: entity provider has
-		// role checks on exposed API)
-		table.add(new AttributeModifier("data-sort-enabled", this.role == GbRole.INSTRUCTOR));
-
 		final WebMarkupContainer noAssignments = new WebMarkupContainer("noAssignments");
-		noAssignments.setVisible(false);
+		noAssignments.setVisible(assignments.isEmpty());
 		this.form.add(noAssignments);
 
 		final WebMarkupContainer noStudents = new WebMarkupContainer("noStudents");
-		noStudents.setVisible(false);
+		noStudents.setVisible(students.isEmpty());
 		this.form.add(noStudents);
 
-		this.form.add(table);
-
 		// Populate the toolbar
 		final WebMarkupContainer toolbar = new WebMarkupContainer("toolbar");
 		this.form.add(toolbar);
 
-		toolbar.add(constructTableSummaryLabel("studentSummary", table));
-
-		final Label gradeItemSummary = new Label("gradeItemSummary",
-				new StringResourceModel("label.toolbar.gradeitemsummary", null, assignments.size() + categories.size(),
-						assignments.size() + categories.size()));
-		gradeItemSummary.setEscapeModelStrings(false);
-		toolbar.add(gradeItemSummary);
-
 		final WebMarkupContainer toggleGradeItemsToolbarItem = new WebMarkupContainer("toggleGradeItemsToolbarItem");
 		toolbar.add(toggleGradeItemsToolbarItem);
 
+		gradeTable = new GbGradeTable("gradeTable",
+					      new LoadableDetachableModel() {
+						      @Override
+						      public GbGradeTableData load() {
+							      return new GbGradeTableData(businessService, settings);
+						      }
+					      });
+		gradeTable.addEventListener("setScore", new GradeUpdateAction());
+		gradeTable.addEventListener("viewLog", new ViewGradeLogAction());
+		gradeTable.addEventListener("editAssignment", new EditAssignmentAction());
+		gradeTable.addEventListener("viewStatistics", new ViewAssignmentStatisticsAction());
+		gradeTable.addEventListener("overrideCourseGrade", new OverrideCourseGradeAction());
+		gradeTable.addEventListener("editComment", new EditCommentAction());
+		gradeTable.addEventListener("viewGradeSummary", new ViewGradeSummaryAction());
+		gradeTable.addEventListener("setZeroScore", new SetZeroScoreAction());
+		gradeTable.addEventListener("viewCourseGradeLog", new ViewCourseGradeLogAction());
+		gradeTable.addEventListener("deleteAssignment", new DeleteAssignmentAction());
+		gradeTable.addEventListener("setUngraded", new SetScoreForUngradedAction());
+		gradeTable.addEventListener("setStudentNameOrder", new SetStudentNameOrderAction());
+		gradeTable.addEventListener("toggleCourseGradePoints", new ToggleCourseGradePoints());
+		gradeTable.addEventListener("editSettings", new EditSettingsAction());
+		gradeTable.addEventListener("moveAssignmentLeft", new MoveAssignmentLeftAction());
+		gradeTable.addEventListener("moveAssignmentRight", new MoveAssignmentRightAction());
+
+		this.form.add(gradeTable);
+
 		final Button toggleCategoriesToolbarItem = new Button("toggleCategoriesToolbarItem") {
 			@Override
 			protected void onInitialize() {
 				super.onInitialize();
-				if (settings.isCategoriesEnabled()) {
+				if (settings.isGroupedByCategory()) {
 					add(new AttributeAppender("class", " on"));
 				}
-				add(new AttributeModifier("aria-pressed", settings.isCategoriesEnabled()));
+				add(new AttributeModifier("aria-pressed", settings.isGroupedByCategory()));
 			}
 
 			@Override
 			public void onSubmit() {
-				settings.setCategoriesEnabled(!settings.isCategoriesEnabled());
+				settings.setGroupedByCategory(!settings.isGroupedByCategory());
 				setUiSettings(settings);
 
 				// refresh
@@ -565,11 +274,33 @@ public class GradebookPage extends BasePage {
 
 			@Override
 			public boolean isVisible() {
-				return categoriesEnabled && !assignments.isEmpty();
+				return categoriesEnabled;
 			}
 		};
 		toolbar.add(toggleCategoriesToolbarItem);
 
+		final GbAjaxLink sortGradeItemsToolbarItem = new GbAjaxLink("sortGradeItemsToolbarItem") {
+			@Override
+			public void onClick(AjaxRequestTarget target) {
+				GbModalWindow window = GradebookPage.this.getSortGradeItemsWindow();
+
+				Map<String, Object> model = new HashMap<>();
+				model.put("categoriesEnabled", categoriesEnabled);
+				model.put("settings", settings);
+
+				window.setTitle(getString("sortgradeitems.heading"));
+				window.setContent(new SortGradeItemsPanel(window.getContentId(), Model.ofMap(model), window));
+				window.setComponentToReturnFocusTo(this);
+				window.show(target);
+			}
+
+			@Override
+			public boolean isVisible() {
+				return GradebookPage.this.role == GbRole.INSTRUCTOR;
+			}
+		};
+		toolbar.add(sortGradeItemsToolbarItem);
+
 		// section and group dropdown
 		final List<GbGroup> groups = this.businessService.getSiteSectionsAndGroups();
 
@@ -648,45 +379,35 @@ public class GradebookPage extends BasePage {
 		groupFilter.setNullValid(false);
 
 		// if only one item, hide the dropdown
-		if (groups.size() == 1) {
+		if (groups.size() == 1 || !this.hasAssignmentsAndGrades) {
 			groupFilter.setVisible(false);
 		}
 
+		this.form.add(groupFilter);
 
-		final ToggleGradeItemsToolbarPanel gradeItemsTogglePanel = new ToggleGradeItemsToolbarPanel(
-				"gradeItemsTogglePanel", Model.ofList(assignments));
+		final Map<String, Object> togglePanelModel = new HashMap<>();
+		togglePanelModel.put("assignments", this.businessService.getGradebookAssignments(sortBy));
+		togglePanelModel.put("settings", settings);
+		togglePanelModel.put("categoriesEnabled", categoriesEnabled);
+
+		final ToggleGradeItemsToolbarPanel gradeItemsTogglePanel =
+			new ToggleGradeItemsToolbarPanel("gradeItemsTogglePanel", Model.ofMap(togglePanelModel));
+		//gradeItemsTogglePanel.setVisible(false);
 		add(gradeItemsTogglePanel);
 
+		this.form.add(new WebMarkupContainer("captionToggle").setVisible(this.hasAssignmentsAndGrades));
+
 		//
 		// hide/show components
 		//
 
-		// no assignments, hide table, show message
-		if (assignments.isEmpty()) {
-			table.setVisible(false);
-			toggleGradeItemsToolbarItem.setVisible(false);
-			noAssignments.setVisible(true);
-		}
-
-		// no visible students, show table, show message
-		// don't want two messages though, hence the else
-		else if (grades.size() == 0) {
-			noStudents.setVisible(true);
-		}
-
 		toolbar.setVisible(this.hasAssignmentsAndGrades);
-
-		//#3755 if group selected but it is empty, bring the groupfilter back into view so they can choose something else
-		if (settings.getGroupFilter() != null && grades.size() == 0) {
-			toolbar.setVisible(true);
-			groupFilter.setVisible(true);
-		}
-
-		toolbar.add(groupFilter);
+		gradeTable.setVisible(this.hasAssignmentsAndGrades);
 
 		stopwatch.time("Gradebook page done", stopwatch.getTime());
 	}
 
+
 	/**
 	 * Getters for panels to get at modal windows
 	 *
@@ -724,10 +445,13 @@ public class GradebookPage extends BasePage {
 		return this.updateCourseGradeDisplayWindow;
 	}
 
+	public GbModalWindow getSortGradeItemsWindow() {
+		return this.sortGradeItemsWindow;
+	}
+
 	/**
 	 * Getter for the GradebookUiSettings. Used to store a few UI related settings for the current session only.
 	 *
-	 * TODO move this to a helper
 	 */
 	public GradebookUiSettings getUiSettings() {
 
@@ -736,7 +460,8 @@ public class GradebookPage extends BasePage {
 		if (settings == null) {
 			settings = new GradebookUiSettings();
 			settings.setCategoriesEnabled(this.businessService.categoriesAreEnabled());
-			settings.setCategoryColors(this.businessService.getGradebookCategories());
+			settings.initializeCategoryColors(this.businessService.getGradebookCategories());
+			settings.setCategoryColor(getString(GradebookPage.UNCATEGORISED), settings.generateRandomRGBColorString());
 			setUiSettings(settings);
 		}
 
@@ -771,109 +496,38 @@ public class GradebookPage extends BasePage {
 
 		// GradebookNG Grade specific styles and behaviour
 		response.render(CssHeaderItem
-				.forUrl(String.format("/gradebookng-tool/styles/gradebook-grades.css?version=%s", version)));
+			.forUrl(String.format("/gradebookng-tool/styles/gradebook-grades.css?version=%s", version)));
+		response.render(CssHeaderItem
+				.forUrl(String.format("/gradebookng-tool/styles/gradebook-gbgrade-table.css?version=%s", version)));
+		response.render(CssHeaderItem
+				.forUrl(String.format("/gradebookng-tool/styles/gradebook-sorter.css?version=%s", version)));
 		response.render(CssHeaderItem
 				.forUrl(String.format("/gradebookng-tool/styles/gradebook-print.css?version=%s", version), "print"));
 		response.render(JavaScriptHeaderItem
-				.forUrl(String.format("/gradebookng-tool/scripts/gradebook-grades.js?version=%s", version)));
-		response.render(JavaScriptHeaderItem
 				.forUrl(String.format("/gradebookng-tool/scripts/gradebook-grade-summary.js?version=%s", version)));
 		response.render(JavaScriptHeaderItem
 				.forUrl(String.format("/gradebookng-tool/scripts/gradebook-update-ungraded.js?version=%s", version)));
-	}
-
-	/**
-	 * Helper to generate a RGB CSS color string with values between 180-250 to ensure a lighter color e.g. rgb(181,222,199)
-	 */
-	public String generateRandomRGBColorString() {
-		final Random rand = new Random();
-		final int min = 180;
-		final int max = 250;
-
-		final int r = rand.nextInt((max - min) + 1) + min;
-		final int g = rand.nextInt((max - min) + 1) + min;
-		final int b = rand.nextInt((max - min) + 1) + min;
-
-		return String.format("rgb(%d,%d,%d)", r, g, b);
-	}
-
-	/**
-	 * Build a table row summary for the table
-	 */
-	private Label constructTableSummaryLabel(final String componentId, final DataTable table) {
-		return constructTableLabel(componentId, table, false);
-	}
-
-	/**
-	 * Build a table pagination summary for the table
-	 */
-	private Label constructTablePaginationLabel(final String componentId, final DataTable table) {
-		return constructTableLabel(componentId, table, true);
-	}
-
-	/**
-	 * Build a table summary for the table along the lines of if verbose: "Showing 1{from} to 100{to} of 153{of} students" else:
-	 * "Showing 100{to} students"
-	 */
-	private Label constructTableLabel(final String componentId, final DataTable table, final boolean verbose) {
-		final long of = table.getItemCount();
-		final long from = (of == 0 ? 0 : table.getCurrentPage() * table.getItemsPerPage() + 1);
-		final long to = (of == 0 ? 0 : Math.min(of, from + table.getItemsPerPage() - 1));
-
-		StringResourceModel labelText;
+		response.render(JavaScriptHeaderItem
+				.forUrl(String.format("/gradebookng-tool/scripts/gradebook-sorter.js?version=%s", version)));
+		response.render(JavaScriptHeaderItem
+			.forUrl(String.format("/gradebookng-tool/scripts/gradebook-connection-poll.js?version=%s", version)));
 
-		if (verbose) {
-			labelText = new StringResourceModel("label.toolbar.studentsummarypaginated", null, from, to, of);
-		} else {
-			labelText = new StringResourceModel("label.toolbar.studentsummary", null, to);
+		// NYU help popup resources
+		response.render(CssHeaderItem
+			.forUrl(String.format("/gradebookng-tool/styles/gradebook-help-popup.css?version=%s", version)));
+		response.render(JavaScriptHeaderItem
+			.forUrl(String.format("/gradebookng-tool/scripts/gradebook-help-popup.js?version=%s", version)));
+
+		final StringValue focusAssignmentId = getPageParameters().get(FOCUS_ASSIGNMENT_ID_PARAM);
+		if (!focusAssignmentId.isNull()) {
+			getPageParameters().remove(FOCUS_ASSIGNMENT_ID_PARAM);
+			response.render(JavaScriptHeaderItem
+				.forScript(
+					String.format("GbGradeTable.focusColumnForAssignmentId(%s)", focusAssignmentId.toString()),
+					null));
 		}
-
-		final Label label = new Label(componentId, labelText);
-		label.setEscapeModelStrings(false); // to allow embedded HTML
-
-		return label;
 	}
 
-	/**
-	 * Comparator class for sorting Assignments in their categorised ordering
-	 */
-	class CategorizedAssignmentComparator implements Comparator<Assignment> {
-		@Override
-		public int compare(final Assignment a1, final Assignment a2) {
-			// if in the same category, sort by their categorized sort order
-			if (a1.getCategoryId() == a2.getCategoryId()) {
-				// handles null orders by putting them at the end of the list
-				if (a1.getCategorizedSortOrder() == null) {
-					return 1;
-				} else if (a2.getCategorizedSortOrder() == null) {
-					return -1;
-				}
-				return Integer.compare(a1.getCategorizedSortOrder(), a2.getCategorizedSortOrder());
-
-				// otherwise, sort by their category order
-			} else {
-				if (a1.getCategoryOrder() == null && a2.getCategoryOrder() == null) {
-					// both orders are null.. so order by A-Z
-					if (a1.getCategoryName() == null && a2.getCategoryName() == null) {
-						// both names are null so order by id
-						return a1.getCategoryId().compareTo(a2.getCategoryId());
-					} else if (a1.getCategoryName() == null) {
-						return 1;
-					} else if (a2.getCategoryName() == null) {
-						return -1;
-					} else {
-						return a1.getCategoryName().compareTo(a2.getCategoryName());
-					}
-				} else if (a1.getCategoryOrder() == null) {
-					return 1;
-				} else if (a2.getCategoryOrder() == null) {
-					return -1;
-				} else {
-					return a1.getCategoryOrder().compareTo(a2.getCategoryOrder());
-				}
-			}
-		}
-	}
 
 	@Override
 	public void onBeforeRender() {
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/StudentPage.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/StudentPage.java
index 7f8ceab913..389cee7e2f 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/StudentPage.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/pages/StudentPage.java
@@ -29,7 +29,7 @@ public class StudentPage extends BasePage {
 		final User u = this.businessService.getCurrentUser();
 
 		final Map<String, Object> userData = new HashMap<>();
-		userData.put("userId", u.getId());
+		userData.put("studentUuid", u.getId());
 		userData.put("groupedByCategoryByDefault", true);
 
 		add(new Label("heading", new StringResourceModel("heading.studentpage", null, new Object[] { u.getDisplayName() })));
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AddOrEditGradeItemPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AddOrEditGradeItemPanel.java
index feaf907d56..c6b1e79e79 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AddOrEditGradeItemPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AddOrEditGradeItemPanel.java
@@ -4,7 +4,6 @@ import java.text.MessageFormat;
 import java.util.Date;
 import java.util.List;
 
-import org.apache.commons.lang.StringUtils;
 import org.apache.wicket.ajax.AjaxRequestTarget;
 import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
 import org.apache.wicket.markup.html.basic.Label;
@@ -22,7 +21,9 @@ import org.sakaiproject.service.gradebook.shared.AssignmentHasIllegalPointsExcep
 import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
 import org.sakaiproject.service.gradebook.shared.ConflictingAssignmentNameException;
 import org.sakaiproject.service.gradebook.shared.ConflictingExternalIdException;
+import org.sakaiproject.service.gradebook.shared.GradebookHelper;
 import org.sakaiproject.service.gradebook.shared.GradebookService;
+import org.sakaiproject.service.gradebook.shared.InvalidGradeItemNameException;
 import org.sakaiproject.tool.gradebook.Gradebook;
 import org.sakaiproject.util.DateFormatterUtil;
 
@@ -108,9 +109,8 @@ public class AddOrEditGradeItemPanel extends BasePanel {
 					final List<CategoryDefinition> categories = AddOrEditGradeItemPanel.this.businessService.getGradebookCategories();
 					final CategoryDefinition category = categories
 							.stream()
-							.filter(c -> (c.getId() == assignment.getCategoryId())
+							.filter(c -> (c.getId().equals(assignment.getCategoryId()))
 									&& (c.getDropHighest() > 0 || c.getKeepHighest() > 0 || c.getDrop_lowest() > 0))
-							.filter(c -> (c.getDropHighest() > 0 || c.getKeepHighest() > 0 || c.getDrop_lowest() > 0))
 							.findFirst()
 							.orElse(null);
 
@@ -129,10 +129,14 @@ public class AddOrEditGradeItemPanel extends BasePanel {
 				}
 
 				// 2. names cannot contain these special chars
-				if(validated && StringUtils.containsAny(assignment.getName(), GradebookService.INVALID_CHARS_IN_GB_ITEM_NAME)) {
-					validated = false;
-					error(getString("error.addeditgradeitem.titlecharacters"));
-					target.addChildren(form, FeedbackPanel.class);
+				if (validated) {
+					try {
+						GradebookHelper.validateGradeItemName(assignment.getName());
+					} catch (InvalidGradeItemNameException e) {
+						validated = false;
+						error(getString("error.addeditgradeitem.titlecharacters"));
+						target.addChildren(form, FeedbackPanel.class);
+					}
 				}
 
 				// OK
@@ -143,7 +147,8 @@ public class AddOrEditGradeItemPanel extends BasePanel {
 
 						if (success) {
 							getSession().success(MessageFormat.format(getString("message.edititem.success"), assignment.getName()));
-							setResponsePage(getPage().getPageClass());
+							setResponsePage(getPage().getPageClass(),
+								new PageParameters().add(GradebookPage.FOCUS_ASSIGNMENT_ID_PARAM, assignment.getId()));
 						} else {
 							error(new ResourceModel("message.edititem.error").getObject());
 							target.addChildren(form, FeedbackPanel.class);
@@ -173,7 +178,7 @@ public class AddOrEditGradeItemPanel extends BasePanel {
 							getSession()
 									.success(MessageFormat.format(getString("notification.addgradeitem.success"), assignment.getName()));
 							setResponsePage(getPage().getPageClass(),
-									new PageParameters().add(GradebookPage.CREATED_ASSIGNMENT_ID_PARAM, assignmentId));
+									new PageParameters().add(GradebookPage.FOCUS_ASSIGNMENT_ID_PARAM, assignmentId));
 						} else {
 							target.addChildren(form, FeedbackPanel.class);
 						}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.html
deleted file mode 100644
index 6e8bf8683c..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.html
+++ /dev/null
@@ -1,46 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	
-	<div class="gb-title">
-		<span wicket:id="externalAppFlag"></span>
-		<a wicket:id="title"><wicket:container wicket:id="label" /></a>
-	</div>
-	
-	<div class="gb-grade-section">
-		<wicket:container wicket:id="totalLabel">Total: </wicket:container> <span wicket:id="totalPoints" class="gb-total-points">100</span>
-	</div>
-	
-	<div class="gb-due-date">
-		<wicket:message key="label.due">Due: </wicket:message> <span wicket:id="dueDate">23/5/2014</span>
-	</div>
-	
-	<div class="gb-grade-item-flags">
-		<span wicket:id="extraCreditFlag" class="gb-flag-extra-credit"></span>
-		<span wicket:id="isReleasedFlag" class="gb-flag-is-released"></span>
-		<span wicket:id="notReleasedFlag" class="gb-flag-not-released"></span>
-		<span wicket:id="isCountedFlag" class="gb-flag-is-counted"></span>
-		<span wicket:id="notCountedFlag" class="gb-flag-not-counted"></span>
-	</div>
-
-	<!-- dropdown -->
-	<div class="btn-group" wicket:id="menu">
-	    <a wicket:id="menuButton" class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true">
-	    	<span class="caret"></span>
-	    </a>
-	    <ul class="dropdown-menu dropdown-menu-right" role="menu">
-	   		<li><a wicket:id="editAssignmentDetails" href="#" class="edit-assignment-details" role="menuitem"><wicket:message key="assignment.option.edit" /></a></li>
-	   		<li><a wicket:id="viewAssignmentGradeStatistics" href="#" role="menuitem"><wicket:message key="assignment.option.viewgradestatistics" /></a></li>
-			<li><a wicket:id="moveAssignmentLeft" href="#" class="move-assignment-left" role="menuitem"><wicket:message key="assignment.option.moveleft" /></a></li>
-			<li><a wicket:id="moveAssignmentRight" href="#" class="move-assignment-right" role="menuitem"><wicket:message key="assignment.option.moveright" /></a></li>
-			<li><a wicket:id="hideAssignment" href="#" role="menuitem"><wicket:message key="assignment.option.hide" /></a></li>
-	    	<li><a wicket:id="setUngraded" href="#" role="menuitem"><wicket:message key="assignment.option.setungraded" /></a></li>
-			<li><a wicket:id="deleteGradeItem" href="#" role="menuitem" class="gb-delete-item"><span class="text-danger"><wicket:message key="delete.label" /></span></a></li>
-	    </ul>
-    </div>
-	
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.java
deleted file mode 100644
index d066334698..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/AssignmentColumnHeaderPanel.java
+++ /dev/null
@@ -1,422 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.stream.Collectors;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.Component;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.apache.wicket.model.ResourceModel;
-import org.apache.wicket.model.StringResourceModel;
-import org.sakaiproject.gradebookng.business.GbCategoryType;
-import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.business.SortDirection;
-import org.sakaiproject.gradebookng.business.model.GbAssignmentGradeSortOrder;
-import org.sakaiproject.gradebookng.business.util.FormatHelper;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.service.gradebook.shared.Assignment;
-import org.sakaiproject.service.gradebook.shared.GraderPermission;
-import org.sakaiproject.service.gradebook.shared.GradingType;
-import org.sakaiproject.service.gradebook.shared.PermissionDefinition;
-
-import lombok.extern.slf4j.Slf4j;
-
-/**
- *
- * Header panel for each assignment column in the UI
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-@Slf4j
-public class AssignmentColumnHeaderPanel extends BasePanel {
-
-	public static final String ICON_SAKAI = "icon-sakai--";
-	private static final long serialVersionUID = 1L;
-
-	private final IModel<Assignment> modelData;
-	private final GradingType gradingType;
-
-	public AssignmentColumnHeaderPanel(final String id, final Model<Assignment> modelData, final GradingType gradingType) {
-		super(id);
-		this.modelData = modelData;
-		this.gradingType = gradingType;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		getParentCellFor(this).setOutputMarkupId(true);
-
-		final Assignment assignment = this.modelData.getObject();
-
-		// get user's role
-		final GbRole role = getUserRole();
-
-		// do they have permission to edit this assignment?
-		final boolean canEditAssignment = canUserEditAssignment(role, assignment);
-
-		final Link<String> title = new Link<String>("title", Model.of(assignment.getName())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-
-				// toggle the sort direction on each click
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				// if null, set a default sort, otherwise toggle, save, refresh.
-				if (settings.getAssignmentSortOrder() == null
-						|| !assignment.getId().equals(settings.getAssignmentSortOrder().getAssignmentId())) {
-					settings.setAssignmentSortOrder(new GbAssignmentGradeSortOrder(assignment.getId(), SortDirection.ASCENDING));
-				} else {
-					final GbAssignmentGradeSortOrder sortOrder = settings.getAssignmentSortOrder();
-					SortDirection direction = sortOrder.getDirection();
-					direction = direction.toggle();
-					sortOrder.setDirection(direction);
-					settings.setAssignmentSortOrder(sortOrder);
-				}
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-			}
-
-		};
-		title.add(new AttributeModifier("title", assignment.getName()));
-		title.add(new Label("label", FormatHelper.abbreviateMiddle(assignment.getName())));
-
-		// set the class based on the sortOrder. May not be set for this assignment so match it
-		final GradebookPage gradebookPage = (GradebookPage) getPage();
-		final GradebookUiSettings settings = gradebookPage.getUiSettings();
-		if (settings != null && settings.getAssignmentSortOrder() != null
-				&& settings.getAssignmentSortOrder().getAssignmentId() == assignment.getId()) {
-			title.add(
-					new AttributeModifier("class", "gb-sort-" + settings.getAssignmentSortOrder().getDirection().toString().toLowerCase()));
-		}
-
-		add(title);
-
-		// if percentage then we want that as the 'outof' label
-		// we also set the attribute here that is used for the cell by the JS
-		final Label totalLabel = new Label("totalLabel");
-		final Label totalPoints = new Label("totalPoints", Model.of(assignment.getPoints()));
-		if (this.gradingType == GradingType.PERCENTAGE) {
-			totalLabel.setDefaultModel(new ResourceModel("label.relativeweight"));
-			totalPoints.add(new AttributeModifier("data-outof-label", new ResourceModel("label.percentage.plain")));
-		} else {
-			totalLabel.setDefaultModel(new ResourceModel("label.total"));
-			totalPoints.add(new AttributeModifier("data-outof-label",
-					new StringResourceModel("grade.outof", null, new Object[] { assignment.getPoints() })));
-		}
-		add(totalLabel);
-		add(totalPoints);
-
-		add(new Label("dueDate", Model.of(FormatHelper.formatDate(assignment.getDueDate(), getString("label.noduedate")))));
-
-		final WebMarkupContainer externalAppFlag = gradebookPage.buildFlagWithPopover("externalAppFlag", "");
-		if (assignment.getExternalAppName() == null) {
-			externalAppFlag.setVisible(false);
-		} else {
-			externalAppFlag.setVisible(true);
-			externalAppFlag.add(new AttributeModifier("data-content",
-					gradebookPage.generatePopoverContent(new StringResourceModel("label.gradeitem.externalapplabel",
-							null, new Object[] { assignment.getExternalAppName() }).getString())));
-			externalAppFlag.add(new AttributeModifier("class", "gb-external-app-flag " + this.businessService.getIconClass(assignment)));
-		}
-		add(externalAppFlag);
-
-		add(gradebookPage.buildFlagWithPopover("extraCreditFlag", generateFlagPopover(HeaderFlagPopoverPanel.Flag.GRADE_ITEM_EXTRA_CREDIT))
-				.setVisible(assignment.isExtraCredit()));
-		add(gradebookPage.buildFlagWithPopover("isCountedFlag", generateFlagPopover(HeaderFlagPopoverPanel.Flag.GRADE_ITEM_COUNTED))
-				.setVisible(assignment.isCounted()));
-		add(gradebookPage.buildFlagWithPopover("notCountedFlag", generateFlagPopover(HeaderFlagPopoverPanel.Flag.GRADE_ITEM_NOT_COUNTED))
-				.setVisible(!assignment.isCounted()));
-		add(gradebookPage.buildFlagWithPopover("isReleasedFlag", generateFlagPopover(HeaderFlagPopoverPanel.Flag.GRADE_ITEM_RELEASED))
-				.setVisible(assignment.isReleased()));
-		add(gradebookPage.buildFlagWithPopover("notReleasedFlag", generateFlagPopover(HeaderFlagPopoverPanel.Flag.GRADE_ITEM_NOT_RELEASED))
-				.setVisible(!assignment.isReleased()));
-
-		add(new AttributeModifier("data-assignmentId", assignment.getId()));
-		add(new AttributeModifier("data-category", assignment.getCategoryName()));
-		if (GbCategoryType.WEIGHTED_CATEGORY.equals(this.businessService.getGradebookCategoryType()) && assignment.getWeight() != null) {
-			add(new AttributeModifier("data-category-weight", String.format("%s%%", Math.round(assignment.getWeight() * 100))));
-		}
-		add(new AttributeModifier("data-category-extra-credit", assignment.isCategoryExtraCredit()));
-		add(new AttributeModifier("data-category-order", assignment.getCategoryOrder()));
-
-		// menu
-		final WebMarkupContainer menu = new WebMarkupContainer("menu");
-
-		menu.add(new GbAjaxLink<Long>("editAssignmentDetails", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GbModalWindow window = gradebookPage.getAddOrEditGradeItemWindow();
-				window.setTitle(getString("heading.editgradeitem"));
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(new AddOrEditGradeItemPanel(window.getContentId(), window, getModel()));
-				window.showUnloadConfirmation(false);
-				window.show(target);
-			}
-
-			@Override
-			public boolean isVisible() {
-				return role == GbRole.INSTRUCTOR;
-			}
-		});
-
-		menu.add(new GbAjaxLink<Long>("viewAssignmentGradeStatistics", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GbModalWindow window = gradebookPage.getGradeStatisticsWindow();
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(new GradeStatisticsPanel(window.getContentId(), getModel(), window));
-				window.show(target);
-			}
-		});
-
-		menu.add(new Link<Long>("moveAssignmentLeft", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-				// given the id, get the assignment, get the sort order, then update and refresh
-				// note that we cannot use the passed in assignment sort order in here
-				// as we may have had an async reorder on the front end but not had the model data updated,
-				// so we just make sure we get it fresh
-
-				final Long assignmentId = getModelObject();
-
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				if (settings == null) {
-					settings = new GradebookUiSettings();
-					gradebookPage.setUiSettings(settings);
-				}
-
-				if (settings.isCategoriesEnabled()) {
-					try {
-						final Integer order = calculateCurrentCategorizedSortOrder(assignmentId);
-						AssignmentColumnHeaderPanel.this.businessService.updateAssignmentCategorizedOrder(assignmentId,
-								(order.intValue() - 1));
-					} catch (final Exception e) {
-						log.warn("Exception calculating categorized sort order and updating order", e);
-						error("error reordering within category");
-					}
-				} else {
-					final int order = AssignmentColumnHeaderPanel.this.businessService.getAssignmentSortOrder(assignmentId.longValue());
-					AssignmentColumnHeaderPanel.this.businessService.updateAssignmentOrder(assignmentId.longValue(), (order - 1));
-				}
-
-				setResponsePage(GradebookPage.class);
-			}
-
-			@Override
-			public boolean isVisible() {
-				return role == GbRole.INSTRUCTOR;
-			}
-		});
-
-		menu.add(new Link<Long>("moveAssignmentRight", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-
-				final Long assignmentId = getModelObject();
-
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				if (settings == null) {
-					settings = new GradebookUiSettings();
-					gradebookPage.setUiSettings(settings);
-				}
-
-				if (settings.isCategoriesEnabled()) {
-					try {
-						final Integer order = calculateCurrentCategorizedSortOrder(assignmentId);
-						AssignmentColumnHeaderPanel.this.businessService.updateAssignmentCategorizedOrder(assignmentId,
-								(order.intValue() + 1));
-					} catch (final Exception e) {
-						log.warn("Exception in onClick calculating categorized sort order and updating order", e);
-						error("error reordering within category");
-					}
-				} else {
-					final int order = AssignmentColumnHeaderPanel.this.businessService.getAssignmentSortOrder(assignmentId.longValue());
-					AssignmentColumnHeaderPanel.this.businessService.updateAssignmentOrder(assignmentId.longValue(), (order + 1));
-				}
-
-				setResponsePage(GradebookPage.class);
-			}
-
-			@Override
-			public boolean isVisible() {
-				return role == GbRole.INSTRUCTOR;
-			}
-		});
-
-		menu.add(new GbAjaxLink<Long>("hideAssignment", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final Long assignmentId = getModelObject();
-				target.appendJavaScript("sakai.gradebookng.spreadsheet.hideGradeItemAndSyncToolbar('" + assignmentId + "');");
-			}
-		});
-
-		menu.add(new GbAjaxLink<Long>("setUngraded", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GbModalWindow window = gradebookPage.getUpdateUngradedItemsWindow();
-				final UpdateUngradedItemsPanel panel = new UpdateUngradedItemsPanel(window.getContentId(), getModel(), window);
-				window.setTitle(getString("heading.updateungradeditems"));
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(panel);
-				window.showUnloadConfirmation(false);
-				window.show(target);
-
-				panel.setOutputMarkupId(true);
-				target.appendJavaScript("new GradebookUpdateUngraded($(\"#" + panel.getMarkupId() + "\"));");
-			}
-
-			@Override
-			public boolean isVisible() {
-				if (assignment.isExternallyMaintained()) {
-					return false;
-				}
-				return canEditAssignment;
-			}
-
-		});
-
-		// delete item
-		menu.add(new GbAjaxLink<Long>("deleteGradeItem", Model.of(assignment.getId())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GbModalWindow window = gradebookPage.getDeleteItemWindow();
-				final DeleteItemPanel panel = new DeleteItemPanel(window.getContentId(), getModel(), window);
-				window.setTitle(getString("delete.label"));
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(panel);
-				window.showUnloadConfirmation(false);
-				window.show(target);
-			}
-
-			@Override
-			public boolean isVisible() {
-				if (assignment.isExternallyMaintained()) {
-					return false;
-				}
-				return role == GbRole.INSTRUCTOR;
-			}
-		});
-
-		menu.add(new WebMarkupContainer("menuButton").add(
-				new AttributeModifier("title", new StringResourceModel("assignment.menulabel", null,
-						new Object[] { assignment.getName() }))));
-
-		add(menu);
-
-		// add abbreviation of header content to aid table accessibility
-		getParentCellFor(this).add(new AttributeModifier("abbr", assignment.getName()))
-				.add(new AttributeModifier("aria-label", assignment.getName()));
-	}
-
-	private Component getParentCellFor(final Component component) {
-		if (StringUtils.equals(component.getMarkupAttributes().getString("wicket:id"), "header")) {
-			return component;
-		} else {
-			return getParentCellFor(component.getParent());
-		}
-	}
-
-	private String generateFlagPopover(final HeaderFlagPopoverPanel.Flag flag) {
-		final Map<String, Object> popoverModel = new HashMap<>();
-		popoverModel.put("assignmentId", this.modelData.getObject().getId());
-		popoverModel.put("flag", flag);
-		return new HeaderFlagPopoverPanel("popover", Model.ofMap(popoverModel)).toPopoverString();
-	}
-
-	/**
-	 * Get the assignment's current sort index within it's category. If this value is null in the database, best calculate this index from
-	 * the assignments.
-	 *
-	 * @param assignmentId the id of the assignment
-	 * @return the current sort index of the assignment within their category
-	 */
-	private Integer calculateCurrentCategorizedSortOrder(final Long assignmentId) {
-		final Assignment assignment = AssignmentColumnHeaderPanel.this.businessService.getAssignment(assignmentId.longValue());
-		Integer order = assignment.getCategorizedSortOrder();
-
-		if (order == null) {
-			// if no categorized order for assignment, calculate one based on the default sort order
-			final List<Assignment> assignments = AssignmentColumnHeaderPanel.this.businessService.getGradebookAssignments();
-			final List<Long> assignmentIdsInCategory = assignments.stream()
-					.filter(a -> a.getCategoryId() == assignment.getCategoryId())
-					.map(Assignment::getId)
-					.collect(Collectors.toList());
-
-			order = assignmentIdsInCategory.indexOf(assignmentId);
-		}
-
-		return order;
-	}
-
-	private boolean canUserEditAssignment(final GbRole role, final Assignment assignment) {
-		if (role == GbRole.INSTRUCTOR) {
-			return true;
-		} else {
-			final List<PermissionDefinition> permissions = this.businessService.getPermissionsForUser(
-					this.businessService.getCurrentUser().getId());
-			final boolean categoriesEnabled = this.businessService.categoriesAreEnabled();
-			for (final PermissionDefinition permission : permissions) {
-				final boolean gradePermission = permission.getFunction().equals(GraderPermission.GRADE.toString());
-
-				if (gradePermission) {
-					if (categoriesEnabled) {
-						if ((assignment.getCategoryId() == null && permission.getCategoryId() == null) ||
-								(assignment.getCategoryId() != null &&
-										assignment.getCategoryId().equals(permission.getCategoryId()))) {
-							return true;
-						}
-					} else {
-						return true;
-					}
-				}
-			}
-		}
-		return false;
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.html
deleted file mode 100644
index 8f78dbf93a..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.html
+++ /dev/null
@@ -1,11 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	
-	<span wicket:id="score">score</span>
-		
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.java
deleted file mode 100644
index c72177ed76..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnCellPanel.java
+++ /dev/null
@@ -1,93 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.Map;
-
-import org.apache.wicket.behavior.AttributeAppender;
-import org.apache.wicket.event.IEvent;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.sakaiproject.gradebookng.business.util.FormatHelper;
-import org.sakaiproject.gradebookng.tool.model.ScoreChangedEvent;
-
-/**
- *
- * Cell panel for the students average score in a category
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-public class CategoryColumnCellPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<Map<String, Object>> model;
-
-	public CategoryColumnCellPanel(final String id, final IModel<Map<String, Object>> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		// unpack model
-		final Map<String, Object> modelData = this.model.getObject();
-
-		final Double score = (Double) modelData.get("score");
-		final String studentUuid = (String) modelData.get("studentUuid");
-		final Long categoryId = (Long) modelData.get("categoryId");
-
-		// score label
-		final Label scoreLabel = new Label("score", Model.of(getCategoryScore(score))) {
-			@Override
-			public void onEvent(final IEvent<?> event) {
-				super.onEvent(event);
-				if (event.getPayload() instanceof ScoreChangedEvent) {
-					final ScoreChangedEvent scoreChangedEvent = (ScoreChangedEvent) event.getPayload();
-					if (studentUuid.equals(scoreChangedEvent.getStudentUuid()) &&
-							categoryId.equals(scoreChangedEvent.getCategoryId())) {
-
-						final Double categoryAverage = CategoryColumnCellPanel.this.businessService.getCategoryScoreForStudent(categoryId,
-								studentUuid);
-
-						final String newCategoryAverage = (categoryAverage == null) ? getString("label.nocategoryscore")
-								: FormatHelper.formatDoubleAsPercentage(categoryAverage);
-
-						if (!newCategoryAverage.equals(getDefaultModelObject())) {
-							setDefaultModel(Model.of(newCategoryAverage));
-
-							getParent().add(new AttributeAppender("class", "gb-score-dynamically-updated"));
-
-							scoreChangedEvent.getTarget().add(this);
-							scoreChangedEvent.getTarget().appendJavaScript(
-								String.format("$('#%s').closest('td').addClass('gb-score-dynamically-updated');",
-									this.getMarkupId()));
-						}
-					}
-				}
-			}
-		};
-		scoreLabel.setOutputMarkupId(true);
-		add(scoreLabel);
-	}
-
-	/**
-	 * Helper to format a category score
-	 *
-	 * The value is a double (ie 12.34) that needs to be formatted as a percentage with two decimal places precision. If null, it should
-	 * return 'N/A' or equivalent translated string.
-	 *
-	 * @param score
-	 * @return 12.34% type string or N/A if null
-	 */
-	private String getCategoryScore(final Double score) {
-
-		if (score == null) {
-			return getString("label.nocategoryscore");
-		}
-
-		return FormatHelper.formatDoubleAsPercentage(score);
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.html
deleted file mode 100644
index 58e9c17839..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.html
+++ /dev/null
@@ -1,14 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-
-	<span wicket:id="categorySwatch" class="gb-category-score-swatch"></span>
-	<div class="gb-title">
-		<a wicket:id="title"><wicket:container wicket:id="label" /></a>
-	</div>
-	
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.java
deleted file mode 100644
index 016e53a399..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CategoryColumnHeaderPanel.java
+++ /dev/null
@@ -1,94 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.Component;
-import org.apache.wicket.behavior.AttributeAppender;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.apache.wicket.model.StringResourceModel;
-import org.sakaiproject.gradebookng.business.SortDirection;
-import org.sakaiproject.gradebookng.business.model.GbCategoryAverageSortOrder;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
-
-/**
- *
- * Header panel for each category column in the UI
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-public class CategoryColumnHeaderPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	private final IModel<CategoryDefinition> modelData;
-
-	public CategoryColumnHeaderPanel(final String id, final IModel<CategoryDefinition> modelData) {
-		super(id);
-		this.modelData = modelData;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		final CategoryDefinition category = this.modelData.getObject();
-
-		final Link<String> title = new Link<String>("title", Model.of(category.getName())) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-
-				// toggle the sort direction on each click
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				// if null, set a default sort, otherwise toggle, save, refresh.
-				if (settings.getCategorySortOrder() == null
-						|| !category.getId().equals(settings.getCategorySortOrder().getCategoryId())) {
-					settings.setCategorySortOrder(new GbCategoryAverageSortOrder(category.getId(), SortDirection.ASCENDING));
-				} else {
-					final GbCategoryAverageSortOrder sortOrder = settings.getCategorySortOrder();
-					SortDirection direction = sortOrder.getDirection();
-					direction = direction.toggle();
-					sortOrder.setDirection(direction);
-					settings.setCategorySortOrder(sortOrder);
-				}
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-			}
-
-		};
-		title.add(new AttributeModifier("title", category.getName()));
-		title.add(new Label("label", category.getName()));
-
-		// set the class based on the sortOrder. May not be set for this category so match it
-		final GradebookPage gradebookPage = (GradebookPage) getPage();
-		final GradebookUiSettings settings = gradebookPage.getUiSettings();
-		if (settings != null && settings.getCategorySortOrder() != null
-				&& settings.getCategorySortOrder().getCategoryId() == category.getId()) {
-			title.add(
-					new AttributeModifier("class", "gb-sort-" + settings.getCategorySortOrder().getDirection().toString().toLowerCase()));
-		}
-
-		add(title);
-
-		final String categoryColor = settings.getCategoryColor(category.getName());
-
-		final Component colorSwatch = gradebookPage.buildFlagWithPopover("categorySwatch",
-				(new StringResourceModel("label.gradeitem.categoryaverage", this, null,
-						new Object[] { category.getName() })).getString());
-		colorSwatch.add(new AttributeAppender("style", String.format("background-color:%s;", categoryColor)));
-		add(colorSwatch);
-	}
-
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.html
deleted file mode 100644
index 1fe58e5c1e..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.html
+++ /dev/null
@@ -1,29 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-
-	<div class="gb-title">
-		<a wicket:id="title"><wicket:container wicket:id="label" /></a>
-	</div>
-
-	<div class="gb-grade-item-flags">
-		<span wicket:id="isReleasedFlag" class="gb-flag-is-released"></span>
-		<span wicket:id="notReleasedFlag" class="gb-flag-not-released"></span>
-	</div>
-	
-	<!-- dropdown -->
-	<div class="btn-group" wicket:id="menu">
-		<a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" wicket:message="title:coursegrade.header.menulabel">
-			<span class="caret"></span>
-		</a>
-		<ul class="dropdown-menu dropdown-menu-right" role="menu">
-			<li><a wicket:id="setUngraded" href="#" role="menuitem"><wicket:message key="coursegrade.option.setungraded" /></a></li>
-			<li><a wicket:id="showHidePoints" href="#" role="menuitem" aria-controls="gradebookGradesTable"><span wicket:id="showHidePointsLabel">Show/hide points</span></a></li>
-		</ul>
-	</div>
-
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.java
deleted file mode 100644
index 21238b5272..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeColumnHeaderPanel.java
+++ /dev/null
@@ -1,179 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.HashMap;
-import java.util.Map;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.Component;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.apache.wicket.model.ResourceModel;
-import org.sakaiproject.gradebookng.business.GbCategoryType;
-import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.business.SortDirection;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.tool.gradebook.Gradebook;
-
-public class CourseGradeColumnHeaderPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<Boolean> model;
-
-	public CourseGradeColumnHeaderPanel(final String id, final IModel<Boolean> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		final GradebookPage gradebookPage = (GradebookPage) getPage();
-
-		getParentCellFor(this).setOutputMarkupId(true);
-
-		final Link<String> title = new Link<String>("title") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-
-				// toggle the sort direction on each click
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				// if null, set a default sort, otherwise toggle, save, refresh.
-				if (settings.getCourseGradeSortOrder() == null) {
-					settings.setCourseGradeSortOrder(SortDirection.getDefault());
-				} else {
-					final SortDirection sortOrder = settings.getCourseGradeSortOrder();
-					settings.setCourseGradeSortOrder(sortOrder.toggle());
-				}
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-			}
-
-		};
-
-		final GradebookUiSettings settings = gradebookPage.getUiSettings();
-		title.add(new AttributeModifier("title", new ResourceModel("column.header.coursegrade")));
-		title.add(new Label("label", new ResourceModel("column.header.coursegrade")));
-		if (settings != null && settings.getCourseGradeSortOrder() != null) {
-			title.add(
-				new AttributeModifier("class", "gb-sort-" + settings.getCourseGradeSortOrder().toString().toLowerCase()));
-		}
-		add(title);
-
-		final Gradebook gradebook = getGradebook();
-		final GbRole role = getUserRole();
-
-		final GbCategoryType categoryType = GbCategoryType.valueOf(gradebook.getCategory_type());
-
-		// get setting
-		final Boolean showPoints = this.model.getObject();
-
-		// icons
-		final Map<String, Object> popoverModel = new HashMap<>();
-		popoverModel.put("role", role);
-		popoverModel.put("flag", HeaderFlagPopoverPanel.Flag.COURSE_GRADE_RELEASED);
-		add(gradebookPage.buildFlagWithPopover("isReleasedFlag",
-				new HeaderFlagPopoverPanel("popover", Model.ofMap(popoverModel)).toPopoverString())
-				.setVisible(gradebook.isCourseGradeDisplayed()));
-		popoverModel.put("flag", HeaderFlagPopoverPanel.Flag.COURSE_GRADE_NOT_RELEASED);
-		add(gradebookPage.buildFlagWithPopover("notReleasedFlag",
-				new HeaderFlagPopoverPanel("popover", Model.ofMap(popoverModel)).toPopoverString())
-				.setVisible(!gradebook.isCourseGradeDisplayed()));
-
-		// menu
-		final WebMarkupContainer menu = new WebMarkupContainer("menu") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public boolean isVisible() {
-				return role == GbRole.INSTRUCTOR;
-			}
-		};
-		menu.add(new GbAjaxLink("setUngraded") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final GbModalWindow window = gradebookPage.getUpdateUngradedItemsWindow();
-				window.setTitle(getString("heading.zeroungradeditems"));
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(new ZeroUngradedItemsPanel(window.getContentId(), window));
-				window.showUnloadConfirmation(false);
-				window.show(target);
-			}
-		});
-
-		final GbAjaxLink<Boolean> showHidePoints = new GbAjaxLink("showHidePoints", this.model) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-
-				// get current setting
-				final Boolean currentSetting = CourseGradeColumnHeaderPanel.this.model.getObject();
-
-				// toggle it
-				final Boolean nextSetting = !currentSetting;
-
-				// set it
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-				settings.setShowPoints(nextSetting);
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-			}
-
-			@Override
-			public boolean isVisible() {
-				return categoryType != GbCategoryType.WEIGHTED_CATEGORY;
-			}
-		};
-
-		// the label changes depending on the state so we wrap it in a model
-		final IModel<String> showHidePointsModel = new Model<String>() {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public String getObject() {
-
-				// toggles the label to the opposite one
-				if (showPoints) {
-					return getString("coursegrade.option.hidepoints");
-				} else {
-					return getString("coursegrade.option.showpoints");
-				}
-			}
-		};
-		showHidePoints.add(new Label("showHidePointsLabel", showHidePointsModel));
-		menu.add(showHidePoints);
-
-		add(menu);
-	}
-
-	private Component getParentCellFor(final Component component) {
-		if (StringUtils.equals(component.getMarkupAttributes().getString("wicket:id"), "header")) {
-			return component;
-		} else {
-			return getParentCellFor(component.getParent());
-		}
-	}
-}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.html
deleted file mode 100644
index 3399ff0a79..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.html
+++ /dev/null
@@ -1,21 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	<span wicket:id="courseGrade">A+++</span>
-	 
-    <!-- dropdown -->
-	<div class="btn-group" wicket:id="menu">
-		<a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" wicket:message="title:coursegrade.cell.menulabel">
-			<span class="caret"></span>
-		</a>
-		<ul class="dropdown-menu dropdown-menu-right" role="menu">
-			<li><a wicket:id="courseGradeOverride" href="#" role="menuitem"><wicket:message key="coursegrade.option.override" /></a></li>
-			<li><a wicket:id="courseGradeOverrideLog" href="#" role="menuitem"><wicket:message key="coursegrade.option.overridelog" /></a></li>
-		</ul>
-	</div>   
-    
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.java
deleted file mode 100644
index f22566b740..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/CourseGradeItemCellPanel.java
+++ /dev/null
@@ -1,185 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.Map;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.wicket.Component;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.behavior.AttributeAppender;
-import org.apache.wicket.event.IEvent;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.business.util.CourseGradeFormatter;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
-import org.sakaiproject.gradebookng.tool.model.ScoreChangedEvent;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.service.gradebook.shared.CourseGrade;
-import org.sakaiproject.tool.gradebook.Gradebook;
-
-/**
- * Panel that is rendered for each student's course grade
- */
-public class CourseGradeItemCellPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<Map<String, Object>> model;
-
-	public CourseGradeItemCellPanel(final String id, final IModel<Map<String, Object>> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		getParentCellFor(this).setOutputMarkupId(true);
-
-		// unpack model
-
-		// Available options:
-		// courseGradeDisplay
-		// studentUuid
-		// currentUserUuid
-		// currentUserRole
-		// gradebook
-		// showPoints
-		// showOverride
-		// courseGradeVisible
-		final Map<String, Object> modelData = this.model.getObject();
-		final String courseGradeDisplay = (String) modelData.get("courseGradeDisplay");
-		final String studentUuid = (String) modelData.get("studentUuid");
-
-		final GbRole role = (GbRole) modelData.get("currentUserRole");
-		final Gradebook gradebook = (Gradebook) modelData.get("gradebook");
-		final boolean courseGradeVisible = (boolean) modelData.get("courseGradeVisible");
-		final boolean showPoints = (boolean) modelData.get("showPoints");
-		final boolean showOverride = (boolean) modelData.get("showOverride");
-
-		final boolean hasCourseGradeOverride = (boolean) modelData.get("hasCourseGradeOverride");
-
-		if (hasCourseGradeOverride) {
-			getParentCellFor(this).add(new AttributeAppender("class", " gb-cg-override"));
-		}
-
-		// the model map contains a lot of additional info we need for the course grade label, this is passed through
-
-		final GradebookPage gradebookPage = (GradebookPage) getPage();
-
-		// course grade label
-		final Label courseGradeLabel = new Label("courseGrade", Model.of(courseGradeDisplay)) {
-
-			@Override
-			public void onEvent(final IEvent<?> event) {
-				super.onEvent(event);
-				if (event.getPayload() instanceof ScoreChangedEvent) {
-					final ScoreChangedEvent scoreChangedEvent = (ScoreChangedEvent) event.getPayload();
-
-					// ensure event is for this student (which may not be applicable if we have no student)
-					// TODO is this check ever not satisfied now that this has been refactroed?
-					if (StringUtils.equals(studentUuid, scoreChangedEvent.getStudentUuid())) {
-
-						final String newCourseGradeDisplay = refreshCourseGrade(studentUuid, gradebook, role, courseGradeVisible,
-								showPoints, showOverride);
-
-						// if course grade has changed, then refresh it
-						if (!newCourseGradeDisplay.equals(getDefaultModelObject())) {
-							setDefaultModel(Model.of(newCourseGradeDisplay));
-
-							scoreChangedEvent.getTarget().add(this);
-							scoreChangedEvent.getTarget().appendJavaScript(
-								String.format("$('#%s').closest('td').addClass('gb-score-dynamically-updated');", this.getMarkupId()));
-						}
-					}
-				}
-			}
-
-		};
-		courseGradeLabel.setOutputMarkupId(true);
-		courseGradeLabel.setEscapeModelStrings(false);
-		add(courseGradeLabel);
-
-		// menu
-		final WebMarkupContainer menu = new WebMarkupContainer("menu") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public boolean isVisible() {
-				return role == GbRole.INSTRUCTOR;
-			}
-		};
-		menu.add(new GbAjaxLink("courseGradeOverride", Model.of(studentUuid)) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final GbModalWindow window = gradebookPage.getUpdateCourseGradeDisplayWindow();
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(new CourseGradeOverridePanel(window.getContentId(), getModel(), window));
-				window.showUnloadConfirmation(false);
-				window.show(target);
-			}
-		});
-		menu.add(new GbAjaxLink<String>("courseGradeOverrideLog", Model.of(studentUuid)) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-				final GbModalWindow window = gradebookPage.getUpdateCourseGradeDisplayWindow();
-				window.setComponentToReturnFocusTo(getParentCellFor(this));
-				window.setContent(new CourseGradeOverrideLogPanel(window.getContentId(), getModel(), window));
-				window.showUnloadConfirmation(false);
-				window.show(target);
-			}
-		});
-		add(menu);
-	}
-
-	/**
-	 * Helper to get the parent cell for the given component TODO move this and all other instances of the same method to a common helper
-	 * class
-	 *
-	 * @param component
-	 * @return
-	 */
-	private Component getParentCellFor(final Component component) {
-		if (StringUtils.equals(component.getMarkupAttributes().getString("wicket:id"), "cells")) {
-			return component;
-		} else {
-			return getParentCellFor(component.getParent());
-		}
-	}
-
-	/**
-	 *
-	 * Helper to refresh the course grade
-	 *
-	 * @param studentUuid
-	 * @param gradebook
-	 * @param role
-	 * @param courseGradeVisible
-	 * @param showPoints
-	 * @param showOverride
-	 * @return
-	 */
-	private String refreshCourseGrade(final String studentUuid, final Gradebook gradebook, final GbRole role,
-			final boolean courseGradeVisible, final boolean showPoints, final boolean showOverride) {
-
-		final CourseGradeFormatter courseGradeFormatter = new CourseGradeFormatter(
-				gradebook,
-				role,
-				courseGradeVisible,
-				showPoints,
-				showOverride);
-
-		final CourseGrade courseGrade = this.businessService.getCourseGrade(studentUuid);
-
-		return courseGradeFormatter.format(courseGrade);
-	}
-
-}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.html
deleted file mode 100644
index f5acc154be..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.html
+++ /dev/null
@@ -1,16 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	<span wicket:id="readonlyGrade" class="gb-readonly-grade">10</span>
-	<input type="text" wicket:id="editableGrade" tabindex="-1"  class="gb-editable-grade"/>
-
-	<span wicket:id="warningNotification" class="gb-cell-notification gb-cell-notification-warning"></span>
-	<span wicket:id="errorNotification" class="gb-cell-notification gb-cell-notification-error"></span>
-	<span wicket:id="overLimitNotification" class="gb-cell-notification gb-cell-notification-over-limit"></span>
-
-	<span wicket:id="commentNotification" class="gb-cell-notification-comment"></span>
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.java
deleted file mode 100644
index 8c44f136f1..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPanel.java
+++ /dev/null
@@ -1,652 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.List;
-import java.util.Map;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.commons.lang.math.NumberUtils;
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.Component;
-import org.apache.wicket.ajax.AjaxEventBehavior;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.ajax.attributes.AjaxCallListener;
-import org.apache.wicket.ajax.attributes.AjaxRequestAttributes;
-import org.apache.wicket.ajax.form.AjaxFormComponentUpdatingBehavior;
-import org.apache.wicket.core.util.string.ComponentRenderer;
-import org.apache.wicket.event.Broadcast;
-import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.form.TextField;
-import org.apache.wicket.markup.html.panel.FeedbackPanel;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.business.GradeSaveResponse;
-import org.sakaiproject.gradebookng.business.model.GbGradeInfo;
-import org.sakaiproject.gradebookng.business.util.FormatHelper;
-import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
-import org.sakaiproject.gradebookng.tool.model.ScoreChangedEvent;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-import org.sakaiproject.service.gradebook.shared.GradingType;
-
-/**
- * The panel for the cell of a grade item
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-public class GradeItemCellPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<Map<String, Object>> model;
-	Map<String, Object> modelData;
-
-	TextField<String> gradeCell;
-	private String originalGrade;
-
-	String rawGrade;
-	String formattedGrade;
-	String displayGrade;
-
-	String comment;
-	boolean gradeable;
-	boolean showMenu;
-
-	GradeCellStyle baseGradeStyle = GradeCellStyle.NORMAL;
-	GradeCellSaveStyle gradeSaveStyle;
-
-	GradingType gradingType;
-
-	double pointsLimit = 0;
-
-	final List<GradeCellNotification> notifications = new ArrayList<GradeCellNotification>();
-
-	public enum GradeCellNotification {
-		IS_EXTERNAL("grade.notifications.isexternal"),
-		OVER_LIMIT("grade.notifications.overlimit"),
-		HAS_COMMENT("grade.notifications.hascomment"),
-		CONCURRENT_EDIT("grade.notifications.concurrentedit"),
-		ERROR("grade.notifications.haserror"),
-		INVALID("grade.notifications.invalid"),
-		READONLY("grade.notifications.readonly");
-
-		private String message;
-
-		GradeCellNotification(final String message) {
-			this.message = message;
-		}
-
-		public String getMessage() {
-			return this.message;
-		}
-
-	}
-
-	public GradeItemCellPanel(final String id, final IModel<Map<String, Object>> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		// unpack model
-		this.modelData = this.model.getObject();
-		final Long assignmentId = (Long) this.modelData.get("assignmentId");
-		// final String assignmentName = (String) this.modelData.get("assignmentName");
-		final Double assignmentPoints = (Double) this.modelData.get("assignmentPoints");
-		final String studentUuid = (String) this.modelData.get("studentUuid");
-		// final String studentName = (String) this.modelData.get("studentName");
-		final Long categoryId = (Long) this.modelData.get("categoryId");
-		final boolean isExternal = (boolean) this.modelData.get("isExternal");
-		final GbGradeInfo gradeInfo = (GbGradeInfo) this.modelData.get("gradeInfo");
-		final GbRole role = (GbRole) this.modelData.get("role");
-		this.gradingType = (GradingType) this.modelData.get("gradingType");
-
-		if (this.gradingType == GradingType.PERCENTAGE) {
-			this.pointsLimit = 100;
-		} else {
-			this.pointsLimit = assignmentPoints.doubleValue();
-		}
-
-		// Note: gradeInfo may be null
-		this.rawGrade = (gradeInfo != null) ? gradeInfo.getGrade() : "";
-		this.comment = (gradeInfo != null) ? gradeInfo.getGradeComment() : "";
-		this.gradeable = (gradeInfo != null) ? gradeInfo.isGradeable() : false; // ensure this is ALWAYS false if gradeInfo is null.
-
-		if (role == GbRole.INSTRUCTOR) {
-			this.gradeable = true;
-		}
-
-		// get grade
-		this.formattedGrade = FormatHelper.formatGrade(this.rawGrade);
-
-		//TODO move this to the format helper?
-		this.displayGrade = formatDisplayGrade(this.formattedGrade);
-
-		// RENDER
-		if (isExternal || !this.gradeable) {
-
-			add(new Label("readonlyGrade", Model.of(this.displayGrade)));
-			add(new Label("editableGrade") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				public boolean isVisible() {
-					return false;
-				}
-			});
-
-			this.showMenu = false;
-
-			if (isExternal) {
-				this.baseGradeStyle = GradeCellStyle.EXTERNAL;
-				this.notifications.add(GradeCellNotification.IS_EXTERNAL);
-			} else if (!this.gradeable) {
-				this.baseGradeStyle = GradeCellStyle.READONLY;
-				this.notifications.add(GradeCellNotification.READONLY);
-			}
-
-		} else {
-			add(new Label("readonlyGrade") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				public boolean isVisible() {
-					return false;
-				}
-			});
-			this.gradeCell = new TextField<String>("editableGrade", Model.of(this.displayGrade)) {
-
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void onInitialize() {
-					// set original grade, once only
-					super.onInitialize();
-
-					final Component parentCell = getParentCellFor(this);
-					parentCell.add(new AttributeModifier("data-assignmentid", assignmentId));
-					parentCell.add(new AttributeModifier("data-studentuuid", studentUuid));
-					parentCell.add(new AttributeModifier("class", GradeCellStyle.NORMAL.getCss()));
-					parentCell.setOutputMarkupId(true);
-
-					GradeItemCellPanel.this.showMenu = true;
-				}
-			};
-
-			this.gradeCell.add(new AjaxFormComponentUpdatingBehavior("scorechange.sakai") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				public void onBind() {
-					super.onBind();
-					//get the model data, and unformat it if required.
-					GradeItemCellPanel.this.originalGrade = unformatDisplayGrade(GradeItemCellPanel.this.gradeCell.getDefaultModelObjectAsString());
-				}
-
-				@Override
-				protected void onUpdate(final AjaxRequestTarget target) {
-					final String rawGrade = GradeItemCellPanel.this.gradeCell.getValue();
-
-					final GradebookPage page = (GradebookPage) getPage();
-
-					clearNotifications();
-
-					// perform validation here so we can bypass the backend
-					if (StringUtils.isNotBlank(rawGrade) && FormatHelper.validateDouble(rawGrade)!= null && (!FormatHelper.isValidDouble(rawGrade) || FormatHelper.validateDouble(rawGrade) < 0)) {
-						// show warning and revert button
-						markWarning(getComponent());
-						target.add(page.updateLiveGradingMessage(getString("feedback.error")));
-					} else {
-						final String newGrade = FormatHelper.formatGrade(rawGrade);
-
-						// for concurrency, get the original grade we have in the UI and pass it into the service as a check
-						final GradeSaveResponse result = GradeItemCellPanel.this.businessService.saveGrade(assignmentId, studentUuid,
-								GradeItemCellPanel.this.originalGrade, newGrade, GradeItemCellPanel.this.comment);
-
-						// reformat to display version
-						GradeItemCellPanel.this.displayGrade = formatDisplayGrade(newGrade);
-						GradeItemCellPanel.this.gradeCell.setDefaultModel(Model.of(GradeItemCellPanel.this.displayGrade));
-
-						// handle the result
-						switch (result) {
-							case OK:
-								markSuccessful(GradeItemCellPanel.this.gradeCell);
-								GradeItemCellPanel.this.originalGrade = newGrade;
-								refreshCourseGradeAndCategoryAverages(target);
-								target.add(page.updateLiveGradingMessage(getString("feedback.saved")));
-								break;
-							case ERROR:
-								markError(getComponent());
-								// show the error message
-								target.add(page.updateLiveGradingMessage(getString("feedback.error")));
-								// and the invalid score message, just to be helpful
-								GradeItemCellPanel.this.notifications.add(GradeCellNotification.INVALID);
-								break;
-							case OVER_LIMIT:
-								markOverLimit(GradeItemCellPanel.this.gradeCell, true);
-								GradeItemCellPanel.this.originalGrade = newGrade;
-								refreshCourseGradeAndCategoryAverages(target);
-								target.add(page.updateLiveGradingMessage(getString("feedback.saved")));
-								break;
-							case NO_CHANGE:
-								handleNoChange(GradeItemCellPanel.this.gradeCell);
-								break;
-							case CONCURRENT_EDIT:
-								markError(GradeItemCellPanel.this.gradeCell);
-								target.add(page.updateLiveGradingMessage(getString("feedback.error")));
-								GradeItemCellPanel.this.notifications.add(GradeCellNotification.CONCURRENT_EDIT);
-								break;
-							default:
-								throw new UnsupportedOperationException("The response for saving the grade is unknown.");
-						}
-					}
-
-					refreshNotifications();
-
-					// refresh the components we need
-					target.addChildren(getPage(), FeedbackPanel.class);
-					target.add(getParentCellFor(getComponent()));
-					target.add(GradeItemCellPanel.this.gradeCell);
-				}
-
-				// TODO can this be moved out of this block?
-				private void refreshCourseGradeAndCategoryAverages(final AjaxRequestTarget target) {
-					// trigger async event that score has been updated and now displayed
-					target.appendJavaScript(
-							String.format("$('#%s').trigger('scoreupdated.sakai')", GradeItemCellPanel.this.gradeCell.getMarkupId()));
-				}
-
-				@Override
-				protected void updateAjaxAttributes(final AjaxRequestAttributes attributes) {
-					super.updateAjaxAttributes(attributes);
-
-					final Map<String, Object> extraParameters = attributes.getExtraParameters();
-					extraParameters.put("assignmentId", assignmentId);
-					extraParameters.put("studentUuid", studentUuid);
-
-					final AjaxCallListener myAjaxCallListener = new AjaxCallListener() {
-						private static final long serialVersionUID = 1L;
-
-						@Override
-						public CharSequence getPrecondition(final Component component) {
-							return "return GradebookWicketEventProxy.updateGradeItem.handlePrecondition('"
-									+ getParentCellFor(component).getMarkupId() + "', attrs);";
-						}
-
-						@Override
-						public CharSequence getBeforeSendHandler(final Component component) {
-							return "GradebookWicketEventProxy.updateGradeItem.handleBeforeSend('"
-									+ getParentCellFor(component).getMarkupId() + "', attrs, jqXHR, settings);";
-						}
-
-						@Override
-						public CharSequence getSuccessHandler(final Component component) {
-							return "GradebookWicketEventProxy.updateGradeItem.handleSuccess('" + getParentCellFor(component).getMarkupId()
-									+ "', attrs, jqXHR, data, textStatus);";
-						}
-
-						@Override
-						public CharSequence getFailureHandler(final Component component) {
-							return "GradebookWicketEventProxy.updateGradeItem.handleFailure('" + getParentCellFor(component).getMarkupId()
-									+ "', attrs, jqXHR, errorMessage, textStatus);";
-						}
-
-						@Override
-						public CharSequence getCompleteHandler(final Component component) {
-							return "GradebookWicketEventProxy.updateGradeItem.handleComplete('" + getParentCellFor(component).getMarkupId()
-									+ "', attrs, jqXHR, textStatus);";
-						}
-					};
-					attributes.getAjaxCallListeners().add(myAjaxCallListener);
-				}
-			});
-
-			this.gradeCell.setType(String.class);
-			this.gradeCell.add(new AjaxEventBehavior("scoreupdated.sakai") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void onEvent(final AjaxRequestTarget target) {
-					send(getPage(), Broadcast.BREADTH, new ScoreChangedEvent(studentUuid, categoryId, target));
-					// ensure the fixed course grade column has been updated
-					target.appendJavaScript(String.format("sakai.gradebookng.spreadsheet.refreshCourseGradeForStudent('%s')", studentUuid));
-				}
-			});
-
-			this.gradeCell.add(new AjaxEventBehavior("revertscore.sakai") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void onEvent(final AjaxRequestTarget target) {
-					final GradebookPage page = (GradebookPage)getPage();
-
-					// reset the cell's score
-					getComponent().setDefaultModelObject(formatDisplayGrade(GradeItemCellPanel.this.originalGrade));
-
-					// reset the cell's style and flags
-					GradeItemCellPanel.this.baseGradeStyle = GradeCellStyle.NORMAL;
-					GradeItemCellPanel.this.gradeSaveStyle = null;
-					styleGradeCell(GradeItemCellPanel.this);
-					clearNotifications();
-
-					// apply any applicable flags
-					refreshExtraCreditFlag();
-					refreshCommentFlag();
-					refreshNotifications();
-
-					// tell the javascript to refresh the cell
-					target.add(getParentCellFor(getComponent()));
-					target.add(page.updateLiveGradingMessage(getString("feedback.saved")));
-				}
-
-				@Override
-				protected void updateAjaxAttributes(final AjaxRequestAttributes attributes) {
-					super.updateAjaxAttributes(attributes);
-
-					final Map<String, Object> extraParameters = attributes.getExtraParameters();
-					extraParameters.put("assignmentId", assignmentId);
-					extraParameters.put("studentUuid", studentUuid);
-
-					final AjaxCallListener myAjaxCallListener = new AjaxCallListener() {
-						private static final long serialVersionUID = 1L;
-
-						@Override
-						public CharSequence getCompleteHandler(final Component component) {
-							return "GradebookWicketEventProxy.revertGradeItem.handleComplete('" + getParentCellFor(component).getMarkupId()
-									+ "', attrs, jqXHR, textStatus);";
-						}
-					};
-					attributes.getAjaxCallListeners().add(myAjaxCallListener);
-				}
-			});
-
-			this.gradeCell.add(new AjaxEventBehavior("viewlog.sakai") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void onEvent(final AjaxRequestTarget target) {
-					final GradebookPage gradebookPage = (GradebookPage) getPage();
-					final GbModalWindow window = gradebookPage.getGradeLogWindow();
-
-					window.setComponentToReturnFocusTo(getParentCellFor(GradeItemCellPanel.this.gradeCell));
-					window.setContent(new GradeLogPanel(window.getContentId(), GradeItemCellPanel.this.model, window));
-					window.show(target);
-				}
-			});
-			this.gradeCell.add(new AjaxEventBehavior("editcomment.sakai") {
-				private static final long serialVersionUID = 1L;
-
-				@Override
-				protected void onEvent(final AjaxRequestTarget target) {
-					final GradebookPage gradebookPage = (GradebookPage) getPage();
-					final GbModalWindow window = gradebookPage.getGradeCommentWindow();
-
-					final EditGradeCommentPanel panel = new EditGradeCommentPanel(window.getContentId(), GradeItemCellPanel.this.model,
-							window);
-					window.setContent(panel);
-					window.showUnloadConfirmation(false);
-					window.clearWindowClosedCallbacks();
-					window.setComponentToReturnFocusTo(getParentCellFor(GradeItemCellPanel.this.gradeCell));
-					window.addWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
-						private static final long serialVersionUID = 1L;
-
-						@Override
-						public void onClose(final AjaxRequestTarget target) {
-							GradeItemCellPanel.this.comment = panel.getComment();
-
-							refreshCommentFlag();
-
-							target.add(getParentCellFor(GradeItemCellPanel.this.gradeCell));
-							target.appendJavaScript("sakai.gradebookng.spreadsheet.setupCell('"
-									+ getParentCellFor(GradeItemCellPanel.this.gradeCell).getMarkupId() + "','" + assignmentId + "', '"
-									+ studentUuid + "');");
-							refreshNotifications();
-						}
-					});
-					window.show(target);
-				}
-			});
-
-			this.gradeCell.setOutputMarkupId(true);
-			add(this.gradeCell);
-		}
-
-		// always add these
-		getParent().add(new AttributeModifier("role", "gridcell"));
-		getParent().add(new AttributeModifier("aria-readonly", Boolean.toString(isExternal || !this.gradeable)));
-
-		refreshExtraCreditFlag();
-		refreshCommentFlag();
-
-		refreshNotifications();
-
-		styleGradeCell(this);
-	}
-
-	/**
-	 * Set the enum value so we can use it when we style. TODO collapse these into one
-	 *
-	 */
-	private void markSuccessful(final Component gradeCell) {
-		this.gradeSaveStyle = GradeCellSaveStyle.SUCCESS;
-		styleGradeCell(gradeCell);
-	}
-
-	private void markError(final Component gradeCell) {
-		this.gradeSaveStyle = GradeCellSaveStyle.ERROR;
-		styleGradeCell(gradeCell);
-		this.notifications.add(GradeCellNotification.ERROR);
-	}
-
-	private void markWarning(final Component gradeCell) {
-		this.gradeSaveStyle = GradeCellSaveStyle.WARNING;
-		styleGradeCell(gradeCell);
-		this.notifications.add(GradeCellNotification.INVALID);
-	}
-
-	private void markOverLimit(final Component gradeCell, final boolean andSuccess) {
-		if (andSuccess) {
-			this.gradeSaveStyle = GradeCellSaveStyle.OVER_LIMIT_AND_SUCCESS;
-		} else {
-			this.gradeSaveStyle = GradeCellSaveStyle.OVER_LIMIT;
-		}
-		styleGradeCell(gradeCell);
-		this.notifications.add(GradeCellNotification.OVER_LIMIT);
-	}
-
-	private void markHasComment(final Component gradeCell) {
-		styleGradeCell(gradeCell); // maintains existing save style
-		this.notifications.add(GradeCellNotification.HAS_COMMENT);
-	}
-
-	private void handleNoChange(final Component gradeCell) {
-		// clear any previous styles
-		this.gradeSaveStyle = null;
-		styleGradeCell(gradeCell);
-	}
-
-	private void clearNotifications() {
-		this.notifications.clear();
-		if (StringUtils.isNotBlank(this.comment)) {
-			markHasComment(this.gradeCell);
-		}
-	}
-
-	/**
-	 * Builder for styling the cell. Aware of the cell 'save style' as well as if it has comments and adds styles accordingly
-	 *
-	 * @param gradeCell the cell to style
-	 */
-	private void styleGradeCell(final Component gradeCell) {
-
-		final ArrayList<String> cssClasses = new ArrayList<>();
-		cssClasses.add(this.baseGradeStyle.getCss()); // always
-		if (this.gradeSaveStyle != null) {
-			cssClasses.add(this.gradeSaveStyle.getCss()); // the particular style for this cell that has been computed previously
-		}
-
-		// replace the cell styles with the new set
-		getParentCellFor(gradeCell).add(AttributeModifier.replace("class", StringUtils.join(cssClasses, " ")));
-	}
-
-	/**
-	 * Get the parent container for the grade cell so we can style it
-	 *
-	 * @param gradeCell
-	 * @return
-	 */
-	private Component getParentCellFor(final Component component) {
-		if (StringUtils.equals(component.getMarkupAttributes().getString("wicket:id"), "cells")) {
-			return component;
-		} else {
-			return getParentCellFor(component.getParent());
-		}
-	}
-
-	/**
-	 * Enum for encapsulating the base grade cell CSS class
-	 *
-	 */
-	enum GradeCellStyle {
-
-		NORMAL("gb-grade-item-cell"),
-		READONLY("gb-readonly-item-cell"),
-		EXTERNAL("gb-external-item-cell");
-
-		private String css;
-
-		GradeCellStyle(final String css) {
-			this.css = css;
-		}
-
-		public String getCss() {
-			return this.css;
-		}
-	}
-
-	/**
-	 * Enum for encapsulating the grade cell save css class that is to be applied
-	 *
-	 */
-	enum GradeCellSaveStyle {
-
-		SUCCESS("grade-save-success"),
-		ERROR("grade-save-error"),
-		WARNING("grade-save-warning"),
-		OVER_LIMIT("grade-save-over-limit"),
-		OVER_LIMIT_AND_SUCCESS("grade-save-over-limit grade-save-success");
-
-		private String css;
-
-		GradeCellSaveStyle(final String css) {
-			this.css = css;
-		}
-
-		public String getCss() {
-			return this.css;
-		}
-	}
-
-	private void refreshExtraCreditFlag() {
-		// check if grade is over limit and mark the cell with the warning class
-		if (NumberUtils.toDouble(this.formattedGrade) > this.pointsLimit) {
-			markOverLimit(this, false);
-			this.notifications.add(GradeCellNotification.OVER_LIMIT);
-		}
-	}
-
-	private void refreshCommentFlag() {
-		if (StringUtils.isNotBlank(this.comment)) {
-			markHasComment(this);
-		}
-	}
-
-	private void refreshNotifications() {
-		final WebMarkupContainer commentNotification = new WebMarkupContainer("commentNotification");
-		final WebMarkupContainer warningNotification = new WebMarkupContainer("warningNotification");
-		final WebMarkupContainer errorNotification = new WebMarkupContainer("errorNotification");
-		final WebMarkupContainer overLimitNotification = new WebMarkupContainer("overLimitNotification");
-
-		warningNotification.setVisible(false);
-		errorNotification.setVisible(false);
-		overLimitNotification.setVisible(false);
-
-		if (StringUtils.isNotBlank(this.comment)) {
-			this.modelData.put("comment", this.comment);
-			commentNotification.setVisible(true);
-			addPopover(commentNotification, Arrays.asList(GradeCellNotification.HAS_COMMENT));
-		} else {
-			commentNotification.setVisible(false);
-		}
-		this.notifications.remove(GradeCellNotification.HAS_COMMENT);
-
-		if (!this.notifications.isEmpty()) {
-			if (this.notifications.contains(GradeCellNotification.ERROR)) {
-				errorNotification.setVisible(true);
-				addPopover(errorNotification, this.notifications);
-			} else if (this.notifications.contains(GradeCellNotification.INVALID)
-					|| this.notifications.contains(GradeCellNotification.CONCURRENT_EDIT)
-					|| this.notifications.contains(GradeCellNotification.IS_EXTERNAL)
-					|| this.notifications.contains(GradeCellNotification.READONLY)) {
-				warningNotification.setVisible(true);
-				addPopover(warningNotification, this.notifications);
-			} else if (this.notifications.contains(GradeCellNotification.OVER_LIMIT)) {
-				overLimitNotification.setVisible(true);
-				addPopover(overLimitNotification, this.notifications);
-			}
-		}
-
-		addOrReplace(commentNotification);
-		addOrReplace(warningNotification);
-		addOrReplace(errorNotification);
-		addOrReplace(overLimitNotification);
-	}
-
-	private void addPopover(final Component component, final List<GradeCellNotification> notifications) {
-		this.modelData.put("gradeable", this.gradeable);
-		final GradeItemCellPopoverPanel popover = new GradeItemCellPopoverPanel("popover", Model.ofMap(this.modelData), notifications);
-		final String popoverString = ComponentRenderer.renderComponent(popover).toString();
-
-		component.add(new AttributeModifier("data-toggle", "popover"));
-		component.add(new AttributeModifier("data-trigger", "manual"));
-		component.add(new AttributeModifier("data-placement", "bottom"));
-		component.add(new AttributeModifier("data-html", "true"));
-		component.add(new AttributeModifier("data-container", "#gradebookGrades"));
-		component.add(new AttributeModifier("data-content", popoverString));
-		component.add(new AttributeModifier("tabindex", "0"));
-	}
-
-	/**
-	 * Get a display version of a grade
-	 *
-	 * @param grade the actual grade
-	 * @return
-	 */
-	private String formatDisplayGrade(final String grade) {
-
-		String rval = grade;
-
-		if (this.gradingType == GradingType.PERCENTAGE && StringUtils.isNotBlank(grade)) {
-			rval += "%";
-		}
-		return rval;
-	}
-
-	/**
-	 * Remove the formatting from a display grade
-	 *
-	 * @param displayGrade the display version
-	 * @return
-	 */
-	private String unformatDisplayGrade(final String displayGrade) {
-		return StringUtils.remove(displayGrade, '%');
-	}
-
-}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.html
deleted file mode 100644
index 57df966386..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.html
+++ /dev/null
@@ -1,32 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-    <a wicket:id="closePopoverLink"  href="javascript:void(0);" class="gb-popover-close"></a>
-    <ul class="gb-popover-notifications">
-        <li wicket:id="isExternalNotification" class="gb-popover-notification-is-external text-info"><span wicket:id="message"></span></li>
-        <li wicket:id="isReadOnlyNotification" class="gb-popover-notification-is-readonly text-info"><span wicket:id="message"></span></li>
-
-        <li wicket:id="saveErrorNotification" class="gb-popover-notification-error text-danger"><span wicket:id="message"></span></li>
-        <li wicket:id="isInvalidNotification" class="gb-popover-notification-invalid text-danger">
-            <span wicket:id="message"></span>
-            <button class="btn btn-sm btn-primary gb-revert-score">
-                <wicket:message key="grade.notifications.revert" />
-            </button>
-        </li>
-        <li wicket:id="concurrentEditNotification" class="gb-popover-notification-concurrentedit text-danger"><span wicket:id="message"></span></li>
-        <li wicket:id="isOverLimitNotification" class="gb-popover-notification-overlimit text-warning"><span wicket:id="message"></span></li>
-        <li wicket:id="hasCommentNotification" class="gb-popover-notification-has-comment text-info">
-            <span wicket:id="message"></span>
-            <blockquote>
-                <p><span wicket:id="snippet"></span></p>
-            </blockquote>
-            <p wicket:id="editCommentContainer"><a href="javascript:void(0);" class="gb-popover-link"><wicket:message key="comment.option.edit" /></a></p>
-            <p wicket:id="externalComment">Editable in [Tool Name] Tool</p>
-        </li>
-    </ul>
-
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.java
deleted file mode 100644
index 3c9b541fc5..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/GradeItemCellPopoverPanel.java
+++ /dev/null
@@ -1,121 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.List;
-import java.util.Map;
-
-import org.apache.commons.lang.StringUtils;
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.ResourceModel;
-import org.apache.wicket.model.StringResourceModel;
-
-public class GradeItemCellPopoverPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	public GradeItemCellPopoverPanel(final String id, final IModel<Map<String, Object>> model,
-			final List<GradeItemCellPanel.GradeCellNotification> notifications) {
-		super(id, model);
-
-		final Map<String, Object> modelData = model.getObject();
-
-		final WebMarkupContainer closePopoverLink = new WebMarkupContainer("closePopoverLink");
-		closePopoverLink.add(new AttributeModifier("data-assignmentid", (Long) modelData.get("assignmentId")));
-		closePopoverLink.add(new AttributeModifier("data-studentUuid", (String) modelData.get("studentUuid")));
-		add(closePopoverLink);
-
-		final WebMarkupContainer saveErrorNotification = new WebMarkupContainer("saveErrorNotification");
-		saveErrorNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.ERROR));
-		saveErrorNotification.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.ERROR.getMessage())));
-		add(saveErrorNotification);
-
-		final String comment = (String) modelData.get("comment");
-
-		final WebMarkupContainer hasCommentNotification = new WebMarkupContainer("hasCommentNotification");
-		hasCommentNotification.setVisible(
-				notifications.contains(GradeItemCellPanel.GradeCellNotification.HAS_COMMENT) && StringUtils.isNotBlank(comment));
-		hasCommentNotification
-				.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.HAS_COMMENT.getMessage())));
-		add(hasCommentNotification);
-
-		if (hasCommentNotification.isVisible()) {
-			hasCommentNotification.add(new Label("snippet", makeSnippet(comment, 100)));
-
-			hasCommentNotification.add(new AttributeModifier("data-assignmentid", (Long) modelData.get("assignmentId")));
-			hasCommentNotification.add(new AttributeModifier("data-studentUuid", (String) modelData.get("studentUuid")));
-
-			// for editing the comment
-			final WebMarkupContainer editCommentContainer = new WebMarkupContainer("editCommentContainer") {
-				@Override
-				public boolean isVisible() {
-					return ((boolean) modelData.get("gradeable") && !(boolean) modelData.get("isExternal"));
-				}
-			};
-			hasCommentNotification.add(editCommentContainer);
-
-			// external comments
-			final Label externalComment = new Label("externalComment",
-					new StringResourceModel("comment.option.external", null, new Object[] { modelData.get("externalAppName") })) {
-				@Override
-				public boolean isVisible() {
-					return (boolean) modelData.get("isExternal");
-				}
-			};
-			hasCommentNotification.add(externalComment);
-		}
-
-		final WebMarkupContainer isOverLimitNotification = new WebMarkupContainer("isOverLimitNotification");
-		isOverLimitNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.OVER_LIMIT));
-		isOverLimitNotification
-				.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.OVER_LIMIT.getMessage())));
-		add(isOverLimitNotification);
-
-		final WebMarkupContainer concurrentEditNotification = new WebMarkupContainer("concurrentEditNotification");
-		concurrentEditNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.CONCURRENT_EDIT));
-		concurrentEditNotification
-				.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.CONCURRENT_EDIT.getMessage())));
-		add(concurrentEditNotification);
-
-		final WebMarkupContainer isExternalNotification = new WebMarkupContainer("isExternalNotification");
-		isExternalNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.IS_EXTERNAL));
-		isExternalNotification
-				.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.IS_EXTERNAL.getMessage())));
-		add(isExternalNotification);
-
-		final WebMarkupContainer isReadOnlyNotification = new WebMarkupContainer("isReadOnlyNotification");
-		isReadOnlyNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.READONLY));
-		isReadOnlyNotification
-				.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.READONLY.getMessage())));
-		add(isReadOnlyNotification);
-
-		final WebMarkupContainer isInvalidNotification = new WebMarkupContainer("isInvalidNotification");
-		isInvalidNotification.setVisible(notifications.contains(GradeItemCellPanel.GradeCellNotification.INVALID));
-		isInvalidNotification.add(new Label("message", new ResourceModel(GradeItemCellPanel.GradeCellNotification.INVALID.getMessage())));
-		add(isInvalidNotification);
-	}
-
-	private String makeSnippet(final String text, final int max) {
-		if (text.length() <= max) {
-			return text;
-		}
-
-		int end = text.lastIndexOf(' ', max - 3);
-
-		if (end == -1) {
-			return text.substring(0, max - 3) + "...";
-		}
-
-		int newEnd = end;
-		do {
-			end = newEnd;
-			newEnd = text.indexOf(' ', end + 1);
-			if (newEnd == -1) {
-				newEnd = text.length();
-			}
-		} while ((text.substring(0, newEnd) + "...").length() < max);
-
-		return text.substring(0, end) + "...";
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.html
deleted file mode 100644
index 5119ecb276..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.html
+++ /dev/null
@@ -1,20 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-
-	<ul class="gb-popover-notifications">
-		<li class="text-info">
-			<p class="gb-popover-message">
-				<wicket:container wicket:id="message" />
-			</p>
-			<a wicket:id="link" class="gb-popover-link">
-				<wicket:container wicket:id="linkText" />
-			</a>
-		</li>
-	</ul>
-
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.java
deleted file mode 100644
index b4a171a967..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/HeaderFlagPopoverPanel.java
+++ /dev/null
@@ -1,94 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.Map;
-
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.behavior.AttributeAppender;
-import org.apache.wicket.core.util.string.ComponentRenderer;
-import org.apache.wicket.markup.html.WebMarkupContainer;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.model.IModel;
-import org.sakaiproject.gradebookng.business.GbRole;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.pages.SettingsPage;
-
-public class HeaderFlagPopoverPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	public enum Flag {
-		GRADE_ITEM_EXTRA_CREDIT("label.gradeitem.extracredit"),
-		GRADE_ITEM_RELEASED("label.gradeitem.released"),
-		GRADE_ITEM_NOT_RELEASED("label.gradeitem.notreleased"),
-		GRADE_ITEM_COUNTED("label.gradeitem.counted"),
-		GRADE_ITEM_NOT_COUNTED("label.gradeitem.notcounted"),
-		COURSE_GRADE_RELEASED("label.coursegrade.released"),
-		COURSE_GRADE_NOT_RELEASED("label.coursegrade.notreleased");
-
-		private String messageKey;
-
-		Flag(final String messageKey) {
-			this.messageKey = messageKey;
-		}
-
-		public String getMessageKey() {
-			return this.messageKey;
-		}
-	}
-
-	Flag flag;
-	Long assignmentId;
-	GbRole role;
-
-	public HeaderFlagPopoverPanel(final String id, final IModel<Map<String, Object>> model) {
-		super(id, model);
-
-		final Map<String, Object> modelData = model.getObject();
-		this.flag = (Flag) modelData.get("flag");
-		this.assignmentId = (Long) modelData.get("assignmentId");
-		this.role = (GbRole) modelData.get("role");
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		add(new Label("message", getString(this.flag.getMessageKey())));
-
-		final boolean isInstructor = GbRole.INSTRUCTOR == this.role;
-
-		if (isInstructor) {
-			if (this.flag == Flag.COURSE_GRADE_NOT_RELEASED || this.flag == Flag.COURSE_GRADE_RELEASED) {
-				final Link link = new Link("link") {
-					@Override
-					public void onClick() {
-						setResponsePage(SettingsPage.class);
-					}
-				};
-				link.add(new Label("linkText", getString("label.coursegrade.editsettings")));
-				add(link);
-			} else if (this.assignmentId != null) {
-				final GbAjaxLink link = new GbAjaxLink("link") {
-					@Override
-					public void onClick(final AjaxRequestTarget target) {
-						// do nothing
-					}
-				};
-				final String javascript = String.format("sakai.gradebookng.spreadsheet.editAssignmentFromFlag('%s');",
-						String.valueOf(this.assignmentId));
-				link.add(new AttributeAppender("onclick", javascript));
-				link.add(new Label("linkText", getString("assignment.option.edit")));
-				add(link);
-			} else {
-				add(new WebMarkupContainer("link").setVisible(false));
-			}
-		} else {
-			add(new WebMarkupContainer("link").setVisible(false));
-		}
-	}
-
-	public String toPopoverString() {
-		return ComponentRenderer.renderComponent(this).toString();
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/InstructorGradeSummaryGradesPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/InstructorGradeSummaryGradesPanel.java
index 6819426d5b..525e503994 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/InstructorGradeSummaryGradesPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/InstructorGradeSummaryGradesPanel.java
@@ -58,7 +58,7 @@ public class InstructorGradeSummaryGradesPanel extends BasePanel {
 
 		// unpack model
 		final Map<String, Object> modelData = (Map<String, Object>) getDefaultModelObject();
-		final String userId = (String) modelData.get("userId");
+		final String userId = (String) modelData.get("studentUuid");
 
 		final GradebookPage gradebookPage = (GradebookPage) getPage();
 
@@ -78,7 +78,7 @@ public class InstructorGradeSummaryGradesPanel extends BasePanel {
 		final GbStudentGradeInfo studentGradeInfo = this.businessService
 				.buildGradeMatrix(
 						assignments,
-						Arrays.asList(userId),
+						new ArrayList<>(Arrays.asList(userId)), // needs to support #remove
 						gradebookPage.getUiSettings())
 				.get(0);
 		final Map<Long, Double> categoryAverages = studentGradeInfo.getCategoryAverages();
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.html
index 8db415f130..0f8ece896d 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.html
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.html
@@ -4,7 +4,7 @@
 <body>
 	<wicket:panel>
 
-		<div class="panel panel-default">
+		<div class="panel panel-default" style="display: none;">
 			<div class="panel-heading" role="tab" id="settingsGradeEntryHeader">
 				<h3 class="panel-title">
 					<a role="button" data-toggle="collapse" href="#settingsGradeEntry" aria-expanded="false" aria-controls="settingsGradeEntry">
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.java
index 6a9518a805..6e6e1f8205 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradeEntryPanel.java
@@ -55,7 +55,7 @@ public class SettingsGradeEntryPanel extends BasePanel {
 				new PropertyModel<Integer>(this.model, "gradebookInformation.gradeType"));
 
 		gradeEntry.add(new Radio<>("points", Model.of(GradingType.POINTS.getValue())));
-		gradeEntry.add(new Radio<>("percentages", Model.of(GradingType.PERCENTAGE.getValue())));
+		gradeEntry.add(new Radio<>("percentages", Model.of(GradingType.PERCENTAGE.getValue())).setEnabled(false));
 		settingsGradeEntryPanel.add(gradeEntry);
 
 	}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.java
index dc6d865057..c25aa2add1 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SettingsGradingSchemaPanel.java
@@ -34,7 +34,6 @@ import org.apache.wicket.model.PropertyModel;
 import org.apache.wicket.model.ResourceModel;
 import org.jfree.chart.ChartFactory;
 import org.jfree.chart.JFreeChart;
-import org.jfree.chart.axis.AxisLocation;
 import org.jfree.chart.axis.NumberTickUnitSource;
 import org.jfree.chart.labels.StandardCategoryToolTipGenerator;
 import org.jfree.chart.plot.CategoryPlot;
@@ -51,17 +50,11 @@ import org.sakaiproject.gradebookng.tool.model.GbGradingSchemaEntry;
 import org.sakaiproject.gradebookng.tool.model.GbSettings;
 import org.sakaiproject.service.gradebook.shared.CourseGrade;
 import org.sakaiproject.service.gradebook.shared.GradeMappingDefinition;
-import org.sakaiproject.tool.gradebook.GradebookArchive;
 import org.sakaiproject.user.api.User;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
 
 public class SettingsGradingSchemaPanel extends BasePanel implements IFormModelUpdateListener {
 
 	private static final long serialVersionUID = 1L;
-	
-	private static Logger logger = LoggerFactory.getLogger(SettingsGradingSchemaPanel.class);
 
 	IModel<GbSettings> model;
 
@@ -406,7 +399,6 @@ public class SettingsGradingSchemaPanel extends BasePanel implements IFormModelU
 				true, // show tooltips
 				false); // show urls
 
-	    chart.getCategoryPlot().setRangeAxisLocation(AxisLocation.BOTTOM_OR_RIGHT);
 		chart.setBorderVisible(false);
 		chart.setAntiAlias(false);
 
@@ -500,21 +492,24 @@ public class SettingsGradingSchemaPanel extends BasePanel implements IFormModelU
 		if (this.total < 1 && StringUtils.equals(this.gradingSchemaName, "Grade Points")) {
 			return "-";
 		} else if (StringUtils.equals(this.gradingSchemaName, "Grade Points")) {
-			Map<String, Double> gpaScoresMap = getGPAScoresMap();
+			Map<String, Double> gpaScoresMap = new HashMap<>();
+			gpaScoresMap.put("A (4.0)", Double.valueOf("4.0"));
+			gpaScoresMap.put("A- (3.67)", Double.valueOf("3.67"));
+			gpaScoresMap.put("B+ (3.33)", Double.valueOf("3.33"));
+			gpaScoresMap.put("B (3.0)", Double.valueOf("3.0"));
+			gpaScoresMap.put("B- (2.67)", Double.valueOf("2.67"));
+			gpaScoresMap.put("C+ (2.33)", Double.valueOf("2.33"));
+			gpaScoresMap.put("C (2.0)", Double.valueOf("2.0"));
+			gpaScoresMap.put("C- (1.67)", Double.valueOf("1.67"));
+			gpaScoresMap.put("D (1.0)", Double.valueOf("1.0"));
+			gpaScoresMap.put("F (0)", Double.valueOf("0"));	
 			
 			// get all of the non null mapped grades
 			// mapped grades will be null if the student doesn't have a course grade yet.
 			final List<String> mappedGrades = this.courseGradeMap.values().stream().filter(c -> c.getMappedGrade() != null).map(c -> (c.getMappedGrade())).collect(Collectors.toList());
 			Double averageGPA = 0.0;
 			for (String mappedGrade : mappedGrades) {
-				// Note to developers. If you changed GradePointsMapping without changing gpaScoresMap, the average will be incorrect.
-				// As per GradePointsMapping, both must be kept in sync
-				Double grade = gpaScoresMap.get(mappedGrade);
-				if(grade != null) {
-					averageGPA += grade;
-				} else {
-					logger.debug("Grade skipped when calculating course average GPA: " + mappedGrade + ". Calculated value will be incorrect.");
-				}
+				averageGPA += gpaScoresMap.get(mappedGrade);
 			}
 			averageGPA /= mappedGrades.size();
 			
@@ -564,22 +559,4 @@ public class SettingsGradingSchemaPanel extends BasePanel implements IFormModelU
 		return this.total > 0 ? String.format("%.2f",stats.getStandardDeviation()) :  "-";
 	}
 	
-	/**
-	 * 
-	 */
-	private Map<String, Double> getGPAScoresMap() {
-		Map<String, Double> gpaScoresMap = new HashMap<>();
-		gpaScoresMap.put("A (4.0)", Double.valueOf("4.0"));
-		gpaScoresMap.put("A- (3.67)", Double.valueOf("3.67"));
-		gpaScoresMap.put("B+ (3.33)", Double.valueOf("3.33"));
-		gpaScoresMap.put("B (3.0)", Double.valueOf("3.0"));
-		gpaScoresMap.put("B- (2.67)", Double.valueOf("2.67"));
-		gpaScoresMap.put("C+ (2.33)", Double.valueOf("2.33"));
-		gpaScoresMap.put("C (2.0)", Double.valueOf("2.0"));
-		gpaScoresMap.put("C- (1.67)", Double.valueOf("1.67"));
-		gpaScoresMap.put("D (1.0)", Double.valueOf("1.0"));
-		gpaScoresMap.put("F (0)", Double.valueOf("0"));	
-		
-		return gpaScoresMap;
-	}
 }
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.html
new file mode 100644
index 0000000000..937ab04d98
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.html
@@ -0,0 +1,29 @@
+<!DOCTYPE html>
+<html xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd">
+
+<body>
+	<wicket:panel>
+
+		<div id="gradebookSorter" class="by-category">
+			<input type="hidden" name="orderby" value="category"/>
+			<div wicket:id="categoriesList" class="gb-sorter-category">
+				<h4 wicket:id="name"></h4>
+				<ul>
+					<li wicket:id="gradeItemList" class="gb-sorter-sortable">
+						<input wicket:id="id" type="hidden"/>
+						<input wicket:id="order" type="hidden"/>
+						<input wicket:id="current_order" type="hidden"/>
+						<span wicket:id="name"></span>
+
+						<button class="gb-sort-up"></button>
+						<button class="gb-sort-down"></button>
+					</li>
+				</ul>
+			</div>
+		</div>
+
+		<script>new GradebookSorter($("#gradebookSorter"));</script>
+
+	</wicket:panel>
+</body>
+</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.java
new file mode 100644
index 0000000000..aae97af16d
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByCategoryPanel.java
@@ -0,0 +1,118 @@
+package org.sakaiproject.gradebookng.tool.panels;
+
+import org.apache.wicket.AttributeModifier;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
+import org.apache.wicket.extensions.markup.html.tabs.AbstractTab;
+import org.apache.wicket.markup.html.basic.Label;
+import org.apache.wicket.markup.html.form.HiddenField;
+import org.apache.wicket.markup.html.list.ListItem;
+import org.apache.wicket.markup.html.list.ListView;
+import org.apache.wicket.markup.html.panel.EmptyPanel;
+import org.apache.wicket.markup.html.panel.Panel;
+import org.apache.wicket.model.IModel;
+import org.apache.wicket.model.Model;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
+import org.sakaiproject.service.gradebook.shared.Assignment;
+import org.sakaiproject.service.gradebook.shared.CategoryDefinition;
+import org.sakaiproject.service.gradebook.shared.SortType;
+
+import java.util.*;
+import java.util.stream.Collectors;
+
+public class SortGradeItemsByCategoryPanel extends Panel {
+
+	private static final long serialVersionUID = 1L;
+
+	@SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+	protected GradebookNgBusinessService businessService;
+
+	public SortGradeItemsByCategoryPanel(final String id, final IModel<Map<String, Object>> model) {
+		super(id, model);
+	}
+
+	@Override
+	public void onInitialize() {
+		super.onInitialize();
+
+		Map<String, Object> model = (Map<String, Object>)getDefaultModelObject();
+		GradebookUiSettings settings = (GradebookUiSettings)model.get("settings");
+
+		// retrieve all categories, remove empty and ensure they're sorted
+		final List<CategoryDefinition> categories = this.businessService.getGradebookCategories().
+				stream().filter(c -> !c.getAssignmentList().isEmpty()).collect(Collectors.toList());
+		Collections.sort(categories, CategoryDefinition.orderComparator);
+
+		add(new ListView<CategoryDefinition>("categoriesList", categories) {
+			@Override
+			protected void populateItem(final ListItem<CategoryDefinition> categoryItem) {
+				final CategoryDefinition category = categoryItem.getModelObject();
+				List<Assignment> assignments = category.getAssignmentList();
+				Collections.sort(assignments, new CategorizedAssignmentComparator());
+
+				categoryItem.add(new AttributeModifier("style",
+					String.format("border-left-color: %s", settings.getCategoryColor(category.getName()))));
+				categoryItem.add(new Label("name", category.getName()));
+				categoryItem.add(new ListView<Assignment>("gradeItemList", assignments) {
+					@Override
+					protected void populateItem(final ListItem<Assignment> assignmentItem) {
+						final Assignment assignment = assignmentItem.getModelObject();
+						assignmentItem.add(new Label("name", assignment.getName()));
+						assignmentItem.add(new HiddenField<Long>("id",
+							Model.of(assignment.getId())).
+							add(new AttributeModifier("name",
+								String.format("id", assignment.getId()))));
+						assignmentItem.add(new HiddenField<Integer>("order",
+							Model.of(assignment.getCategorizedSortOrder())).
+							add(new AttributeModifier("name",
+								String.format("item_%s[order]", assignment.getId()))));
+						assignmentItem.add(new HiddenField<Integer>("current_order",
+							Model.of(assignment.getCategorizedSortOrder())).
+							add(new AttributeModifier("name",
+								String.format("item_%s[current_order]", assignment.getId()))));
+					}
+				});
+			}
+		});
+	}
+}
+
+class CategorizedAssignmentComparator implements Comparator<Assignment> {
+	@Override
+	public int compare(final Assignment a1, final Assignment a2) {
+		// if in the same category, sort by their categorized sort order
+		if (a1.getCategoryId() == a2.getCategoryId()) {
+			// handles null orders by putting them at the end of the list
+			if (a1.getCategorizedSortOrder() == null) {
+				return 1;
+			} else if (a2.getCategorizedSortOrder() == null) {
+				return -1;
+			}
+			return Integer.compare(a1.getCategorizedSortOrder(), a2.getCategorizedSortOrder());
+
+			// otherwise, sort by their category order
+		} else {
+			if (a1.getCategoryOrder() == null && a2.getCategoryOrder() == null) {
+				// both orders are null.. so order by A-Z
+				if (a1.getCategoryName() == null && a2.getCategoryName() == null) {
+					// both names are null so order by id
+					return a1.getCategoryId().compareTo(a2.getCategoryId());
+				} else if (a1.getCategoryName() == null) {
+					return 1;
+				} else if (a2.getCategoryName() == null) {
+					return -1;
+				} else {
+					return a1.getCategoryName().compareTo(a2.getCategoryName());
+				}
+			} else if (a1.getCategoryOrder() == null) {
+				return 1;
+			} else if (a2.getCategoryOrder() == null) {
+				return -1;
+			} else {
+				return a1.getCategoryOrder().compareTo(a2.getCategoryOrder());
+			}
+		}
+	}
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.html
new file mode 100644
index 0000000000..a6eb958324
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.html
@@ -0,0 +1,25 @@
+<!DOCTYPE html>
+<html xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd">
+
+<body>
+	<wicket:panel>
+
+		<div id="gradebookSorter" class="by-grade-item">
+			<input type="hidden" name="orderby" value="item"/>
+			<ul>
+				<li wicket:id="gradeItemList" class="gb-sorter-sortable">
+					<input wicket:id="id" type="hidden"/>
+					<input wicket:id="order" type="hidden"/>
+					<input wicket:id="current_order" type="hidden"/>
+					<span wicket:id="name"></span>
+
+					<button class="gb-sort-up"></button>
+					<button class="gb-sort-down"></button>
+				</li>
+			</ul>
+		</div>
+
+		<script>new GradebookSorter($("#gradebookSorter"));</script>
+	</wicket:panel>
+</body>
+</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.java
new file mode 100644
index 0000000000..87fc48e5dc
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsByGradeItemPanel.java
@@ -0,0 +1,61 @@
+package org.sakaiproject.gradebookng.tool.panels;
+
+import org.apache.wicket.AttributeModifier;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
+import org.apache.wicket.extensions.markup.html.tabs.AbstractTab;
+import org.apache.wicket.markup.html.basic.Label;
+import org.apache.wicket.markup.html.form.HiddenField;
+import org.apache.wicket.markup.html.list.ListItem;
+import org.apache.wicket.markup.html.list.ListView;
+import org.apache.wicket.markup.html.panel.EmptyPanel;
+import org.apache.wicket.markup.html.panel.Panel;
+import org.apache.wicket.model.IModel;
+import org.apache.wicket.model.Model;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+import org.sakaiproject.service.gradebook.shared.Assignment;
+import org.sakaiproject.service.gradebook.shared.SortType;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Map;
+
+public class SortGradeItemsByGradeItemPanel extends Panel {
+
+	private static final long serialVersionUID = 1L;
+
+	@SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+	protected GradebookNgBusinessService businessService;
+
+	public SortGradeItemsByGradeItemPanel(final String id) {
+		super(id);
+	}
+
+	@Override
+	public void onInitialize() {
+		super.onInitialize();
+
+		final List<Assignment> assignments = this.businessService.getGradebookAssignments(SortType.SORT_BY_SORTING);
+
+		add(new ListView<Assignment>("gradeItemList", assignments) {
+			@Override
+			protected void populateItem(final ListItem<Assignment> assignmentItem) {
+				final Assignment assignment = assignmentItem.getModelObject();
+				assignmentItem.add(new Label("name", assignment.getName()));
+				assignmentItem.add(new HiddenField<Long>("id",
+					Model.of(assignment.getId())).
+					add(new AttributeModifier("name",
+						String.format("id", assignment.getId()))));
+				assignmentItem.add(new HiddenField<Integer>("order",
+					Model.of(assignment.getSortOrder())).
+						add(new AttributeModifier("name",
+							String.format("item_%s[order]", assignment.getId()))));
+				assignmentItem.add(new HiddenField<Integer>("current_order",
+					Model.of(assignment.getSortOrder())).
+					add(new AttributeModifier("name",
+						String.format("item_%s[current_order]", assignment.getId()))));
+			}
+		});
+	}
+}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.html
new file mode 100644
index 0000000000..3585e422eb
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.html
@@ -0,0 +1,24 @@
+<!DOCTYPE html>
+<html xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd">
+
+<body>
+	<wicket:panel>
+
+		<div class="">
+			<form class="form-vertical gb-sorter-form" wicket:id="form">
+				<div wicket:id="tabs"></div>
+
+				<div class="gb-sorter-actions">
+					<button wicket:id="submit" class="button_color">
+						<wicket:container wicket:id="label"/>
+					</button>
+					<button class="button_color">
+						<wicket:message key="button.cancel"/>
+					</button>
+				</div>
+			</form>
+		</div>
+
+	</wicket:panel>
+</body>
+</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.java
new file mode 100644
index 0000000000..56525b11d4
--- /dev/null
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/SortGradeItemsPanel.java
@@ -0,0 +1,148 @@
+package org.sakaiproject.gradebookng.tool.panels;
+
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.ajax.markup.html.form.AjaxButton;
+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;
+import org.apache.wicket.extensions.markup.html.tabs.AbstractTab;
+import org.apache.wicket.markup.html.basic.Label;
+import org.apache.wicket.markup.html.form.Form;
+import org.apache.wicket.markup.html.panel.Panel;
+import org.apache.wicket.model.IModel;
+import org.apache.wicket.model.Model;
+import org.apache.wicket.spring.injection.annot.SpringBean;
+import org.sakaiproject.exception.IdUnusedException;
+import org.sakaiproject.exception.PermissionException;
+import org.sakaiproject.gradebookng.business.GradebookNgBusinessService;
+
+import javax.servlet.http.HttpServletRequest;
+import java.text.MessageFormat;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+public class SortGradeItemsPanel extends Panel {
+
+	private static final long serialVersionUID = 1L;
+
+	@SpringBean(name = "org.sakaiproject.gradebookng.business.GradebookNgBusinessService")
+	protected GradebookNgBusinessService businessService;
+
+	private final ModalWindow window;
+
+	public SortGradeItemsPanel(final String id, final IModel<Map<String, Object>> model, final ModalWindow window) {
+		super(id, model);
+		this.window = window;
+	}
+
+	@Override
+	public void onInitialize() {
+		super.onInitialize();
+
+		final List tabs = new ArrayList();
+
+		final Map<String, Object> model = (Map<String, Object>)getDefaultModelObject();
+		final boolean categoriesEnabled = (boolean) model.get("categoriesEnabled");
+
+		final Form<Void> form = new Form<>("form");
+
+		final AjaxButton submit = new AjaxButton("submit") {
+			private static final long serialVersionUID = 1L;
+
+			@Override
+			public void onSubmit(final AjaxRequestTarget target, final Form<?> form) {
+				final HttpServletRequest request = (HttpServletRequest) getRequest().getContainerRequest();
+				String[] ids = request.getParameterValues("id");
+
+				Map<Long, Integer> updates = new HashMap<>();
+				boolean error = false;
+
+				for (int i=0; i<ids.length; i++) {
+					String id = ids[i];
+					String order = request.getParameter(String.format("item_%s[order]", id));
+					String current = request.getParameter(String.format("item_%s[current_order]", id));
+
+					if (current != order) {
+						updates.put(Long.valueOf(id), Integer.valueOf(order));
+					}
+				}
+
+				String orderToUpdate = request.getParameter("orderby");
+				boolean byCategory = "category".equals(orderToUpdate);
+				boolean byItem = "item".equals(orderToUpdate);
+				try {
+					for (Long assignmentId : updates.keySet()) {
+						Integer order = updates.get(assignmentId);
+
+						if (byCategory) {
+							businessService.updateAssignmentCategorizedOrder(assignmentId, order);
+						} else if (byItem) {
+							businessService.updateAssignmentOrder(assignmentId, order);
+						}
+					}
+				} catch (IdUnusedException e) {
+					System.err.println(e);
+					e.printStackTrace();
+					error = true;
+				} catch (PermissionException e) {
+					System.err.println(e);
+					e.printStackTrace();
+					error = true;
+				}
+
+				if (error) {
+					getSession().error(getString("sortgradeitems.error"));
+				} else if (byCategory){
+					getSession().info(getString("sortgradeitems.success.bycategory"));
+				} else if (byItem) {
+					getSession().info(getString("sortgradeitems.success.byitem"));
+				}
+
+				setResponsePage(getPage().getPageClass());
+			}
+		};
+
+		if (categoriesEnabled) {
+			tabs.add(new AbstractTab(new Model<String>(getString("sortgradeitems.bycategory"))) {
+				@Override
+				public Panel getPanel(final String panelId) {
+					return new SortGradeItemsByCategoryPanel(panelId, (IModel<Map<String, Object>>)getDefaultModel());
+				}
+			});
+
+			submit.add(new Label("label", getString("sortgradeitems.submitbycategory")));
+		} else {
+			submit.add(new Label("label", getString("sortgradeitems.submit")));
+		}
+		tabs.add(new AbstractTab(new Model<String>(getString("sortgradeitems.bygradeitem"))) {
+			@Override
+			public Panel getPanel(final String panelId) {
+				return new SortGradeItemsByGradeItemPanel(panelId);
+			}
+		});
+
+		form.add(new AjaxBootstrapTabbedPanel("tabs", tabs) {
+			@Override
+			protected String getTabContainerCssClass() {
+				return "nav nav-tabs";
+			}
+
+			@Override
+			protected void onAjaxUpdate(final AjaxRequestTarget target) {
+				// ensure the submit button reflects the currently selected tab
+				// as form will only submit the status on that tab (not both!)
+				if (getSelectedTab() == 1) {
+					submit.replace(new Label("label", getString("sortgradeitems.submit")));
+					target.add(submit);
+				} else if (getTabs().size() > 1) {
+					submit.replace(new Label("label", getString("sortgradeitems.submitbycategory")));
+					target.add(submit);
+				}
+				super.onAjaxUpdate(target);
+			}
+		});
+
+		form.add(submit);
+		add(form);
+	}
+}
\ No newline at end of file
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryGradesPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryGradesPanel.java
index 626f3b948b..1d380b59ad 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryGradesPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryGradesPanel.java
@@ -64,7 +64,7 @@ public class StudentGradeSummaryGradesPanel extends BasePanel {
 
 		// unpack model
 		final Map<String, Object> modelData = (Map<String, Object>) getDefaultModelObject();
-		final String userId = (String) modelData.get("userId");
+		final String userId = (String) modelData.get("studentUuid");
 
 		final Gradebook gradebook = getGradebook();
 		final CourseGradeFormatter courseGradeFormatter = new CourseGradeFormatter(
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryPanel.java
index 1aef09ba4d..5cf6867c3c 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentGradeSummaryPanel.java
@@ -12,8 +12,11 @@ import org.apache.wicket.markup.html.WebMarkupContainer;
 import org.apache.wicket.markup.html.panel.Panel;
 import org.apache.wicket.model.IModel;
 import org.apache.wicket.model.Model;
+import org.sakaiproject.gradebookng.business.GbRole;
 import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
 import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
+import org.sakaiproject.gradebookng.tool.pages.BasePage;
+import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
 
 /**
  *
@@ -39,11 +42,6 @@ public class StudentGradeSummaryPanel extends BasePanel {
 	public void onInitialize() {
 		super.onInitialize();
 
-		// unpack model
-		// final Map<String, Object> modelData = (Map<String, Object>) getDefaultModelObject();
-		// final String eid = (String) modelData.get("eid");
-		// final String displayName = (String) modelData.get("displayName");
-
 		// done button
 		add(new GbAjaxLink("done") {
 			private static final long serialVersionUID = 1L;
@@ -68,14 +66,19 @@ public class StudentGradeSummaryPanel extends BasePanel {
 				return new InstructorGradeSummaryGradesPanel(panelId, (IModel<Map<String, Object>>) getDefaultModel());
 			}
 		});
-		tabs.add(new AbstractTab(new Model<String>(getString("label.studentsummary.studentviewtab"))) {
-			private static final long serialVersionUID = 1L;
 
-			@Override
-			public Panel getPanel(final String panelId) {
-				return new StudentGradeSummaryGradesPanel(panelId, (IModel<Map<String, Object>>) getDefaultModel());
-			}
-		});
+		// Disable Student View for TAs as they most likely won't have the access
+		// to view the grade data for every student
+		if (((BasePage)getPage()).getCurrentRole() == GbRole.INSTRUCTOR) {
+			tabs.add(new AbstractTab(new Model<String>(getString("label.studentsummary.studentviewtab"))) {
+				private static final long serialVersionUID = 1L;
+
+				@Override
+				public Panel getPanel(final String panelId) {
+					return new StudentGradeSummaryGradesPanel(panelId, (IModel<Map<String, Object>>) getDefaultModel());
+				}
+			});
+		}
 
 		add(new AjaxBootstrapTabbedPanel("tabs", tabs) {
 			@Override
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.html
deleted file mode 100644
index 4f4c47d2b1..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.html
+++ /dev/null
@@ -1,13 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	
-	<a href="#" wicket:id="link" class="gb-student-label">
-		<span wicket:id="name">John Smith</span> (<span wicket:id="eid">(js1234)</span>)
-	</a>
-		
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.java
deleted file mode 100644
index 9865c517c9..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameCellPanel.java
+++ /dev/null
@@ -1,124 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import java.util.HashMap;
-import java.util.Map;
-
-import org.apache.wicket.Component;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.apache.wicket.model.StringResourceModel;
-import org.sakaiproject.gradebookng.business.model.GbStudentNameSortOrder;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.model.GbModalWindow;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-
-/**
- *
- * Cell panel for the student name and eid. Link shows the student grade summary
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-public class StudentNameCellPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<Map<String, Object>> model;
-
-	public StudentNameCellPanel(final String id, final IModel<Map<String, Object>> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		// unpack model
-		final Map<String, Object> modelData = this.model.getObject();
-		final String eid = (String) modelData.get("eid");
-		final String firstName = (String) modelData.get("firstName");
-		final String lastName = (String) modelData.get("lastName");
-		final String displayName = (String) modelData.get("displayName");
-		final GbStudentNameSortOrder nameSortOrder = (GbStudentNameSortOrder) modelData.get("nameSortOrder");
-
-		// link
-		final GbAjaxLink<String> link = new GbAjaxLink<String>("link") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GbModalWindow window = gradebookPage.getStudentGradeSummaryWindow();
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				final Map<String, Object> windowModel = new HashMap<>(StudentNameCellPanel.this.model.getObject());
-				windowModel.put("groupedByCategoryByDefault", settings.isCategoriesEnabled());
-
-				final Component content = new StudentGradeSummaryPanel(window.getContentId(), Model.ofMap(windowModel), window);
-
-				if (window.isShown() && window.isVisible()) {
-					window.replace(content);
-					content.setVisible(true);
-					target.add(content);
-				} else {
-					window.setContent(content);
-					window.setComponentToReturnFocusTo(this);
-					window.show(target);
-				}
-
-				content.setOutputMarkupId(true);
-				final String modalTitle = (new StringResourceModel("heading.studentsummary",
-						null, new Object[] { displayName, eid })).getString();
-				target.appendJavaScript(String.format(
-						"new GradebookGradeSummary($(\"#%s\"), false, \"%s\");",
-						content.getMarkupId(), modalTitle));
-			}
-		};
-		link.setOutputMarkupId(true);
-
-		// name label
-		link.add(new Label("name", getFormattedStudentName(firstName, lastName, nameSortOrder)));
-
-		// eid label, configurable
-		link.add(new Label("eid", eid) {
-
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public boolean isVisible() {
-				return true; // TODO use config, will need to be passed in the model map
-			}
-
-		});
-
-		add(link);
-	}
-
-	/**
-	 * Helper to format a student name based on the sort type.
-	 *
-	 * Sorted by Last Name = Smith, John (jsmith26) Sorted by First Name = John Smith (jsmith26)
-	 *
-	 * @param firstName
-	 * @param lastName
-	 * @param sortOrder
-	 * @return
-	 */
-	private String getFormattedStudentName(final String firstName, final String lastName, final GbStudentNameSortOrder sortOrder) {
-
-		final String msg = "formatter.studentname." + sortOrder.name();
-		if (GbStudentNameSortOrder.LAST_NAME == sortOrder) {
-			return String.format(getString(msg), lastName, firstName);
-		}
-		if (GbStudentNameSortOrder.FIRST_NAME == sortOrder) {
-			return String.format(getString(msg), firstName, lastName);
-		}
-		return firstName;
-	}
-
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.html
deleted file mode 100644
index a3ca7d1bdf..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.html
+++ /dev/null
@@ -1,28 +0,0 @@
-<!DOCTYPE html>
-<html xmlns:wicket="http://wicket.apache.org">
-
-<body>
-<wicket:panel>
-	
-	<div class="gb-title">
-		<a wicket:id="title"><wicket:container wicket:id="label" /></a>
-	</div>
-	
-	<div class="gb-student-filter">
-	  <label for="studentFilterInput" style="display:none" aria-hidden="true"><wicket:message key="filter.groups" /></label>
-	  <input type="text" id="studentFilterInput" wicket:message="placeholder:filter.students" aria-controls="gradebookGradesTable" accesskey="f" />
-	  <a id="studentFilterClear" class="gb-student-filter-clear" href="javascript:void(0);" aria-controls="studentFilterInput" aria-label="Clear student filter"></a>
-	</div>
-	
-	<div class="btn-group">
-	    <a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" wicket:message="title:students.menulabel">
-	    	<span class="caret"></span>
-	    </a>
-	    <ul class="dropdown-menu dropdown-menu-right" role="menu">
-	   		<li><a wicket:id="sortByName" href="#" role="menuitem" aria-controls="gradebookGradesTable"><span wicket:id="sortByNameLabel">Sort by First/Last Name</span></a></li>
-	    </ul>
-    </div>
-	
-</wicket:panel>
-</body>
-</html>
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.java
deleted file mode 100644
index fc34230685..0000000000
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/StudentNameColumnHeaderPanel.java
+++ /dev/null
@@ -1,124 +0,0 @@
-package org.sakaiproject.gradebookng.tool.panels;
-
-import org.apache.wicket.AttributeModifier;
-import org.apache.wicket.ajax.AjaxRequestTarget;
-import org.apache.wicket.markup.html.basic.Label;
-import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.model.IModel;
-import org.apache.wicket.model.Model;
-import org.apache.wicket.model.ResourceModel;
-import org.sakaiproject.gradebookng.business.SortDirection;
-import org.sakaiproject.gradebookng.business.model.GbStudentNameSortOrder;
-import org.sakaiproject.gradebookng.tool.component.GbAjaxLink;
-import org.sakaiproject.gradebookng.tool.model.GradebookUiSettings;
-import org.sakaiproject.gradebookng.tool.pages.GradebookPage;
-
-/**
- *
- * Header panel for the student name/eid
- *
- * @author Steve Swinsburg (steve.swinsburg@gmail.com)
- *
- */
-public class StudentNameColumnHeaderPanel extends BasePanel {
-
-	private static final long serialVersionUID = 1L;
-
-	IModel<GbStudentNameSortOrder> model;
-
-	public StudentNameColumnHeaderPanel(final String id, final IModel<GbStudentNameSortOrder> model) {
-		super(id, model);
-		this.model = model;
-	}
-
-	@Override
-	public void onInitialize() {
-		super.onInitialize();
-
-		final GradebookPage gradebookPage = (GradebookPage) getPage();
-
-		// setup model
-		final GbStudentNameSortOrder sortType = this.model.getObject();
-
-		// title
-		final Link<String> title = new Link<String>("title") {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick() {
-
-				// toggle the sort direction on each click
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
-				// if null, set a default sort, otherwise toggle, save, refresh.
-				if (settings.getStudentSortOrder() == null) {
-					settings.setStudentSortOrder(SortDirection.getDefault());
-				} else {
-					final SortDirection sortOrder = settings.getStudentSortOrder();
-					settings.setStudentSortOrder(sortOrder.toggle());
-				}
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-			}
-		};
-
-		final GradebookUiSettings settings = gradebookPage.getUiSettings();
-		title.add(new AttributeModifier("title", new ResourceModel("column.header.students")));
-		title.add(new Label("label", new ResourceModel("column.header.students")));
-		if (settings != null && settings.getStudentSortOrder() != null) {
-			title.add(
-				new AttributeModifier("class", "gb-sort-" + settings.getStudentSortOrder().toString().toLowerCase()));
-		}
-		add(title);
-
-		// sort by first/last name link
-		final GbAjaxLink<GbStudentNameSortOrder> sortByName = new GbAjaxLink<GbStudentNameSortOrder>("sortByName", this.model) {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public void onClick(final AjaxRequestTarget target) {
-
-				// get current sort
-				final GbStudentNameSortOrder currentSort = StudentNameColumnHeaderPanel.this.model.getObject();
-
-				// get next
-				final GbStudentNameSortOrder newSort = currentSort.toggle();
-
-				// set the sort
-				final GradebookPage gradebookPage = (GradebookPage) getPage();
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-				settings.setNameSortOrder(newSort);
-
-				// save settings
-				gradebookPage.setUiSettings(settings);
-
-				// refresh
-				setResponsePage(GradebookPage.class);
-
-			}
-		};
-
-		// the label changes depending on the state so we wrap it in a model
-		final IModel<String> sortByNameModel = new Model<String>() {
-			private static final long serialVersionUID = 1L;
-
-			@Override
-			public String getObject() {
-
-				// shows the label opposite to the current sort type
-				if (sortType == GbStudentNameSortOrder.FIRST_NAME) {
-					return getString("sortbyname.option.last");
-				} else {
-					return getString("sortbyname.option.first");
-				}
-			}
-		};
-
-		sortByName.add(new Label("sortByNameLabel", sortByNameModel));
-		add(sortByName);
-	}
-}
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.html b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.html
index 26ebc54493..de777306b0 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.html
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.html
@@ -12,6 +12,7 @@
       <label tabindex="0" role="menuitem">
         <span wicket:id="category"></span>
         <span class="gb-item-category-filter-signal"></span>
+        <span wicket:id="categorySignal"class="gb-item-filter-signal"></span>
         <input wicket:id="categoryCheckbox" type="checkbox">
       </label>
       <div class="btn-group">
@@ -28,7 +29,7 @@
     <div wicket:id="assignmentsForCategory" class="gb-item-filter">
       <label tabindex="0" role="menuitem">
         <span wicket:id="assignmentTitle"></span>
-        <span class="gb-item-category-filter-signal"></span>
+        <span wicket:id="assignmentSignal" class="gb-item-filter-signal"></span>
         <input wicket:id="assignmentCheckbox" type="checkbox">
       </label>
       <div class="btn-group">
@@ -45,7 +46,7 @@
     <div wicket:id="categoryScore" class="gb-item-category-score-filter">
       <label tabindex="0" role="menuitem">
           <span wicket:id="categoryScoreLabel"></span>
-          <span class="gb-item-category-filter-signal"></span>
+          <span  wicket:id="categoryScoreSignal" class="gb-item-filter-signal"></span>
           <input wicket:id="categoryScoreCheckbox" type="checkbox">
       </label>
       <div class="btn-group">
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.java
index 71e0075d6a..d34b70ef8c 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/ToggleGradeItemsToolbarPanel.java
@@ -30,12 +30,8 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 
 	private static final long serialVersionUID = 1L;
 
-	IModel<List<? extends Assignment>> model;
-	boolean categoriesEnabled = false;
-
-	public ToggleGradeItemsToolbarPanel(final String id, final IModel<List<? extends Assignment>> model) {
+	public ToggleGradeItemsToolbarPanel(final String id, final IModel<Map<String, Object>> model) {
 		super(id, model);
-		this.model = model;
 	}
 
 	@Override
@@ -46,15 +42,15 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 		final List<String> categoryNames = new ArrayList<String>();
 		final Map<String, List<Assignment>> categoryNamesToAssignments = new HashMap<String, List<Assignment>>();
 
-		final List<Assignment> assignments = (List<Assignment>) this.model.getObject();
-
-		// only deal with categories if categories are enabled
-		this.categoriesEnabled = this.businessService.categoriesAreEnabled();
+		final Map<String, Object> model = (Map<String, Object>) getDefaultModelObject();
+		final List<Assignment> assignments = (List<Assignment>) model.get("assignments");
+		final GradebookUiSettings settings = (GradebookUiSettings) model.get("settings");
+		final boolean categoriesEnabled = (Boolean) model.get("categoriesEnabled");
 
 		// iterate over assignments and build map of categoryname to list of assignments
 		for (final Assignment assignment : assignments) {
 
-			final String categoryName = getCategoryName(assignment);
+			final String categoryName = getCategoryName(assignment, categoriesEnabled);
 
 			if (!categoryNamesToAssignments.containsKey(categoryName)) {
 				categoryNames.add(categoryName);
@@ -71,8 +67,8 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 			protected void populateItem(final ListItem<String> categoryItem) {
 				final String categoryName = categoryItem.getModelObject();
 
-				final WebMarkupContainer categoryFilter = new WebMarkupContainer("categoryFilter");
-				if (!ToggleGradeItemsToolbarPanel.this.categoriesEnabled) {
+				WebMarkupContainer categoryFilter = new WebMarkupContainer("categoryFilter");
+				if (!categoriesEnabled) {
 					categoryFilter.add(new AttributeAppender("class", " hide"));
 					categoryItem.add(new AttributeAppender("class", " gb-no-categories"));
 				}
@@ -80,12 +76,16 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 
 				final GradebookPage gradebookPage = (GradebookPage) getPage();
 
-				final GradebookUiSettings settings = gradebookPage.getUiSettings();
-
 				final Label categoryLabel = new Label("category", categoryName);
 				categoryLabel.add(new AttributeModifier("data-category-color", settings.getCategoryColor(categoryName)));
 				categoryFilter.add(categoryLabel);
 
+				categoryFilter.add(new WebMarkupContainer("categorySignal").
+					add(new AttributeModifier("style",
+						String.format("background-color: %s; border-color: %s",
+							settings.getCategoryColor(categoryName),
+							settings.getCategoryColor(categoryName)))));
+
 				final CheckBox categoryCheckbox = new CheckBox("categoryCheckbox");
 				categoryCheckbox.add(new AttributeModifier("value", categoryName));
 				categoryCheckbox.add(new AttributeModifier("checked", "checked"));
@@ -98,22 +98,24 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 					protected void populateItem(final ListItem<Assignment> assignmentItem) {
 						final Assignment assignment = assignmentItem.getModelObject();
 
-						GradebookUiSettings settings = gradebookPage.getUiSettings();
-						if (settings == null) {
-							settings = new GradebookUiSettings();
-							gradebookPage.setUiSettings(settings);
-						}
+						final GradebookUiSettings settings = gradebookPage.getUiSettings();
 
 						assignmentItem.add(new Label("assignmentTitle", FormatHelper.abbreviateMiddle(assignment.getName())));
 
+						final WebMarkupContainer assignmentSignal = new WebMarkupContainer("assignmentSignal");
+						if (settings.isCategoriesEnabled()) {
+							assignmentSignal.add(new AttributeModifier("style",
+								String.format("background-color: %s; border-color: %s",
+									settings.getCategoryColor(getCategoryName(assignment, categoriesEnabled)),
+									settings.getCategoryColor(getCategoryName(assignment, categoriesEnabled)))));
+						}
+						assignmentItem.add(assignmentSignal);
+
 						final CheckBox assignmentCheckbox = new AjaxCheckBox("assignmentCheckbox",
 								Model.of(Boolean.valueOf(settings.isAssignmentVisible(assignment.getId())))) {
 							@Override
 							protected void onUpdate(final AjaxRequestTarget target) {
 								GradebookUiSettings settings = gradebookPage.getUiSettings();
-								if (settings == null) {
-									settings = new GradebookUiSettings();
-								}
 
 								final Boolean value = settings.isAssignmentVisible(assignment.getId());
 								settings.setAssignmentVisibility(assignment.getId(), !value);
@@ -132,15 +134,18 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 				categoryScoreFilter.add(new Label("categoryScoreLabel",
 						new StringResourceModel("label.toolbar.categoryscorelabel", null, new Object[] { categoryName })));
 
+				categoryScoreFilter.add(new WebMarkupContainer("categoryScoreSignal").
+					add(new AttributeModifier("style",
+						String.format("background-color: %s; border-color: %s",
+							settings.getCategoryColor(categoryName),
+							settings.getCategoryColor(categoryName)))));
+
 				final CheckBox categoryScoreCheckbox = new AjaxCheckBox("categoryScoreCheckbox",
 						new Model<Boolean>(settings.isCategoryScoreVisible(categoryName))) {// Model.of(Boolean.valueOf(settings.isCategoryScoreVisible(category))))
 					// {
 					@Override
 					protected void onUpdate(final AjaxRequestTarget target) {
 						GradebookUiSettings settings = gradebookPage.getUiSettings();
-						if (settings == null) {
-							settings = new GradebookUiSettings();
-						}
 
 						final Boolean value = settings.isCategoryScoreVisible(categoryName);
 						settings.setCategoryScoreVisibility(categoryName, !value);
@@ -162,9 +167,9 @@ public class ToggleGradeItemsToolbarPanel extends BasePanel {
 	 * @param assignment
 	 * @return
 	 */
-	private String getCategoryName(final Assignment assignment) {
+	private String getCategoryName(final Assignment assignment, final boolean categoriesEnabled) {
 
-		if (!this.categoriesEnabled) {
+		if (!categoriesEnabled) {
 			return getString(GradebookPage.UNCATEGORISED);
 		}
 
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/UpdateUngradedItemsPanel.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/UpdateUngradedItemsPanel.java
index 55f3525cef..b7f1b40c36 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/UpdateUngradedItemsPanel.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/UpdateUngradedItemsPanel.java
@@ -46,13 +46,10 @@ public class UpdateUngradedItemsPanel extends BasePanel {
 
 	private final ModalWindow window;
 
-	private final IModel<Long> model;
-
 	private static final double DEFAULT_GRADE = 0;
 
 	public UpdateUngradedItemsPanel(final String id, final IModel<Long> model, final ModalWindow window) {
-		super(id);
-		this.model = model;
+		super(id, model);
 		this.window = window;
 	}
 
@@ -61,7 +58,7 @@ public class UpdateUngradedItemsPanel extends BasePanel {
 		super.onInitialize();
 
 		// unpack model
-		final Long assignmentId = this.model.getObject();
+		final Long assignmentId = (Long) getDefaultModelObject();
 
 		final Assignment assignment = this.businessService.getAssignment(assignmentId);
 
diff --git a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/importExport/GradeImportUploadStep.java b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/importExport/GradeImportUploadStep.java
index 64ce87fe81..ee6e8817a8 100644
--- a/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/importExport/GradeImportUploadStep.java
+++ b/gradebookng/tool/src/java/org/sakaiproject/gradebookng/tool/panels/importExport/GradeImportUploadStep.java
@@ -7,6 +7,8 @@ import java.util.stream.Collectors;
 
 import org.apache.poi.openxml4j.exceptions.InvalidFormatException;
 import org.apache.wicket.Component;
+import org.apache.wicket.ajax.AjaxRequestTarget;
+import org.apache.wicket.ajax.form.OnChangeAjaxBehavior;
 import org.apache.wicket.markup.html.form.Button;
 import org.apache.wicket.markup.html.form.Form;
 import org.apache.wicket.markup.html.form.upload.FileUpload;
@@ -60,6 +62,7 @@ public class GradeImportUploadStep extends BasePanel {
 	private class UploadForm extends Form<Void> {
 
 		FileUploadField fileUploadField;
+		Button continueButton;
 
 		public UploadForm(final String id) {
 			super(id);
@@ -68,9 +71,18 @@ public class GradeImportUploadStep extends BasePanel {
 			setMaxSize(Bytes.megabytes(2));
 
 			this.fileUploadField = new FileUploadField("upload");
+			this.fileUploadField.add(new OnChangeAjaxBehavior() {
+				@Override
+				protected void onUpdate(AjaxRequestTarget ajaxRequestTarget) {
+					UploadForm.this.continueButton.setEnabled(true);
+					ajaxRequestTarget.add(UploadForm.this.continueButton);
+				}
+			});
 			add(this.fileUploadField);
 
-			add(new Button("continuebutton"));
+			this.continueButton = new Button("continuebutton");
+			this.continueButton.setEnabled(false);
+			add(this.continueButton);
 
 			final Button cancel = new Button("cancelbutton") {
 				@Override
@@ -99,20 +111,20 @@ public class GradeImportUploadStep extends BasePanel {
 				try {
 					spreadsheetWrapper = ImportGradesHelper.parseImportedGradeFile(upload.getInputStream(), upload.getContentType(), upload.getClientFileName(), userMap);
 				} catch (final GbImportExportInvalidColumnException e) {
-					log.debug("incorrect format", e);
-					error(getString("importExport.error.incorrectformat")+" - "+e.getMessage());
+					log.debug("GBNG import error", e);
+					error(getString("importExport.error.incorrectformat"));
 					return;
 				} catch (final GbImportExportInvalidFileTypeException | InvalidFormatException e) {
-					log.debug("incorrect type", e);
-					error(getString("importExport.error.incorrecttype")+" - "+e.getMessage());
+					log.debug("GBNG import error", e);
+					error(getString("importExport.error.incorrecttype"));
 					return;
 				} catch (final GbImportExportDuplicateColumnException e) {
-					log.debug("duplicate column", e);
-					error(getString("importExport.error.duplicatecolumn")+" - "+e.getMessage());
+					log.debug("GBNG import error", e);
+					error(getString("importExport.error.duplicatecolumn"));
 					return;
 				} catch (final IOException e) {
-					log.debug("unknown", e);
-					error(getString("importExport.error.unknown")+" - "+e.getMessage());
+					log.debug("GBNG import error", e);
+					error(getString("importExport.error.unknown"));
 					return;
 				}
 
@@ -131,8 +143,7 @@ public class GradeImportUploadStep extends BasePanel {
 					processedGradeItems = ImportGradesHelper.processImportedGrades(spreadsheetWrapper, assignments, grades);
 				} catch (final GbImportCommentMissingItemException e) {
 					// TODO would be good if we could show the column here, but would have to return it
-					log.debug("commentnoitem", e);
-					error(getString("importExport.error.commentnoitem")+" - "+e.getMessage());
+					error(getString("importExport.error.commentnoitem"));
 					return;
 				}
 				// if empty there are no users
diff --git a/gradebookng/tool/src/test/org/sakaiproject/gradebookng/business/util/TestImportGradesHelper.java b/gradebookng/tool/src/test/org/sakaiproject/gradebookng/business/util/TestImportGradesHelper.java
index 4885ddbf2d..03a414dc51 100644
--- a/gradebookng/tool/src/test/org/sakaiproject/gradebookng/business/util/TestImportGradesHelper.java
+++ b/gradebookng/tool/src/test/org/sakaiproject/gradebookng/business/util/TestImportGradesHelper.java
@@ -36,8 +36,14 @@ public class TestImportGradesHelper {
 		String headerValue = "Week #1: Intro to A-B-C [55.4]";
 		Matcher m1 = ImportGradesHelper.ASSIGNMENT_WITH_POINTS_PATTERN.matcher(headerValue);
 		Assert.assertTrue(m1.matches());
-		Assert.assertEquals(StringUtils.trimToNull(m1.group(1)), "Week #1: Intro to A-B-C");
-		Assert.assertEquals(m1.group(2), "55.4");
+
+		Matcher titleMatcher = ImportGradesHelper.STANDARD_HEADER_PATTERN.matcher(headerValue);
+		Assert.assertTrue(titleMatcher.find());
+		Assert.assertEquals(StringUtils.trimToNull(titleMatcher.group()), "Week #1: Intro to A-B-C");
+
+		Matcher pointsMatcher = ImportGradesHelper.POINTS_PATTERN.matcher(headerValue);
+		Assert.assertTrue(pointsMatcher.find());
+		Assert.assertEquals(pointsMatcher.group(), "55.4");
 	}
 
 	@Test
@@ -51,10 +57,21 @@ public class TestImportGradesHelper {
 		Matcher m2 = ImportGradesHelper.ASSIGNMENT_WITH_POINTS_PATTERN.matcher(headerValueB);
 		Assert.assertTrue(m2.matches());
 
-		Assert.assertEquals(StringUtils.trimToNull(m1.group(1)), "Week #1");
-		Assert.assertEquals(StringUtils.trimToNull(m2.group(1)), "Week #2");
-		Assert.assertEquals(m1.group(2), "55.1");
-		Assert.assertEquals(m2.group(2), "55.2");
+		Matcher titleMatcherA = ImportGradesHelper.STANDARD_HEADER_PATTERN.matcher(headerValueA);
+		Assert.assertTrue(titleMatcherA.find());
+		Assert.assertEquals(StringUtils.trimToNull(titleMatcherA.group()), "Week #1");
+
+		Matcher titleMatcherB = ImportGradesHelper.STANDARD_HEADER_PATTERN.matcher(headerValueB);
+		Assert.assertTrue(titleMatcherB.find());
+		Assert.assertEquals(StringUtils.trimToNull(titleMatcherB.group()), "Week #2");
+
+		Matcher pointsMatcherA = ImportGradesHelper.POINTS_PATTERN.matcher(headerValueA);
+		Assert.assertTrue(pointsMatcherA.find());
+		Assert.assertEquals(pointsMatcherA.group(), "55.1");
+
+		Matcher pointsMatcherB = ImportGradesHelper.POINTS_PATTERN.matcher(headerValueB);
+		Assert.assertTrue(pointsMatcherB.find());
+		Assert.assertEquals(pointsMatcherB.group(), "55.2");
 	}
 
 	@Test
@@ -62,8 +79,14 @@ public class TestImportGradesHelper {
 		String headerValue = "Week #2 [5]";
 		Matcher m1 = ImportGradesHelper.ASSIGNMENT_WITH_POINTS_PATTERN.matcher(headerValue);
 		Assert.assertTrue(m1.matches());
-		Assert.assertEquals(StringUtils.trimToNull(m1.group(1)), "Week #2");
-		Assert.assertEquals(m1.group(2), "5");
+
+		Matcher titleMatcher = ImportGradesHelper.STANDARD_HEADER_PATTERN.matcher(headerValue);
+		Assert.assertTrue(titleMatcher.find());
+		Assert.assertEquals(StringUtils.trimToNull(titleMatcher.group()), "Week #2");
+
+		Matcher pointsMatcher = ImportGradesHelper.POINTS_PATTERN.matcher(headerValue);
+		Assert.assertTrue(pointsMatcher.find());
+		Assert.assertEquals(pointsMatcher.group(), "5");
 	}
 
 	@Test
diff --git a/gradebookng/tool/src/test/resources/grades_import.xls b/gradebookng/tool/src/test/resources/grades_import.xls
index ff7fd4d18c..7baf947761 100644
Binary files a/gradebookng/tool/src/test/resources/grades_import.xls and b/gradebookng/tool/src/test/resources/grades_import.xls differ
diff --git a/gradebookng/tool/src/test/resources/grades_import_invalid_header_1.csv b/gradebookng/tool/src/test/resources/grades_import_invalid_header_1.csv
new file mode 100644
index 0000000000..9aedaae670
--- /dev/null
+++ b/gradebookng/tool/src/test/resources/grades_import_invalid_header_1.csv
@@ -0,0 +1,3 @@
+"Student ID","Student Name","a1 [10.0]","* a1","food [77.0]","* food"
+"student1","Stu Dent1","7","graded","null","null"
+"student2","Stu Dent2","3","interesting work","42","I'm hungry"
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/images/gradebook-help-check.png b/gradebookng/tool/src/webapp/images/gradebook-help-check.png
new file mode 100644
index 0000000000..dc73bdaeca
Binary files /dev/null and b/gradebookng/tool/src/webapp/images/gradebook-help-check.png differ
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-connection-poll.js b/gradebookng/tool/src/webapp/scripts/gradebook-connection-poll.js
new file mode 100644
index 0000000000..d762de7fe0
--- /dev/null
+++ b/gradebookng/tool/src/webapp/scripts/gradebook-connection-poll.js
@@ -0,0 +1,45 @@
+/**************************************************************************************
+ *                    Connection Poll Javascript                                       
+ *************************************************************************************/
+function ConnectionPoll($message) {
+    this.PING_INTERVAL = 1000*5; // 5 seconds
+    this.PING_TIMEOUT = 1000*10; // 10 seconds
+    this.PING_URL = "/direct/gbng/ping";
+
+    this.$message = $message;
+
+    this.poll();
+};
+
+
+ConnectionPoll.prototype.poll = function() {
+  var self = this;
+
+  self._interval = setInterval(function() {
+    self.ping();
+  }, self.PING_INTERVAL);
+};
+
+
+ConnectionPoll.prototype.ping = function() {
+  $.ajax({
+    type: "GET",
+    url: this.PING_URL,
+    timeout: this.PING_TIMEOUT,
+    cache: false,
+    success: $.proxy(this.onSuccess, this),
+    error: $.proxy(this.onTimeout, this)
+  });
+};
+
+ConnectionPoll.prototype.onTimeout = function() {
+  this.$message.show();
+};
+
+ConnectionPoll.prototype.onSuccess = function() {
+  this.$message.hide();
+};
+
+$(document).ready(function() {
+  new ConnectionPoll($("#gbConnectionTimeoutFeedback"));
+});
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-gbgrade-table.js b/gradebookng/tool/src/webapp/scripts/gradebook-gbgrade-table.js
new file mode 100644
index 0000000000..65e00be4a3
--- /dev/null
+++ b/gradebookng/tool/src/webapp/scripts/gradebook-gbgrade-table.js
@@ -0,0 +1,2986 @@
+GbGradeTable = {};
+
+GbGradeTable._onReadyCallbacks = [];
+
+GbGradeTable.unpack = function (s, rowCount, columnCount) {
+  if (/^packed:/.test(s)) {
+      return GbGradeTable.unpackPackedScores(s, rowCount, columnCount);
+  } else if (/^json:/.test(s)) {
+      return GbGradeTable.unpackJsonScores(s, rowCount, columnCount);
+  } else {
+      console.log("Unknown data format");
+  }
+};
+
+GbGradeTable.unpackJsonScores = function (s, rowCount, columnCount) {
+    var parsedArray = JSON.parse(s.substring('json:'.length));
+    var result = [];
+    var currentRow = [];
+
+    for (var i = 0; i < parsedArray.length; i++) {
+        if (i > 0 && (i % columnCount) == 0) {
+            result.push(currentRow);
+            currentRow = []
+        }
+
+        currentRow.push(parsedArray[i] < 0 ? "" : GbGradeTable.localizeNumber(parsedArray[i]));
+    }
+
+    result.push(currentRow);
+
+    return result;
+}
+
+GbGradeTable.unpackPackedScores = function (s, rowCount, columnCount) {
+    var blob = atob(s.substring('packed:'.length));
+
+    // Our result will be an array of Float64Array rows
+    var result = [];
+
+    // The byte from our blob we're currently working on
+    var readIndex = 0;
+
+    for (var row = 0; row < rowCount; row++) {
+        var writeIndex = 0;
+        var currentRow = [];
+
+        for (var column = 0; column < columnCount; column++) {
+            if (blob[readIndex].charCodeAt() == 127) {
+                // This is a sentinel value meaning "null"
+                currentRow[writeIndex] = "";
+                readIndex += 1;
+            } else if (blob[readIndex].charCodeAt() & 128) {
+                // If the top bit is set, we're reading a two byte integer
+                currentRow[writeIndex] = ('' + (((blob[readIndex].charCodeAt() & 63) << 8) | blob[readIndex + 1].charCodeAt()));
+
+                // If the second-from-left bit is set, there's a fraction too
+                if (blob[readIndex].charCodeAt() & 64) {
+                    // third byte is a fraction
+                    var fraction = blob[readIndex + 2].charCodeAt();
+                    if (fraction < 10) {
+                        currentRow[writeIndex] += ('.0' + fraction);
+                    } else {
+                        currentRow[writeIndex] += ('.' + fraction);
+                    }
+                    readIndex += 1;
+                }
+
+                readIndex += 2;
+            } else {
+                // a one byte integer and no fraction
+                currentRow[writeIndex] = ('' + blob[readIndex].charCodeAt());
+                readIndex += 1;
+            }
+
+            currentRow[writeIndex] = GbGradeTable.localizeNumber(currentRow[writeIndex]);
+
+            writeIndex += 1;
+        };
+
+        result.push(currentRow);
+    }
+
+    return result;
+};
+
+function TrimPathFragmentCache(name, template) {
+  this.name = name;
+  this.template = template;
+  this.cacheSize = 0;
+  this.maxCacheSize = 1000;
+  this.cacheHitRates = {}
+  this.cache = {}
+}
+
+TrimPathFragmentCache.prototype.getFragment = function (values) {
+  var self = this;
+
+  var key = JSON.stringify(values);
+  var html;
+
+  if (self.cache[key]) {
+    html = self.cache[key].clone(false);
+    self.cacheHitRates[key] += 1;
+  } else {
+    var parse_start = new Date().getTime();
+    html_string = self.template.process(values);
+
+    self.cache[key] = $(html_string);
+    self.cacheSize += 1
+
+    self.cacheHitRates[key] = 1;
+    html = self.cache[key];
+  }
+
+  if (self.cacheSize > self.maxCacheSize) {
+    var sortedFrequencies = Object.values(self.cacheHitRates).sort().reverse();
+    var cutOff = sortedFrequencies[(self.maxCacheSize / 2)];
+
+    var cacheKeys = Object.keys(self.cache);
+    for (var i in cacheKeys) {
+      var key = cacheKeys[i];
+
+      if (self.cacheHitRates[key] <= cutOff) {
+        delete(self.cache[key]);
+        delete(self.cacheHitRates[key]);
+      }
+    }
+  }
+
+  return html[0];
+}
+
+TrimPathFragmentCache.prototype.setHTML = function (target, values) {
+  GbGradeTable.replaceContents(target, this.getFragment(values));
+}
+
+
+
+$(document).ready(function() {
+  // need TrimPath to load before parsing templates
+  GbGradeTable.templates = {
+    cell: new TrimPathFragmentCache('cell', TrimPath.parseTemplate(
+        $("#cellTemplate").html().trim().toString())),
+    courseGradeCell: new TrimPathFragmentCache('courseGradeCell',TrimPath.parseTemplate(
+        $("#courseGradeCellTemplate").html().trim().toString())),
+    courseGradeHeader: TrimPath.parseTemplate(
+        $("#courseGradeHeaderTemplate").html().trim().toString()),
+    assignmentHeader: TrimPath.parseTemplate(
+        $("#assignmentHeaderTemplate").html().trim().toString()),
+    categoryScoreHeader: TrimPath.parseTemplate(
+        $("#categoryScoreHeaderTemplate").html().trim().toString()),
+    studentHeader: TrimPath.parseTemplate(
+        $("#studentHeaderTemplate").html().trim().toString()),
+    studentCell: new TrimPathFragmentCache('studentCell', TrimPath.parseTemplate(
+        $("#studentCellTemplate").html().trim().toString())),
+    metadata: TrimPath.parseTemplate(
+        $("#metadataTemplate").html().trim().toString()),
+    studentSummary: TrimPath.parseTemplate(
+        $("#studentSummaryTemplate").html().trim().toString()),
+    gradeItemSummary: TrimPath.parseTemplate(
+        $("#gradeItemSummaryTemplate").html().trim().toString()),
+    gradeItemSummaryTooltip: TrimPath.parseTemplate(
+        $("#gradeItemSummaryTooltipTemplate").html().trim().toString()),
+    caption: TrimPath.parseTemplate(
+        $("#captionTemplate").html().trim().toString()),
+    tooltip: TrimPath.parseTemplate(
+        $("#tooltipTemplate").html().trim().toString()),
+    gradeMenuTooltip: TrimPath.parseTemplate(
+       $("#gradeMenuTooltip").html().trim().toString()),
+    gradeHeaderMenuTooltip: TrimPath.parseTemplate(
+       $("#gradeHeaderMenuTooltip").html().trim().toString()),
+  };
+
+});
+
+GbGradeTable.courseGradeRenderer = function (instance, td, row, col, prop, value, cellProperties) {
+
+  var $td = $(td);
+  var scoreState = GbGradeTable.getCellState(row, col, instance);
+  var cellKey = GbGradeTable.cleanKey([row, col, scoreState, value.join('_')].join('_'));
+  var wasInitialised = $.data(td, 'cell-initialised');
+
+  if (wasInitialised === cellKey) {
+    return;
+  }
+
+  var isOverridden = value[2] == "1";
+
+  if (!wasInitialised) {
+    GbGradeTable.templates.courseGradeCell.setHTML(td, {
+      value: value[0],
+      isOverridden: isOverridden
+    });
+  } else if (wasInitialised != cellKey) {
+    var valueCell = td.getElementsByClassName('gb-value')[0];
+    GbGradeTable.replaceContents(valueCell, document.createTextNode(value[0]));
+    if (isOverridden) {
+      valueCell.classList.add('gb-overridden');
+    } else {
+      valueCell.classList.remove('gb-overridden');
+    }
+  }
+
+  var student = instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+
+  $.data(td, 'studentid', student.userId);
+  $.data(td, 'cell-initialised', cellKey);
+  $.data(td, "metadata", {
+    id: cellKey,
+    student: student,
+    courseGrade: value[0]
+  });
+  $td.removeAttr('aria-describedby');
+
+  var $cellDiv = $(td.getElementsByClassName('relative')[0]);
+  if (scoreState == "synced") {
+    $cellDiv.addClass("gb-just-synced");
+
+    setTimeout(function() {
+      GbGradeTable.clearCellState(row, col);
+      $cellDiv.removeClass("gb-just-synced", 2000);
+    }, 2000);
+  }
+};
+
+GbGradeTable.cleanKey = function(key) {
+    return key.replace(/[^a-zA-Z0-9]/g, '_');
+};
+
+
+GbGradeTable.replaceContents = function (elt, newContents) {
+  // empty it
+  while (elt.firstChild) {
+    elt.removeChild(elt.firstChild);
+  }
+
+  if ($.isArray(newContents)) {
+    for (var i in newContents) {
+      elt.appendChild(newContents[i]);
+    }
+  } else {
+    elt.appendChild(newContents);
+  }
+
+  return elt;
+};
+
+// This function is called a *lot*, so avoid doing anything too expensive here.
+GbGradeTable.cellRenderer = function (instance, td, row, col, prop, value, cellProperties) {
+  var $td = $(td);
+  var index = col - GbGradeTable.FIXED_COLUMN_OFFSET;
+  var student = instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+  var column = instance.view.settings.columns[col]._data_;
+
+  // key needs to contain all values the cell requires for render
+  // otherwise it won't rerender when those values change
+  var hasComment = column.type === "assignment" ? GbGradeTable.hasComment(student, column.assignmentId) : false;
+  var scoreState = GbGradeTable.getCellState(row, col, instance);
+  var isReadOnly = column.type === "assignment" ? GbGradeTable.isReadOnly(student, column.assignmentId) : false;
+  var hasConcurrentEdit = column.type === "assignment" ? GbGradeTable.hasConcurrentEdit(student, column.assignmentId) : false;
+  var keyValues = [row, index, value, student.eid, hasComment, isReadOnly, hasConcurrentEdit, column.type, scoreState];
+  var cellKey = GbGradeTable.cleanKey(keyValues.join("_"));
+
+  var wasInitialised = $.data(td, 'cell-initialised');
+
+  if (!GbGradeTable.forceRedraw && wasInitialised === cellKey) {
+    // Nothing to do
+    return;
+  }
+
+  var student = instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+
+  var valueCell;
+
+  if (!wasInitialised || td.getAttribute('scope') == 'row') {
+    // First time we've initialised this cell.
+    // Or we're replacing the student name cell
+    GbGradeTable.templates.cell.setHTML(td, {
+      value: value
+    });
+
+    if (td.hasAttribute('scope')) {
+      td.removeAttribute('scope');
+      td.removeAttribute('role');
+    }
+  } else if (wasInitialised != cellKey) {
+    valueCell = td.getElementsByClassName('gb-value')[0];
+
+    // This cell was previously holding a different value.  Just patch it.
+    GbGradeTable.replaceContents(valueCell, document.createTextNode(value));
+  }
+
+  if (!valueCell) {
+    valueCell = td.getElementsByClassName('gb-value')[0];
+  }
+
+  $.data(td, "studentid", student.userId);
+  if (column.type === "assignment") {
+    $.data(td, "assignmentid", column.assignmentId);
+    $.removeData(td, "categoryId");
+
+    if (GbGradeTable.settings.isPercentageGradeEntry && value != null && value != "") {
+      GbGradeTable.replaceContents(valueCell, document.createTextNode('' + value + '%'));
+    }
+
+    // rewrite the dropdown tooltip
+    var dropdownToggle = $td.find('.dropdown-toggle');
+    if (dropdownToggle.length > 0) {
+      if (isReadOnly) {
+          dropdownToggle[0].style.display = 'none';
+          dropdownToggle.attr('aria-hidden', 'true');
+      } else {
+          dropdownToggle[0].style.display = 'block';
+          dropdownToggle.attr('aria-hidden', 'false');
+          var dropdownToggleTooltip = GbGradeTable.templates.gradeMenuTooltip.process();
+          dropdownToggleTooltip = dropdownToggleTooltip.replace('{0}', student.firstName + ' ' + student.lastName);
+          dropdownToggleTooltip = dropdownToggleTooltip.replace('{1}', column.title);
+          dropdownToggle.attr('title', dropdownToggleTooltip);
+      }
+    }
+  } else if (column.type === "category") {
+    $.data(td, "categoryId", column.categoryId);
+    $.removeData(td, "assignmentid");
+    GbGradeTable.replaceContents(valueCell, document.createTextNode(GbGradeTable.formatCategoryAverage(value)));
+
+    var dropdownToggle = $td.find('.dropdown-toggle');
+    if (dropdownToggle.length > 0) {
+      dropdownToggle[0].style.display = 'none';
+      dropdownToggle.attr('aria-hidden', 'true');
+    }
+  } else {
+    throw "column.type not supported: " + column.type;
+  }
+
+  // collect all the notification
+  var notifications = [];
+
+  // comment notification
+  var commentNotification = td.getElementsByClassName("gb-comment-notification")[0];
+  if (commentNotification) {
+    if (hasComment) {
+      commentNotification.style.display = 'block';
+      notifications.push({
+        type: 'comment',
+        comment: "..."
+      });
+    } else {
+      commentNotification.style.display = 'none';
+    }
+  }
+
+
+  // other notifications
+  var gbNotification = td.getElementsByClassName('gb-notification')[0];
+  var cellDiv = td.getElementsByClassName('relative')[0];
+
+  cellDiv.className = 'relative';
+  var $cellDiv = $(cellDiv);
+
+  if (column.externallyMaintained) {
+    $cellDiv.addClass("gb-read-only");
+    notifications.push({
+      type: 'external',
+      externalId: column.externalId,
+      externalAppName: column.externalAppName,
+    });
+  } else if (isReadOnly) {
+    $cellDiv.addClass("gb-read-only");
+    notifications.push({
+      type: 'readonly'
+    });
+  } else if (scoreState == "saved") {
+    $cellDiv.addClass("gb-save-success");
+
+    setTimeout(function() {
+      GbGradeTable.clearCellState(row, col);
+      $cellDiv.removeClass("gb-save-success", 2000);
+    }, 2000);
+  } else if (scoreState == "synced") {
+    $cellDiv.addClass("gb-just-synced");
+
+    setTimeout(function() {
+      GbGradeTable.clearCellState(row, col);
+      $cellDiv.removeClass("gb-just-synced", 2000);
+    }, 2000);
+  } else if (hasConcurrentEdit) {
+    $cellDiv.addClass("gb-concurrent-edit");
+    notifications.push({
+      type: 'concurrent-edit',
+      conflict: $.data(td, "concurrent-edit"),
+      showSaveError: (scoreState == 'error')
+    });
+  } else if (scoreState == "error") {
+    $cellDiv.addClass("gb-save-error");
+    notifications.push({
+      type: 'save-error'
+    });
+  } else if (scoreState == "invalid") {
+    $cellDiv.addClass("gb-save-invalid");
+    notifications.push({
+      type: 'save-invalid'
+    });
+  }
+  var isExtraCredit = false;
+
+  if (GbGradeTable.settings.isPointsGradeEntry) {
+    isExtraCredit = parseFloat(value) > parseFloat(column.points);
+  } else if (GbGradeTable.settings.isPercentageGradeEntry) {
+    isExtraCredit = parseFloat(value) > 100;
+  }
+
+  if (isExtraCredit) {
+    $cellDiv.addClass("gb-extra-credit");
+    $(gbNotification).addClass("gb-flag-extra-credit");
+    notifications.push({
+      type: 'extra-credit'
+    });
+  } else {
+    $(gbNotification).removeClass("gb-flag-extra-credit");
+    $cellDiv.removeClass("gb-extra-credit");
+  }
+
+  if (column.type == 'category') {
+    $cellDiv.addClass('gb-category-average');
+  } else {
+    $cellDiv.removeClass('gb-category-average');
+  }
+
+  // create notification tooltip
+  if (column.type == 'assignment') {
+    $.data(td, "metadata", {
+      id: cellKey,
+      student: student,
+      value: value,
+      assignment: column,
+      notifications: notifications,
+      readonly: isReadOnly
+    });
+  } else if (column.type == 'category') {
+    $.data(td, "metadata", {
+      id: cellKey,
+      student: student,
+      categoryAverage: GbGradeTable.formatCategoryAverage(value),
+      category: column,
+      notifications: notifications
+    });
+  } else {
+    td.removeAttribute('aria-describedby');
+    $.data(td, "metadata", null);
+  }
+
+  $.data(td, 'cell-initialised', cellKey);
+};
+
+
+GbGradeTable.headerRenderer = function (col, column) {
+  if (col == 0) {
+    return GbGradeTable.templates.studentHeader.process({col: col, settings: GbGradeTable.settings});
+  } else if (col == 1) {
+    return GbGradeTable.templates.courseGradeHeader.process({col: col, settings: GbGradeTable.settings});
+  }
+
+  var templateData = $.extend({
+    col: col,
+    settings: GbGradeTable.settings
+  }, column);
+
+  if (column.type === "assignment") {
+    return GbGradeTable.templates.assignmentHeader.process(templateData);
+  } else if (column.type === "category") {
+    return GbGradeTable.templates.categoryScoreHeader.process(templateData);
+  } else {
+    return "Unknown column type for column: " + col + " (" + column.type+ ")";
+  }
+};
+
+GbGradeTable.studentCellRenderer = function(instance, td, row, col, prop, value, cellProperties) {
+  if (value === null) {
+    return;
+  }
+
+  var $td = $(td);
+
+  $td.attr("scope", "row").attr("role", "rowHeader");
+
+  var cellKey = (row + '_' + col);
+
+  var data = $.extend({
+    settings: GbGradeTable.settings
+  }, value);
+
+  var html = GbGradeTable.templates.studentCell.setHTML(td, data);
+
+  $.data(td, 'cell-initialised', cellKey);
+  $.data(td, "studentid", value.userId);
+  $.data(td, "metadata", {
+    id: cellKey,
+    student: value
+  });
+
+  $td.removeAttr('aria-describedby');
+}
+
+
+GbGradeTable.mergeColumns = function (data, fixedColumns) {
+  var result = [];
+
+  for (var row = 0; row < data.length; row++) {
+    var updatedRow = []
+
+    for (var i=0; i < fixedColumns.length; i++) {
+      updatedRow.push(fixedColumns[i][row]);
+    }
+
+    for (var col = 0; col < data[row].length; col++) {
+      updatedRow.push(data[row][col]);
+    }
+
+    result.push(updatedRow)
+  }
+
+  return result;
+}
+
+var nextRequestId = 0;
+GbGradeTable.ajaxCallbacks = {}
+
+GbGradeTable.ajaxComplete = function (requestId, status, data) {
+  GbGradeTable.ajaxCallbacks[requestId](status, data);
+};
+
+GbGradeTable.ajax = function (params, callback) {
+  params['_requestId'] = nextRequestId++;
+
+  GbGradeTable.ajaxCallbacks[params['_requestId']] = callback || $.noop;;
+
+  GbGradeTable.domElement.trigger("gbgradetable.action", params);
+};
+
+// FIXME: Hard-coded stuff here
+GbGradeTable.renderTable = function (elementId, tableData) {
+  GbGradeTable.domElement = $('#' + elementId);
+  GbGradeTable.students = tableData.students;
+  GbGradeTable.columns = tableData.columns;
+  GbGradeTable.settings = tableData.settings;
+  GbGradeTable.grades = GbGradeTable.mergeColumns(GbGradeTable.unpack(tableData.serializedGrades,
+                                                                      tableData.rowCount,
+                                                                      tableData.columnCount),
+                                                  [
+                                                    tableData.students,
+                                                    tableData.courseGrades
+                                                  ]);
+
+  GbGradeTableEditor = Handsontable.editors.TextEditor.prototype.extend();
+
+  GbGradeTableEditor.prototype.createElements = function () {
+    Handsontable.editors.TextEditor.prototype.createElements.apply(this, arguments);
+    var outOf = "<span class='out-of'></span>";
+    $(this.TEXTAREA_PARENT).append(outOf);
+  };
+
+  GbGradeTableEditor.prototype.beginEditing = function() {
+    Handsontable.editors.TextEditor.prototype.beginEditing.apply(this, arguments);
+
+    var col = this.instance.getSelected()[1];
+
+    var outOf = $(this.TEXTAREA_PARENT).find(".out-of")[0];
+
+    if (GbGradeTable.settings.isPercentageGradeEntry) {
+      outOf.innerHTML = "100%";
+    } else if (GbGradeTable.settings.isPointsGradeEntry) {
+      var assignment = GbGradeTable.instance.view.settings.columns[col]._data_;
+      var points = assignment.points;
+      outOf.innerHTML = "/" + points;
+    }
+    var innerHeight = ($(this.TEXTAREA).height() - 3) + 'px';
+    outOf.style.height = innerHeight;
+    outOf.style.lineHeight = innerHeight;
+    this.TEXTAREA.style.lineHeight = innerHeight;
+
+    if ($(this.TEXTAREA).val().length > 0) {
+      $(this.TEXTAREA).select();
+    }
+  };
+
+  GbGradeTable.container = $("#gradebookSpreadsheet");
+
+  GbGradeTable.columnDOMNodeCache = {};
+
+  GbGradeTable.calculateIdealHeight = function() {
+    return $(window).height() * 0.6;
+  };
+
+  GbGradeTable.calculateIdealWidth = function() {
+    return MorpheusViewportHelper.isPhone() ? $("#pageBody").width() - 40 : $("#pageBody").width() - $("#toolMenuWrap").width() - 60;
+  };
+
+  GbGradeTable.instance = new Handsontable(document.getElementById(elementId), {
+    data: GbGradeTable.getFilteredData(),
+    fixedColumnsLeft: 2,
+    colHeaders: true,
+    columns: GbGradeTable.getFilteredColumns(),
+    colWidths: GbGradeTable.getColumnWidths(),
+    autoRowSize: true,
+    autoColSize: false,
+    height: GbGradeTable.calculateIdealHeight(),
+    width: GbGradeTable.calculateIdealWidth(),
+    fillHandle: false,
+    afterGetRowHeader: function(row,th) {
+      $(th).
+        attr("role", "rowheader").
+        attr("scope", "row");
+    },
+
+    // This function is another hotspot.  Efficiency is paramount!
+    afterGetColHeader: function(col, th) {
+      var $th = $(th);
+
+      // Calculate the HTML that we need to show
+      var html = '';
+      if (col < 2) {
+        html = GbGradeTable.headerRenderer(col);
+      } else {
+        html = GbGradeTable.headerRenderer(col, this.view.settings.columns[col]._data_);
+      }
+
+      // If we haven't got a cached parse of it, do that now
+      if (!GbGradeTable.columnDOMNodeCache[col] || GbGradeTable.columnDOMNodeCache[col].html !== html) {
+        GbGradeTable.columnDOMNodeCache[col] = {
+          html: html,
+          dom: $(html).toArray()
+        };
+      }
+
+      // We need to clone the dom elements as they may be reused by the static fixed headers
+      // and we want to avoid one render stealing another headers element instances
+      var clonedDom = GbGradeTable.columnDOMNodeCache[col].dom.map(function(el) {
+        return el.cloneNode(true);
+      });
+
+      GbGradeTable.replaceContents(th, clonedDom);
+
+      $th.
+        attr("role", "columnheader").
+        attr("scope", "col");
+
+      if (GbGradeTable.settings.isGroupedByCategory) {
+        th.classList.add('gb-categorized');
+      }
+
+      if (GbGradeTable.currentSortColumn == col && GbGradeTable.currentSortDirection != null) {
+        var handle = th.getElementsByClassName('gb-title')[0];
+        handle.classList.add("gb-sorted-"+GbGradeTable.currentSortDirection);
+      }
+
+      var columnModel = this.view.settings.columns[col]._data_;
+
+      // assignment column
+      if (col > 1) {
+        var columnName = columnModel.title;
+
+        $th.
+          attr("role", "columnheader").
+          attr("scope", "col").
+          attr("abbr", columnName).
+          attr("aria-label", columnName);
+
+        $.data(th, "columnType", columnModel.type);
+        $.data(th, "categoryId", columnModel.categoryId);
+
+        if (columnModel.type == "assignment") {
+          $.data(th, "assignmentid", columnModel.assignmentId);
+
+          if (columnModel.externallyMaintained) {
+            var flag = th.getElementsByClassName('gb-external-app')[0];
+            flag.title = flag.title.replace('{0}', columnModel.externalAppName);
+          }
+
+          var dropdownToggle = $th.find('.dropdown-toggle');
+          if (dropdownToggle.length > 0) {
+            dropdownToggle[0].style.display = 'block';
+            dropdownToggle.attr('aria-hidden', 'false');
+            var dropdownToggleTooltip = GbGradeTable.templates.gradeHeaderMenuTooltip.process();
+            dropdownToggleTooltip = dropdownToggleTooltip.replace('{0}', columnModel.title);
+            dropdownToggle.attr('title', dropdownToggleTooltip);
+          }
+        }
+
+        if (GbGradeTable.settings.isCategoriesEnabled) {
+          var color = columnModel.color || columnModel.categoryColor;
+          if (GbGradeTable.settings.isGroupedByCategory) {
+            $th.css("borderTopColor", color);
+          }
+          $th.find(".swatch").css("backgroundColor", color);
+        }
+      }
+
+      // show visual cue that columns are hidden
+      // check for last of the fixed columns
+      if (col == 1) { //GbGradeTable.instance.getSettings().fixedColumnsLeft - 1) {
+        if (GbGradeTable.columns[0].hidden &&
+            $th.find(".gb-hidden-column-visual-cue").length == 0) {
+          $th.find(".relative").append("<a href='javascript:void(0);' class='gb-hidden-column-visual-cue'></a>");
+        }
+      } else if (col >= 2) { //GbGradeTable.instance.getSettings().fixedColumnsLeft) {
+        var origColIndex = GbGradeTable.columns.findIndex(function(c, i) {
+          return c == columnModel;
+        });
+
+        if (origColIndex < (GbGradeTable.columns.length - 1)) {
+          if (GbGradeTable.columns[origColIndex+1].hidden &&
+              $th.find(".gb-hidden-column-visual-cue").length == 0) {
+            $th.find(".relative").append("<a href='javascript:void(0);' class='gb-hidden-column-visual-cue'></a>");
+          }
+        }
+      }
+    },
+    beforeRender: function(isForced) {
+      $(".gb-hidden-column-visual-cue").remove();
+    },
+    beforeOnCellMouseDown: function(event, coords, td) {
+      var self = this;
+
+      if (coords.row < 0 && coords.col >= 0) {
+        var dragging = false;
+        var timeout = setTimeout(function() {
+          dragging = true;
+          $(document).trigger('dragstarted', event);
+        }, 200);
+
+        $(event.target).one('mouseup', function() {
+          if (!dragging) {
+            clearTimeout(timeout);
+            event.stopImmediatePropagation();
+            self.selectCell(0, coords.col);
+          }
+        });
+      } else if (coords.col < 0) {
+        event.stopImmediatePropagation();
+        self.selectCell(coords.row, GbGradeTable.STUDENT_COLUMN_INDEX);
+      }
+    },
+    afterChange: function(changes, source) {
+        if (changes) {
+            for (var i=0; i<changes.length; i++) {
+                var change = changes[i];
+                var row = change[0];
+                var col = change[1];
+                var oldScore = change[2];
+                var newScore = change[3];
+
+                if (col < GbGradeTable.FIXED_COLUMN_OFFSET) {
+                    // we don't care if a student or course grade changes
+                    continue;
+                }
+
+                if (oldScore == newScore) {
+                    // nothing to do!
+                    continue;
+                }
+
+                var column = GbGradeTable.instance.view.settings.columns[col]._data_;
+                if (column.type != "assignment") {
+                    // not an assignment!! Bail!
+                    continue;
+                }
+
+                var student = GbGradeTable.instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+                var studentId = student.userId;
+
+                var assignmentId = column.assignmentId;
+
+                GbGradeTable.setScore(studentId, assignmentId, oldScore, newScore);
+            }
+        }
+    },
+    currentRowClassName: 'currentRow',
+    currentColClassName: 'currentCol',
+    multiSelect: false,
+    copyPaste: false
+  });
+
+  GbGradeTable.instance.updateSettings({
+    cells: function (row, col, prop) {
+      var cellProperties = {};
+
+      var column = GbGradeTable.instance.view.settings.columns[col]._data_;
+      var student = GbGradeTable.instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+
+      if (column == null) {
+         cellProperties.readOnly = true;
+      } else if (student == null) {
+         cellProperties.readOnly = true;
+      } else {
+        var readonly = column.type === "assignment" ? GbGradeTable.isReadOnly(student, column.assignmentId) : true;
+
+        if (column.externallyMaintained || readonly) {
+          cellProperties.readOnly = true;
+        }
+      }
+
+      return cellProperties;
+    }
+  });
+
+
+  // resize the table on window resize
+  var resizeTimeout;
+  $(window).on("resize", function() {
+    clearTimeout(resizeTimeout);
+    resizeTimeout = setTimeout(function() {
+      GbGradeTable.instance.updateSettings({
+        height: GbGradeTable.calculateIdealHeight(),
+        width: GbGradeTable.calculateIdealWidth(),
+      });
+    }, 200);
+  });
+
+  $(".js-toggle-nav").on("click", function() {
+    $(window).trigger('resize');
+  });
+
+
+  // append all dropdown menus to body to avoid overflows on table
+  var $dropdownMenu;
+  var $link;
+  $(window).on('show.bs.dropdown', function (event) {
+    $link = $(event.target);
+    $dropdownMenu = $(event.target).find('.dropdown-menu');
+
+    if ($link.closest("#gradeTable").length == 0) {
+      return true;
+    }
+
+    $dropdownMenu.addClass("gb-dropdown-menu");
+
+    $dropdownMenu.data("cell", $link.closest("td, th"));
+
+    $dropdownMenu.width($dropdownMenu.outerWidth());
+
+    $('body').append($dropdownMenu.detach());
+
+    var linkOffset = $link.offset();
+
+    $dropdownMenu.css({
+        'display': 'block',
+        'top': linkOffset.top + $link.outerHeight(),
+        'left': linkOffset.left - $dropdownMenu.outerWidth() + $link.outerWidth()
+    });
+  });
+  $(window).on('hide.bs.dropdown', function (event) {
+    if ($link.closest("#gradeTable").length == 0) {
+      return true;
+    }
+    $link.append($dropdownMenu.detach());
+    $dropdownMenu.hide();
+    $dropdownMenu = null;
+  });
+  $(".wtHolder").on('scroll', function (event) {
+    if ($dropdownMenu && $dropdownMenu.length > 0) {
+      var linkOffset = $link.offset();
+
+      $dropdownMenu.css({
+          'top': linkOffset.top + $link.outerHeight(),
+          'left': linkOffset.left - $dropdownMenu.outerWidth() + $link.outerWidth()
+      });
+    }
+  });
+
+
+  var filterTimeout;
+  $("#studentFilterInput").on("keyup", function(event) {
+    clearTimeout(filterTimeout);
+    filterTimeout = setTimeout(function() {
+      GbGradeTable.redrawTable(true);
+    }, 500);
+  }).on("focus", function() {
+    // deselect the table so subsequent keyboard entry isn't entered into cells
+    GbGradeTable.instance.deselectCell();
+  });
+  $(document).on('click', '.gb-student-filter-clear-button', function(event) {
+    event.preventDefault();
+    if ($("#studentFilterInput").val().length > 0) {
+      $("#studentFilterInput").val("");
+      $("#studentFilterInput").trigger('keyup');
+    }
+  });
+
+  // Setup menu event bindings
+  // View Log
+  $(document).on("click", ".gb-dropdown-menu .gb-view-log", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'viewLog',
+      studentId: $.data($cell[0], "studentid"),
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // Edit Assignment
+  on("click", ".gb-dropdown-menu .edit-assignment-details", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'editAssignment',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // View Assignment Statistics
+  on("click", ".gb-dropdown-menu .gb-view-statistics", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'viewStatistics',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // Override Course Grade
+  on("click", ".gb-dropdown-menu .gb-course-grade-override", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'overrideCourseGrade',
+      studentId: $.data($cell[0], "studentid")
+    });
+  }).
+  // Edit Comment
+  on("click", ".gb-dropdown-menu .gb-edit-comments", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.editComment($.data($cell[0], "studentid"), $.data($cell[0], "assignmentid"));
+  }).
+  // View Grade Summary
+  on("click", ".gb-view-grade-summary", function() {
+    var $cell = $(this).closest('td');
+
+    GbGradeTable.viewGradeSummary($.data($cell[0], "studentid"));
+  }).
+  // Set Zero Score for Empty Cells
+  on("click", ".gb-dropdown-menu .gb-set-zero-score", function() {
+    GbGradeTable.ajax({
+      action: 'setZeroScore'
+    });
+  }).
+  // View Course Grade Override Log
+  on("click", ".gb-dropdown-menu .gb-course-grade-override-log", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'viewCourseGradeLog',
+      studentId: $.data($cell[0], "studentid")
+    });
+  }).
+  // Delete Grade Item
+  on("click", ".gb-dropdown-menu .gb-delete-item", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'deleteAssignment',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // Set ungraded values for assignment
+  on("click", ".gb-dropdown-menu .gb-set-ungraded", function() {
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'setUngraded',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // Student name sort order
+  on("click", ".gb-student-name-order-toggle", function() {
+    var $action = $(this);
+
+        GbGradeTable.ajax({
+          action: 'setStudentNameOrder',
+          orderby: $action.data("order-by")
+        });
+  }).
+  // Toggle Points (Course Grade)
+  on("click", ".gb-dropdown-menu .gb-toggle-points", function() {
+    GbGradeTable.ajax({
+      action: 'toggleCourseGradePoints'
+    });
+  }).
+  // Move Left (Assignment column)
+  on("click", ".gb-dropdown-menu .gb-move-left", function(event) {
+    event.preventDefault();
+
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'moveAssignmentLeft',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  }).
+  // Move Right (Assignment column)
+  on("click", ".gb-dropdown-menu .gb-move-right", function(event) {
+    event.preventDefault();
+
+    var $dropdown = $(this).closest(".gb-dropdown-menu");
+    var $cell = $dropdown.data("cell");
+
+    GbGradeTable.ajax({
+      action: 'moveAssignmentRight',
+      assignmentId: $.data($cell[0], "assignmentid")
+    });
+  });
+
+  GbGradeTable.setupToggleGradeItems();
+  GbGradeTable.setupColumnSorting();
+  GbGradeTable.setupConcurrencyCheck();
+  GbGradeTable.setupKeyboardNavigation();
+  GbGradeTable.setupCellMetaDataSummary();
+  GbGradeTable.setupAccessiblityBits();
+  GbGradeTable.refreshSummaryLabels();
+  GbGradeTable.setupDragAndDrop();
+
+  // Patch HandsonTable getWorkspaceWidth for improved scroll performance on big tables
+  var origGetWorkspaceWidth = WalkontableViewport.prototype.getWorkspaceWidth;
+
+  (function () {
+    var cachedWidth = undefined;
+    WalkontableViewport.prototype.getWorkspaceWidth = function () {
+      var self = this;
+      if (!cachedWidth) {
+        cachedWidth = origGetWorkspaceWidth.bind(self)();
+      }
+
+      return cachedWidth;
+    }
+  }());
+
+  // Patch HandsonTable adjustColumnWidths for improved scroll performance
+  var origAdjustColumnWidths = WalkontableTableRenderer.prototype.adjustColumnWidths;
+
+  (function () {
+    WalkontableTableRenderer.prototype.adjustColumnWidths = function (columnsToRender) {
+      var sourceInstance = this.wot.cloneSource ? this.wot.cloneSource : this.wot;
+      var mainHolder = sourceInstance.wtTable.holder;
+      if (this.wot.cachedScrollbarCompensation === undefined) {
+        this.wot.cachedScrollbarCompensation = 0;
+        if (mainHolder.offsetHeight < mainHolder.scrollHeight) {
+          // NYU: Hacked this!  was getScrollbarWidth();
+          this.wot.cachedScrollbarCompensation = 0;
+        }
+      }
+
+      var scrollbarCompensation = this.wot.cachedScrollbarCompensation;
+
+      this.wot.wtViewport.columnsRenderCalculator.refreshStretching(this.wot.wtViewport.getViewportWidth() - scrollbarCompensation);
+      var rowHeaderWidthSetting = this.wot.getSetting('rowHeaderWidth');
+      if (rowHeaderWidthSetting != null) {
+        for (var i = 0; i < this.rowHeaderCount; i++) {
+          var oldWidth = this.COLGROUP.childNodes[i].style.width;
+          var newWidth = (isNaN(rowHeaderWidthSetting) ? rowHeaderWidthSetting[i] : rowHeaderWidthSetting) + 'px';
+
+          // NYU: Added these conditionals
+          if (oldWidth != newWidth) {
+            this.COLGROUP.childNodes[i].style.width = (isNaN(rowHeaderWidthSetting) ? rowHeaderWidthSetting[i] : rowHeaderWidthSetting) + 'px';
+          }
+        }
+      }
+      for (var renderedColIndex = 0; renderedColIndex < columnsToRender; renderedColIndex++) {
+        var oldWidth = this.COLGROUP.childNodes[renderedColIndex + this.rowHeaderCount].style.width;
+        var width = this.wtTable.getStretchedColumnWidth(this.columnFilter.renderedToSource(renderedColIndex));
+
+        // NYU: Added these conditionals
+        if (oldWidth != width) {
+          this.COLGROUP.childNodes[renderedColIndex + this.rowHeaderCount].style.width = width + 'px';
+        }
+      }
+    }
+  }());
+
+  GbGradeTable.runReadyCallbacks();
+};
+
+GbGradeTable.viewGradeSummary = function(studentId) {
+  GbGradeTable.ajax({
+    action: 'viewGradeSummary',
+    studentId: studentId
+  });
+};
+
+
+GbGradeTable.selectCell = function(assignmentId, studentId) {
+  var row = 0;
+  if (studentId != null){
+    row = GbGradeTable.rowForStudent(studentId);
+  }
+
+  var col = 0;
+  if (assignmentId != null) {
+    col = GbGradeTable.colForAssignment(assignmentId);
+  }
+
+  return GbGradeTable.instance.selectCell(row, col);
+};
+
+GbGradeTable.selectCourseGradeCell = function(studentId) {
+  var row = 0;
+  if (studentId != null){
+    row = GbGradeTable.rowForStudent(studentId);
+  }
+
+  return GbGradeTable.instance.selectCell(row, GbGradeTable.COURSE_GRADE_COLUMN_INDEX);
+};
+
+GbGradeTable.rowForStudent = function(studentId) {
+  return GbGradeTable.instance.view.settings.data.findIndex(function(row, index, array) {
+           return row[GbGradeTable.STUDENT_COLUMN_INDEX].userId === studentId;
+         });
+};
+
+GbGradeTable.indexOfFirstCategoryColumn = function(categoryId) {
+  return GbGradeTable.columns.findIndex(function(column, index, array) {
+           return column.categoryId == categoryId;
+         });
+};
+
+GbGradeTable.modelForStudent = function(studentId) {
+  for (var i=0; i<GbGradeTable.students.length; i++) {
+    var student = GbGradeTable.students[i];
+    if (student.userId === studentId) {
+      return student;
+    }
+  }
+
+  throw "modelForStudent: model not found for " + studentId;
+};
+
+GbGradeTable.modelIndexForStudent = function(studentId) {
+  for (var i=0; i<GbGradeTable.students.length; i++) {
+    var student = GbGradeTable.students[i];
+    if (student.userId === studentId) {
+      return i;
+    }
+  }
+
+  throw "modelIndexForStudent: model not found for " + studentId;
+};
+
+
+GbGradeTable.colForAssignment = function(assignmentId) {
+  return GbGradeTable.instance.view.settings.columns.findIndex(function(column, index, array) {
+           return column._data_ && column._data_.assignmentId === parseInt(assignmentId);
+         });
+};
+
+GbGradeTable.colForCategoryScore = function(categoryId) {
+  return GbGradeTable.instance.view.settings.columns.findIndex(function(column, index, array) {
+           return column._data_ && column._data_.categoryId === parseInt(categoryId);
+         });
+};
+
+GbGradeTable.colModelForAssignment = function(assignmentId) {
+  for (var i=0; i<GbGradeTable.columns.length; i++) {
+    var column = GbGradeTable.columns[i];
+    if (column.type == "assignment") {
+      if (column.assignmentId === parseInt(assignmentId)) {
+        return column;
+      }
+    }
+  }
+  
+  throw "colModelForAssignment: column not found for " + assignmentId;
+};
+
+GbGradeTable.hasComment = function(student, assignmentId) {
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+  return student.hasComments[assignmentIndex] === "1";
+};
+
+
+GbGradeTable.isReadOnly = function(student, assignmentId) {
+  if (student.readonly == null) {
+    return false;
+  }
+
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+  return student.readonly[assignmentIndex] === "1";
+};
+
+
+GbGradeTable.updateHasComment = function(student, assignmentId, comment) {
+  var hasComments = student.hasComments;
+  var flag = (comment == null || comment == "") ? '0' : '1';
+
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+
+  student.hasComments = hasComments.substr(0, assignmentIndex) + flag + hasComments.substr(assignmentIndex+1);
+};
+
+
+GbGradeTable.editComment = function(studentId, assignmentId) {
+  GbGradeTable.ajax({
+    action: 'editComment',
+    studentId: studentId,
+    assignmentId: assignmentId
+  });
+};
+
+
+GbGradeTable.editSettings = function() {
+  GbGradeTable.ajax({
+      action: 'editSettings',
+  });
+};
+
+
+GbGradeTable.hasConcurrentEdit = function(student, assignmentId) {
+  if (student.hasConcurrentEdit == null) {
+    student.hasConcurrentEdit = "";
+    for(var i=0; i < GbGradeTable.columns.length; i++) {
+      student.hasConcurrentEdit += "0";
+    };
+    return false;
+  }
+
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+  return student.hasConcurrentEdit[assignmentIndex] === "1";
+};
+
+
+GbGradeTable.setHasConcurrentEdit = function(conflict) {
+  var student = GbGradeTable.modelForStudent(conflict.studentUuid);
+
+  if (GbGradeTable.hasConcurrentEdit(student, conflict.assignmentId)) {
+    // already marked grade as out of date
+    return;
+  }
+
+  var hasConcurrentEdit = student.hasConcurrentEdit;
+
+  var row = GbGradeTable.rowForStudent(conflict.studentUuid);
+  var col = GbGradeTable.colForAssignment(conflict.assignmentId);
+
+  $.data(GbGradeTable.instance.getCell(row, col), "concurrent-edit", conflict);
+
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(conflict.assignmentId), GbGradeTable.columns);
+
+  student.hasConcurrentEdit = hasConcurrentEdit.substr(0, assignmentIndex) + "1" + hasConcurrentEdit.substr(assignmentIndex+1);
+
+  GbGradeTable.instance.setDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX, student);
+  GbGradeTable.redrawCell(row, col);
+}
+
+
+GbGradeTable.colModelForCategoryScore = function(categoryName) {
+  for (var i=0; i<GbGradeTable.columns.length; i++) {
+    var column = GbGradeTable.columns[i];
+    if (column.type == "category") {
+      if (column.categoryName === categoryName) {
+        return column;
+      }
+    }
+  }
+  
+  throw "colModelForCategoryScore: column not found for " + categoryName;
+};
+
+
+GbGradeTable.colModelForCategoryId = function(categoryId) {
+  for (var i=0; i<GbGradeTable.columns.length; i++) {
+    var column = GbGradeTable.columns[i];
+    if (column.type == "category") {
+      if (column.categoryId === parseInt(categoryId)) {
+        return column;
+      }
+    }
+  }
+
+  throw "colModelForCategoryId: column not found for " + categoryId;
+};
+
+
+GbGradeTable.selectStudentCell = function(studentId) {
+  var row = 0;
+  if (studentId != null){
+    row = GbGradeTable.rowForStudent(studentId);
+  }
+
+  return GbGradeTable.instance.selectCell(row, GbGradeTable.STUDENT_COLUMN_INDEX);
+};
+
+GbGradeTable.updateComment = function(assignmentId, studentId, comment) {
+  var student = GbGradeTable.modelForStudent(studentId);
+
+  var hasComments = student.hasComments;
+  var flag = (comment == null || comment == "") ? '0' : '1';
+
+  var assignmentIndex = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+
+  student.hasComments = hasComments.substr(0, assignmentIndex) + flag + hasComments.substr(assignmentIndex+1);
+
+  var row = GbGradeTable.rowForStudent(studentId);
+  var col = GbGradeTable.colForAssignment(assignmentId);
+
+  GbGradeTable.instance.setDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX, student);
+  GbGradeTable.redrawCell(row, col);
+};
+
+GbGradeTable.redrawCell = function(row, col) {
+  var $cell = $(GbGradeTable.instance.getCell(row, col));
+  $cell.removeData('cell-initialised');
+
+  GbGradeTable.instance.render();
+};
+
+GbGradeTable.formatCategoryAverage = function(value) {
+  if (value != null && (value+"").length > 0 && value != "-") {
+    var valueAsLocaleString = GbGradeTable.localizeNumber(value);
+    return '' + valueAsLocaleString + '%';
+  } else {
+    return '-';
+  }
+};
+
+GbGradeTable._redrawTableTimeout;
+GbGradeTable.redrawTable = function(force) {
+  clearTimeout(GbGradeTable._redrawTableTimeout);
+
+  GbGradeTable._redrawTableTimeout = setTimeout(function() {
+    GbGradeTable.forceRedraw = force || false;
+
+    GbGradeTable.currentSortColumn = 0;
+    GbGradeTable.currentSortDirection = 'desc';
+
+    GbGradeTable.instance.loadData(GbGradeTable.getFilteredData());
+    GbGradeTable.instance.updateSettings({
+      columns: GbGradeTable.getFilteredColumns()
+    });
+    GbGradeTable.refreshSummaryLabels();
+    GbGradeTable.forceRedraw = false;
+  }, 100);
+};
+
+GbGradeTable.getFilteredColumns = function() {
+  return [{
+    renderer: GbGradeTable.studentCellRenderer,
+    editor: false,
+  },
+  {
+    renderer: GbGradeTable.courseGradeRenderer,
+    editor: false,
+  }].concat(GbGradeTable.columns.filter(function(col) {
+    return !col.hidden;
+  }).map(function (column) {
+    if (column.type === 'category') {
+      return {
+        renderer: GbGradeTable.cellRenderer,
+        editor: false,
+        _data_: column
+      };
+    } else {
+      var readonly = column.externallyMaintained;
+
+      return {
+        renderer: GbGradeTable.cellRenderer,
+        editor: readonly ? false : GbGradeTableEditor,
+        _data_: column
+      };
+    }
+  }));
+};
+
+GbGradeTable.getFilteredColHeaders = function() {
+  return GbGradeTable.getFilteredColumns().map(function() {
+    return GbGradeTable.headerRenderer;
+  });
+};
+
+GbGradeTable.getFilteredData = function() {
+  var data = GbGradeTable.grades.slice(0);
+
+  data = GbGradeTable.applyStudentFilter(data);
+  data = GbGradeTable.applyColumnFilter(data);
+
+  return data;
+};
+
+GbGradeTable.applyColumnFilter = function(data) {
+  for (var i=GbGradeTable.columns.length-1; i>=0; i--) {
+    var column = GbGradeTable.columns[i];
+    if (column.hidden) {
+      for(var row=0; row<data.length; row++) {
+        data[row] = data[row].slice(0,i+2).concat(data[row].slice(i+3))
+      }
+    }
+  } 
+
+  return data;
+};
+
+GbGradeTable.applyStudentFilter = function(data) {
+  var query = $("#studentFilterInput").val();
+
+  if (query == "") {
+    return data;
+  } else {
+    var queryStrings = query.split(" ");
+    var filteredData = data.filter(function(row) {
+      var match = true;
+
+      var student = row[GbGradeTable.STUDENT_COLUMN_INDEX];
+      var searchableFields = [student.firstName, student.lastName, student.eid];
+      var studentSearchString = searchableFields.join(";")
+
+      for (var i=0; i<queryStrings.length; i++) {
+        var queryString = queryStrings[i];
+
+        if (studentSearchString.match(new RegExp(queryString, "i")) == null) {
+          return false;
+        }
+      }
+      return match;
+    });
+
+    return filteredData;
+  }
+};
+
+GbGradeTable.getColumnWidths = function() {
+  var studentColumnWidth = 220;
+  var courseGradeColumnWidth = 140;
+  var gradeColumnWidth = 180;
+
+  // if showing points
+  // make column a touch wider
+  if (GbGradeTable.settings.showPoints) {
+    courseGradeColumnWidth = 220;
+  }
+
+  return [studentColumnWidth, courseGradeColumnWidth].
+            concat(GbGradeTable.columns.map(function () { return gradeColumnWidth }));
+};
+
+GbGradeTable.setupToggleGradeItems = function() {
+  var SUPPRESS_TABLE_REDRAW = true;
+
+  var $panel = $("<div>").addClass("gb-toggle-grade-items-panel").hide();
+  var $button = $("#toggleGradeItemsToolbarItem");
+  $button.after($panel);
+
+  // move the Wicket generated panel into this menu dropdown
+  $panel.append($("#gradeItemsTogglePanel").show());
+
+  function repositionPanel() {
+    $panel.css('top', $button.position().top + $button.outerHeight() + "px");
+  };
+
+  var updateCategoryFilterState = function($itemFilter) {
+    var $group = $itemFilter.closest(".gb-item-filter-group");
+    var $label = $group.find(".gb-item-category-filter label");
+    var $input = $group.find(".gb-item-category-filter input");
+
+    var checkedItemFilters = $group.find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked").length;
+    var itemFilters = $group.find(".gb-item-filter :input, .gb-item-category-score-filter :input").length;
+
+    $label.
+      removeClass("partial").
+      removeClass("off").
+      find(".gb-filter-partial-signal").remove();
+
+    if (checkedItemFilters == 0) {
+      $input.prop("checked", false);
+      $label.addClass("off");
+    } else if (checkedItemFilters == itemFilters) {
+      $input.prop("checked", true);
+    } else {
+      $input.prop("checked", false);
+      $label.addClass("partial");
+      $label.find(".gb-item-filter-signal").
+        append($("<span>").addClass("gb-filter-partial-signal"));
+    }
+  };
+
+
+  function handleCategoryFilterStateChange(event) {
+    var $input = $(event.target);
+    var $label = $input.closest("label");
+    var $filter = $input.closest(".gb-item-category-filter");
+
+    // toggle all columns in this category
+    if ($input.is(":checked")) {
+      $label.removeClass("off");
+      // show all
+      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:not(:checked), .gb-item-category-score-filter :input:not(:checked)").trigger("click");
+    } else {
+      $label.addClass("off");
+      // hide all
+      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked").trigger("click");
+    }
+
+    updateCategoryFilterState($input);
+  };
+
+
+  function handleGradeItemFilterStateChange(event, suppressRedraw) {
+    var $input = $(event.target);
+    var $label = $input.closest("label");
+    var $filter = $input.closest(".gb-item-filter");
+
+    var assignmentId = $input.val();
+
+    var column = GbGradeTable.colModelForAssignment(assignmentId);
+
+    if ($input.is(":checked")) {
+      $filter.removeClass("off");
+      column.hidden = false;
+    } else {
+      $filter.addClass("off");
+      column.hidden = true;
+    }
+
+    updateCategoryFilterState($input);
+
+    if (suppressRedraw != SUPPRESS_TABLE_REDRAW) {
+      GbGradeTable.redrawTable(true);
+    }
+  };
+
+
+  function handleCategoryScoreFilterStateChange(event, suppressRedraw) {
+    var $input = $(event.target);
+    var $label = $input.closest("label");
+    var $filter = $input.closest(".gb-item-category-score-filter");
+
+    var category = $input.val();
+
+    var column = GbGradeTable.colModelForCategoryScore(category);
+
+    if ($input.is(":checked")) {
+      //self.gradebookSpreadsheet.showCategoryScoreColumn(category);
+      // TODO
+      $filter.removeClass("off");
+      column.hidden = false;
+    } else {
+      //self.gradebookSpreadsheet.hideCategoryScoreColumn(category);
+      // TODO
+      $filter.addClass("off");
+      column.hidden = true;
+    }
+
+    updateCategoryFilterState($input);
+    if (!suppressRedraw) {
+      GbGradeTable.redrawTable(true);
+    }
+  }
+
+
+  function handleShowAll() {
+    $panel.find(".gb-item-filter :input:not(:checked), .gb-item-category-score-filter :input:not(:checked)").trigger("click");
+  };
+
+
+  function handleHideAll() {
+    $panel.find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked").trigger("click");
+  };
+
+
+  function handleShowOnlyThisCategory($filter) {
+    var $input = $filter.find(":input");
+    var $label = $filter.find("label");
+
+    $panel.
+        find(".gb-item-category-filter :input:checked:not([value='"+$input.val()+"'])").
+        trigger("click");
+
+    if ($input.is(":not(:checked)")) {
+      $label.trigger("click");
+    } else {
+      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:not(:checked), .gb-item-category-score-filter :input:not(:checked)").trigger("click");
+    }
+  };
+
+
+  function handleShowOnlyThisItem($filter) {
+    var $input = $filter.find(":input");
+    var $label = $filter.find("label");
+
+    $panel.
+        find(".gb-item-filter :input:checked:not(#"+$input.attr("id")+"), .gb-item-category-score-filter :input:checked").
+        trigger("click");
+
+    if ($input.is(":not(:checked)")) {
+      $label.trigger("click");
+    }
+  };
+
+
+  function handleShowOnlyThisCategoryScore($filter) {
+    var $input = $filter.find(":input");
+    var $label = $filter.find("label");
+
+    $panel.
+        find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked:not(#"+$input.attr("id")+")").
+        trigger("click");
+
+    if ($input.is(":not(:checked)")) {
+      $label.trigger("click");
+    }
+  };
+
+
+  $button.on("click", function(event) {
+    event.preventDefault();
+
+    $button.toggleClass("on");
+
+    if ($button.hasClass("on")) {
+      repositionPanel();
+      $button.attr("aria-expanded", "true");
+      $panel.show().attr("aria-hidden", "false");
+    } else {
+      $button.attr("aria-expanded", "false");
+      $panel.hide().attr("aria-hidden", "true");
+    }
+
+    // Support click outside menu panel to close panel
+    function hidePanelOnOuterClick(mouseDownEvent) {
+      if ($(mouseDownEvent.target).closest(".gb-toggle-grade-items-panel, #toggleGradeItemsToolbarItem").length == 0) {
+        $button.removeClass("on");
+        $button.attr("aria-expanded", "false");
+        $panel.hide().attr("aria-hidden", "true");
+        $(document).off("mouseup", hidePanelOnOuterClick);
+      }
+      return true;
+    };
+    $(document).on("mouseup", hidePanelOnOuterClick);
+
+    return false;
+  });
+
+  $button.on("keydown", function(event) {
+    // up arrow hides menu
+    if (event.keyCode == 38) {
+      if ($panel.is(":visible")) {
+        $(this).trigger("click");
+        return false;
+      }
+    // down arrow shows menu or focuses first item in menu
+    } else if (event.keyCode == 40) {
+      if ($panel.is(":not(:visible)")) {
+        $(this).trigger("click");
+      } else {
+        $panel.find("a:first").focus();
+      }
+      return false;
+    }
+  });
+
+  $panel.
+        on("click", "#showAllGradeItems", function() {
+          handleShowAll();
+          $(this).focus();
+        }).
+        on("click", "#hideAllGradeItems", function() {
+          handleHideAll();
+          $(this).focus();
+        }).
+        on("click", ".gb-show-only-this-category", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-category-filter");
+          handleShowOnlyThisCategory($filter);
+          $(this).focus();
+        }).
+        on("click", ".gb-show-only-this-item", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-filter");
+          handleShowOnlyThisItem($filter);
+          $(this).focus();
+        }).
+        on("click", ".gb-show-only-this-category-score", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-category-score-filter");
+          handleShowOnlyThisCategoryScore($filter);
+          $(this).focus();
+        }).
+        on("click", ".gb-toggle-this-category", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-category-filter");
+          $filter.find(":input").trigger("click");
+          $(this).focus();
+        }).
+        on("click", ".gb-toggle-this-item", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-filter");
+          $filter.find(":input").trigger("click");
+          $(this).focus();
+        }).
+        on("click", ".gb-toggle-this-category-score", function(event) {
+          event.preventDefault();
+
+          var $filter = $(event.target).closest(".gb-item-category-score-filter");
+          $filter.find(":input").trigger("click");
+          $(this).focus();
+        });
+
+  // any labels or action links will be included in the arrow navigation
+  // we won't include dropdown toggles for this.. can get to those with tab keys
+  var $menuItems = $panel.find("#hideAllGradeItems, #showAllGradeItems, label[role='menuitem']");
+  $menuItems.on("keydown", function(event) {
+    var $this = $(this);
+    var currentIndex = $menuItems.index($this);
+
+    // up arrow navigates up or back to button
+    if (event.keyCode == 38) {
+      if (currentIndex == 0) {
+        $button.focus();
+      } else {
+        $menuItems[currentIndex-1].focus();
+      }
+      return false;
+    // down arrow navigates down list
+    } else if (event.keyCode == 40) {
+      if (currentIndex + 1 < $menuItems.length) {
+        $menuItems[currentIndex+1].focus();
+        return false;
+      }
+
+    // if return then treat as click
+    } else if (event.keyCode == 13) {
+      $this.trigger("click");
+      return false;
+    }
+
+    return true;
+  });
+
+  $panel.find(".gb-item-category-filter :input").on("change", handleCategoryFilterStateChange);
+  $panel.find(".gb-item-filter :input").on("change", handleGradeItemFilterStateChange);
+  $panel.find(".gb-item-category-score-filter :input").on("change", handleCategoryScoreFilterStateChange);
+
+  $panel.find(":input:not(:checked)").trigger("change", [SUPPRESS_TABLE_REDRAW]);
+
+  // setup hidden visual cue clicky
+  $(GbGradeTable.instance.rootElement).on("click", ".gb-hidden-column-visual-cue", function(event) {
+    event.preventDefault();
+    event.stopImmediatePropagation();
+
+    var $th = $(this).closest("th");
+    var data = $.data($th[0]);
+    var index = 0;
+    if (data.columnType == "assignment") {
+      index = GbGradeTable.colForAssignment(data.assignmentid) - GbGradeTable.instance.getSettings().fixedColumnsLeft + 1;
+    } else if (data.columnType == "category") {
+      index = GbGradeTable.colForCategoryScore(data.categoryId) - GbGradeTable.instance.getSettings().fixedColumnsLeft + 1;
+    }
+
+    var columnsAfter = GbGradeTable.columns.slice(index);
+    var done = false;
+    $.each(columnsAfter, function(i, column) {
+      if (!done && column.hidden) {
+        if (column.type == "assignment") {
+          $panel.find(".gb-item-filter :input[value='"+column.assignmentId+"']").trigger("click", [SUPPRESS_TABLE_REDRAW]);
+        } else {
+          $panel.find(".gb-item-category-score-filter :input[value='"+column.categoryName+"']").trigger("click", [SUPPRESS_TABLE_REDRAW]);
+        }
+      } else {
+        done = true;
+      }
+    });
+
+    $(this).remove();
+    GbGradeTable.redrawTable(true);
+  });
+};
+
+
+GbGradeTable.currentSortColumn = 0;
+GbGradeTable.currentSortDirection = 'desc';
+
+GbGradeTable.setupColumnSorting = function() {
+  var $table = $(GbGradeTable.instance.rootElement);
+
+  $table.on("click", ".gb-title", function() {
+    var $handle = $(this);
+
+    var colIndex = $handle.closest("th").index();
+
+    if (GbGradeTable.currentSortColumn != colIndex) {
+      GbGradeTable.currentSortColumn = colIndex;
+      GbGradeTable.currentSortDirection = null;
+    }
+
+    // remove all sort icons
+    $table.find(".gb-title").each(function() {
+      $(this).removeClass("gb-sorted-asc").removeClass("gb-sorted-desc");
+      $(this).data("sortOrder", null);
+    });
+
+    if (GbGradeTable.currentSortDirection == "desc") {
+      GbGradeTable.currentSortDirection = "asc";
+    } else {
+      GbGradeTable.currentSortDirection = "desc";
+    }
+
+    if (GbGradeTable.currentSortDirection != null) {
+      $handle.addClass("gb-sorted-"+GbGradeTable.currentSortDirection);
+    }
+
+    GbGradeTable.sort(colIndex, GbGradeTable.currentSortDirection);
+  });
+};
+
+
+GbGradeTable.sort = function(colIndex, direction) {
+  if (direction == null) {
+    // reset the table data to default order
+    GbGradeTable.instance.loadData(GbGradeTable.getFilteredData());
+    return;
+  }
+
+  var clone = GbGradeTable.getFilteredData().slice(0);
+
+  clone.sort(function(row_a, row_b) {
+    var a = row_a[colIndex];
+    var b = row_b[colIndex];
+
+    // sort by students
+    if (colIndex == 0) {
+      return GbGradeTable.studentSorter(a, b);
+
+    // sort by course grade
+    } else if (colIndex == 1) {
+      var a_points = parseFloat(a[1]);
+      var b_points = parseFloat(b[1]);
+
+      if (a_points > b_points) {
+        return 1;
+      }
+      if (a_points < b_points) {
+        return -1;
+      }
+    } else {
+      if (a == null || a == "") {
+        return -1;
+      }
+      if (b == null || b == "") {
+        return 1;
+      }
+      if (parseFloat(a) > parseFloat(b)) {
+        return 1;
+      }
+      if (parseFloat(a) < parseFloat(b)) {
+        return -1;
+      }
+    }
+
+    return 0;
+  });
+
+  if (direction == "desc") {
+    clone.reverse();
+  }
+
+  GbGradeTable.instance.loadData(clone);
+};
+
+GbGradeTable.setCellState = function(state, row, col) {
+    var studentId = (GbGradeTable.instance || instance).getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX).userId;
+    var student = GbGradeTable.modelForStudent(studentId);
+
+    if (!student.hasOwnProperty('cellStatus')) {
+      student.cellStatus = {};
+    }
+
+    student.cellStatus['col'+col] = state;
+};
+
+GbGradeTable.clearCellState = function(row, col) {
+    var studentId = GbGradeTable.instance.getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX).userId;
+    var student = GbGradeTable.modelForStudent(studentId);
+
+    if (student.hasOwnProperty('cellStatus')) {
+      delete student.cellStatus['col'+col];
+    }
+};
+
+GbGradeTable.getCellState = function(row, col, instance) {
+    var studentId = (GbGradeTable.instance || instance).getDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX).userId;
+    var student = GbGradeTable.modelForStudent(studentId);
+
+    if (student.hasOwnProperty('cellStatus')) {
+      return student.cellStatus['col'+col] || false;
+    } else {
+      return false;
+    }
+};
+
+GbGradeTable.studentSorter = function(a, b) {
+  function generateSortStrings(student) {
+    if (GbGradeTable.settings.isStudentOrderedByLastName) {
+      return [student.lastName.toLowerCase(), student.firstName.toLowerCase(), student.eid];
+    } else {
+      return [student.firstName.toLowerCase(), student.lastName.toLowerCase(), student.eid];
+    }
+  }
+
+  var sort_strings_a = generateSortStrings(a);
+  var sort_strings_b = generateSortStrings(b);
+
+  for (var i = 0; i < sort_strings_a.length; i++) {
+    var sort_a = sort_strings_a[i];
+    var sort_b = sort_strings_b[i];
+
+    if (sort_a < sort_b) {
+      return 1;
+    } else if (sort_a > sort_b) {
+      return -1;
+    }
+  }
+
+  return 0;
+};
+
+
+GbGradeTable.setupConcurrencyCheck = function() {
+  var self = this;
+
+  function showConcurrencyNotification(data) {
+    $.each(data, function(i, conflict) {
+      GbGradeTable.setHasConcurrentEdit(conflict)
+    });
+  };
+
+  function hideConcurrencyNotification() {
+    GbGradeTable.container.find(".gb-cell-out-of-date").removeClass("gb-cell-out-of-date");
+  };
+
+  function handleConcurrencyCheck(data) {
+    if ($.isEmptyObject(data) || $.isEmptyObject(data.gbng_collection)) {
+      // nobody messing with my..
+      hideConcurrencyNotification();
+      return;
+    }
+
+    // there are *other* people doing things!
+    showConcurrencyNotification(data.gbng_collection);
+  };
+
+  function performConcurrencyCheck() {
+    GradebookAPI.isAnotherUserEditing(
+        GbGradeTable.container.data("siteid"),
+        GbGradeTable.container.data("gradestimestamp"),
+        handleConcurrencyCheck);
+  };
+
+  // Check for concurrent editors.. and again every 10 seconds
+  // (note: there's a 10 second cache)
+  performConcurrencyCheck();
+  var concurrencyCheckInterval = setInterval(performConcurrencyCheck, 10 * 1000);
+};
+
+
+GbGradeTable.setupDragAndDrop = function () {
+  /* True if drag/drop is active */
+  var currentlyDragging = false;
+
+  /* Our floating drag indicator */
+  var floatyFloat = undefined;
+
+  /* The element we'll be dropping near */
+  var dropTarget = undefined;
+
+  /* And the side of the element we're targetting */
+  var dropTargetSide = undefined;
+
+  /* The thing we're dragging */
+  var dragTarget = undefined;
+
+  var LEFT_POSITION = 'left';
+  var RIGHT_POSITION = 'right';
+
+  function clearSelection() {
+    if ( document.selection ) {
+      document.selection.empty();
+    } else if ( window.getSelection ) {
+      window.getSelection().removeAllRanges();
+    }
+  }
+
+  function isDraggable(th) {
+    return ($(th).data('columnType') == 'assignment');
+  }
+
+
+  $(document).on('dragstarted', function (dragStartedEvent, e) {
+    if (e.button != 0) {
+      /* Only interested in drag events from the primary button */
+      return;
+    }
+
+    dragTarget = $(e.target).closest('th');
+
+    if (isDraggable(dragTarget)) {
+      currentlyDragging = true;
+    } else {
+      dragTarget = undefined;
+      return;
+    }
+
+    floatyFloat = dragTarget.clone();
+
+    if (window.getComputedStyle) {
+        var styles = window.getComputedStyle(dragTarget[0], null);
+        floatyFloat[0].style.cssText = styles.cssText;
+    }
+
+    floatyFloat.css('opacity', 0.9)
+               .css('position', 'fixed')
+               .css('width', dragTarget.width())
+               .css('height', dragTarget.height())
+               .css('background-color', 'white')
+               .css('box-shadow', '1px 1px 3px #999')
+               .css('z-index', 5000)
+               .css('top', $('#gradeTable').offset().top - window.scrollY + 'px');
+
+
+
+    /* Knock out input elements */
+    $('.btn-group', floatyFloat).remove();
+
+    $('#gradeTableWrapper').append(floatyFloat);
+  });
+
+  function cancelDrag() {
+    if (currentlyDragging) {
+      currentlyDragging = false;
+      $('.column-marker').remove();
+
+      if (floatyFloat) {
+        floatyFloat.remove();
+        floatyFloat = undefined;
+      }
+
+      return true;
+    } else {
+      return false;
+    }
+  }
+
+  GbGradeTable._cancelDrag = cancelDrag;
+
+
+  function moveColumn(table, fromIndex, toIndex) {
+    if (fromIndex == toIndex) {
+      return;
+    }
+
+    if (fromIndex < toIndex) {
+      /* Moving left to right */
+      $.each(table, function (i, row) {
+        var fromValue = row[fromIndex]
+
+        /* Shift rows left to make space */
+        for (var i = fromIndex; i < toIndex; i++) {
+          row[i] = row[i + 1];
+        }
+
+        /* Place the moved value */
+        row[toIndex] = fromValue;
+      });
+    } else {
+      /* Moving right to left */
+      $.each(table, function (i, row) {
+        var fromValue = row[fromIndex]
+
+        /* Shift rows right to make space */
+        for (var i = fromIndex; i > toIndex; i--) {
+          row[i] = row[i - 1];
+        }
+
+        /* Place the moved value */
+        row[toIndex] = fromValue;
+      });
+    }
+  }
+
+
+  $(document).on('mouseup', function (e) {
+    if (currentlyDragging) {
+      cancelDrag();
+
+      $('#gbReorderColumnsFailed').hide();
+
+      if (dropTarget) {
+        var targetColIndexssignmentId = $.data(dropTarget[0], "assignmentid");
+        var sourceAssignmentId = $.data(dragTarget[0], "assignmentid");
+
+        var targetColIndex = GbGradeTable.colForAssignment(targetAssignmentId);
+        var sourceColIndex = GbGradeTable.colForAssignment(sourceAssignmentId);
+
+        /* If we drop in a spot that would put our column in the same position,
+           don't bother doing anything. */
+        if (targetColIndex == sourceColIndex || 
+            (dropTargetSide == LEFT_POSITION && targetColIndex == (sourceColIndex + 1)) ||
+            (dropTargetSide == RIGHT_POSITION && targetColIndex == (sourceColIndex - 1))) {
+              return true;
+        }
+
+        var numberOfFixedColumns = GbGradeTable.instance.getSettings().fixedColumnsLeft;
+        var newIndex = targetColIndex - numberOfFixedColumns;
+
+        if (dropTargetSide == RIGHT_POSITION) {
+          newIndex = newIndex + 1;
+        }
+
+        // moving left to right
+        if (sourceColIndex < targetColIndex) {
+          newIndex = newIndex - 1;
+        }
+
+        var sourceModel = GbGradeTable.colModelForAssignment(sourceAssignmentId);
+
+        var handleColumnReorder = function () {
+          /* Reorder was successful.  Update local state to match */
+
+          /* Rearrange the grade columns */
+          moveColumn(GbGradeTable.grades, sourceColIndex, targetColIndex);
+
+          /* And the header columns */
+          moveColumn([GbGradeTable.columns],
+                     (sourceColIndex - numberOfFixedColumns),
+                     (targetColIndex - numberOfFixedColumns));
+
+          GbGradeTable.redrawTable(true);
+        };
+
+        if (GbGradeTable.settings.isGroupedByCategory) {
+          // subtract the category column offset
+          newIndex = newIndex - GbGradeTable.indexOfFirstCategoryColumn(sourceModel.categoryId);
+
+          GradebookAPI.updateCategorizedAssignmentOrder(
+            GbGradeTable.container.data("siteid"),
+            sourceAssignmentId,
+            sourceModel.categoryId,
+            newIndex,
+            handleColumnReorder,
+            function () {
+              /* error! */
+              $('#gbReorderColumnsFailed').show();
+            },
+            $.noop);
+        } else {
+          GradebookAPI.updateAssignmentOrder(
+            GbGradeTable.container.data("siteid"),
+            sourceAssignmentId,
+            newIndex,
+            handleColumnReorder,
+            function () {
+              /* error! */
+              $('#gbReorderColumnsFailed').show();
+            },
+            $.noop)
+        }
+
+        dragTarget = undefined;
+      }
+    }
+
+    return true;
+  });
+
+  function isDroppable(dropTarget) {
+    if (GbGradeTable.settings.isGroupedByCategory) {
+      if (dragTarget.data('categoryId') != dropTarget.data('categoryId')) {
+        return false;
+      }
+    }
+
+    if (dropTarget.data('columnType') !== 'assignment') {
+      return false;
+    }
+
+    return true;
+  }
+
+  $(document).on('mousemove', function (e) {
+    if (currentlyDragging) {
+      clearSelection();
+
+      $('.column-marker').remove();
+
+      var margin = 10;
+      floatyFloat.css('left', e.clientX + margin + 'px');
+
+      var candidateTarget = $(e.target).closest('th');
+
+      if (candidateTarget.length == 0) {
+        return true;
+      }
+
+      if (!isDroppable(candidateTarget)) {
+        return true;
+      }
+
+      dropTarget = candidateTarget;
+
+      var leftX = $(dropTarget).offset().left;
+      var candidateXMidpoint = leftX + ($(dropTarget).width() / 2.0);
+
+      var marker = $('<div class="column-marker" />')
+        .css('display', 'inline-block')
+        .css('position', 'absolute')
+        .css('width', '2px')
+        .css('height', '100%')
+        .css('background-color', 'green');
+
+      if (e.clientX < candidateXMidpoint) {
+        dropTargetSide = LEFT_POSITION;
+        marker.css('left', '0')
+      } else {
+        dropTargetSide = RIGHT_POSITION;
+        marker.css('right', '0')
+      }
+
+      if (candidateTarget.is(dragTarget) ||
+          (candidateTarget.is(dragTarget.prev()) && dropTargetSide == RIGHT_POSITION) ||
+          (candidateTarget.is(dragTarget.next()) && dropTargetSide == LEFT_POSITION)) {
+
+            /* If our drop target would put us right back where we started,
+               don't show the drop indicator. */
+            return true;
+      }
+
+      marker.prependTo($('.relative', dropTarget));
+    }
+
+    return true;
+  });
+};
+
+
+GbGradeTable.setupKeyboardNavigation = function() {
+  // add grade table to the tab flow
+  $(GbGradeTable.instance.rootElement).attr("tabindex", 0);
+
+  // enter handsontable upon return
+  $(GbGradeTable.instance.rootElement).on("keydown", function(event) {
+    if ($(this).is(":focus") && event.keyCode == 13) {
+      event.stopImmediatePropagation();
+      $(this).blur();
+      GbGradeTable.instance.selectCell(0,0);
+    }
+  });
+
+  GbGradeTable.instance.addHook("afterSelection", function(event) {
+    // ensure root element is out of tab index, so subsequent tabs are
+    // handled by handsontable plugin
+    setTimeout(function() {
+      GbGradeTable.instance.rootElement.blur();
+    });
+  });
+
+  GbGradeTable.instance.addHook("beforeKeyDown", function(event) {
+    var handled = false;
+
+    function iGotThis(allowDefault) {
+      event.stopImmediatePropagation();
+      if (!allowDefault) {
+        event.preventDefault();
+      }
+      handled = true;
+    }
+
+    var $current = $(GbGradeTable.instance.rootElement).find("td.current:visible:last"); // get the last and visible, as may be multiple due to fixed columns
+    var $focus = $(":focus");
+    var editing = GbGradeTable.instance.getActiveEditor() && GbGradeTable.instance.getActiveEditor()._opened;
+
+    if ($current.length > 0) {
+      // Allow accessibility shortcuts (no conflicts they said.. sure..)
+      if (event.altKey && event.ctrlKey) {
+        return iGotThis(true);
+      }
+
+      // space - open menu
+      if (!editing && event.keyCode == 32) {
+        iGotThis();
+
+        var $dropdown;
+
+        // ctrl+space to open the header menu
+        if (event.ctrlKey) {
+          var $th = $(GbGradeTable.instance.rootElement).find("th.currentCol");
+          $dropdown = $th.find(".dropdown-toggle");
+
+        // space to open the current cell's menu
+        } else {
+           $dropdown = $current.find(".dropdown-toggle");
+        }
+
+        $dropdown.dropdown("toggle");
+        setTimeout(function() {
+          $(".dropdown-menu:visible a:first").focus();
+        });
+      }
+
+      // menu focused
+      if ($focus.closest(".dropdown-menu ").length > 0) {
+        // up arrow
+        if (event.keyCode == 38) {
+          iGotThis(true);
+          if ($focus.closest("li").index() == 0) {
+            // first item, so close the menu
+            $(".btn-group.open .dropdown-toggle").dropdown("toggle");
+            $current.focus();
+          } else {
+            $focus.closest("li").prev().find("a").focus();
+          }
+        }
+        // down arrow
+        if (event.keyCode == 40) {
+          iGotThis();
+          $focus.closest("li").next().find("a").focus();
+        }
+        // esc
+        if (event.keyCode == 27) {
+          iGotThis(true);
+          $(".btn-group.open .dropdown-toggle").dropdown("toggle");
+          $current.focus();
+        }
+        // enter
+        if (event.keyCode == 13) {
+          iGotThis(true);
+          // deselect cell so keyboard focus is given to the menu's action
+          GbGradeTable.instance.deselectCell();
+        }
+
+        if (handled) {
+          GbGradeTable.hideMetadata();
+          return;
+        }
+      }
+
+      // escape - return focus to table if not currently editing a grade
+      if (!editing && event.keyCode == 27) {
+        if (GbGradeTable._cancelDrag()) {
+          /* Nothing else to do */
+        } else {
+          iGotThis();
+          GbGradeTable.instance.deselectCell();
+          GbGradeTable.instance.rootElement.focus();
+        }
+      }
+
+      // return on student cell should invoke student summary
+      if (!editing && event.keyCode == 13) {
+          if ($current.find('.gb-view-grade-summary').length > 0) {
+              iGotThis();
+              $current.find('.gb-view-grade-summary').trigger('click');
+          }
+      }
+    }
+  });
+};
+
+
+GbGradeTable.clearMetadata = function() {
+  $(".gb-metadata").remove();
+};
+
+GbGradeTable.hideMetadata = function() {
+  $(".gb-metadata").hide();
+};
+
+GbGradeTable.setupCellMetaDataSummary = function() {
+
+  function initializeMetadataSummary(row, col) {
+    var cell = GbGradeTable.instance.getCell(row, col);
+    if (cell != null) {
+      var cellKey = $.data(cell, 'cell-initialised');
+
+      var metadata = $.data(cell, 'metadata');
+
+      if ($("#"+cellKey)[0]) {
+        // already exists!
+        return;
+      }
+
+      if (metadata) {
+        $(cell).attr("aria-describedby", cellKey);
+
+        $(GbGradeTable.instance.rootElement).after(
+          GbGradeTable.templates.metadata.process(metadata)
+        );
+
+        if (metadata.assignment && metadata.assignment.externalAppName) {
+          var externalFlag = $("#"+cellKey).find('.gb-external-app-wrapper');
+          externalFlag.find('.gb-flag-external').addClass(metadata.assignment.externalAppIconCSS);
+          externalFlag.html(externalFlag.html().replace('{0}', metadata.assignment.externalAppName));
+        }
+
+        $("#"+cellKey).hide().on("click", ".gb-metadata-close", function() {
+          GbGradeTable.hideMetadata();
+          GbGradeTable.instance.selectCell(row, col);
+        });
+
+        $("#"+cellKey).hide().on("click", ".gb-revert-score", function(event) {
+          event.preventDefault();
+
+          var studentId = metadata.student.userId;
+          var assignmentId = metadata.assignment.assignmentId;
+          if (GbGradeTable.lastValidGrades[studentId] && GbGradeTable.lastValidGrades[studentId][assignmentId]) {
+            var validScore = GbGradeTable.lastValidGrades[studentId][assignmentId];
+            GbGradeTable.syncScore(studentId, [assignmentId], validScore);
+            GbGradeTable.setCellState('reverted', row, col);
+            GbGradeTable.redrawTable(true);
+            GbGradeTable.hideMetadata();
+            GbGradeTable.instance.selectCell(row, col);
+          } else {
+            // we need to reload the entire page
+            location.reload();
+          }
+        });
+
+        $("#"+cellKey).hide().on("click", ".gb-edit-comments", function(event) {
+          event.preventDefault();
+
+          var studentId = metadata.student.userId;
+          var assignmentId = metadata.assignment.assignmentId;
+
+          GbGradeTable.hideMetadata();
+
+          GbGradeTable.editComment(studentId, assignmentId);
+        });
+      }
+    }
+  }
+
+
+  function showMetadata(cellKey, $td, showCellNotifications, showCommentNotification) {
+    var cellOffset = $td.offset();
+    var wrapperOffset = $("#gradeTableWrapper").offset();
+    var cellHeight = $td.height();
+    var cellWidth = $td.width();
+
+    var topOffset = Math.abs(wrapperOffset.top - cellOffset.top) + cellHeight + 5;
+    var leftOffset = Math.abs(wrapperOffset.left - cellOffset.left) + parseInt(cellWidth/2) - parseInt($("#"+cellKey).width() / 2) - 8;
+
+    var $metadata = $("#"+cellKey);
+
+    if (showCellNotifications) {
+      $metadata.find(".gb-metadata-notifications li:not(.gb-metadata-comment-notification)").show();
+    } else {
+      $metadata.find(".gb-metadata-notifications li:not(.gb-metadata-comment-notification)").hide();
+    }
+
+    if (showCommentNotification && $metadata.find(".gb-metadata-comment-notification").length > 0) {
+      $metadata.find("blockquote").hide();
+
+      setTimeout(function() {
+        GradebookAPI.getComments(
+          GbGradeTable.container.data("siteid"),
+          $.data($td[0], "assignmentid"),
+          $.data($td[0], "studentid"),
+          function(comment) {
+            // success
+            $metadata.find("blockquote").html(comment).show();
+          },
+          function() {
+            // error
+            $metadata.find("blockquote").html("Unable to load comment. Please try again later.").show();
+          })
+      });
+
+      $metadata.find(".gb-metadata-notifications li.gb-metadata-comment-notification").show()
+    } else {
+      $metadata.find(".gb-metadata-notifications li.gb-metadata-comment-notification").hide();
+    }
+
+    $metadata.css({
+      top: topOffset,
+      left: leftOffset
+    }).toggle();
+  }
+
+  GbGradeTable.instance.addHook("afterSelection", function(row, col) {
+    GbGradeTable.clearMetadata();
+
+    // only care about data cells (not headers)
+    if (row >= 0 && col >= 0) {
+      initializeMetadataSummary(row, col);
+    }
+  });
+
+  GbGradeTable.instance.addHook("beforeKeyDown", function(event) {
+      // get the last and visible, as may be multiple due to fixed columns
+      var $current = $(GbGradeTable.instance.rootElement).find("td.current:visible:last");
+
+      if ($current[0]) {
+        var cellKey = $.data($current[0], 'cell-initialised');
+
+        if (event.keyCode == 83) { // s
+          event.preventDefault();
+          event.stopImmediatePropagation();
+
+          showMetadata(cellKey, $current, true, true);
+        } else {
+          GbGradeTable.hideMetadata();
+        }
+      } else {
+        GbGradeTable.clearMetadata();
+      }
+  });
+
+  // PROTOTYPE: show metadata popover on mouse hover
+  // GbGradeTable._hoverSummaryTimeout;
+  // GbGradeTable._mouseCoords;
+  // GbGradeTable.instance.addHook("afterOnCellMouseOver", function(event, coords, TD) {
+  //   clearTimeout(GbGradeTable._hoverSummaryTimeout);
+  //
+  //   // only show something if mouse has actually moved!
+  //   var newMouseCoords = event.clientX + "," + event.clientY;
+  //   if (GbGradeTable._mouseCoords != newMouseCoords) {
+  //     GbGradeTable._mouseCoords = newMouseCoords;
+  //
+  //     if (coords.row >= 0 && coords.col >= 0) {
+  //       GbGradeTable._hoverSummaryTimeout = setTimeout(function() {
+  //         var $cell = $(event.target).closest("td");
+  //         if (!$cell[0]) {
+  //             $cell = $(GbGradeTable.instance.getCell(coords.row, coords.col));
+  //         }
+  //         if ($cell[0]) {
+  //           var cellKey = $.data($cell[0], 'cell-initialised');
+  //           GbGradeTable.hideMetadata();
+  //           initializeMetadataSummary(coords.row, coords.col);
+  //           showMetadata(cellKey, $cell);
+  //         }
+  //       }, 2000);
+  //     }
+  //   }
+  // });
+  //
+  // GbGradeTable.instance.addHook("afterSelection", function() {
+  //   clearTimeout(GbGradeTable._hoverSummaryTimeout);
+  // });
+
+  // on mouse click on notification, toggle metadata summary
+  $(GbGradeTable.instance.rootElement).on("click", ".gb-notification, .gb-comment-notification", function(event){
+    var $cell = $(event.target).closest("td");
+    if ($cell[0]) {
+      var cellKey = $.data($cell[0], 'cell-initialised');
+      var coords = GbGradeTable.instance.getCoords($cell[0]);
+      initializeMetadataSummary(coords.row, coords.col);
+      var showCellNotifications = $(event.target).is(".gb-notification");
+      var showCommentNotification = $(event.target).is(".gb-comment-notification");
+      showMetadata(cellKey, $cell, showCellNotifications, showCommentNotification);
+    }
+  });
+
+  $(GbGradeTable.instance.rootElement).on("click", "th .gb-external-app, th .gb-grade-item-flags > *, th .gb-flag-extra-credit", function(event){
+    event.preventDefault();
+    event.stopImmediatePropagation();
+
+    var data = {
+      tooltip: $(this).attr('title') 
+    };
+
+    GbGradeTable.showTooltip($(this), data);
+  });
+
+  GbGradeTable.instance.addHook("afterScrollHorizontally", function() {
+    GbGradeTable.hideMetadata();
+  });
+
+  GbGradeTable.instance.addHook("afterScrollVertically", function() {
+    GbGradeTable.hideMetadata();
+  });
+};
+
+
+GbGradeTable.hideTooltip = function() {
+  $("#gbTooltip").remove();
+};
+
+
+GbGradeTable.showTooltip = function(target, data) {
+  GbGradeTable.hideTooltip();
+  var selected = GbGradeTable.instance.getSelected();
+  var $tooltip = GbGradeTable.templates.tooltip.process(data);
+
+  $(GbGradeTable.instance.rootElement).after($tooltip);
+
+  $tooltip = $("#gbTooltip");
+
+  var extraBits = $(target).find('.gb-tooltip-extras');
+  if (extraBits.length > 0) {
+    $tooltip.append(extraBits.html());
+  }
+
+  var targetOffset = target.offset();
+  var wrapperOffset = $("#gradeTableWrapper").offset();
+  var targetHeight = target.height();
+  var targetWidth = target.width();
+
+  var topOffset = Math.abs(wrapperOffset.top - targetOffset.top) + targetHeight + 10;
+  var leftOffset = Math.abs(wrapperOffset.left - targetOffset.left) + parseInt(targetWidth/2) - parseInt($tooltip.width() / 2) - 8;
+
+  $tooltip.css({
+    top: topOffset,
+    left: leftOffset
+  });
+
+  $tooltip.on('click', '.gb-metadata-close', function(event) {
+    GbGradeTable.hideTooltip();
+    GbGradeTable.instance.selectCell(selected[0], selected[1]);
+  });
+
+  $tooltip.on('click', '.gb-gradebook-settings', function(event) {
+    event.preventDefault();
+    GbGradeTable.hideTooltip();
+    GbGradeTable.editSettings();
+  });
+};
+
+
+GbGradeTable.setLiveFeedbackAsSaving = function() {
+  var $liveFeedback = $(".gb-live-feedback");
+  $liveFeedback.html($liveFeedback.data("saving-message"));
+  $liveFeedback.show()
+};
+
+
+GbGradeTable.refreshSummaryLabels = function() {
+  var $toolbar = $("#gradebookGradesToolbar");
+
+  function refreshStudentSummary() {
+    $toolbar.find(".gb-student-summary").html(GbGradeTable.templates.studentSummary.process());
+    var visible = GbGradeTable.instance.view.settings.data.length;
+    var total = GbGradeTable.students.length;
+
+    $toolbar.find(".gb-student-summary .visible").html(visible);
+    $toolbar.find(".gb-student-summary .total").html(total);
+
+    if (visible < total) {
+      $toolbar.find(".gb-student-summary-counts").addClass("warn-students-hidden");
+    }
+  };
+
+  function refreshGradeItemSummary() {
+    $toolbar.find(".gb-grade-item-summary").html(GbGradeTable.templates.gradeItemSummary.process());
+    var visibleColumns = 0;
+    var totalColumns = GbGradeTable.columns.length;
+    $.each(GbGradeTable.columns, function(i, col) {
+      if (!col.hidden) {
+        visibleColumns = visibleColumns + 1;
+      }
+    });
+    $toolbar.find(".gb-grade-item-summary .visible").html(visibleColumns);
+    $toolbar.find(".gb-grade-item-summary .total").html(totalColumns);
+    if (visibleColumns < totalColumns) {
+      $toolbar.find(".gb-item-summary-counts").addClass("warn-items-hidden");
+    }
+
+    var visibleAssignments = 0;
+    var totalAssignments = 0;
+
+    var visibleCategories = 0;
+    var totalCategories = 0;
+
+    $.each(GbGradeTable.columns, function (i, col) {
+      if (col.type === 'category') {
+        totalCategories += 1;
+
+        if (!col.hidden) {
+          visibleCategories += 1;
+        }
+      } else if (col.type === 'assignment') {
+        totalAssignments += 1;
+
+        if (!col.hidden) {
+          visibleAssignments += 1;
+        }
+      }
+    });
+
+    var title = $toolbar.find(".gb-grade-item-summary").text();
+
+    if (GbGradeTable.settings.isCategoriesEnabled) {
+      title = GbGradeTable.templates.gradeItemSummaryTooltip.process();
+
+      $.each([visibleColumns, totalColumns, visibleAssignments, totalAssignments, visibleCategories, totalCategories],
+             function (i, value) {
+               title = title.replace(new RegExp("\\{" + i + "\\}", "g"), value);
+             });
+    }
+
+    $toolbar.find(".gb-grade-item-summary").attr('title', title);
+  };
+
+  refreshStudentSummary();
+  refreshGradeItemSummary();
+};
+
+
+GbGradeTable.setupAccessiblityBits = function() {
+
+  var $wrapper = $("#gradeTable");
+
+  function setupWrapperAccessKey() {
+    $wrapper.on("click", function(event) {
+      if ($(event.target).is("#gradeTable")) {
+        $wrapper.focus();
+      };
+    });
+  };
+
+  function setupTableCaption() {
+    // handsontable does not support the <caption>
+    // it causes rendering issues in Firefox.
+    // Instead we create a <div> and link it to the <table>
+    // using aria-describedby.
+    var caption = GbGradeTable.templates.caption.process();
+    $('#gradeTableWrapper').append(caption);
+
+    var $captionToggle = $("#captionToggle");
+    $captionToggle.on("click", function(event) {
+      event.preventDefault();
+      $('#gradeTableCaption').toggleClass("maximized");
+    }).on("keyup", function(event) {
+      if (event.keyCode == 27) { //ESC
+        $('#gradeTableCaption').removeClass("maximized");
+      }
+    });
+
+    $("#gradeTableCaption").on("click", function() {
+      $(this).closest("#gradeTableCaption").removeClass("maximized");
+      $captionToggle.focus();
+    });
+  };
+
+  setupWrapperAccessKey();
+  setupTableCaption();
+};
+
+
+GbGradeTable.localizeNumber = function(number) {
+    if (typeof number == 'string' && !/^[0-9]+(\.[0-9]+)?$/.test(number)) {
+        // If we're a string that isn't parseable as float, just keep what we
+        // have.
+        return number;
+    }
+
+    if (typeof number == 'undefined') {
+        return;
+    }
+
+    if (sakai && sakai.locale && sakai.locale.userLanguage) {
+        return parseFloat(number).toLocaleString(sakai.locale.userLanguage);
+    }
+
+    return '' + number;
+};
+
+
+// Commit values to the grade data and the table meta data where applicable
+GbGradeTable.syncScore = function(studentId, assignmentId, value) {
+    var modelCol = $.inArray(GbGradeTable.colModelForAssignment(assignmentId), GbGradeTable.columns);
+    var modelRow = GbGradeTable.modelIndexForStudent(studentId);
+
+    // update model
+    GbGradeTable.grades[modelRow][modelCol + GbGradeTable.FIXED_COLUMN_OFFSET] = value;
+
+    // NB update of table is handled by saveValue
+};
+
+
+GbGradeTable.syncCourseGrade = function(studentId, courseGradeData) {
+    // update table
+    var tableRow = GbGradeTable.rowForStudent(studentId);
+    GbGradeTable.setCellState('synced', tableRow, GbGradeTable.COURSE_GRADE_COLUMN_INDEX);
+    GbGradeTable.instance.setDataAtCell(tableRow, GbGradeTable.COURSE_GRADE_COLUMN_INDEX, courseGradeData);
+
+    // update model
+    var modelRow = GbGradeTable.modelIndexForStudent(studentId);
+    GbGradeTable.grades[modelRow][GbGradeTable.COURSE_GRADE_COLUMN_INDEX] = courseGradeData;
+};
+
+
+GbGradeTable.syncCategoryAverage = function(studentId, categoryId, categoryScore) {
+    var categoryScoreAsLocaleString = GbGradeTable.localizeNumber(categoryScore);
+
+    // update table
+    var tableRow = GbGradeTable.rowForStudent(studentId);
+    var tableCol = GbGradeTable.colForCategoryScore(categoryId);
+    GbGradeTable.setCellState('synced', tableRow, tableCol);
+    GbGradeTable.instance.setDataAtCell(tableRow, tableCol, categoryScoreAsLocaleString);
+
+    // update model
+    var modelRow = GbGradeTable.modelIndexForStudent(studentId);
+    var modelCol = $.inArray(GbGradeTable.colModelForCategoryId(categoryId), GbGradeTable.columns);
+    GbGradeTable.grades[modelRow][modelCol + GbGradeTable.FIXED_COLUMN_OFFSET] = categoryScore;
+};
+
+
+GbGradeTable.STUDENT_COLUMN_INDEX = 0;
+GbGradeTable.COURSE_GRADE_COLUMN_INDEX = 1;
+GbGradeTable.FIXED_COLUMN_OFFSET = 2;
+
+// If an entered score is invalid, we keep track of the last good value here
+GbGradeTable.lastValidGrades = {};
+
+GbGradeTable.setScore = function(studentId, assignmentId, oldScore, newScore) {
+    if (!GbGradeTable.lastValidGrades[studentId]) {
+      GbGradeTable.lastValidGrades[studentId] = {};
+    }
+
+    if (GbGradeTable.lastValidGrades[studentId].hasOwnProperty(assignmentId)) {
+      oldScore = GbGradeTable.lastValidGrades[studentId][assignmentId];
+    }
+
+    var postData = {
+      action: 'setScore',
+      studentId: studentId,
+      assignmentId: assignmentId,
+      oldScore: oldScore,
+      newScore: newScore
+    };
+
+    var row = GbGradeTable.rowForStudent(studentId);
+    var assignment = GbGradeTable.colModelForAssignment(assignmentId);
+    var col = GbGradeTable.colForAssignment(assignmentId);
+
+    if (assignment.categoryId != null) {
+      postData['categoryId']= assignment.categoryId;
+    }
+
+    GbGradeTable.setLiveFeedbackAsSaving();
+
+    GbGradeTable.ajax(postData, function (status, data) {
+      if (status == "OK") {
+        GbGradeTable.setCellState('saved', row, col);
+
+        delete GbGradeTable.lastValidGrades[studentId][assignmentId];
+
+        // update the course grade cell
+        if (data.courseGrade) {
+          GbGradeTable.syncCourseGrade(studentId, data.courseGrade);
+        }
+
+        // update the category average cell
+        if (assignment.categoryId) {
+          GbGradeTable.syncCategoryAverage(studentId, assignment.categoryId, data.categoryScore);
+        }
+
+        GbGradeTable.syncScore(studentId, assignmentId, newScore);
+      } else if (status == "error") {
+        GbGradeTable.setCellState('error', row, col);
+
+        if (!GbGradeTable.lastValidGrades[studentId][assignmentId]) {
+          GbGradeTable.lastValidGrades[studentId][assignmentId] = oldScore;
+        }
+      } else if (status == "invalid") {
+        GbGradeTable.setCellState('invalid', row, col);
+
+        if (!GbGradeTable.lastValidGrades[studentId][assignmentId]) {
+          GbGradeTable.lastValidGrades[studentId][assignmentId] = oldScore;
+        }
+      } else if (status == "nochange") {
+        GbGradeTable.clearCellState(row, col);
+      } else {
+        console.log("Unhandled saveValue response: " + status);
+      }
+
+      GbGradeTable.instance.setDataAtCell(row, GbGradeTable.STUDENT_COLUMN_INDEX, GbGradeTable.modelForStudent(studentId));
+    });
+};
+
+
+GbGradeTable.runReadyCallbacks = function() {
+    $.each(GbGradeTable._onReadyCallbacks, function(i, callback) {
+        if (typeof callback == 'function') {
+            callback();
+        }
+    });
+};
+
+
+GbGradeTable.addReadyCallback = function(callback) {
+    if (GbGradeTable.instance) {
+        if (typeof callback == 'function') {
+            callback();
+        }
+    } else {
+        GbGradeTable._onReadyCallbacks.push(callback);
+    }
+};
+
+
+GbGradeTable.focusColumnForAssignmentId = function(assignmentId) {
+    if (assignmentId) {
+        GbGradeTable.addReadyCallback(function() {
+            var col = GbGradeTable.colForAssignment(assignmentId);
+            GbGradeTable.instance.selectCell(0, col);
+        });
+    }
+};
+
+/**************************************************************************************
+ * GradebookAPI - all the GradebookNG entity provider calls in one happy place
+ */
+GradebookAPI = {};
+
+
+GradebookAPI.isAnotherUserEditing = function(siteId, timestamp, onSuccess, onError) {
+  var endpointURL = "/direct/gbng/isotheruserediting/" + siteId + ".json";
+  var params = {
+    since: timestamp
+  };
+  GradebookAPI._GET(endpointURL, params, onSuccess, onError);
+};
+
+
+GradebookAPI.getComments = function(siteId, assignmentId, studentUuid, onSuccess, onError) {
+  var endpointURL = "/direct/gbng/comments";
+  var params = {
+    siteId: siteId,
+    assignmentId: assignmentId,
+    studentUuid: studentUuid
+  };
+  GradebookAPI._GET(endpointURL, params, onSuccess, onError);
+};
+
+
+GradebookAPI.updateAssignmentOrder = function(siteId, assignmentId, order, onSuccess, onError, onComplete) {
+  GradebookAPI._POST("/direct/gbng/assignment-order", {
+                                                        siteId: siteId,
+                                                        assignmentId: assignmentId,
+                                                        order: order
+                                                      },
+                                                      onSuccess, onError, onComplete)
+};
+
+
+GradebookAPI.updateCategorizedAssignmentOrder = function(siteId, assignmentId, categoryId, order, onSuccess, onError, onComplete) {
+  GradebookAPI._POST("/direct/gbng/categorized-assignment-order", {
+                                                        siteId: siteId,
+                                                        assignmentId: assignmentId,
+                                                        categoryId: categoryId,
+                                                        order: order
+                                                      },
+                                                      onSuccess, onError, onComplete)
+};
+
+
+GradebookAPI._GET = function(url, data, onSuccess, onError, onComplete) {
+  $.ajax({
+    type: "GET",
+    url: url,
+    data: data,
+    cache: false,
+    success: onSuccess || $.noop,
+    error: onError || $.noop,
+    complete: onComplete || $.noop
+  });
+};
+
+
+GradebookAPI._POST = function(url, data, onSuccess, onError, onComplete) {
+  $.ajax({
+    type: "POST",
+    url: url,
+    data: data,
+    success: onSuccess || $.noop,
+    error: onError || $.noop,
+    complete: onComplete || $.noop
+  });
+};
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-grade-summary.js b/gradebookng/tool/src/webapp/scripts/gradebook-grade-summary.js
index 2ceb625c1e..c1b683007a 100644
--- a/gradebookng/tool/src/webapp/scripts/gradebook-grade-summary.js
+++ b/gradebookng/tool/src/webapp/scripts/gradebook-grade-summary.js
@@ -108,20 +108,27 @@ GradebookGradeSummary.prototype.setupStudentNavigation = function() {
   var $showNext = this.$content.find(".gb-summary-next-student");
   var $done = this.$content.find(".gb-summary-close");
 
-  var $previous = sakai.gradebookng.spreadsheet.findVisibleStudentBefore(this.studentId);
-  var $next = sakai.gradebookng.spreadsheet.findVisibleStudentAfter(this.studentId);
+  var currentStudentIndex = GbGradeTable.rowForStudent(this.studentId);
 
-  if ($previous) {
+  var previousStudentId, nextStudentId;
+  if (currentStudentIndex > 0) {
+    previousStudentId = GbGradeTable.students[currentStudentIndex - 1].userId;
+  }
+  if (currentStudentIndex < GbGradeTable.students.length - 1) {
+    nextStudentId = GbGradeTable.students[currentStudentIndex + 1].userId;
+  } 
+
+  if (previousStudentId) {
     $showPrevious.click(function() {
-      $previous.find("a.gb-student-label").trigger("click");
+      GbGradeTable.viewGradeSummary(previousStudentId);
     });
   } else {
     $showPrevious.hide();
   }
 
-  if ($next) {
+  if (nextStudentId) {
     $showNext.click(function() {
-      $next.find("a.gb-student-label").trigger("click");
+      GbGradeTable.viewGradeSummary(nextStudentId);
     });    
   } else {
     $showNext.hide();
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-grades.js b/gradebookng/tool/src/webapp/scripts/gradebook-grades.js
deleted file mode 100644
index 3d33bfd720..0000000000
--- a/gradebookng/tool/src/webapp/scripts/gradebook-grades.js
+++ /dev/null
@@ -1,2585 +0,0 @@
-/**************************************************************************************
- *                    Gradebook Grades Javascript                                      
- *************************************************************************************/
-
-/**************************************************************************************
- * A GradebookSpreadsheet to encapsulate all the grid features 
- */
-function GradebookSpreadsheet($spreadsheet) {
-  this.$spreadsheet = $spreadsheet;
-  this.$table = $("#gradebookGradesTable");
-  this.$horizontalOverflow = $("#gradebookHorizontalOverflowWrapper");
-
-  // no students or grade items, nothing to do
-  if (this.$table.length == 0) {
-	  return;
-  }
-
-  // all the Grade Item cell models keyed on studentUuid, then assignmentId
-  this._GRADE_CELLS = {};
-
-  // categories and ordering
-  this._CATEGORIES_MAP = {}; // header models keyed on their category
-  this._ALL_CATEGORIES = []; // category strings in an alpha sorted list
-  this._COLUMN_ORDER = [];   // the order of the columns when categories aren't enabled
-  this._CATEGORY_DATA = {} // info about each category including weighting and color
-
-
-  // set it all up
-  this.setupGradeItemCellModels();
-  this._refreshColumnOrder();
-  this.setupToolbar();
-  this.setupColoredCategories();
-
-  var self = this;
-  // these things are less important, so can push off the
-  // critical path of the page load
-  this.onReady(function() {
-    self.setupKeyboadNavigation();
-    setTimeout(function(){ self.setupFixedColumns(); });
-    // only setup the fixed header if categies are not enabled
-    // otherwise they'll be setup post group-by-category
-    if (!$("#toggleCategoriesToolbarItem").hasClass("on")) {
-      self.setupFixedTableHeader();
-    }
-    setTimeout(function() { self.setupColumnDragAndDrop(); });
-    self.setupRowSelector();
-    self.setupConcurrencyCheck();
-    self.setupStudentFilter();
-    self.setupMenusAndPopovers();
-    self.setupNewAssignmentFocus();
-  });
-
-  this.onReady(function() {
-    self.setupScrollHandling();
-    self.setupConnectionPoll();
-  })
-
-  this.ready();
-};
-
-
-GradebookSpreadsheet.prototype.getCellModelForWicketParams = function(wicketExtraParameters) {
-    var extraParameters = {};
-
-    if (!wicketExtraParameters) {
-      return;
-    }
-
-    wicketExtraParameters.map(function(o, i) {
-      extraParameters[o.name] = o.value;
-    });
-
-    return this.getCellModelForStudentAndAssignment(extraParameters.studentUuid, extraParameters.assignmentId);
-};
-
-
-GradebookSpreadsheet.prototype.setupGradeItemCellModels = function() {
-  var self = this;
-  //var t = Date.now();
-
-//  var tmpHeaderByIndex = [];
-
-  self.$table.find("> thead > tr.gb-headers > th").each(function(cellIndex, cell) {
-    var $cell = $(cell);
-
-    var model = new GradebookHeaderCell($cell, self);
-
-    //tmpHeaderByIndex.push(model);
-  });
-
-  self.$table.on("focus", "td, th", function(event) {
-    // lazy load model
-    self.getCellModel($(this));
-  });
-
-  self.$table.on("focus", "td.gb-grade-item-cell :text", function(event) {
-    // lazy load model
-    self.getCellModel($(event.target).closest("td"));
-  });
-
-  function setupContextMenu($cell) {
-    // ensure model
-    self.getCellModel($cell);
-
-    // append menu
-    $cell.find("> div:first").append($("#gradeItemCellDropdownMenu").html());
-
-    // setup tooltip
-    var $dropdown = $cell.find(".dropdown-toggle");
-    var tooltip = $dropdown.attr("title");
-    tooltip = tooltip.replace("{0}", self.getCellModel($cell).getRow().find(".gb-student-cell:first").attr("abbr"));
-    tooltip = tooltip.replace("{1}", self.getCellModel($cell).header.$cell.attr("abbr"));
-    $dropdown.attr("title", tooltip);
-    $dropdown.dropdown();
-
-    $cell.data("has-dropdown", true);
-  };
-
-  self.$table.on("focus", "td.gb-grade-item-cell", function(event) {
-    var $cell = $(event.target).closest(".gb-grade-item-cell");
-    if (!$cell.data("has-dropdown")) {
-      setupContextMenu($cell);
-    }
-    return true;
-  });
-
-  self.$table.find(".gb-grade-item-cell, .gb-grade-item-cell :text").hover(function(event) {
-    var $cell = $(event.target).closest(".gb-grade-item-cell");
-    if (!$cell.data("has-dropdown")) {
-      setupContextMenu($cell);
-    }
-  }, function() {
-    
-  })
-};
-
-
-GradebookSpreadsheet.prototype.setupKeyboadNavigation = function() {
-  var self = this;
-
-  self.$table.
-    on("keydown", function(event) {
-      return self.onKeydown(event);
-    });
-};
-
-
-GradebookSpreadsheet.prototype.onKeydown = function(event) {
-  var self = this;
-
-  var $eventTarget = $(event.target);
-
-  if (!$eventTarget.is("td,th")) {
-    return true;
-  }
-
-  var isEditableCell = this.isCellEditable($eventTarget);
-
-
-  // arrow left 37 (DISABLE TAB FOR NOW || tab 9 + SHIFT)
-  if (event.keyCode == 37) { // || (event.shiftKey && event.keyCode == 9)) {
-    self.navigate(event, event.target, "left");
-
-  // arrow up 38
-  } else if (event.keyCode == 38) {
-    self.navigate(event, event.target, "up");
-
-  // arrow right 39 (DISABLE TAB FOR NOW || tab 9)
-  } else if (event.keyCode == 39) { // || event.keyCode == 9) {
-    self.navigate(event, event.target, "right");
-
-  // arrow down 40
-  } else if (event.keyCode == 40) {
-    self.navigate(event, event.target, "down");
-
-  // return 13
-  } else if (isEditableCell && event.keyCode == 13) {
-    event.preventDefault();
-    self.getCellModel($eventTarget).enterEditMode(event.keyCode);
-
-  // 0-9 48-57 and keypad 0-9 96-105
-  } else if (isEditableCell &&
-      ((event.keyCode >= 48 && event.keyCode <= 57) || (event.keyCode >= 96 && event.keyCode <= 105))) {
-    event.preventDefault();
-    self.getCellModel($eventTarget).enterEditMode(event.keyCode);
-
-  // DEL 8
-  } else if (isEditableCell && event.keyCode == 8) {
-    event.preventDefault();
-    // TODO: no clear mechanism yet
-    //self.getCellModel($eventTarget).clear();
-
-  // ESC 27
-  } else if (event.keyCode == 27) {
-    event.preventDefault();
-    self.$table.find('[data-toggle="popover"]').popover("hide");
-  }
-};
-
-
-GradebookSpreadsheet.prototype.navigate = function(event, fromCell, direction, enableEditMode) {
-  var self = this;
-
-  var $cell = $(fromCell);
-  var aCell = self.getCellModel($cell);
-
-  var $row = aCell.getRow();
-
-  var $targetCell;
-
-  if (direction == "left") {
-    if ($cell.index() > 0) {
-      event.preventDefault();
-      event.stopPropagation();
-
-      $targetCell = $cell.prevAll(":visible:first");
-
-    } else {
-      fromCell.focus();
-      return true;
-    }
-  } else if (direction == "right") {
-    event.preventDefault();
-    event.stopPropagation();
-
-    if ($cell.index() < $row.children().last().index()) {
-      $targetCell = $cell.nextAll(":visible:first");
-    } else {
-      fromCell.focus();
-      if (fromCell.data("_pendingReplacement")) {
-        fromCell.data("model")._focusAfterSaveComplete = true;
-      }
-      return true;
-    }
-  } else if (direction == "up") {
-    // can we go up a row inside the tbody
-    if ($row.index() > 0) {
-      event.preventDefault();
-      event.stopPropagation();
-
-      var $targetRow = aCell.getRow().prevAll(":visible:first");
-
-      if ($targetRow.length == 0) {
-        // all rows above are hidden! Jump to the header
-        $targetRow = self.$table.find("> thead > tr.gb-headers");
-      }
-
-      $targetCell = $targetRow.find("> *:nth-child("+($cell.index()+1)+")");
-
-    // can we go up a row to the thead
-    } else if ($row.index() == 0 && $row.parent().is("tbody")) {
-      event.preventDefault();
-      event.stopPropagation();
-
-      $targetCell = self.$table.find("> thead > tr.gb-headers").
-                      find("> *:nth-child("+($cell.index()+1)+")");
-
-    // or are we at the top!
-    } else {
-      fromCell.focus();
-    }
-  } else if (direction == "down") {
-    if ($row.parent().is("thead")) {
-      event.preventDefault();
-      event.stopPropagation();
-
-      $targetCell = self.$table.find("> tbody > tr:visible:first").
-                      find("> *:nth-child("+($cell.index()+1)+")");
-    } else if ($row.index() < $row.siblings().last().index()) {
-      event.preventDefault();
-      event.stopPropagation();
-
-      $targetCell = aCell.getRow().nextAll(":visible:first").
-                                      find("> *:nth-child("+($cell.index()+1)+")");
-
-    } else {
-      fromCell.focus();
-      if (fromCell.data("_pendingReplacement")) {
-        fromCell.data("model")._focusAfterSaveComplete = true;
-      }
-    }
-  }
-
-  // stay in "edit mode" if the next cell is editable
-  if (enableEditMode && $targetCell && $cell != $targetCell) {
-    var targetCellModel = self.getCellModel($targetCell);
-    if (targetCellModel.isEditable()) {
-      targetCellModel.enterEditMode();
-    } else {
-      $targetCell.focus();
-    }
-  } else if ($targetCell && $targetCell.is(":visible")) {
-    $targetCell.focus();
-  } else {
-    // ensure the table retains focus to facilitate continuation of keyboard navigation
-    aCell._focusAfterSaveComplete = true;
-  }
-
-  return false;
-};
-
-
-GradebookSpreadsheet.prototype.ensureCellIsVisible = function($cell) {
-  var self= this;
-
-  // check input is visible on x-scroll
-  var fixedColWidth = self.find(".gb-fixed-columns-table").width();
-  if  ($cell[0].offsetLeft - self.$horizontalOverflow[0].scrollLeft < fixedColWidth) {
-    self.$horizontalOverflow[0].scrollLeft = $cell[0].offsetLeft - fixedColWidth;
-  }
-
-  // check input is visible on y-scroll
-  if ($cell.parent().parent().prop("tagName") == "TBODY") {
-    var $header = self.getHeader();
-    var headerBottomPosition = $header[0].offsetTop + $header[0].offsetHeight;
-    if ($cell[0].offsetTop < headerBottomPosition) {
-      $(window).scrollTop($(window).scrollTop() - (headerBottomPosition - ($cell[0].offsetTop - $cell.height())));
-    }
-  }
-};
-
-
-GradebookSpreadsheet.prototype.isCellEditable = function($cell) {
-  return $cell.hasClass("gb-grade-item-cell");
-};
-
-
-GradebookSpreadsheet.prototype.isCellForExternalItem = function($cell) {
-  return $cell.hasClass("gb-external-item-cell");
-};
-
-
-GradebookSpreadsheet.prototype.isCellForCategoryScore = function($cell) {
-  return $cell.hasClass("gb-category-item-column-cell");
-};
-
-
-GradebookSpreadsheet.prototype.getCellModelForStudentAndAssignment = function(studentUuid, assignmentId) {
-  if (this._GRADE_CELLS.hasOwnProperty(studentUuid) && this._GRADE_CELLS[studentUuid].hasOwnProperty(assignmentId)) {
-    return this._GRADE_CELLS[studentUuid][assignmentId];
-  }
-
-  if (!this._GRADE_CELLS.hasOwnProperty(studentUuid)) {
-    this._GRADE_CELLS[studentUuid] = {};
-  }
-
-  if (!this._GRADE_CELLS[studentUuid].hasOwnProperty(assignmentId)) {
-    var $cell = this.$table.find("> tbody td[data-studentuuid='"+studentUuid+"'][data-assignmentid='"+assignmentId+"']:first");
-    var $header = this.$table.find("> thead > tr:last [data-assignmentid='"+assignmentId+"']:first").closest("th");
-
-    if (this.isCellEditable($cell)) {
-      cellModel = new GradebookEditableCell($cell, this.getCellModel($header), this);
-    } else if (this.isCellForExternalItem($cell) || this.isCellForCategoryScore($cell)) {
-      cellModel = new GradebookBasicCell($cell, this.getCellModel($header), this);
-    } else {
-      cellModel = new GradebookBasicCell($cell, this.getCellModel($header), this);
-    }
-    this._GRADE_CELLS[studentUuid][assignmentId] = cellModel;
-  }
-
-  return this._GRADE_CELLS[studentUuid][assignmentId];
-};
-
-
-GradebookSpreadsheet.prototype.getCellModel = function($cell) {
-  if ($cell.data("model")) {
-    return $cell.data("model");
-  }
-
-  if ($cell.data("studentuuid") && $cell.data("assignmentid")) {
-    return this.getCellModelForStudentAndAssignment($cell.data("studentuuid"), $cell.data("assignmentid"));
-  }
-
-  var headerModel = this.getCellModel(this.$table.find("> thead > tr:last > th:eq(" + $cell.index() + ")"));
-
-  return new GradebookBasicCell($cell, headerModel, this);
-};
-
-
-GradebookSpreadsheet.prototype.handleInputReturn = function(event, $cell) {
-  this.navigate(event, $cell, "down", true);
-};
-
-
-GradebookSpreadsheet.prototype.handleInputArrowKey = function(event, $cell) {
-  if (event.keyCode == 37) {
-    this.navigate(event, $cell, "left", true);
-  } else if (event.keyCode == 38) {
-    this.navigate(event, $cell, "up", true);
-  } else if (event.keyCode == 39) {
-    this.navigate(event, $cell, "right", true);
-  } else if (event.keyCode == 40) {
-    this.navigate(event, $cell, "down", true);
-  }
-  return false;
-};
-
-
-GradebookSpreadsheet.prototype.handleInputTab = function(event, $cell) {
-  if (event.shiftKey) {
-    this.navigate(event, $cell, "left", true);
-  } else {
-    this.navigate(event, $cell, "right", true);
-  }
-};
-
-
-GradebookSpreadsheet.prototype.getHeader = function() {
-  // if floating, return the floating header
-  if (this.find(".gb-fixed-header-table:visible").length > 0) {
-    return this.find(".gb-fixed-header-table:visible");
-  }
-
-  // otherwise, return the fixed header
-  return this.$table.find("> thead", "> tr");
-};
-
-
-GradebookSpreadsheet.prototype.setupFixedTableHeader = function(reset) {
-  var self = this;
-
-  if (reset) {
-    // delete the existing header and initialize a new one
-    self.find(".gb-fixed-header-table").remove();
-  };
-
-  var $head = self.$table.find("> thead");
-  self.$fixedHeader = $("<table>").
-                        attr("class", self.$table.attr("class")).
-                        addClass("gb-fixed-header-table").
-                        attr("role", "presentation").
-                        attr("aria-hidden", "true").
-                        hide();
-
-  var $fixedHeaderHead = $("<thead>");
-  self.$fixedHeader.append($fixedHeaderHead);
-
-  $head.find("> tr").each(function() {
-    var $tr = $(this);
-
-    if ($tr.hasClass("gb-headers")) {
-      var $cloneRow = $("<tr>").addClass("gb-headers");
-      $.each($tr.find("> td, > th"), function(i, th) {
-        var $th = $(th);
-        var $clone = self._cloneCell($th);
-        $clone.find("ul").remove();
-        var model = $th.data("model");
-        if (model) {
-          model.setFixedHeaderCell($clone);
-        }
-        $cloneRow.append($clone);
-      });
-      $fixedHeaderHead.append($cloneRow);
-    } else {
-      $fixedHeaderHead.append(self._cloneCell($tr));
-    }
-  });
-
-  self.$spreadsheet.prepend(self.$fixedHeader);
-
-  if (reset && self.$fixedColumnsHeader) {
-    // ensure the $fixedColumnsHeader and $fixedHeader are the same height
-    self.$fixedColumnsHeader.find("> tr.gb-headers > th").height(self.$fixedHeader.find(".headers th:first").height());
-  }
-
-  self.$fixedHeader.find("th").on("mousedown", function(event) {
-    event.preventDefault();
-
-    $(window).scrollTop(self.$table.offset().top - 10);
-    // find the header row (last in the thead) and get the corresponding th element
-    var $target = $(self.$table.find("> thead > tr.gb-headers > *").get($(this).index()));
-
-    self.$spreadsheet.data("activeCell", $target);
-
-    // attempt to proxy to elements in the original cell
-    if (!self.proxyEventToElementsInOriginalCell(event, $target)) {
-      // if false, proxy through the event to start up a drag action
-      $target.trigger(event); 
-    }
-  });
-
-  self._fixedThingsAreReady += 1;
-};
-
-
-GradebookSpreadsheet.prototype.refreshFixedTableHeader = function() {
-  this.setupFixedTableHeader(true);
-};
-
-
-GradebookSpreadsheet.prototype.setupFixedColumns = function() {
-  var self = this;
-
-  // all columns before the grade item columns should be fixed
-  self.$fixedColumnsHeader = $("<table>").attr("class", self.$table.attr("class")).
-                                          addClass("gb-fixed-column-headers-table").
-                                          attr("role", "presentation").
-                                          attr("aria-hidden", "true").
-                                          hide();
-
-  self.$fixedColumns = $("<table>").attr("class", self.$table.attr("class")).
-                                    addClass("gb-fixed-columns-table").
-                                    attr("role", "presentation").
-                                    attr("aria-hidden", "true").
-                                    hide();
-
-  var $headers = self.$table.find("> thead > tr.gb-headers > th").slice(0,3);
-  var $thead = $("<thead>");
-  if(self.isGroupedByCategory()) {
-    // append a dummy header row for when categorised
-    $thead.append($("<tr>").addClass("gb-categories-row").append($("<th>").attr("colspan", $headers.length)));
-  }
-
- // add the row for all cloned cells
-  $thead.append($("<tr>").addClass("gb-clone-row").addClass("gb-headers"));
-  self.$fixedColumnsHeader.append($thead);
-
-  self.$fixedColumns.append($("<tbody>"));
-
-  // populate the dummy header table
-  $headers.each(function(i, origCell) {
-    var $th = self._cloneCell($(origCell));
-    self.$fixedColumnsHeader.find("tr.gb-clone-row").append($th);
-  });
-
-  // populate the dummy column table
-  var $tbody = $("<tbody>");
-  self.$table.find("> tbody > tr").each(function(i, origRow) {
-    var $tr = $("<tr>");
-    self._cloneCells($(origRow).find(" > :lt(3)")).appendTo($tr);
-    $tbody.append($tr);
-  });
-  self.$fixedColumns.append($tbody);
-
-  self.$spreadsheet.prepend(self.$fixedColumnsHeader);
-  self.$spreadsheet.prepend(self.$fixedColumns);
-
-  self.$fixedColumns.data("width", self.$fixedColumns.width());
-
-  self.$table.find("> tbody > tr").hover(
-    function() {
-      $(self.$fixedColumns.find("tr")[$(this).index()]).addClass("hovered");
-    },
-    function() {
-      $(self.$fixedColumns.find("tr")[$(this).index()]).removeClass("hovered");
-    }
-  );
-
-  // Clicks on the fixed header return you to the real header cell
-  self.$fixedColumnsHeader.find("> thead > tr > *").on("mousedown", function(event) {
-    event.preventDefault();
-    $(window).scrollTop(self.$table.offset().top - 10);
-    self.$spreadsheet.scrollLeft(0);
-    var $targetCell = $(self.$table.find("> thead > tr.gb-headers > *").get($(this).index()));
-
-    self.$spreadsheet.data("activeCell", $targetCell);
-
-    // attempt to proxy to elements in the original cell
-    if (!self.proxyEventToElementsInOriginalCell(event, $targetCell)) {
-      // otherwise just focus the original cell
-      $targetCell.focus();
-    }
-  });
-
-  // Clicks on the fixed column return you to the real column cell
-  self.$fixedColumns.find("td,th").on("mousedown", function(event) {
-    event.preventDefault();
-    var cellIndex = $(this).index();
-    var rowIndex = $(this).closest("tr").index();
-    $targetCell = $($(self.$table.find("> tbody > tr").get(rowIndex)).find("> *").get(cellIndex));
-
-    self.$spreadsheet.data("activeCell", $targetCell);
-
-    // attempt to proxy to elements in the original cell
-    if (!self.proxyEventToElementsInOriginalCell(event, $targetCell)) {
-      // otherwise just focus the original cell
-      $targetCell.focus();
-    }
-  });
-
-  self._fixedThingsAreReady += 1;
-};
-
-
-GradebookSpreadsheet.prototype.setupScrollHandling = function() {
-  var self = this;
-
-  $(document).on("scroll", $.proxy(self.handleScrollEvent, self));
-  self.$horizontalOverflow.on("scroll", $.proxy(self.handleScrollEvent, self));
-
-  self.handleScrollEvent();
-};
-
-
-GradebookSpreadsheet.prototype._fixedThingsAreReady = 0;
-GradebookSpreadsheet.prototype.handleScrollEvent = function() {
-  var self = this;
-
-  function positionFixedColumn() {
-    if (self.$horizontalOverflow[0].scrollLeft > 0) {
-      self.$fixedColumns.
-          show().
-          css("left", self.$horizontalOverflow.offset().left).
-          css("top", self.$table.find("tbody").offset().top - $(window).scrollTop());
-    } else {
-      self.$fixedColumns.hide();
-    }
-  };
-
-  function positionFixedColumnHeader() {
-    var showFixedHeader = false;
-    var leftOffset = self.$horizontalOverflow.offset().left;
-    var topOffset = Math.max(0, self.$table.offset().top - $(window).scrollTop());
-
-    self.$fixedColumnsHeader.css("position", "fixed");
-
-    if (self.$horizontalOverflow[0].scrollLeft > 0 || self.$table.offset().top < $(window).scrollTop()) {
-      if (self.$horizontalOverflow[0].scrollLeft > 0) {
-        showFixedHeader = true;
-      }
-
-      if ($(window).scrollTop() + self.$fixedColumnsHeader.height() + 80 > self.$table.offset().top + self.$table.height()) {
-        // hard position the fixed column header just above the bottom of the
-        // table
-        topOffset = self.$table.height() - self.$fixedColumnsHeader.height() - 80;
-        leftOffset = 0;
-        self.$fixedColumnsHeader.css("position", "absolute");
-        // except check for the horizontal scroll
-        if (self.$horizontalOverflow[0].scrollLeft == 0) {
-          showFixedHeader = true;
-        }
-      } else if (self.$table.offset().top < $(window).scrollTop()) {
-        showFixedHeader = true
-      }
-    }
-
-    if (showFixedHeader) {
-      self.$fixedColumnsHeader.show().css("top", topOffset).css("left", leftOffset);
-    } else {
-      self.$fixedColumnsHeader.hide();
-    }
-  }
-
-  function positionFixedHeader() {
-    if ($(window).scrollTop() + self.$fixedHeader.height() + 80 > self.$table.offset().top + self.$table.height()) {
-      // freeze the header just above the bottom of the table
-      self.$fixedHeader.css("top", self.$table.height() - self.$fixedHeader.height() - 80);
-    } else if (self.$table.offset().top < $(window).scrollTop()) {
-      var forceCategoryLabelRefresh = self.$fixedHeader.is(":not(:visible)");
-
-      self.$fixedHeader.
-          show().
-          css("top", $(window).scrollTop() - self.$spreadsheet.offset().top + "px").
-          css("left", -self.$horizontalOverflow.scrollLeft() + "px");
-
-      if (forceCategoryLabelRefresh) {
-        self.$horizontalOverflow.trigger("refreshcategorylabels.aspace");
-      }
-    } else {
-      self.$fixedHeader.hide();
-    }
-  }
-
-  window.cancelAnimationFrame(self.scrollRequest);
-  self.scrollRequest = window.requestAnimationFrame(function() {
-    if (self._fixedThingsAreReady > 1) {
-      positionFixedColumn();
-      positionFixedColumnHeader();
-      positionFixedHeader();
-    }
-  });
-}
-
-
-GradebookSpreadsheet.prototype.proxyEventToElementsInOriginalCell = function(event, $originalCell) {
-  var $target = $(event.target);
-
-  // if a span, then check if this is a child of link
-  if ($target.is("span") && $target.closest("a").length > 0) {
-    // yep! let's proxy through the event to the link
-    // as it's likely the user wanted to click it
-    $target = $target.closest("a");
-  }
-
-  // check for an id
-  if ($target.data("id") || $target.attr("id")) {
-    var $originalElement = $originalCell.find("#"+($target.data("id") || $target.attr("id")));
-    if ($originalElement.length > 0) {
-      $originalElement.focus().trigger("click");
-      return true;
-    }
-  // or a dropdown?
-  } else if ($target.is("a.btn.dropdown-toggle")) {
-    setTimeout(function() {
-      $originalCell.find("a.btn.dropdown-toggle").focus().trigger("click");
-    });
-    return true;
-  // or the row selector?
-  } else if ($target.is(".gb-row-selector")) {
-    $originalCell.next().focus();
-    return true;
-  // or a flag?
-  } else if ($target.closest(".gb-grade-item-flags").length == 1) {
-    setTimeout(function() {
-      $originalCell.find($target.attr("class").split(' ').map(function(cssClass) {return "." + cssClass}).join(" ")).focus();
-    });
-    return true;
-  // external item flag?
-  } else if ($target.closest(".gb-external-app-flag").length == 1) {
-    setTimeout(function() {
-      $originalCell.find(".gb-external-app-flag").focus();
-    });
-  }
-  return false;
-};
-
-
-GradebookSpreadsheet.prototype.setupColumnDragAndDrop = function() {
-  var self = this;
-
-  // is sorting enabled for the user?
-  if (!self.$table.data("sort-enabled")) {
-    return;
-  }
-
-  function updateOrderingAfterDrop(droppedCellModel) {
-    if (self.isGroupedByCategory()) {
-      var categoryScope = droppedCellModel.categoryDragScope;
-      var category = droppedCellModel.getCategory();
-
-      if (self._CATEGORIES_MAP[category].length == 1) {
-        return; // only 1 in the category so don't need to change order
-      }
-
-      var $cellsInCategory = self.$table.find("." + categoryScope);
-
-      var oldSiblingsIndex = $.inArray(droppedCellModel, self._CATEGORIES_MAP[category]);
-      var newSiblingsIndex = $cellsInCategory.index(droppedCellModel.$cell);
-
-      if (oldSiblingsIndex == newSiblingsIndex) {
-        // no change in order
-        return;
-      }
-
-      var oldRealIndex = $.inArray(droppedCellModel, self._COLUMN_ORDER);
-
-      // drop it from the array
-      self._CATEGORIES_MAP[category].splice(oldSiblingsIndex, 1);
-
-      if (newSiblingsIndex < oldSiblingsIndex) { // moved to the left
-        var closestSiblingOnRightIndex = $.inArray(droppedCellModel.$cell.next().data("model"), self._CATEGORIES_MAP[category]);
-        self._CATEGORIES_MAP[category].splice(closestSiblingOnRightIndex, 0, droppedCellModel)
-      } else { // moved to the right
-        var closestSiblingOnLeftIndex = $.inArray(droppedCellModel.$cell.prev().data("model"), self._CATEGORIES_MAP[category]);
-        self._CATEGORIES_MAP[category].splice(closestSiblingOnLeftIndex + 1, 0, droppedCellModel);
-      }
-    } else {
-      self._refreshColumnOrder();
-    }
-  };
-
-
-  function applyAndPersistOrder($source, $target) {
-    var sourceModel = $source.data("model");
-    var targetModel = $target.data("model");
-    // position relative to other header cells
-    var newPosition = $target.index();
-    // order relative to other grade item cells
-    var newOrder = $.inArray(targetModel, self._COLUMN_ORDER);
-
-    sourceModel.moveColumnTo(newPosition);
-
-    updateOrderingAfterDrop(sourceModel);
-
-    if (self.isGroupedByCategory()) {
-      // determine the new position of the grade item in relation to grade items in this category
-      var order = $.inArray(sourceModel, self._CATEGORIES_MAP[sourceModel.getCategory()]);
-      GradebookAPI.updateCategorizedAssignmentOrder(self.$table.data("siteid"),
-                                                    sourceModel.columnKey,
-                                                    sourceModel.getCategoryId(),
-                                                    order);
-    } else {
-      GradebookAPI.updateAssignmentOrder(self.$table.data("siteid"),
-                                        sourceModel.columnKey,
-                                        newOrder);
-    }
-
-    // refresh the fixed header
-    self.refreshFixedTableHeader(true);
-
-    // refresh any hidden column visual cues
-    self.refreshHiddenVisualCue();
-  }
-
-
-  self.find(".gb-grade-item-column-cell").on("mousedown", function() {
-    self.$spreadsheet.data("activeCell", $(this));
-    $(this).focus();
-    return true;
-  });
-
-  var $droppables = self.$table.find("> thead .gb-grade-item-column-cell").droppable({
-    accept: ".gb-grade-item-column-cell",
-    hoverClass: "gb-grade-item-drag-hover",
-    tolerance: "pointer",
-    drop: function(event, ui) {
-      // let the drop fully complete (DOM handle is removed, droppable updated)
-      // before updating any state
-      setTimeout(function() {
-        applyAndPersistOrder(ui.draggable, $(event.target));
-      });
-    }
-  });
-
-  self.$table.find("> thead .gb-grade-item-column-cell").draggable({
-    addClasses: false,
-    helper: function(event, ui, foo) {
-      var $cell = $(event.currentTarget);
-      if ($cell[0] == document) {
-        // drag was initiated on a fixed header cell so figure out which cell we really want
-        $cell = self.$table.find("thead > tr:last > :eq("+$(event.target).closest("th").index()+")");
-      }
-      var $clone = self._cloneCell($cell);
-      $clone.data("model", $cell.data("model"));
-
-      $clone.height(self.$table.height());
-
-      return $clone;
-    },
-    axis: 'x',
-    delay: 500,
-    scrollSensitivity: 100,
-    opacity: 0.9,
-    zIndex: 1000,
-    cancel: '.btn-group, .btn-group *, .gb-grade-item-flags *, .gb-external-app-flag', // don't start drag if the dropdown menu or a flag is clicked
-    start: function(event, ui) {
-      $(ui.helper.context).addClass("gb-grade-item-drag-source");
-      // enable all droppable
-      $droppables.droppable("enable");
-      // but disable those that aren't in the same category if grouped
-      if (self.isGroupedByCategory()) {
-        var model = $(ui.helper).data("model");
-        $droppables.filter(":not(."+ model.categoryDragScope+")").droppable("disable");
-      }
-    },
-    stop: function(event, ui) {
-      $(ui.helper.context).removeClass("gb-grade-item-drag-source");   
-    }
-  });
-};
-
-
-GradebookSpreadsheet.prototype.setupToolbar = function() {
-  this.toolbarModel = new GradebookToolbar($("#gradebookGradesToolbar"), this);
-};
-
-GradebookSpreadsheet.prototype._cloneCells = function($cells) {
-  var $clones = $cells.clone();
-  $clones.find("[id]").andSelf().each(function() {
-    $(this).data("id", $(this).attr("id")).removeAttr("id");
-  });
-
-  // set the width/height
-  $($clones.get(0)).height($($cells.get(0)).outerHeight());
-  $($clones.get(0)).width($($cells.get(0)).outerWidth());
-
-  return $clones;
-};
-
-GradebookSpreadsheet.prototype._cloneCell = function($cell) {
-  // clone and sanitize the $cell so it can be used in a fixed header/column
-  // and not interfere with javascript bindings already out there
-
-  // start with a basic clone
-  var $clone = $cell.clone();
-
-  // remove any ids
-  $clone.find("[id]").andSelf().each(function() {
-    $(this).data("id", $(this).attr("id")).removeAttr("id");
-  });
-
-  // set the width/height
-  $clone.height($cell.outerHeight());
-  $clone.width($cell.outerWidth());
-
-  return $clone;
-};
-
-
-GradebookSpreadsheet.prototype.enableGroupByCategory = function() {
-  var self = this;
-
-  var currentCategory, newColIndex = 3;
-  var $categoriesRow = self.$spreadsheet.find(".gb-categories-row");
-
-  $.each(self._ALL_CATEGORIES, function(i, category) {
-    var cellsForCategory = self._CATEGORIES_MAP[category];
-    var categoryData = self._CATEGORY_DATA[category];
-
-    var numberVisible = 0;
-
-    var $categoryCell;
-    if (category == "Uncategorized") {
-      $categoryCell = $categoriesRow.find("> th.gb-uncategorized");
-    } else {
-      $categoryCell = $categoriesRow.find("> th[data-category-id='" + categoryData.id + "']");
-    }
-
-    $.each(cellsForCategory, function(_, model) {
-      var categoryDragScope = "gb-category-"+i; // used to scope drag and drop when grouped
-      model.$cell.addClass(categoryDragScope);
-      model.categoryDragScope = categoryDragScope;
-      model.setCategoryCell($categoryCell);
-
-      if (model.$cell.is(":visible")) {
-        numberVisible++;
-      }
-
-      newColIndex++;
-    });
-
-    if (categoryData.scoreHeaderModel) {
-      categoryData.scoreHeaderModel.setCategoryCell($categoryCell);
-      if (categoryData.scoreHeaderModel.$cell.is(":visible")) {
-        numberVisible++;
-      }
-      newColIndex++;
-    }
-
-    $categoryCell.attr("colspan", numberVisible);
-    if (numberVisible == 0) {
-      $categoryCell.hide();
-    } else {
-      $categoryCell.show();
-    }
-  });
-
-  self.refreshFixedTableHeader(true);
-  self.refreshHiddenVisualCue();
-
-  // setup category header text so it is visible when horizontal scrolling
-  function setupScrollHandlerToUpdateCategoryLabelPosition(event) {
-    if (self.$spreadsheet.data("categoryScrollTimeout")) {
-      clearTimeout(self.$spreadsheet.data("categoryScrollTimeout"));
-    }
-    // only reposition every 100ms after a scroll.. to avoid too
-    // many repositions
-    self.$spreadsheet.data("categoryScrollTimeout", setTimeout(function() {
-      self.updateCategoryLabelPositions();
-    }, 500)); // only refresh 0.5sec after scrolling has finished
-  };
-
-  self.$horizontalOverflow.
-    off("scroll refreshcategorylabels.aspace", setupScrollHandlerToUpdateCategoryLabelPosition).
-    on("scroll refreshcategorylabels.aspace", setupScrollHandlerToUpdateCategoryLabelPosition);
-
-  self.$horizontalOverflow.trigger("scroll"); // force redraw of the fixed columns
-};
-
-
-GradebookSpreadsheet.prototype.updateCategoryLabelPositions = function(animate) {
-  var self = this;
-
-  animate = false; //(animate == null) ? true : animate;
-
-  self.$spreadsheet.find(".gb-category-label").each(function() {
-    var $label = $(this);
-    var $table = $label.closest("table");
-
-    if ($table.is(":visible")) {
-      var viewport = self.getWidth();
-      var overlay = self.$fixedColumns.data("width");
-      var available = viewport - overlay;
-      var scroll = self.$horizontalOverflow[0].scrollLeft;
-
-      if (available < 0) {
-        return; // screen too small for this awesomeness...
-      }
-
-      var $cell = $label.closest("th");
-
-      var relativeCellOffset = $table.is(".gb-fixed-header-table") ?
-                                  $cell.position().left - overlay :
-                                  $cell.position().left - $table.position().left - overlay;
-
-      var offset = Math.max(0, scroll - relativeCellOffset);
-      var newLabelWidth = Math.min($cell.width() - offset, Math.min(available - (relativeCellOffset - scroll), available));
-
-      if (newLabelWidth < 180) {
-        newLabelWidth = 180;
-        offset = Math.min(offset, $cell.width() - newLabelWidth);
-      }
-
-      var newLeftOffset = Math.max(offset, 0);
-
-      if ($label.data("leftOffset") != newLeftOffset || $label.data("labelWidth") != newLabelWidth) {
-        var newStyles = {
-          marginLeft: Math.max(offset, 0),
-          width: newLabelWidth
-        };
-
-        if (animate && $label.is(":visible")) {
-          $label.animate(newStyles, 200);
-        } else {
-          $label.css(newStyles);
-        }
-        $label.data("leftOffset", newLeftOffset);
-        $label.data("labelWidth", newLabelWidth);
-      }
-    }
-  });
-};
-
-
-GradebookSpreadsheet.prototype.find = function() {
-  return this.$spreadsheet.find.apply(this.$spreadsheet, arguments);
-}
-
-
-GradebookSpreadsheet.prototype._refreshColumnOrder = function() {
-  var self = this;
-
-  self._CATEGORIES_MAP = {};
-  self._ALL_CATEGORIES = [];
-  self._CATEGORY_DATA = {};
-
-  self._COLUMN_ORDER = self.$table.find("> thead > tr.gb-headers > th.gb-grade-item-column-cell").map(function() {
-    return self.getCellModel($(this));
-  });
-
-  $.each(self._COLUMN_ORDER, function(i, model) {
-    var category = model.getCategory();
-
-    self._CATEGORIES_MAP[category] = self._CATEGORIES_MAP[category] || [];
-    self._CATEGORIES_MAP[category].push(model);
-
-    if ($.inArray(category, self._ALL_CATEGORIES) == -1) {
-      self._ALL_CATEGORIES.push(category);
-      if (category != "Uncategorized") {
-        self._CATEGORY_DATA[category] = model.getCategoryData();
-      } else {
-        self._CATEGORY_DATA["Uncategorized"] = {
-          label: "Uncategorized",
-        };
-      }
-    }
-  });
-
-  // take note of any category total column headers
-  self.$table.find("> thead > tr.gb-headers > th.gb-category-item-column-cell").each(function() {
-    var $th = $(this);
-    var model = $th.data("model");
-    var category = $th.find("[data-category]:first").data("category");
-
-    self._CATEGORY_DATA[category] = self._CATEGORY_DATA[category] || {};
-
-    self._CATEGORY_DATA[category]["scoreHeaderModel"] = model;
-    self._CATEGORY_DATA[category]["totalHeaderIndex"] = $th.index();
-  });
-
-  self._ALL_CATEGORIES = self._ALL_CATEGORIES.sort(function(a, b) {
-    if (a == "Uncategorized") {
-      return 1;
-    } else if (b == "Uncategorized") {
-      return -1;
-    }
-
-    if (self._CATEGORY_DATA[a] == null) {
-      return 1;
-    } else if (self._CATEGORY_DATA[b] == null) {
-      return -1;
-    }
-
-    return self._CATEGORY_DATA[a].order > self._CATEGORY_DATA[b].order;
-  });
-}
-
-
-GradebookSpreadsheet.prototype.isGroupedByCategory = function() {
-  return this.toolbarModel.$toolbar.
-      find("#toggleCategoriesToolbarItem").hasClass("on");
-}
-
-GradebookSpreadsheet.prototype.getCategoriesMap = function() {
-  return this._CATEGORIES_MAP;
-};
-
-
-GradebookSpreadsheet.prototype.getHeaderModelForAssignment = function(assignmentId) {
-  return this.$table.find("thead .gb-headers .gb-grade-item-column-cell [data-assignmentid='" + assignmentId + "']").closest(".gb-grade-item-column-cell").data("model");
-};
-
-
-GradebookSpreadsheet.prototype.showGradeItemColumn = function(assignmentId) {
-  var headerModel = this.getHeaderModelForAssignment(assignmentId);
-  headerModel.show();
-  this.$table.find("> tbody > tr").each(function(i, row) {
-    $(row).find("> *:eq("+headerModel.$cell.index()+")").show();
-  });
-  this.refreshWidth();
-};
-
-
-GradebookSpreadsheet.prototype.hideGradeItemColumn = function(assignmentId) {
-  var headerModel = this.getHeaderModelForAssignment(assignmentId);
-  headerModel.hide();
-  this.$table.find("> tbody > tr").each(function(i, row) {
-    $(row).find("> *:eq("+headerModel.$cell.index()+")").hide();
-  });
-  this.refreshWidth();
-};
-
-
-GradebookSpreadsheet.prototype.refreshHiddenVisualCue = function() {
-  var self = this;
-
-  function showColumns() {
-    var $th = $(this).closest("th");
-    var $headersToShow;
-    if ($th.nextAll(":visible:first").length > 0) {
-      // only show hidden columns up to the next visible column
-      $headersToShow = [];
-      var $i = $th;
-      while($i.next(":not(:visible)").length > 0) {
-         $i = $i.next();
-         $headersToShow.push($i);
-      }
-    } else {
-      // show all hidden columns to the right of the current column
-      $headersToShow = $th.nextAll(":not(:visible)");
-    }
-    $.each($headersToShow, function() {
-      var model = $(this).data("model");
-      var key;
-      if (model.$cell.is(".gb-category-item-column-cell")) {
-        self.toolbarModel.$gradeItemsFilterPanel.find(".gb-item-category-score-filter :input:not(:checked)[value='"+model.getCategory()+"']").trigger("click");
-      } else {
-        self.toolbarModel.$gradeItemsFilterPanel.find(":input:not(:checked)[value='"+model.columnKey+"']").trigger("click");
-      }
-    });
-    self.refreshHiddenVisualCue();
-    $th.focus();
-  };
-
-  this.$spreadsheet.find(".gb-hidden-column-visual-cue").remove();
-  $.each(self.$table.find("> thead > tr.gb-headers > th"), function(i, th) {
-    var $th = $(th);
-    if ($th.is(":not(:visible)")) {
-      var $cue = $("<a>").attr("href", "javascript:void(0);").addClass("gb-hidden-column-visual-cue");
-      var $prevVisible = $th.prev(":visible");
-      if ($prevVisible.find(".gb-hidden-column-visual-cue").length == 0) {
-        $prevVisible.find("> div:first").append($cue);
-      }
-      $cue.click(showColumns);
-    }
-  });
-}
-
-
-GradebookSpreadsheet.prototype.showCategoryScoreColumn = function(category) {
-  var headerModel = this._CATEGORY_DATA[category].scoreHeaderModel;
-  headerModel.show();
-  this.$table.find("> tbody > tr").each(function(i, row) {
-    $(row).find("> *:eq("+headerModel.$cell.index()+")").show();
-  });
-  this.refreshWidth();
-};
-
-
-GradebookSpreadsheet.prototype.hideCategoryScoreColumn = function(category) {
-  var headerModel = this._CATEGORY_DATA[category].scoreHeaderModel;
-  headerModel.hide();
-  this.$table.find("> tbody > tr").each(function(i, row) {
-    $(row).find("> *:eq("+headerModel.$cell.index()+")").hide();
-  });
-  this.refreshWidth();
-};
-
-
-GradebookSpreadsheet.prototype.refreshSummary = function() {
-  var $summary = this.toolbarModel.$toolbar.find(".gb-item-summary");
-  var $filterPanel = this.toolbarModel.$gradeItemsFilterPanel;
-
-  var visible = $filterPanel.find(".gb-item-filter-group:not(.hide-me) .gb-item-filter :input:checked, .gb-item-category-score-filter:not(.hide-me) :input:checked").length;
-  var total = $filterPanel.find(".gb-item-filter-group:not(.hide-me) .gb-item-filter :input, .gb-item-category-score-filter:not(.hide-me) :input").length;
-
-  $summary.find(".visible").html(visible);
-  $summary.find(".total").html(total);
-
-  if (visible < total) {
-    $summary.addClass("warn-items-hidden");
-  } else {
-    $summary.removeClass("warn-items-hidden");
-  }
-};
-
-
-GradebookSpreadsheet.prototype.highlightRow = function($row) {
-  this.$spreadsheet.find(".gb-highlighted-row").removeClass("gb-highlighted-row");
-  $row.addClass("gb-highlighted-row");
-  if ($row.closest("tbody").length > 0){
-    $(this.$fixedColumns.find("tr").get($row.index())).addClass("gb-highlighted-row");
-  }
-};
-
-
-GradebookSpreadsheet.prototype.setupRowSelector = function() {
-  this.$table.on("click", '.gb-row-selector', function() {
-    $(this).next().focus();
-  });
-};
-
-
-GradebookSpreadsheet.prototype.hideGradeItemAndSyncToolbar = function(assignmentId) {
-  var $input = this.toolbarModel.$gradeItemsFilterPanel.find(".gb-item-filter :input").filter("[value='"+assignmentId+"']");
-  $input.trigger("click");
-};
-
-
-GradebookSpreadsheet.prototype.setupConcurrencyCheck = function() {
-  var self = this;
-
-  function showConcurrencyNotification(data) {
-    $.each(data, function(i, conflict) {
-      var model = self.getCellModelForStudentAndAssignment(conflict.studentUuid, conflict.assignmentId);
-      var $notification = model.$cell.find(".gb-cell-notification-out-of-date");
-      if ($notification.length == 0) {
-        $notification = $("<span>").addClass("gb-cell-notification").addClass("gb-cell-notification-out-of-date");
-        model.$cell.find("> div").prepend($notification);
-      
-        var $message = $("#gradeItemsConcurrentUserWarning").clone();
-        $message.find(".gb-concurrent-edit-user").html(conflict.lastUpdatedBy);
-        $message.find(".gb-concurrent-edit-time").html(new Date(conflict.lastUpdated).toLocaleTimeString());
-
-        model.$cell.addClass("gb-cell-out-of-date");
-
-        $notification.
-          attr("data-toggle", "popover").
-          data("content", $message.html()).
-          data("placement", "bottom").
-          data("trigger", "focus").
-          data("html", "true").
-          attr("tabindex", 0).
-          data("container", "#gradebookGrades");
-
-        self.enablePopovers(model.$cell);
-      }
-    });
-  };
-
-  function hideConcurrencyNotification() {
-    self.$table.find(".gb-cell-out-of-date").removeClass("gb-cell-out-of-date");
-  };
-
-  function handleConcurrencyCheck(data) {
-    if ($.isEmptyObject(data) || $.isEmptyObject(data.gbng_collection)) {
-      // nobody messing with my..
-      hideConcurrencyNotification();
-      return;
-    }
-
-    // there are *other* people doing things!
-    showConcurrencyNotification(data.gbng_collection);
-  };
-
-  function performConcurrencyCheck() {
-    GradebookAPI.isAnotherUserEditing(self.$table.data("siteid"), self.$table.data("gradestimestamp"), handleConcurrencyCheck);
-  };
-
-  // Check for concurrent editors.. and again every 10 seconds
-  // (note: there's a 10 second cache)
-  performConcurrencyCheck();
-  var concurrencyCheckInterval = setInterval(performConcurrencyCheck, 10 * 1000);
-
-
-  $("#gradeItemsConcurrentUserWarning").on("click", ".gb-message-close", function() {
-    // dismiss the message
-    $("#gradeItemsConcurrentUserWarning").addClass("hide");
-    // and stop checking (they know!)
-    clearInterval(concurrencyCheckInterval);
-  });
-};
-
-
-GradebookSpreadsheet.prototype.setupColoredCategories = function() {
-  var self = this;
-
-  self.toolbarModel.$toolbar.find(".gb-item-filter-group").each(function() {
-    var $group = $(this);
-    var category = $(this).find(".gb-item-category-filter :input").val();
-
-    if(self._CATEGORY_DATA[category]) {
-    	 if (!self._CATEGORY_DATA[category].hasOwnProperty("color")) {
-    	      self._CATEGORY_DATA[category]["color"] = $group.find("[data-category-color]").data("category-color");
-    	 }
-    	 var color = self._CATEGORY_DATA[category].color;
-
-		$group.find(".gb-item-category-filter-signal").
-		       css("backgroundColor", color).
-		       css("borderColor", color);
-    }
-   
-  });
-};
-
-
-GradebookSpreadsheet.prototype.setupStudentFilter = function() {
-  var self = this;
-
-  function applyFilter(query) {
-    self.$spreadsheet.find(".filtered-by-studentFilter").removeClass("filtered-by-studentFilter");
-
-    if (query != "") {
-      var $allStudentLabels = self.$spreadsheet.find("tbody .gb-student-cell .gb-student-label:not(:icontains('"+query+"'))");
-      $allStudentLabels.each(function() {
-        $(this).closest("tr").addClass("filtered-by-studentFilter");
-      });
-    }
-
-    self.refreshStudentSummary();
-  };
-
-  self.$table.on("keyup", ".gb-student-filter :input", function(event) {
-    var query = $(event.target).val();
-    applyFilter(query);
-
-    // update fixed header
-    self.$fixedColumnsHeader.find(".gb-student-filter :input").val(query);
-  });
-
-  self.$table.on("click", "#studentFilterClear", function() {
-    $(this).siblings(":input").val("").trigger("keyup").focus();
-  });
-};
-
-
-GradebookSpreadsheet.prototype.setupMenusAndPopovers = function() {
-  var self = this;
-
-  self._popovers = [];
-
-  function hideAllPopovers() {
-    $.each(self._popovers, function(i, popover) {
-      popover.popover("hide");
-    });
-    self._popovers = [];
-  };
-
-  self.popoverClicked = false;
-
-  self.enablePopovers(self.$table);
-
-  self.$spreadsheet.on("focus", '[data-toggle="popover"]', function(event) {
-    if (self.suppressPopover) {
-      self.suppressPopover = false;
-      return;
-    }
-
-    hideAllPopovers();
-
-    $(event.target).data("popoverShowTimeout", setTimeout(function() {
-      $(event.target).popover('show');
-      self._popovers.push($(event.target));
-    }, 500));
-  });
-
-  self.$spreadsheet.on("click", ".popover", function(event) {
-    self.popoverClicked = true;
-  }).on("click", ":not(.popover)", function(event) {
-    setTimeout(function() {
-      hideAllPopovers();
-    }, 100);
-  }).on("click", ".popover .gb-popover-notification-has-comment .gb-popover-link", function(event) {
-    var $notification = $(event.target).closest(".gb-popover-notification-has-comment");
-    var cell = self.getCellModelForStudentAndAssignment($notification.data("studentuuid"), $notification.data("assignmentid"));
-    cell.$cell.find(".gb-edit-comments").trigger("click");
-    hideAllPopovers();
-  }).on("click", ".popover .gb-popover-close", function(event) {
-    var $link = $(this);
-    var $cellToFocus;
-
-    if ($link.data("studentuuid") && $link.data("assignmentid")) {
-      var cell = self.getCellModelForStudentAndAssignment($link.data("studentuuid"), $link.data("assignmentid"));
-      $cellToFocus = cell.$cell;
-    } else {
-      $cellToFocus = $link.closest("td,th");
-    }
-
-    hideAllPopovers();
-    $cellToFocus.focus();
-  }).on("click", ".popover .gb-revert-score", function(event) {
-    event.preventDefault();
-    var $popover = $(event.target).closest(".popover");
-    var $close = $popover.find(".gb-popover-close");
-    var cell = self.getCellModelForStudentAndAssignment($close.data("studentuuid"), $close.data("assignmentid"));
-    cell._focusAfterSaveComplete = true;
-    cell.$input.trigger("revertscore.sakai");
-    hideAllPopovers();
-  });;
-
-  // close the dropdown if the user navigates away from it
-  self.$spreadsheet.find(".btn-group").on("shown.bs.dropdown", function(event) {
-    var $btnGroup = $(event.target);
-
-    function handleDropdownItemBlur(blurEvent) {
-      if ($(blurEvent.relatedTarget).closest(".btn-group.open").length == 0) {
-        // Firefox will only offer a blurEvent.relatedTarget if the item can be focussed
-        // and links will only be included in the tab index if the user's accessibility
-        // configuration has this option enabled (e.g. accessibility.tabfocus option).
-        // Instead, delay hiding the menu (0.5s is enough) to allow any click events to
-        // hit the link before we force close the menu.
-        setTimeout(function() {
-          if ($btnGroup.is(".open")) {
-            $btnGroup.find(".btn.dropdown-toggle").dropdown("toggle");
-          }
-        }, 500);
-      }
-    };
-
-    $btnGroup.find(".btn.dropdown-toggle").on("mousedown", function(mouseDownEvent) {
-      if ($(mouseDownEvent.target).closest(".btn-group.open").length > 0) {
-        mouseDownEvent.stopPropagation();
-        $(mouseDownEvent.target).focus();
-      }
-      return true;
-    });
-
-    $btnGroup.find("ul.dropdown-menu li a").on("mousedown", function(mouseDownEvent) {
-      mouseDownEvent.stopPropagation();
-      $(mouseDownEvent.target).focus();
-    });
-
-    $btnGroup.find(".btn.dropdown-toggle, ul.dropdown-menu li a").on("blur", handleDropdownItemBlur);
-
-    $btnGroup.one("hidden.bs.dropdown", function() {
-      $btnGroup.find(".btn.dropdown-toggle, ul.dropdown-menu li a").off("blur", handleDropdownItemBlur);
-    });
-  });
-
-  // initialize all dropdown menus
-  self.$spreadsheet.find('.dropdown-toggle').dropdown();
-};
-
-
-GradebookSpreadsheet.prototype.enablePopovers = function($target) {
-  var self = this;
-  var $popovers = $target.find('[data-toggle="popover"]');
-
-  $popovers.popover("destroy");
-
-  $popovers.popover().blur(function(event) {
-    clearTimeout($(event.target).data("popoverShowTimeout"));
-    $(event.target).data("popoverHideTimeout", setTimeout(function() {
-      if (!self.popoverClicked) {
-        $(event.target).popover("hide");
-      }
-    }, 100));
-  }).on("hidden.bs.popover", function() {
-    self.popoverClicked = false;
-  }).on("shown.bs.popover", function(event) {
-    var $popover = $(this).data("bs.popover").$tip;
-    var bottomMostPoint = $popover.position().top + $popover.outerHeight();
-    if (bottomMostPoint > self.$spreadsheet[0].offsetHeight) {
-      self.$spreadsheet[0].scrollTop = bottomMostPoint - self.$spreadsheet[0].offsetHeight + 20;
-    }
-  });
-
-  // Ensure the popover doesn't get in the way of the dropdown menu
-  $popovers.find('.btn-group').on("shown.bs.dropdown", function() {
-    var $popover = $(this).closest('[data-toggle="popover"]');
-    if ($popover.length > 0) {
-      clearTimeout($popover.data("popoverShowTimeout"));
-      $popover.popover("hide");
-    }
-  });
-};
-
-
-GradebookSpreadsheet.prototype.ready = function() {
-  this.$spreadsheet.data("initialized", true);//.trigger("ready.gradebookng");
-  $.each(GradebookSpreadsheet.prototype._callbacks, function(i, callback) {
-    callback();
-  });
-  GradebookSpreadsheet.prototype._callbacks = null;
-}
-
-GradebookSpreadsheet.prototype._callbacks = [];
-
-GradebookSpreadsheet.prototype.onReady = function(callback) {
-  if (this.$spreadsheet.data("initialized") == true) {
-    setTimeout(function() { callback(); });
-  } else {
-    GradebookSpreadsheet.prototype._callbacks.push(callback);
-  }
-};
-
-
-GradebookSpreadsheet.prototype.setupCell = function(cellId, assignmentId, studentUuid) {
-  var cellModel = this.getCellModelForStudentAndAssignment(studentUuid, assignmentId);
-  cellModel.handleSaveComplete(cellId)
-};
-
-
-GradebookSpreadsheet.prototype.findVisibleStudentBefore = function(studentUuid) {
-  var $cell = this.$spreadsheet.find(".gb-student-cell[data-studentuuid='"+studentUuid+"']");
-  var $row = $cell.closest("tr");
-
-  var $targetRow = $row.prevAll(":visible:first");
-  if ($targetRow.length > 0) {
-    return $targetRow.find(".gb-student-cell");
-  } else {
-    return false;
-  }
-};
-
-
-GradebookSpreadsheet.prototype.findVisibleStudentAfter = function(studentUuid) {
-  var $cell = this.$spreadsheet.find(".gb-student-cell[data-studentuuid='"+studentUuid+"']");
-  var $row = $cell.closest("tr");
-
-  var $targetRow = $row.nextAll(":visible:first");
-  if ($targetRow.length > 0) {
-    return $targetRow.find(".gb-student-cell");
-  } else {
-    return false;
-  }
-}
-
-
-GradebookSpreadsheet.prototype.setupNewAssignmentFocus = function() {
-  var self = this;
-
-  var $justCreated = self.$table.find(".gb-just-created");
-
-  if ($justCreated.length > 0) {
-    self.onReady(function() {
-      $justCreated.parent().focus();
-    });
-  }
-};
-
-
-GradebookSpreadsheet.prototype.refreshCourseGradeForStudent = function(studentUuid) {
-  // cell has been updated, so need to refresh the course grade in the fixed column
-  // on the off chance the grade has changed
-  var $studentNameCell = this.$table.find(".gb-student-cell[data-studentuuid='"+studentUuid+"']");
-  var $courseGradeCell = $studentNameCell.closest("tr").find(".gb-course-grade");
-
-  var $fixedColumnStudentNameCell = this.$fixedColumns.find(".gb-student-cell[data-studentuuid='"+studentUuid+"']");
-  var $fixedColumnCourseGradeCell = $fixedColumnStudentNameCell.closest("tr").find(".gb-course-grade");
-
-  var courseGrade = this._cloneCell($courseGradeCell).html();
-  $fixedColumnCourseGradeCell.html(courseGrade);
-  $fixedColumnCourseGradeCell.addClass("gb-score-dynamically-updated");
-
-  this.$spreadsheet.find(".gb-score-dynamically-updated").removeClass("gb-score-dynamically-updated", 1000);
-};
-
-
-GradebookSpreadsheet.prototype.refreshStudentSummary = function() {
-  var $labelCount = this.$spreadsheet.find(".gb-student-summary-counts .visible");
-
-  $labelCount.html(this.$table.find("tbody tr:visible").length);
-};
-
-
-GradebookSpreadsheet.prototype.editAssignmentFromFlag = function(assignmentId) {
-  var $cell = this.getHeaderModelForAssignment(assignmentId).$cell;
-  var $editLink = $cell.find(".edit-assignment-details");
-
-  $editLink.trigger("click");
-  this.$table.find('[data-toggle="popover"]').popover("hide");
-};
-
-
-GradebookSpreadsheet.prototype.positionModalAtTop = function($modal) {
-  // position the modal at the top of the viewport
-  // taking into account the current scroll offset
-  $modal.css('top', 30 + $(window).scrollTop() + "px");
-};
-
-
-GradebookSpreadsheet.prototype.setLiveFeedbackAsSaving = function() {
-  var $liveFeedback = this.$spreadsheet.closest("#gradebookSpreadsheet").find(".gb-live-feedback");
-  $liveFeedback.html($liveFeedback.data("saving-message"));
-  $liveFeedback.show()
-};
-
-
-/*************************************************************************************
- * AbstractCell - behaviour inherited by all cells
- */
-var GradebookAbstractCell = {
-  setupCell: function($cell) {
-    var self = this;
-    self.$cell = $cell;
-    $cell.data("model", this);
-    $cell.on("focus", function(event) {
-      self.gradebookSpreadsheet.ensureCellIsVisible($(event.target));
-      self.gradebookSpreadsheet.highlightRow(self.getRow());
-    });
-  },
-  getRow: function() {
-    return this.$cell.closest("tr");
-  },
-  show: function() {
-    this.$cell.show();
-  },
-  hide: function() {
-    this.$cell.hide();
-  }
-};
-
-
-GradebookSpreadsheet.prototype.getWidth = function() {
-  if (this.width) {
-    return this.width;
-  }
-
-  return this.refreshWidth();
-};
-
-
-GradebookSpreadsheet.prototype.refreshWidth = function() {
-  this.width = this.$spreadsheet.width();
-  return this.width;
-};
-
-
-GradebookSpreadsheet.prototype.setupConnectionPoll = function() {
-  this.ping = new ConnectionPoll($("#gbConnectionTimeoutFeedback"));
-};
-
-/*************************************************************************************
- * GradebookEditableCell - behaviour for editable cells
- */
-function GradebookEditableCell($cell, header, gradebookSpreadsheet) {
-  this.header = header;
-  this.gradebookSpreadsheet = gradebookSpreadsheet;
-  this.$spreadsheet = gradebookSpreadsheet.$spreadsheet;
-
-  this.setupEditableCell($cell);
-};
-
-
-GradebookEditableCell.prototype = Object.create(GradebookAbstractCell);
-
-GradebookEditableCell.prototype.setupEditableCell = function($cell) {
-  this.$input = $cell.find("input.gb-editable-grade:first");
-
-  this.setupCell($cell);
-
-  this.$cell.data("initialValue", null);
-  this.$cell.data("wicket_input_initialized", false).removeClass("gb-cell-editing");
-  this.$cell.data("wicket_label_initialized", true);
-
-  this.setupInput();
-  this.setupMenu();
-};
-
-
-GradebookEditableCell.prototype.setupMenu = function() {
-  var self = this;
-  self.$cell.on("click", ".gb-view-log", function() {
-    self.$input.trigger("viewlog.sakai");
-    self.$cell.find(".dropdown-toggle").dropdown('toggle');
-    return false;
-  })
-  self.$cell.on("click", ".gb-edit-comments", function() {
-    self.$input.trigger("editcomment.sakai");
-    self.$cell.find(".dropdown-toggle").dropdown('toggle');
-    return false;
-  });
-};
-
-
-
-GradebookEditableCell.prototype.isEditable = function() {
-  return true;
-};
-
-
-GradebookEditableCell.prototype.setupInputKeyboardNavigation = function() {
-  var self = this;
-  self.$input.on("keydown", function(event) {
-    // Return 13
-    if (event.keyCode == 13) {
-      // first blur the $input to trigger a change event
-      self.$input.trigger("blur");
-
-      // ask the spreadsheet to navigate based on a return key action
-      self.gradebookSpreadsheet.handleInputReturn(event, self.$cell);
-    // ESC 27
-    } else if (event.keyCode == 27) {
-      self.$cell.focus();
-      self._focusAfterSaveComplete = true;
-
-    // arrow keys
-    } else if (event.keyCode >= 37 && event.keyCode <= 40) {
-      self.gradebookSpreadsheet.handleInputArrowKey(event, self.$cell);
-
-    // TAB 9
-    } else if (event.keyCode == 9) {
-      self.gradebookSpreadsheet.handleInputTab(event, self.$cell);
-    }
-  });
-};
-
-GradebookEditableCell.prototype.setupInput = function() {
-  var self = this;
-
-  if (self.$cell.data("wicket_input_initialized")) {
-    return;
-  }
-
-  function prepareForEdit(event) {
-    self.$cell.addClass("gb-cell-editing");
-    
-    //strip any symbols and put it back into the input field
-    var inputVal = strip(self.$input.val());
-    self.$input.val(inputVal);
-    
-    self.$cell.data("originalValue", self.$input.val());
-
-    var withValue = self.$cell.data("initialValue");
-   
-    if (withValue != null && withValue != "") {
-      self.$input.val(withValue);
-    } else {
-      self.$input.select();
-    }
-
-    // add the "out of XXX marks" label
-    var $outOf = $("<span class='gb-out-of'></span>");
-    $outOf.html(self.getOutOfLabel());
-    self.$input.after($outOf);
-
-    // ensure row is highlighted if triggered from click
-    self.gradebookSpreadsheet.highlightRow(self.getRow());
-  }
-
-  function completeEditing(event) {
-    self.$cell.removeClass("gb-cell-editing");
-    self.$cell.find(".gb-out-of").remove();
-    self.$cell.data("initialValue", null);
-
-    // In Chrome, IE, the "change" event is only triggered after direct user
-    // changes to the input and not after jQuery.val().  So need to ensure
-    // "change" is triggered once when a user or programmatic change is detected.
-    // To get around this, we use a custom event "scorechanged" and trigger this
-    // manually; a Wicket behaviour is bound to this custom event and handles the
-    // the update in the Wicket backend.
-    if (self.$cell.data("originalValue") != self.$input.val()) {
-      self.$cell.data("_pendingReplacement", true);
-      self.$input.trigger("scorechange.sakai");
-    } else {
-      self.$input.val(unstrip(self.$input.val()));
-    }
-  }
-
-  function strip(value) {
-    self.$input.data("unstrippedValue", value);
-    return value.replace('%','');
-  }
-
-  function unstrip(value) {
-    return self.$input.data("unstrippedValue") || value;
-  }
-
-  self.$input.off("focus", prepareForEdit).on("focus", prepareForEdit);
-  self.$input.off("blur", completeEditing).on("blur", completeEditing);
-
-  self.setupInputKeyboardNavigation();
-
-  self.$cell.data("wicket_input_initialized", true);
-};
-
-
-GradebookEditableCell.prototype.getHeaderCell = function() {
-  return this.header.$cell;
-};
-
-
-GradebookEditableCell.prototype.getOutOfLabel = function() {
-  return this.header.$cell.find(".gb-total-points").data("outof-label");
-};
-
-
-GradebookEditableCell.prototype.enterEditMode = function(keyCode) {
-  var self = this;
-
-  var initialValue = "";
-
-  if (keyCode && typeof keyCode == "number") {
-    // only buffer 0-9 key strokes
-    if (keyCode >= 48 && keyCode <= 57) {
-      initialValue = keyCode - 48;
-    } else if (keyCode >= 96 && keyCode <= 105) {
-      initialValue = keyCode - 96;
-    }
-  }
-
-  self.$cell.data("initialValue", initialValue + "");
-  self.$input.focus();
-};
-
-
-GradebookEditableCell.prototype.getWicketAjaxLabel = function() {
-    return this.$cell.find("span[id^='label']");
-};
-
-GradebookEditableCell.prototype.getStudentName = function() {
-  return this.$cell.closest("tr").find(".gb-student-cell").text().trim();
-};
-
-
-GradebookEditableCell.prototype.handleBeforeSave = function() {
-  this.$cell.addClass("gb-cell-saving");
-  this.gradebookSpreadsheet.setLiveFeedbackAsSaving();
-};
-
-
-GradebookEditableCell.prototype.handleSaveComplete = function(cellId) {
-  this.handleWicketCellReplacement(cellId);
-  // ensure fixed headers are aligned correctly after save, as vertical scroll
-  // may change as messages are added/removed from above the grade table
-  setTimeout(function() {
-    // take this off the critical path as we don't want any errors on
-    // the document scroll to stop the spreadsheet working
-    $(document).trigger("scroll");
-  });
-};
-
-
-GradebookEditableCell.prototype.handleWicketCellReplacement = function(cellId) {
-  //bind a timeout to the successful save. An easing would be nice
-  $(".grade-save-success").removeClass("grade-save-success", 1000);
-
-  this.setupEditableCell($("#" + cellId));
-
-  //re-enable popover?
-  if (this.$cell.is('[data-toggle="popover"]')) {
-    this.gradebookSpreadsheet.enablePopovers(this.$cell);
-  }
-
-  if (this._focusAfterSaveComplete) {
-    this.$cell.focus();
-    this._focusAfterSaveComplete = false;
-  }
-};
-
-
-/**************************************************************************************
- * GradebookBasicCell basic cell with basic functions
- */
-function GradebookBasicCell($cell, header, gradebookSpreadsheet) {
-  this.header = header;
-  this.gradebookSpreadsheet = gradebookSpreadsheet;
-
-  this.setupCell($cell);
-};
-
-
-GradebookBasicCell.prototype = Object.create(GradebookAbstractCell);
-
-
-GradebookBasicCell.prototype.isEditable = function() {
-  return false;
-};
-
-
-/**************************************************************************************
- * GradebookHeaderCell basic header cell with basic functions
- */
-function GradebookHeaderCell($cell, gradebookSpreadsheet) {
-  this.gradebookSpreadsheet = gradebookSpreadsheet;
-
-  this.setupCell($cell);
-
-  this.setColumnKey();
-  this.truncateTitle();
-  this.setupTooltip();
-};
-
-
-GradebookHeaderCell.prototype = Object.create(GradebookAbstractCell);
-
-
-GradebookHeaderCell.prototype.isEditable = function() {
-  return false;
-};
-
-
-GradebookHeaderCell.prototype.setColumnKey = function() {
-  var self = this;
-
-  var columnKey;
-  if (self.$cell.hasClass("gb-grade-item-column-cell")) {
-    columnKey = self.$cell.find("[data-assignmentid]").data("assignmentid");
-  } else if (self.$cell.hasClass("gb-category-item-column-cell")) {
-    columnKey = "category_" + self.$cell.find(".gb-title").text().trim();
-  } else if (self.$cell.find(".gb-title").length > 0) {
-    columnKey = self.$cell.find(".gb-title").text().trim();
-  } else {
-    columnKey = self.$cell.find("span:first").text().trim();
-  }
-  self.columnKey = columnKey;
-
-  return columnKey;
-}
-
-
-GradebookHeaderCell.prototype.getTitle = function() {
-  if (self.$cell.hasClass("gb-grade-item-column-cell")) {
-    return this.$cell.find(".gb-title span[title]").attr("title");
-  } else {
-    throw "getTitle not supported yet";
-  }
-};
-
-
-GradebookHeaderCell.prototype.truncateTitle = function() {
-  var self = this;
-
-  if (self.$cell.hasClass("gb-grade-item-column-cell")) {
-    var $title = self.$cell.find(".gb-title");
-    var targetHeight = $title.height();
-    if ($title[0].scrollHeight > targetHeight) {
-      var $titleText = $title.find("span[title]");
-      var words = $titleText.text().split(" ");
-
-      while (words.length > 1) {
-        words = words.slice(0, words.length - 1); // drop a word
-        $titleText.html(words.join(" ") + "&hellip;");
-        if ($title[0].scrollHeight <= targetHeight) {
-          break;
-        }
-      }
-    }
-
-  }
-};
-
-
-GradebookHeaderCell.prototype.getCategory = function() {
-  var category = null;
-
-  if (this.$cell.hasClass("gb-category-item-column-cell")) {
-    category = this.$cell.find("[data-category]").data("category");
-  } else if (this.$cell.hasClass("gb-grade-item-column-cell")) {
-    category = this.getCategoryData() ? this.getCategoryData().label : null;
-  }
-
-  return category || "Uncategorized";
-};
-
-
-GradebookHeaderCell.prototype.getCategoryId = function() {
-  return this.$cell.find("[data-category-id]").data("category-id") || null;
-};
-
-
-GradebookHeaderCell.prototype.getCategoryData = function() {
-  var category_data = null;
-
-  if (this.$cell.hasClass("gb-grade-item-column-cell")) {
-    var $category = this.$cell.find("[data-category]");
-
-    if ($category.length > 0) {
-      category_data = {
-        id: $category.data("category-id"),
-        label: $category.data("category"),
-        weight: $category.data("category-weight"),
-        isExtraCredit: $category.data("category-extra-credit"),
-        order: parseInt($category.data("category-order"))
-      };
-    }
-  }
-
-  return category_data;
-};
-
-
-GradebookHeaderCell.prototype.moveColumnTo = function(newIndex) {
-  var self = this;
-
-  var currentIndex = self.$cell.index();
-
-  if (currentIndex == newIndex) {
-    return; //nothing to do
-  }
-
-  if (currentIndex < newIndex) {
-    // reorder the header cell
-    $(self.getRow().children().get(newIndex)).after(self.$cell);
-
-    // reorder the tbody cells
-    self.gradebookSpreadsheet.$table.find("tbody > tr").each(function() {
-        var $tr = $(this);
-        // match either th or td (as row contains either
-        $tr.find(" > *:eq(" + newIndex + ")").after($tr.find("> *:eq("+currentIndex+")"));
-    });    
-  } else {
-    // reorder the header cell
-    $(self.getRow().children().get(newIndex)).before(self.$cell);
-
-    // reorder the tbody cells
-    self.gradebookSpreadsheet.$table.find("> tbody > tr").each(function() {
-        var $tr = $(this);
-        $tr.find("> *:eq(" + newIndex + ")").before($tr.find("> *:eq("+currentIndex+")"));
-    });
-  }
-};
-
-
-GradebookHeaderCell.prototype.setFixedHeaderCell = function($fixedHeaderCell) {
-  this.$fixedHeaderCell = $fixedHeaderCell;
-};
-
-
-GradebookHeaderCell.prototype.setCategoryCell = function($categoryCell) {
-  this.$categoryCell = $categoryCell;
-};
-
-
-GradebookHeaderCell.prototype.show = function() {
-  this.$cell.show();
-  if (this.$fixedHeaderCell) {
-    this.$fixedHeaderCell.show();
-  }
-  if (this.$categoryCell) {
-    this.$categoryCell.show();
-    var newColspan = parseInt(this.$categoryCell.attr("colspan")) + 1;
-    this.$categoryCell.attr("colspan", newColspan);
-    this.$categoryCell.show();
-  }
-};
-
-
-GradebookHeaderCell.prototype.hide = function() {
-  this.$cell.hide();
-  if (this.$fixedHeaderCell) {
-    this.$fixedHeaderCell.hide();
-  }
-  if (this.$categoryCell) {
-    var newColspan = parseInt(this.$categoryCell.attr("colspan")) - 1;
-    this.$categoryCell.attr("colspan", newColspan);
-    if (newColspan == 0) {
-      this.$categoryCell.hide();
-    }
-  }
-};
-
-
-GradebookHeaderCell.prototype.setupTooltip = function() {
-  if (this.$cell.hasClass("gb-grade-item-column-cell")) {
-    var $title = this.$cell.find(".gb-title > a");
-    var tooltip = $title.attr("title");
-
-    tooltip += " (" + this.getCategory() + ")";
-
-    this.$cell.attr("title", tooltip);
-
-    // remove the $title[@title] so it doesn't conflict with the outer title
-    $title.removeAttr("title");
-  }
-};
-
-
-/**************************************************************************************
- * GradebookToolbar - all the toolbar actions
- */
-
-function GradebookToolbar($toolbar, gradebookSpreadsheet) {
-  this.$toolbar = $toolbar;
-  this.gradebookSpreadsheet = gradebookSpreadsheet;
-  this.$spreadsheet = gradebookSpreadsheet.$spreadsheet;
-  this.setupToggleGradeItems();
-  this.setupToggleCategories();
-}
-
-
-GradebookToolbar.prototype.setupToggleGradeItems = function() {
-  var self = this;
-  self.$gradeItemsFilterPanel = $("<div>").addClass("gb-toggle-grade-items-panel").hide();
-  self.$toolbar.find("#toggleGradeItemsToolbarItem").after(self.$gradeItemsFilterPanel);
-
-  var $button = self.$toolbar.find("#toggleGradeItemsToolbarItem");
-
-  // move the Wicket generated panel into this menu dropdown
-  self.$gradeItemsFilterPanel.append($("#gradeItemsTogglePanel").show());
-
-
-  function repositionPanel() {
-    self.$gradeItemsFilterPanel.css("right", self.gradebookSpreadsheet.getWidth() - ($button.position().left + $button.outerWidth()));
-  };
-
-  var updateSignal = function($label, $input) {
-    var $categoryGroup = $label.closest(".gb-item-filter-group");
-    var $categoryFilter = $categoryGroup.find(".gb-item-category-filter");
-    var category = $categoryFilter.find(":input").val();
-    var myColor = self.gradebookSpreadsheet._CATEGORY_DATA[category].color;
-    var $signal = $label.find(".gb-item-category-filter-signal");
-
-    if ($input.is(":checked")) {
-      $signal.css("backgroundColor", myColor).
-              css("borderColor", myColor);
-    } else {
-      $signal.css("backgroundColor", "#FFF").
-              css("borderColor", myColor);
-    }
-  };
-
-  var updateCategoryFilterState = function($itemFilter) {
-    var $group = $itemFilter.closest(".gb-item-filter-group");
-    var $label = $group.find(".gb-item-category-filter label");
-    var $input = $group.find(".gb-item-category-filter input");
-
-    var checkedItemFilters = $group.find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked").length;
-    var itemFilters = $group.find(".gb-item-filter :input, .gb-item-category-score-filter :input").length;
-
-    $label.find(".gradebook-filter-partial-signal").remove();
-    if (checkedItemFilters == 0) {
-      $input.prop("checked", false);
-    } else if (checkedItemFilters == itemFilters) {
-      $input.prop("checked", true);
-    } else {
-      $input.prop("checked", false);
-      $label.find(".gb-item-category-filter-signal").append($("<span>").addClass("gradebook-filter-partial-signal"));
-    }
-
-    updateSignal($label, $input);
-    refreshDependants();
-  };
-
-
-  function handleCategoryFilterStateChange(event) {
-    var $input = $(event.target);
-    var $label = $input.closest("label");
-    var $filter = $input.closest(".gb-item-category-filter");
-
-    // toggle all columns in this category
-    if ($input.is(":checked")) {
-      $filter.removeClass("off");
-      // show all
-      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:not(:checked), .gb-item-category-score-filter :input:not(:checked)").trigger("click");
-    } else {
-      $filter.addClass("off");
-      // hide all
-      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked").trigger("click");
-    }
-
-    updateCategoryFilterState($input);
-    refreshDependants();
-  };
-
-
-  function handleGradeItemFilterStateChange(event) {
-    var $input = $(event.target);
-    var $label = $input.closest("label");
-    var $filter = $input.closest(".gb-item-filter");
-
-    var assignmentId = $input.val();
-
-    if ($input.is(":checked")) {
-      $filter.removeClass("off");
-      self.gradebookSpreadsheet.showGradeItemColumn(assignmentId);
-    } else {
-      $filter.addClass("off");
-      self.gradebookSpreadsheet.hideGradeItemColumn(assignmentId);
-    }
-
-    updateSignal($label, $input);
-    updateCategoryFilterState($input);
-    refreshDependants();
-  };
-
-
-  function handleCategoryScoreFilterStateChange(event) {
-    var $input = $(event.target);
-    var $label = $input.closest("label");
-    var $filter = $input.closest(".gb-item-category-score-filter");
-
-    var category = $input.val();
-
-    if ($input.is(":checked")) {
-      self.gradebookSpreadsheet.showCategoryScoreColumn(category);
-      $filter.removeClass("off");
-    } else {
-      self.gradebookSpreadsheet.hideCategoryScoreColumn(category);
-      $filter.addClass("off");
-    }
-
-    updateSignal($label, $input);
-    updateCategoryFilterState($input);
-  }
-
-
-  function handleShowAll() {
-    self.$gradeItemsFilterPanel.find(".gb-item-category-filter :input:not(:checked)").trigger("click");
-  };
-
-
-  function handleHideAll() {
-    self.$gradeItemsFilterPanel.find(".gb-item-category-filter :input:checked").trigger("click");
-  };
-
-
-  function handleShowOnlyThisCategory($filter) {
-    var $input = $filter.find(":input");
-    var $label = $filter.find("label");
-
-    self.$gradeItemsFilterPanel.
-        find(".gb-item-category-filter :input:checked:not([value="+$input.val()+"])").
-        trigger("click");
-
-    if ($input.is(":not(:checked)")) {
-      $label.trigger("click");
-    } else {
-      $input.closest(".gb-item-filter-group").find(".gb-item-filter :input:not(:checked), .gb-item-category-score-filter :input:not(:checked)").trigger("click");
-    }
-  };
-
-
-  function handleShowOnlyThisItem($filter) {
-    var $input = $filter.find(":input");
-    var $label = $filter.find("label");
-
-    self.$gradeItemsFilterPanel.
-        find(".gb-item-filter :input:checked:not(#"+$input.attr("id")+"), .gb-item-category-score-filter :input:checked").
-        trigger("click");
-
-    if ($input.is(":not(:checked)")) {
-      $label.trigger("click");
-    }
-  };
-
-
-  function handleShowOnlyThisCategoryScore($filter) {
-    var $input = $filter.find(":input");
-    var $label = $filter.find("label");
-
-    self.$gradeItemsFilterPanel.
-        find(".gb-item-filter :input:checked, .gb-item-category-score-filter :input:checked:not(#"+$input.attr("id")+")").
-        trigger("click");
-
-    if ($input.is(":not(:checked)")) {
-      $label.trigger("click");
-    }
-  };
-
-
-  function refreshDependants() {
-    // Use a timeout to ensure summary and the visual cue
-    // is only run once when a column or columns are hidden
-    if (self._refreshTimeout) {
-      clearTimeout(self._refreshTimeout);
-    }
-    self._refreshTimeout = setTimeout(function() {
-      self.gradebookSpreadsheet.refreshSummary();
-      self.gradebookSpreadsheet.refreshHiddenVisualCue();
-      self.gradebookSpreadsheet.refreshFixedTableHeader();
-    });
-  };
-
-
-  $button.on("click", function(event) {
-    event.preventDefault();
-
-    $button.toggleClass("on");
-
-    if ($button.hasClass("on")) {
-      repositionPanel();
-      $button.attr("aria-expanded", "true");
-      self.$gradeItemsFilterPanel.show().attr("aria-hidden", "false");
-    } else {
-      $button.attr("aria-expanded", "false");
-      self.$gradeItemsFilterPanel.hide().attr("aria-hidden", "true");
-    }
-
-    // Support click outside menu panel to close panel
-    function hidePanelOnOuterClick(mouseDownEvent) {
-      if ($(mouseDownEvent.target).closest(".gb-toggle-grade-items-panel, #toggleGradeItemsToolbarItem").length == 0) {
-        $button.removeClass("on");
-        $button.attr("aria-expanded", "false");
-        self.$gradeItemsFilterPanel.hide().attr("aria-hidden", "true");
-        $(document).off("mousedown", hidePanelOnOuterClick);
-      }
-    };
-    $(document).on("mousedown", hidePanelOnOuterClick);
-
-    return false;
-  });
-
-  $button.on("keydown", function(event) {
-    // up arrow hides menu
-    if (event.keyCode == 38) {
-      if (self.$gradeItemsFilterPanel.is(":visible")) {
-        $(this).trigger("click");
-        return false;
-      }
-    // down arrow shows menu or focuses first item in menu
-    } else if (event.keyCode == 40) {
-      if (self.$gradeItemsFilterPanel.is(":not(:visible)")) {
-        $(this).trigger("click");
-      } else {
-        self.$gradeItemsFilterPanel.find("a:first").focus();
-      }
-      return false;
-    }
-  });
-
-  self.$gradeItemsFilterPanel.
-        on("click", "#showAllGradeItems", function() {
-          handleShowAll();
-          $(this).focus();
-        }).
-        on("click", "#hideAllGradeItems", function() {
-          handleHideAll();
-          $(this).focus();
-        }).
-        on("click", ".gb-show-only-this-category", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-category-filter");
-          handleShowOnlyThisCategory($filter);
-          $(this).focus();
-        }).
-        on("click", ".gb-show-only-this-item", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-filter");
-          handleShowOnlyThisItem($filter);
-          $(this).focus();
-        }).
-        on("click", ".gb-show-only-this-category-score", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-category-score-filter");
-          handleShowOnlyThisCategoryScore($filter);
-          $(this).focus();
-        }).
-        on("click", ".gb-toggle-this-category", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-category-filter");
-          $filter.find(":input").trigger("click");
-          $(this).focus();
-        }).
-        on("click", ".gb-toggle-this-item", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-filter");
-          $filter.find(":input").trigger("click");
-          $(this).focus();
-        }).
-        on("click", ".gb-toggle-this-category-score", function(event) {
-          event.preventDefault();
-
-          var $filter = $(event.target).closest(".gb-item-category-score-filter");
-          $filter.find(":input").trigger("click");
-          $(this).focus();
-        });
-
-  // any labels or action links will be included in the arrow navigation
-  // we won't include dropdown toggles for this.. can get to those with tab keys
-  var $menuItems = self.$gradeItemsFilterPanel.find("#hideAllGradeItems, #showAllGradeItems, label[role='menuitem']");
-  $menuItems.on("keydown", function(event) {
-    var $this = $(this);
-    var currentIndex = $menuItems.index($this);
-
-    // up arrow navigates up or back to button
-    if (event.keyCode == 38) {
-      if (currentIndex == 0) {
-        $button.focus();
-      } else {
-        $menuItems[currentIndex-1].focus();
-      }
-      return false;
-    // down arrow navigates down list
-    } else if (event.keyCode == 40) {
-      if (currentIndex + 1 < $menuItems.length) {
-        $menuItems[currentIndex+1].focus();
-        return false;
-      }
-
-    // if return then treat as click
-    } else if (event.keyCode == 13) {
-      $this.trigger("click");
-      return false;
-    }
-
-    return true;
-  });
-
-  self.$gradeItemsFilterPanel.find(".gb-item-category-filter :input").on("change", handleCategoryFilterStateChange);
-  self.$gradeItemsFilterPanel.find(".gb-item-filter :input").on("change", handleGradeItemFilterStateChange);
-  self.$gradeItemsFilterPanel.find(".gb-item-category-score-filter :input").on("change", handleCategoryScoreFilterStateChange);
-
-  // Reinstate hidden columns
-  self.gradebookSpreadsheet.onReady(function() {
-    self.$gradeItemsFilterPanel.find(":input:not(:checked)").trigger("change");
-  });
-};
-
-
-GradebookToolbar.prototype.setupToggleCategories = function() {
-  var self = this;
-  self.gradebookSpreadsheet.onReady(function() {
-      if ($("#toggleCategoriesToolbarItem").hasClass("on")) {
-        self.gradebookSpreadsheet.enableGroupByCategory();
-      }
-  });
-};
-
-
-/**************************************************************************************
- * GradebookAPI - all the backend calls in one happy place
- */
-GradebookAPI = {};
-
-
-GradebookAPI.isAnotherUserEditing = function(siteId, timestamp, onSuccess, onError) {
-  var endpointURL = "/direct/gbng/isotheruserediting/" + siteId + ".json";
-  var params = {
-    since: timestamp,
-    auto: true // indicate that the request is automatic, not from a user action
-  };
-  GradebookAPI._GET(endpointURL, params, onSuccess, onError);
-};
-
-
-GradebookAPI.updateAssignmentOrder = function(siteId, assignmentId, order, onSuccess, onError) {
-  GradebookAPI._POST("/direct/gbng/assignment-order", {
-                                                        siteId: siteId,
-                                                        assignmentId: assignmentId,
-                                                        order: order
-                                                      })
-};
-
-
-GradebookAPI.updateCategorizedAssignmentOrder = function(siteId, assignmentId, categoryId, order, onSuccess, onError) {
-  GradebookAPI._POST("/direct/gbng/categorized-assignment-order", {
-                                                        siteId: siteId,
-                                                        assignmentId: assignmentId,
-                                                        categoryId: categoryId,
-                                                        order: order
-                                                      })
-};
-
-
-GradebookAPI._GET = function(url, data, onSuccess, onError, onComplete) {
-  $.ajax({
-    type: "GET",
-    url: url,
-    data: data,
-    cache: false,
-    success: onSuccess || $.noop,
-    error: onError || $.noop,
-    complete: onComplete || $.noop
-  });
-};
-
-
-GradebookAPI._POST = function(url, data, onSuccess, onError, onComplete) {
-  $.ajax({
-    type: "POST",
-    url: url,
-    data: data,
-    success: onSuccess || $.noop,
-    error: onError || $.noop,
-    complete: onComplete || $.noop
-  });
-};
-
-
-/**************************************************************************************
- * GradebookWicketEventProxy - proxy any Wicket events to the Gradebook Spreadsheet
- */
-
-GradebookWicketEventProxy = {
-  updateGradeItem: {
-    handlePrecondition: $.noop,
-    handleBeforeSend: function(cellId, attrs, jqXHR, settings) {
-      var model = sakai.gradebookng.spreadsheet.getCellModelForWicketParams(attrs.ep);
-      model.handleBeforeSave && model.handleBeforeSave();
-    },
-    handleSuccess: $.noop,
-    handleFailure: $.noop,
-    handleComplete: function(cellId, attrs, jqXHR, textStatus) {
-      var model = sakai.gradebookng.spreadsheet.getCellModelForWicketParams(attrs.ep);
-      model.handleSaveComplete && model.handleSaveComplete(cellId);
-    }
-  },
-  revertGradeItem: {
-    handleComplete: function(cellId, attrs, jqXHR, textStatus) {
-      var model = sakai.gradebookng.spreadsheet.getCellModelForWicketParams(attrs.ep);
-      model.handleWicketCellReplacement && model.handleWicketCellReplacement(cellId);
-    }
-  }
-};
-
-
-/**************************************************************************************
- * jQuery extension to support case-insensitive :contains
- */
-(function( $ ) {
-  function icontains( elem, text ) {
-      return (
-          elem.textContent ||
-          elem.innerText ||
-          $( elem ).text() ||
-          ""
-      ).toLowerCase().indexOf( (text || "").toLowerCase() ) > -1;
-  };
-
-  $.expr[':'].icontains = $.expr.createPseudo ?
-      $.expr.createPseudo(function( text ) {
-          return function( elem ) {
-              return icontains( elem, text );
-          };
-      }) :
-      function( elem, i, match ) {
-          return icontains( elem, match[3] );
-      };
-
-})( jQuery );
-
-
-/**************************************************************************************
- *                    Connection Poll Javascript                                       
- *************************************************************************************/
-function ConnectionPoll($message) {
-    this.PING_INTERVAL = 1000*5; // 5 seconds
-    this.PING_TIMEOUT = 1000*10; // 10 seconds
-    this.PING_URL = "/direct/gbng/ping";
-
-    this.$message = $message;
-
-    this.poll();
-};
-
-
-ConnectionPoll.prototype.poll = function() {
-  var self = this;
-
-  self._interval = setInterval(function() {
-    self.ping();
-  }, self.PING_INTERVAL);
-};
-
-
-ConnectionPoll.prototype.ping = function() {
-  $.ajax({
-    type: "GET",
-    url: this.PING_URL,
-    data: {
-      auto: true // indicate that the request is automatic, not from a user action
-    },
-    timeout: this.PING_TIMEOUT,
-    cache: false,
-    success: $.proxy(this.onSuccess, this),
-    error: $.proxy(this.onTimeout, this)
-  });
-};
-
-ConnectionPoll.prototype.onTimeout = function() {
-  this.$message.show();
-};
-
-ConnectionPoll.prototype.onSuccess = function() {
-  this.$message.hide();
-};
-
-
-/**************************************************************************************
- * Let's initialize our GradebookSpreadsheet 
- */
-var start;
-$(function() {
-  start = Date.now();
-  sakai.gradebookng = {
-    spreadsheet: new GradebookSpreadsheet($("#gradebookGrades"))
-  };
-});
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-help-popup.js b/gradebookng/tool/src/webapp/scripts/gradebook-help-popup.js
new file mode 100644
index 0000000000..e2453241af
--- /dev/null
+++ b/gradebookng/tool/src/webapp/scripts/gradebook-help-popup.js
@@ -0,0 +1,118 @@
+function GradebookHelpPopup() {
+    this.siteid = $("#gradebookSpreadsheet").data('siteid');
+    this.checkIfShouldShowPopup();
+}
+
+
+GradebookHelpPopup.prototype.isHelpLinkPresent = function() {
+    return this.getHelpLink().length > 0;
+};
+
+
+GradebookHelpPopup.prototype.getHelpLink = function() {
+    return $('.Mrphs-toolTitleNav__link.Mrphs-toolTitleNav__link--help-popup');
+};
+
+
+GradebookHelpPopup.prototype.checkIfShouldShowPopup = function() {
+    var self = this;
+
+    if (!self.isHelpLinkPresent()) {
+        // no help link!
+        return;
+    }
+
+    if (self.isSoftlyDismissed()) {
+        // cookie says we're dismissed for this session!
+        return;
+    }
+
+    $.ajax('/direct/gbng/show-help-popup', {
+        method: 'GET',
+        data: {
+            siteId: self.siteid
+        },
+        cache: false,
+        success: function(result) {
+            if (result == 'true') {
+                self.showPopup();
+            } else {
+                // ensure the popup checks only won't happen again until the session expires 
+                document.cookie = "gradebookng-help-popup=dismissed; path=/"
+            }
+        }
+    });
+};
+
+
+GradebookHelpPopup.prototype.showPopup = function() {
+    var self = this;
+
+    var $mask = $('<div>').attr('id', 'gradebookHelpMask');
+
+    var $popup = $('<div>').attr('id', 'gradebookHelpPopup');
+    $popup.append('<a href="javascript:void()" class="gradebookHelpSoftDismiss" aria-label="Close this popup"><i class="fa fa-times" aria-hidden="true"></i></a>');
+    $popup.append('<h3>Welcome to the new Gradebook</h3>');
+    $popup.append('<p>Spreadsheet-style grade entry, student grade summary views, improved usability and more.</p>');
+    $popup.append('<p>Click the <strong>Help for this tool</strong> button above to learn more.</p>');
+
+    $popup.attr('role', 'dialog');
+
+    var $actions = $('<div>').addClass('help-popup-actions');
+    $actions.append($('<button class="button">Remind me later</button>').addClass('gradebookHelpSoftDismiss'));
+    $actions.append($('<button class="button_color">Ok, got it</button>').addClass('gradebookHelpHardDismiss'));
+
+    $popup.append($actions);
+
+    $(".Mrphs-sakai-gradebookng").prepend($popup);
+    $(document.body).prepend($mask);
+
+    $popup.on('click', '.gradebookHelpHardDismiss', function(event) {
+        $popup.remove();
+        $mask.remove();
+        self.hardDismissPopup();
+    }).on('click', '.gradebookHelpSoftDismiss', function(event) {
+        $popup.remove();
+        $mask.remove();
+        self.softlyDismissPopup();
+    });
+
+    $mask.on('click', function() {
+        $popup.remove();
+        $mask.remove();
+        self.softlyDismissPopup();
+    });
+};
+
+
+GradebookHelpPopup.prototype.hardDismissPopup = function() {
+    var self = this;
+
+    // hide forevermore
+    $.ajax('/direct/gbng/dismiss-help-popup', {
+        method: 'POST',
+        data: {
+            siteId: self.siteid
+        }
+    });
+
+    // ensure the popup checks only won't happen again until the session expires 
+    document.cookie = "gradebookng-help-popup=dismissed; path=/"
+};
+
+
+GradebookHelpPopup.prototype.softlyDismissPopup = function() {
+    var timeToBeDismissed = 60*60*24; // hide for the 24 hours
+    document.cookie = "gradebookng-help-popup=dismissed; path=/; max-age=" + timeToBeDismissed;
+};
+
+
+GradebookHelpPopup.prototype.isSoftlyDismissed = function() {
+    var cookieValue = document.cookie.replace(/(?:(?:^|.*;\s*)gradebookng-help-popup\s*\=\s*([^;]*).*$)|^.*$/, "$1");
+    return cookieValue == 'dismissed';
+};
+
+
+$(document).ready(function() {
+    new GradebookHelpPopup();
+});
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/scripts/gradebook-sorter.js b/gradebookng/tool/src/webapp/scripts/gradebook-sorter.js
new file mode 100644
index 0000000000..34572bc7e8
--- /dev/null
+++ b/gradebookng/tool/src/webapp/scripts/gradebook-sorter.js
@@ -0,0 +1,91 @@
+/**************************************************************************************
+ *                    Gradebook Sorter Javascript                                      
+ *************************************************************************************/
+function GradebookSorter($container) {
+  this.$container = $container;
+
+  if ($container.hasClass("by-category")) {
+    this.setupByCategorySorting();
+  } else if ($container.hasClass("by-grade-item")) {
+    this.setupByGradeItemSorting();
+  }
+
+  this.setupSortButtons();
+};
+
+GradebookSorter.prototype.setupByCategorySorting = function() {
+  var self = this;
+
+  $(".gb-sorter-category ul", this.$container).each(function() {
+    $(this).sortable({
+      axis: "y",
+      placeholder: "gb-sorter-placeholder",
+      forcePlaceholderSize: true,
+      stop: self.updateHiddenInputValues
+    });
+  });
+};
+
+GradebookSorter.prototype.setupByGradeItemSorting = function() {
+  var self = this;
+
+  $("ul", this.$container).each(function() {
+    $(this).sortable({
+      axis: "y",
+      placeholder: "gb-sorter-placeholder",
+      forcePlaceholderSize: true,
+      stop: self.updateHiddenInputValues
+    });
+  });
+};
+
+GradebookSorter.prototype.updateHiddenInputValues = function(event, ui) {
+  var $ul = $(ui.item).closest("ul");
+
+  $ul.find("li").each(function(i, li) {
+    var $li = $(li);
+    $li.find(":input[name$='[order]']").val(i);
+  });
+};
+
+GradebookSorter.prototype.setupSortButtons = function() {
+  var self = this;
+
+  self.$container.on("click", ".gb-sort-up", function(event) {
+    event.preventDefault();
+
+    var $btn = $(this);
+
+    // move current <li> up one
+    var $li = $btn.closest("li");
+    $li.insertBefore($li.prev('li'));
+
+    self.updateHiddenInputValues(event, {
+      item: $li
+    });
+
+    if ($btn.is(":visible")) {
+      $btn.focus();
+    } else {
+      $btn.siblings(".gb-sort-down").focus();
+    }
+  }).on("click", ".gb-sort-down", function(event) {
+    event.preventDefault();
+
+    var $btn = $(this);
+
+    // move current <li> up one
+    var $li = $btn.closest("li");
+    $li.insertAfter($li.next('li'));
+
+    self.updateHiddenInputValues(event, {
+      item: $li
+    });
+
+    if ($btn.is(":visible")) {
+      $btn.focus();
+    } else {
+      $btn.siblings(".gb-sort-up").focus();
+    }
+  });
+};
diff --git a/gradebookng/tool/src/webapp/scripts/handsontable.full.min.js b/gradebookng/tool/src/webapp/scripts/handsontable.full.min.js
new file mode 100644
index 0000000000..56bc487b84
--- /dev/null
+++ b/gradebookng/tool/src/webapp/scripts/handsontable.full.min.js
@@ -0,0 +1,88 @@
+/*!
+(The MIT License)
+
+Copyright (c) 2012-2014 Marcin Warpechowski
+Copyright (c) 2015 Handsoncode sp. z o.o. <hello@handsoncode.net>
+
+Permission is hereby granted, free of charge, to any person obtaining
+a copy of this software and associated documentation files (the
+'Software'), to deal in the Software without restriction, including
+without limitation the rights to use, copy, modify, merge, publish,
+distribute, sublicense, and/or sell copies of the Software, and to
+permit persons to whom the Software is furnished to do so, subject to
+the following conditions:
+
+The above copyright notice and this permission notice shall be
+included in all copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
+EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
+IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
+CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
+TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
+SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+*/
+!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Handsontable=e()}}(function(){var e;return function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!l&&u)return u(a,!0);if(i)return i(a,!0);if(s[a]&&"undefined"!=typeof window[s[a]])return window[s[a]];var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,s=JSON.parse('{"zeroclipboard":"ZeroClipboard","moment":"moment","numbro":"numbro","pikaday":"Pikaday"}')||{},a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){},{}],2:[function(e,t,n){window.jQuery&&!function(e){e.fn.handsontable=function(e){var t,n,o,r,i,s=this.first(),a=s.data("handsontable");if("string"!=typeof e)return i=e||{},a?a.updateSettings(i):(a=new Handsontable.Core(s[0],i),s.data("handsontable",a),a.init()),s;if(o=[],arguments.length>1)for(t=1,n=arguments.length;t<n;t++)o.push(arguments[t]);if(a){if("undefined"==typeof a[e])throw new Error("Handsontable do not provide action: "+e);r=a[e].apply(a,o),"destroy"===e&&s.removeData()}return r}}(window.jQuery)},{}],3:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableBorder:{get:function(){return C}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),c=u.getComputedStyle,d=u.getTrimmingContainer,h=u.innerWidth,f=u.innerHeight,p=u.offset,m=u.outerHeight,g=u.outerWidth,w=(r=e("helpers/dom/event"),r&&r.__esModule&&r||{default:r}).stopImmediatePropagation,v=(i=e("helpers/browser"),i&&i.__esModule&&i||{default:i}).isMobileBrowser,y=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).EventManager,b=(a=e("cell/coords"),a&&a.__esModule&&a||{default:a}).WalkontableCellCoords,C=((l=e("overlay/_base.js"),l&&l.__esModule&&l||{default:l}).WalkontableOverlay,function(e,t){t&&(this.eventManager=new y(e),this.instance=e,this.wot=e,this.settings=t,this.mouseDown=!1,this.main=null,this.top=null,this.left=null,this.bottom=null,this.right=null,this.topStyle=null,this.leftStyle=null,this.bottomStyle=null,this.rightStyle=null,this.cornerDefaultStyle={width:"5px",height:"5px",borderWidth:"2px",borderStyle:"solid",borderColor:"#FFF"},this.corner=null,this.cornerStyle=null,this.createBorders(t),this.registerListeners())});$traceurRuntime.createClass(C,{registerListeners:function(){var e=this;this.eventManager.addEventListener(document.body,"mousedown",function(){return e.onMouseDown()}),this.eventManager.addEventListener(document.body,"mouseup",function(){return e.onMouseUp()});for(var t=this,n=function(n,o){t.eventManager.addEventListener(t.main.childNodes[n],"mouseenter",function(t){return e.onMouseEnter(t,e.main.childNodes[n])})},o=0,r=this.main.childNodes.length;o<r;o++)n(o,r)},onMouseDown:function(){this.mouseDown=!0},onMouseUp:function(){this.mouseDown=!1},onMouseEnter:function(e,t){function n(e){return e.clientY<Math.floor(i.top)||(e.clientY>Math.ceil(i.top+i.height)||(e.clientX<Math.floor(i.left)||(e.clientX>Math.ceil(i.left+i.width)||void 0)))}function o(e){n(e)&&(r.eventManager.removeEventListener(document.body,"mousemove",o),t.style.display="block")}if(this.mouseDown&&this.wot.getSetting("hideBorderOnMouseDownOver")){e.preventDefault(),w(e);var r=this,i=t.getBoundingClientRect();t.style.display="none",this.eventManager.addEventListener(document.body,"mousemove",o)}},createBorders:function(e){this.main=document.createElement("div");var t=["top","left","bottom","right","corner"],n=this.main.style;n.position="absolute",n.top=0,n.left=0;for(var o=0;o<5;o++){var r=t[o],i=document.createElement("div");i.className="wtBorder "+(this.settings.className||""),this.settings[r]&&this.settings[r].hide&&(i.className+=" hidden"),n=i.style,n.backgroundColor=this.settings[r]&&this.settings[r].color?this.settings[r].color:e.border.color,n.height=this.settings[r]&&this.settings[r].width?this.settings[r].width+"px":e.border.width+"px",n.width=this.settings[r]&&this.settings[r].width?this.settings[r].width+"px":e.border.width+"px",this.main.appendChild(i)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.topStyle=this.top.style,this.leftStyle=this.left.style,this.bottomStyle=this.bottom.style,this.rightStyle=this.right.style,this.corner=this.main.childNodes[4],this.corner.className+=" corner",this.cornerStyle=this.corner.style,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.height=this.cornerDefaultStyle.height,this.cornerStyle.border=[this.cornerDefaultStyle.borderWidth,this.cornerDefaultStyle.borderStyle,this.cornerDefaultStyle.borderColor].join(" "),v()&&this.createMultipleSelectorHandles(),this.disappear(),this.wot.wtTable.bordersHolder||(this.wot.wtTable.bordersHolder=document.createElement("div"),this.wot.wtTable.bordersHolder.className="htBorders",this.wot.wtTable.spreader.appendChild(this.wot.wtTable.bordersHolder)),this.wot.wtTable.bordersHolder.insertBefore(this.main,this.wot.wtTable.bordersHolder.firstChild)},createMultipleSelectorHandles:function(){this.selectionHandles={topLeft:document.createElement("DIV"),topLeftHitArea:document.createElement("DIV"),bottomRight:document.createElement("DIV"),bottomRightHitArea:document.createElement("DIV")};var e=10,t=40;this.selectionHandles.topLeft.className="topLeftSelectionHandle",this.selectionHandles.topLeftHitArea.className="topLeftSelectionHandle-HitArea",this.selectionHandles.bottomRight.className="bottomRightSelectionHandle",this.selectionHandles.bottomRightHitArea.className="bottomRightSelectionHandle-HitArea",this.selectionHandles.styles={topLeft:this.selectionHandles.topLeft.style,topLeftHitArea:this.selectionHandles.topLeftHitArea.style,bottomRight:this.selectionHandles.bottomRight.style,bottomRightHitArea:this.selectionHandles.bottomRightHitArea.style};var n={position:"absolute",height:t+"px",width:t+"px","border-radius":parseInt(t/1.5,10)+"px"};for(var o in n)n.hasOwnProperty(o)&&(this.selectionHandles.styles.bottomRightHitArea[o]=n[o],this.selectionHandles.styles.topLeftHitArea[o]=n[o]);var r={position:"absolute",height:e+"px",width:e+"px","border-radius":parseInt(e/1.5,10)+"px",background:"#F5F5FF",border:"1px solid #4285c8"};for(var i in r)r.hasOwnProperty(i)&&(this.selectionHandles.styles.bottomRight[i]=r[i],this.selectionHandles.styles.topLeft[i]=r[i]);this.main.appendChild(this.selectionHandles.topLeft),this.main.appendChild(this.selectionHandles.bottomRight),this.main.appendChild(this.selectionHandles.topLeftHitArea),this.main.appendChild(this.selectionHandles.bottomRightHitArea)},isPartRange:function(e,t){return!(!this.wot.selections.area.cellRange||e==this.wot.selections.area.cellRange.to.row&&t==this.wot.selections.area.cellRange.to.col)},updateMultipleSelectionHandlesPosition:function(e,t,n,o,r,i){var s=parseInt(this.selectionHandles.styles.topLeft.width,10),a=parseInt(this.selectionHandles.styles.topLeftHitArea.width,10);this.selectionHandles.styles.topLeft.top=parseInt(n-s,10)+"px",this.selectionHandles.styles.topLeft.left=parseInt(o-s,10)+"px",this.selectionHandles.styles.topLeftHitArea.top=parseInt(n-a/4*3,10)+"px",this.selectionHandles.styles.topLeftHitArea.left=parseInt(o-a/4*3,10)+"px",this.selectionHandles.styles.bottomRight.top=parseInt(n+i,10)+"px",this.selectionHandles.styles.bottomRight.left=parseInt(o+r,10)+"px",this.selectionHandles.styles.bottomRightHitArea.top=parseInt(n+i-a/4,10)+"px",this.selectionHandles.styles.bottomRightHitArea.left=parseInt(o+r-a/4,10)+"px",this.settings.border.multipleSelectionHandlesVisible&&this.settings.border.multipleSelectionHandlesVisible()?(this.selectionHandles.styles.topLeft.display="block",this.selectionHandles.styles.topLeftHitArea.display="block",this.isPartRange(e,t)?(this.selectionHandles.styles.bottomRight.display="none",this.selectionHandles.styles.bottomRightHitArea.display="none"):(this.selectionHandles.styles.bottomRight.display="block",this.selectionHandles.styles.bottomRightHitArea.display="block")):(this.selectionHandles.styles.topLeft.display="none",this.selectionHandles.styles.bottomRight.display="none",this.selectionHandles.styles.topLeftHitArea.display="none",this.selectionHandles.styles.bottomRightHitArea.display="none"),e==this.wot.wtSettings.getSetting("fixedRowsTop")||t==this.wot.wtSettings.getSetting("fixedColumnsLeft")?(this.selectionHandles.styles.topLeft.zIndex="9999",this.selectionHandles.styles.topLeftHitArea.zIndex="9999"):(this.selectionHandles.styles.topLeft.zIndex="",this.selectionHandles.styles.topLeftHitArea.zIndex="")},appear:function(e){if(!this.disabled){var t,n,o,r,i,s,a,l,u,w,y,C,_,R,S,E,M,T,O;O=this.wot.wtTable.getRenderedRowsCount();for(var k=0;k<O;k++){var x=this.wot.wtTable.rowFilter.renderedToSource(k);if(x>=e[0]&&x<=e[2]){_=x;break}}for(var H=O-1;H>=0;H--){var D=this.wot.wtTable.rowFilter.renderedToSource(H);if(D>=e[0]&&D<=e[2]){S=D;break}}O=this.wot.wtTable.getRenderedColumnsCount();for(var A=0;A<O;A++){var P=this.wot.wtTable.columnFilter.renderedToSource(A);if(P>=e[1]&&P<=e[3]){R=P;break}}for(var N=O-1;N>=0;N--){var L=this.wot.wtTable.columnFilter.renderedToSource(N);if(L>=e[1]&&L<=e[3]){E=L;break}}if(void 0===_||void 0===R)return void this.disappear();t=_!==S||R!==E,n=this.wot.wtTable.getCell(new b(_,R)),o=t?this.wot.wtTable.getCell(new b(S,E)):n,r=p(n),i=t?p(o):r,s=p(this.wot.wtTable.TABLE),l=r.top,y=i.top+m(o)-l,w=r.left,C=i.left+g(o)-w,a=l-s.top-1,u=w-s.left-1;var W=c(n);parseInt(W.borderTopWidth,10)>0&&(a+=1,y=y>0?y-1:0),parseInt(W.borderLeftWidth,10)>0&&(u+=1,C=C>0?C-1:0),this.topStyle.top=a+"px",this.topStyle.left=u+"px",this.topStyle.width=C+"px",this.topStyle.display="block",this.leftStyle.top=a+"px",this.leftStyle.left=u+"px",this.leftStyle.height=y+"px",this.leftStyle.display="block";var I=Math.floor(this.settings.border.width/2);this.bottomStyle.top=a+y-I+"px",this.bottomStyle.left=u+"px",this.bottomStyle.width=C+"px",this.bottomStyle.display="block",this.rightStyle.top=a+"px",this.rightStyle.left=u+C-I+"px",this.rightStyle.height=y+1+"px",this.rightStyle.display="block",v()||!this.hasSetting(this.settings.border.cornerVisible)||this.isPartRange(S,E)?this.cornerStyle.display="none":(this.cornerStyle.top=a+y-4+"px",this.cornerStyle.left=u+C-4+"px",this.cornerStyle.borderRightWidth=this.cornerDefaultStyle.borderWidth,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.display="block",M=d(this.wot.wtTable.TABLE),E===this.wot.getSetting("totalColumns")-1&&(T=o.offsetLeft+g(o)>=h(M),T&&(this.cornerStyle.left=Math.floor(u+C-3-parseInt(this.cornerDefaultStyle.width)/2)+"px",this.cornerStyle.borderRightWidth=0)),S===this.wot.getSetting("totalRows")-1&&(T=o.offsetTop+m(o)>=f(M),T&&(this.cornerStyle.top=Math.floor(a+y-3-parseInt(this.cornerDefaultStyle.height)/2)+"px",this.cornerStyle.borderBottomWidth=0))),v()&&this.updateMultipleSelectionHandlesPosition(_,R,a,u,C,y)}},disappear:function(){this.topStyle.display="none",this.leftStyle.display="none",this.bottomStyle.display="none",this.rightStyle.display="none",this.cornerStyle.display="none",v()&&(this.selectionHandles.styles.topLeft.display="none",this.selectionHandles.styles.bottomRight.display="none")},hasSetting:function(e){return"function"==typeof e?e():!!e}},{}),window.WalkontableBorder=C},{"cell/coords":6,eventManager:42,"helpers/browser":44,"helpers/dom/element":47,"helpers/dom/event":48,"overlay/_base.js":12}],4:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableViewportColumnsCalculator:{get:function(){return r}},__esModule:{value:!0}});var o=new WeakMap,r=function(e,t,n,r,i,s,a){var l=void 0!==arguments[7]?arguments[7]:function(e){return e};o.set(this,{viewportWidth:e,scrollOffset:t,totalColumns:n,columnWidthFn:r,overrideFn:i,onlyFullyVisible:s,stretchingColumnWidthFn:l}),this.count=0,this.startColumn=null,this.endColumn=null,this.startPosition=null,this.stretchAllRatio=0,this.stretchLastWidth=0,this.stretch=a,this.totalTargetWidth=0,this.needVerifyLastColumnWidth=!0,this.stretchAllColumnsWidth=[],this.calculate()},i=r;$traceurRuntime.createClass(r,{calculate:function(){for(var e,t=0,n=!0,r=[],i=o.get(this),s=i.onlyFullyVisible,a=i.overrideFn,l=i.scrollOffset,u=i.totalColumns,c=i.viewportWidth,d=0;d<u;d++)if(e=this._getColumnWidth(d),t<=l&&!s&&(this.startColumn=d),t>=l&&t+e<=l+c&&(null==this.startColumn&&(this.startColumn=d),this.endColumn=d),r.push(t),t+=e,s||(this.endColumn=d),t>=l+c){n=!1;break}if(this.endColumn===u-1&&n)for(this.startColumn=this.endColumn;this.startColumn>0;){var h=r[this.endColumn]+e-r[this.startColumn-1];if((h<=c||!s)&&this.startColumn--,h>c)break}null!==this.startColumn&&a&&a(this),this.startPosition=r[this.startColumn],void 0==this.startPosition&&(this.startPosition=null),null!==this.startColumn&&(this.count=this.endColumn-this.startColumn+1)},refreshStretching:function(e){if("none"!==this.stretch){this.totalTargetWidth=e;for(var t=o.get(this),n=t.totalColumns,r=0,i=0;i<n;i++){var s=this._getColumnWidth(i),a=t.stretchingColumnWidthFn(void 0,i);"number"==typeof a?e-=a:r+=s}var l=e-r;if("all"===this.stretch&&l>0)this.stretchAllRatio=e/r,this.stretchAllColumnsWidth=[],this.needVerifyLastColumnWidth=!0;else if("last"===this.stretch&&e!==1/0){var u=this._getColumnWidth(n-1),c=l+u;this.stretchLastWidth=c>=0?c:u}}},getStretchedColumnWidth:function(e,t){var n=null;return"all"===this.stretch&&0!==this.stretchAllRatio?n=this._getStretchedAllColumnWidth(e,t):"last"===this.stretch&&0!==this.stretchLastWidth&&(n=this._getStretchedLastColumnWidth(e)),n},_getStretchedAllColumnWidth:function(e,t){var n=0,r=o.get(this),i=r.totalColumns;if(!this.stretchAllColumnsWidth[e]){var s=Math.round(t*this.stretchAllRatio),a=r.stretchingColumnWidthFn(s,e);void 0===a?this.stretchAllColumnsWidth[e]=s:this.stretchAllColumnsWidth[e]=isNaN(a)?this._getColumnWidth(e):a}if(this.stretchAllColumnsWidth.length===i&&this.needVerifyLastColumnWidth){this.needVerifyLastColumnWidth=!1;for(var l=0;l<this.stretchAllColumnsWidth.length;l++)n+=this.stretchAllColumnsWidth[l];n!==this.totalTargetWidth&&(this.stretchAllColumnsWidth[this.stretchAllColumnsWidth.length-1]+=this.totalTargetWidth-n)}return this.stretchAllColumnsWidth[e]},_getStretchedLastColumnWidth:function(e){var t=o.get(this),n=t.totalColumns;return e===n-1?this.stretchLastWidth:null},_getColumnWidth:function(e){var t=o.get(this).columnWidthFn(e);return void 0===t&&(t=i.DEFAULT_WIDTH),t}},{get DEFAULT_WIDTH(){return 50}}),window.WalkontableViewportColumnsCalculator=r},{}],5:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableViewportRowsCalculator:{get:function(){return r}},__esModule:{value:!0}});var o=new WeakMap,r=function(e,t,n,r,i,s,a){o.set(this,{viewportHeight:e,scrollOffset:t,totalRows:n,rowHeightFn:r,overrideFn:i,onlyFullyVisible:s,horizontalScrollbarHeight:a}),this.count=0,this.startRow=null,this.endRow=null,this.startPosition=null,this.calculate()},i=r;$traceurRuntime.createClass(r,{calculate:function(){for(var e=0,t=!0,n=[],r=o.get(this),s=r.onlyFullyVisible,a=r.overrideFn,l=r.rowHeightFn,u=r.scrollOffset,c=r.totalRows,d=r.viewportHeight,h=r.horizontalScrollbarHeight||0,f=0;f<c;f++){var p=l(f);if(void 0===p&&(p=i.DEFAULT_HEIGHT),e<=u&&!s&&(this.startRow=f),e>=u&&e+p<=u+d-h&&(null===this.startRow&&(this.startRow=f),this.endRow=f),n.push(e),e+=p,s||(this.endRow=f),e>=u+d-h){t=!1;break}}if(this.endRow===c-1&&t)for(this.startRow=this.endRow;this.startRow>0;){var m=n[this.endRow]+p-n[this.startRow-1];if((m<=d-h||!s)&&this.startRow--,m>=d-h)break}null!==this.startRow&&a&&a(this),this.startPosition=n[this.startRow],void 0==this.startPosition&&(this.startPosition=null),null!==this.startRow&&(this.count=this.endRow-this.startRow+1)}},{get DEFAULT_HEIGHT(){return 23}}),window.WalkontableViewportRowsCalculator=r},{}],6:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableCellCoords:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t){"undefined"!=typeof e&&"undefined"!=typeof t?(this.row=e,this.col=t):(this.row=null,this.col=null)};$traceurRuntime.createClass(o,{isValid:function(e){return!(this.row<0||this.col<0)&&!(this.row>=e.getSetting("totalRows")||this.col>=e.getSetting("totalColumns"))},isEqual:function(e){return e===this||this.row===e.row&&this.col===e.col},isSouthEastOf:function(e){return this.row>=e.row&&this.col>=e.col},isNorthWestOf:function(e){return this.row<=e.row&&this.col<=e.col},isSouthWestOf:function(e){return this.row>=e.row&&this.col<=e.col},isNorthEastOf:function(e){return this.row<=e.row&&this.col>=e.col}},{}),window.WalkontableCellCoords=o},{}],7:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableCellRange:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e("cell/coords"),o&&o.__esModule&&o||{default:o}).WalkontableCellCoords,i=function(e,t,n){this.highlight=e,this.from=t,this.to=n},s=i;$traceurRuntime.createClass(i,{isValid:function(e){return this.from.isValid(e)&&this.to.isValid(e)},isSingle:function(){return this.from.row===this.to.row&&this.from.col===this.to.col},getHeight:function(){return Math.max(this.from.row,this.to.row)-Math.min(this.from.row,this.to.row)+1},getWidth:function(){return Math.max(this.from.col,this.to.col)-Math.min(this.from.col,this.to.col)+1},includes:function(e){var t=e,n=t.row,o=t.col,r=this.getTopLeftCorner(),i=this.getBottomRightCorner();return r.row<=n&&i.row>=n&&r.col<=o&&i.col>=o},includesRange:function(e){return this.includes(e.getTopLeftCorner())&&this.includes(e.getBottomRightCorner())},isEqual:function(e){return Math.min(this.from.row,this.to.row)==Math.min(e.from.row,e.to.row)&&Math.max(this.from.row,this.to.row)==Math.max(e.from.row,e.to.row)&&Math.min(this.from.col,this.to.col)==Math.min(e.from.col,e.to.col)&&Math.max(this.from.col,this.to.col)==Math.max(e.from.col,e.to.col)},overlaps:function(e){return e.isSouthEastOf(this.getTopLeftCorner())&&e.isNorthWestOf(this.getBottomRightCorner())},isSouthEastOf:function(e){return this.getTopLeftCorner().isSouthEastOf(e)||this.getBottomRightCorner().isSouthEastOf(e)},isNorthWestOf:function(e){return this.getTopLeftCorner().isNorthWestOf(e)||this.getBottomRightCorner().isNorthWestOf(e)},expand:function(e){var t=this.getTopLeftCorner(),n=this.getBottomRightCorner();return(e.row<t.row||e.col<t.col||e.row>n.row||e.col>n.col)&&(this.from=new r(Math.min(t.row,e.row),Math.min(t.col,e.col)),this.to=new r(Math.max(n.row,e.row),Math.max(n.col,e.col)),!0)},expandByRange:function(e){if(this.includesRange(e)||!this.overlaps(e))return!1;var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=(this.getTopRightCorner(),this.getBottomLeftCorner(),e.getTopLeftCorner()),i=e.getBottomRightCorner(),a=Math.min(t.row,o.row),l=Math.min(t.col,o.col),u=Math.max(n.row,i.row),c=Math.max(n.col,i.col),d=new r(a,l),h=new r(u,c),f=new s(d,d,h).isCorner(this.from,e),p=e.isEqual(new s(d,d,h));return f&&!p&&(this.from.col>d.col&&(d.col=c,h.col=l),this.from.row>d.row&&(d.row=u,h.row=a)),this.from=d,this.to=h,!0},getDirection:function(){return this.from.isNorthWestOf(this.to)?"NW-SE":this.from.isNorthEastOf(this.to)?"NE-SW":this.from.isSouthEastOf(this.to)?"SE-NW":this.from.isSouthWestOf(this.to)?"SW-NE":void 0},setDirection:function(e){switch(e){case"NW-SE":this.from=this.getTopLeftCorner(),this.to=this.getBottomRightCorner();break;case"NE-SW":this.from=this.getTopRightCorner(),this.to=this.getBottomLeftCorner();break;case"SE-NW":this.from=this.getBottomRightCorner(),this.to=this.getTopLeftCorner();break;case"SW-NE":this.from=this.getBottomLeftCorner(),this.to=this.getTopRightCorner()}},getTopLeftCorner:function(){return new r(Math.min(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},getBottomRightCorner:function(){return new r(Math.max(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},getTopRightCorner:function(){return new r(Math.min(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},getBottomLeftCorner:function(){return new r(Math.max(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},isCorner:function(e,t){return!!(t&&t.includes(e)&&(this.getTopLeftCorner().isEqual(new r(t.from.row,t.from.col))||this.getTopRightCorner().isEqual(new r(t.from.row,t.to.col))||this.getBottomLeftCorner().isEqual(new r(t.to.row,t.from.col))||this.getBottomRightCorner().isEqual(new r(t.to.row,t.to.col))))||(e.isEqual(this.getTopLeftCorner())||e.isEqual(this.getTopRightCorner())||e.isEqual(this.getBottomLeftCorner())||e.isEqual(this.getBottomRightCorner()))},getOppositeCorner:function(e,t){if(!(e instanceof r))return!1;if(t&&t.includes(e)){if(this.getTopLeftCorner().isEqual(new r(t.from.row,t.from.col)))return this.getBottomRightCorner();if(this.getTopRightCorner().isEqual(new r(t.from.row,t.to.col)))return this.getBottomLeftCorner();if(this.getBottomLeftCorner().isEqual(new r(t.to.row,t.from.col)))return this.getTopRightCorner();if(this.getBottomRightCorner().isEqual(new r(t.to.row,t.to.col)))return this.getTopLeftCorner()}return e.isEqual(this.getBottomRightCorner())?this.getTopLeftCorner():e.isEqual(this.getTopLeftCorner())?this.getBottomRightCorner():e.isEqual(this.getTopRightCorner())?this.getBottomLeftCorner():e.isEqual(this.getBottomLeftCorner())?this.getTopRightCorner():void 0},getBordersSharedWith:function(e){if(!this.includesRange(e))return[];var t={top:Math.min(this.from.row,this.to.row),bottom:Math.max(this.from.row,this.to.row),left:Math.min(this.from.col,this.to.col),right:Math.max(this.from.col,this.to.col)},n={top:Math.min(e.from.row,e.to.row),bottom:Math.max(e.from.row,e.to.row),left:Math.min(e.from.col,e.to.col),right:Math.max(e.from.col,e.to.col)},o=[];return t.top==n.top&&o.push("top"),t.right==n.right&&o.push("right"),t.bottom==n.bottom&&o.push("bottom"),t.left==n.left&&o.push("left"),o},getInner:function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o<=t.row;o++)for(var i=e.col;i<=t.col;i++)this.from.row===o&&this.from.col===i||this.to.row===o&&this.to.col===i||n.push(new r(o,i));return n},getAll:function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o<=t.row;o++)for(var i=e.col;i<=t.col;i++)e.row===o&&e.col===i?n.push(e):t.row===o&&t.col===i?n.push(t):n.push(new r(o,i));return n},forAll:function(e){for(var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=t.row;o<=n.row;o++)for(var r=t.col;r<=n.col;r++){var i=e(o,r);if(i===!1)return}}},{}),window.WalkontableCellRange=i},{"cell/coords":6}],8:[function(e,t,n){"use strict";Object.defineProperties(n,{Walkontable:{get:function(){return D}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),v=w.addClass,y=w.fastInnerText,b=w.isVisible,C=w.removeClass,_=(r=e("helpers/object"),r&&r.__esModule&&r||{default:r}).objectEach,R=(i=e("helpers/string"),i&&i.__esModule&&i||{default:i}),S=R.toUpperCaseFirst,E=R.randomString,M=(s=e("event"),s&&s.__esModule&&s||{default:s}).WalkontableEvent,T=(a=e("overlays"),a&&a.__esModule&&a||{default:a}).WalkontableOverlays,O=(l=e("scroll"),l&&l.__esModule&&l||{default:l}).WalkontableScroll,k=(u=e("settings"),u&&u.__esModule&&u||{default:u}).WalkontableSettings,x=(c=e("table"),c&&c.__esModule&&c||{default:c}).WalkontableTable,H=(d=e("viewport"),d&&d.__esModule&&d||{default:d}).WalkontableViewport,D=((h=e("overlay/_base.js"),h&&h.__esModule&&h||{default:h}).WalkontableOverlay,(f=e("overlay/top.js"),f&&f.__esModule&&f||{default:f}).WalkontableTopOverlay,(p=e("overlay/left.js"),p&&p.__esModule&&p||{default:p}).WalkontableLeftOverlay,(m=e("overlay/debug.js"),m&&m.__esModule&&m||{default:m}).WalkontableDebugOverlay,(g=e("overlay/topLeftCorner.js"),g&&g.__esModule&&g||{default:g}).WalkontableTopLeftCornerOverlay,function(e){var t=[];if(this.guid="wt_"+E(),e.cloneSource?(this.cloneSource=e.cloneSource,this.cloneOverlay=e.cloneOverlay,this.wtSettings=e.cloneSource.wtSettings,this.wtTable=new x(this,e.table,e.wtRootElement),this.wtScroll=new O(this),this.wtViewport=e.cloneSource.wtViewport,this.wtEvent=new M(this),this.selections=this.cloneSource.selections):(this.wtSettings=new k(this,e),this.wtTable=new x(this,e.table),this.wtScroll=new O(this),this.wtViewport=new H(this),this.wtEvent=new M(this),this.selections=this.getSetting("selections"),this.wtOverlays=new T(this),this.exportSettingsAsClassNames()),this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var n=0,o=this.wtTable.THEAD.childNodes[0].childNodes.length;n<o;n++)t.push(this.wtTable.THEAD.childNodes[0].childNodes[n].innerHTML);this.getSetting("columnHeaders").length||this.update("columnHeaders",[function(e,n){y(n,t[e])}])}this.drawn=!1,this.drawInterrupted=!1});$traceurRuntime.createClass(D,{draw:function(){var e=void 0!==arguments[0]&&arguments[0];return this.drawInterrupted=!1,e||b(this.wtTable.TABLE)?this.wtTable.draw(e):this.drawInterrupted=!0,this},getCell:function(e){var t=void 0!==arguments[1]&&arguments[1];if(!t)return this.wtTable.getCell(e);var n=this.wtSettings.getSetting("totalRows"),o=this.wtSettings.getSetting("fixedRowsTop"),r=this.wtSettings.getSetting("fixedRowsBottom"),i=this.wtSettings.getSetting("fixedColumnsLeft");if(e.row<o&&e.col<i)return this.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell(e);if(e.row<o)return this.wtOverlays.topOverlay.clone.wtTable.getCell(e);if(e.col<i&&e.row>=n-r){if(this.wtOverlays.bottomLeftCornerOverlay.clone)return this.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell(e)}else{if(e.col<i)return this.wtOverlays.leftOverlay.clone.wtTable.getCell(e);if(e.row<n&&e.row>n-r&&this.wtOverlays.bottomOverlay.clone)return this.wtOverlays.bottomOverlay.clone.wtTable.getCell(e)}return this.wtTable.getCell(e)},update:function(e,t){return this.wtSettings.update(e,t)},scrollVertical:function(e){return this.wtOverlays.topOverlay.scrollTo(e),this.getSetting("onScrollVertically"),this},scrollHorizontal:function(e){return this.wtOverlays.leftOverlay.scrollTo(e),this.getSetting("onScrollHorizontally"),this},scrollViewport:function(e){return this.wtScroll.scrollViewport(e),this},getViewport:function(){return[this.wtTable.getFirstVisibleRow(),this.wtTable.getFirstVisibleColumn(),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]},getOverlayName:function(){return this.cloneOverlay?this.cloneOverlay.type:"master"},isOverlayName:function(e){return!!this.cloneOverlay&&this.cloneOverlay.type===e},exportSettingsAsClassNames:function(){var e=this,t={rowHeaders:["array"],columnHeaders:["array"]},n=[],o=[];_(t,function(t,r){t.indexOf("array")>-1&&e.getSetting(r).length&&o.push("ht"+S(r)),n.push("ht"+S(r))}),C(this.wtTable.wtRootElement.parentNode,n),v(this.wtTable.wtRootElement.parentNode,o)},getSetting:function(e,t,n,o,r){return this.wtSettings.getSetting(e,t,n,o,r)},hasSetting:function(e){return this.wtSettings.has(e)},destroy:function(){this.wtOverlays.destroy(),this.wtEvent.destroy()}},{}),window.Walkontable=D},{event:9,"helpers/dom/element":47,"helpers/object":53,"helpers/string":55,"overlay/_base.js":12,"overlay/debug.js":13,"overlay/left.js":14,"overlay/top.js":15,"overlay/topLeftCorner.js":16,overlays:17,scroll:18,settings:20,table:21,viewport:23}],9:[function(e,t,n){"use strict";function o(e){var t=this,n=h(e);this.instance=e;var o=[null,null];this.dblClickTimeout=[null,null];var r,i=function(e){var n=t.parentCell(e.realTarget);u(e.realTarget,"corner")?t.instance.getSetting("onCellCornerMouseDown",e,e.realTarget):n.TD&&t.instance.hasSetting("onCellMouseDown")&&t.instance.getSetting("onCellMouseDown",e,n.coords,n.TD,t.instance),2!==e.button&&n.TD&&(o[0]=n.TD,clearTimeout(t.dblClickTimeout[0]),t.dblClickTimeout[0]=setTimeout(function(){o[0]=null},1e3))},s=function(e){t.instance.touchMoving=!0},a=function(e){n.addEventListener(this,"touchmove",s),t.checkIfTouchMove=setTimeout(function(){return t.instance.touchMoving===!0?(t.instance.touchMoving=void 0,void n.removeEventListener("touchmove",s,!1)):void i(e)},30)},f=function(e){var n,o,r;t.instance.hasSetting("onCellMouseOver")&&(n=t.instance.wtTable.TABLE,o=l(e.realTarget,["TD","TH"],n),r=t.instance.cloneSource||t.instance,o&&o!==r.lastMouseOver&&c(o,n)&&(r.lastMouseOver=o,t.instance.getSetting("onCellMouseOver",e,t.instance.wtTable.getCoords(o),o,t.instance)))},p=function(e){if(2!==e.button){var n=t.parentCell(e.realTarget);n.TD===o[0]&&n.TD===o[1]?(u(e.realTarget,"corner")?t.instance.getSetting("onCellCornerDblClick",e,n.coords,n.TD,t.instance):t.instance.getSetting("onCellDblClick",e,n.coords,n.TD,t.instance),o[0]=null,o[1]=null):n.TD===o[0]&&(o[1]=n.TD,clearTimeout(t.dblClickTimeout[1]),t.dblClickTimeout[1]=setTimeout(function(){o[1]=null},500))}},m=function(e){clearTimeout(r),e.preventDefault(),p(e)};if(n.addEventListener(this.instance.wtTable.holder,"mousedown",i),n.addEventListener(this.instance.wtTable.TABLE,"mouseover",f),n.addEventListener(this.instance.wtTable.holder,"mouseup",p),this.instance.wtTable.holder.parentNode.parentNode&&d()&&!t.instance.wtTable.isWorkingOnClone()){var g="."+this.instance.wtTable.holder.parentNode.className.split(" ").join(".");n.addEventListener(this.instance.wtTable.holder,"touchstart",function(e){t.instance.touchApplied=!0,c(e.target,g)&&a.call(e.target,e)}),n.addEventListener(this.instance.wtTable.holder,"touchend",function(e){t.instance.touchApplied=!1,c(e.target,g)&&m.call(e.target,e)}),t.instance.momentumScrolling||(t.instance.momentumScrolling={}),n.addEventListener(this.instance.wtTable.holder,"scroll",function(e){clearTimeout(t.instance.momentumScrolling._timeout),t.instance.momentumScrolling.ongoing||t.instance.getSetting("onBeforeTouchScroll"),t.instance.momentumScrolling.ongoing=!0,t.instance.momentumScrolling._timeout=setTimeout(function(){t.instance.touchApplied||(t.instance.momentumScrolling.ongoing=!1,t.instance.getSetting("onAfterMomentumScroll"))},200)})}n.addEventListener(window,"resize",function(){"none"!==t.instance.getSetting("stretchH")&&t.instance.draw()}),this.destroy=function(){clearTimeout(this.dblClickTimeout[0]),clearTimeout(this.dblClickTimeout[1]),n.destroy()}}Object.defineProperties(n,{WalkontableEvent:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),l=a.closestDown,u=a.hasClass,c=a.isChildOf,d=(i=e("helpers/browser"),i&&i.__esModule&&i||{default:i}).isMobileBrowser,h=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).eventManager;o.prototype.parentCell=function(e){var t={},n=this.instance.wtTable.TABLE,o=l(e,["TD","TH"],n);return o?(t.coords=this.instance.wtTable.getCoords(o),t.TD=o):u(e,"wtBorder")&&u(e,"current")?(t.coords=this.instance.selections.current.cellRange.highlight,t.TD=this.instance.wtTable.getCell(t.coords)):u(e,"wtBorder")&&u(e,"area")&&this.instance.selections.area.cellRange&&(t.coords=this.instance.selections.area.cellRange.to,t.TD=this.instance.wtTable.getCell(t.coords)),t},window.WalkontableEvent=o},{eventManager:42,"helpers/browser":44,"helpers/dom/element":47}],10:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableColumnFilter:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t,n){this.offset=e,this.total=t,this.countTH=n};$traceurRuntime.createClass(o,{offsetted:function(e){return e+this.offset},unOffsetted:function(e){return e-this.offset},renderedToSource:function(e){return this.offsetted(e)},sourceToRendered:function(e){return this.unOffsetted(e)},offsettedTH:function(e){return e-this.countTH},unOffsettedTH:function(e){return e+this.countTH},visibleRowHeadedColumnToSourceColumn:function(e){return this.renderedToSource(this.offsettedTH(e))},sourceColumnToVisibleRowHeadedColumn:function(e){return this.unOffsettedTH(this.sourceToRendered(e));
+}},{}),window.WalkontableColumnFilter=o},{}],11:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableRowFilter:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t,n){this.offset=e,this.total=t,this.countTH=n};$traceurRuntime.createClass(o,{offsetted:function(e){return e+this.offset},unOffsetted:function(e){return e-this.offset},renderedToSource:function(e){return this.offsetted(e)},sourceToRendered:function(e){return this.unOffsetted(e)},offsettedTH:function(e){return e-this.countTH},unOffsettedTH:function(e){return e+this.countTH},visibleColHeadedRowToSourceRow:function(e){return this.renderedToSource(this.offsettedTH(e))},sourceRowToVisibleColHeadedRow:function(e){return this.unOffsettedTH(this.sourceToRendered(e))}},{}),window.WalkontableRowFilter=o},{}],12:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableOverlay:{get:function(){return h}},__esModule:{value:!0}});var o,r,i,s=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),a=s.getScrollableElement,l=s.getTrimmingContainer,u=(r=e("helpers/object"),r&&r.__esModule&&r||{default:r}).defineGetter,c=(i=e("eventManager"),i&&i.__esModule&&i||{default:i}).eventManager,d={},h=function(e){u(this,"wot",e,{writable:!1}),this.instance=this.wot,this.type="",this.mainTableScrollableElement=null,this.TABLE=this.wot.wtTable.TABLE,this.hider=this.wot.wtTable.hider,this.spreader=this.wot.wtTable.spreader,this.holder=this.wot.wtTable.holder,this.wtRootElement=this.wot.wtTable.wtRootElement,this.trimmingContainer=l(this.hider.parentNode.parentNode),this.needFullRender=this.shouldBeRendered(),this.areElementSizesAdjusted=!1},f=h;$traceurRuntime.createClass(h,{shouldBeRendered:function(){return!0},updateTrimmingContainer:function(){this.trimmingContainer=l(this.hider.parentNode.parentNode)},updateMainScrollableElement:function(){this.mainTableScrollableElement=a(this.wot.wtTable.TABLE)},makeClone:function(e){if(f.CLONE_TYPES.indexOf(e)===-1)throw new Error('Clone type "'+e+'" is not supported.');var t=document.createElement("DIV"),n=document.createElement("TABLE");t.className="ht_clone_"+e+" handsontable",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.overflow="hidden",n.className=this.wot.wtTable.TABLE.className,t.appendChild(n),this.type=e,this.wot.wtTable.wtRootElement.parentNode.appendChild(t);var o=this.wot.getSetting("preventOverflow");return o===!0||"horizontal"===o&&this.type===f.CLONE_TOP||"vertical"===o&&this.type===f.CLONE_LEFT?this.mainTableScrollableElement=window:this.mainTableScrollableElement=a(this.wot.wtTable.TABLE),new Walkontable({cloneSource:this.wot,cloneOverlay:this,table:n})},refresh:function(){var e=void 0!==arguments[0]&&arguments[0],t=this.shouldBeRendered();this.clone&&(this.needFullRender||t)&&this.clone.draw(e),this.needFullRender=t},destroy:function(){c(this.clone).destroy()}},{get CLONE_TOP(){return"top"},get CLONE_BOTTOM(){return"bottom"},get CLONE_LEFT(){return"left"},get CLONE_TOP_LEFT_CORNER(){return"top_left_corner"},get CLONE_BOTTOM_LEFT_CORNER(){return"bottom_left_corner"},get CLONE_DEBUG(){return"debug"},get CLONE_TYPES(){return[f.CLONE_TOP,f.CLONE_BOTTOM,f.CLONE_LEFT,f.CLONE_TOP_LEFT_CORNER,f.CLONE_BOTTOM_LEFT_CORNER,f.CLONE_DEBUG]},registerOverlay:function(e,t){if(f.CLONE_TYPES.indexOf(e)===-1)throw new Error("Unsupported overlay ("+e+").");d[e]=t},createOverlay:function(e,t){return new d[e](t)},isOverlayTypeOf:function(e,t){return!(!e||!d[t])&&e instanceof d[t]}}),window.WalkontableOverlay=h},{eventManager:42,"helpers/dom/element":47,"helpers/object":53}],13:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableDebugOverlay:{get:function(){return a}},__esModule:{value:!0}});var o,r,i=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}).addClass,s=(r=e("_base"),r&&r.__esModule&&r||{default:r}).WalkontableOverlay,a=function(e){$traceurRuntime.superConstructor(l).call(this,e),this.clone=this.makeClone(s.CLONE_DEBUG),this.clone.wtTable.holder.style.opacity=.4,this.clone.wtTable.holder.style.textShadow="0 0 2px #ff0000",i(this.clone.wtTable.holder.parentNode,"wtDebugVisible")},l=a;$traceurRuntime.createClass(a,{},{},s),window.WalkontableDebugOverlay=a,s.registerOverlay(s.CLONE_DEBUG,a)},{_base:12,"helpers/dom/element":47}],14:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableLeftOverlay:{get:function(){return w}},__esModule:{value:!0}});var o,r,i=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),s=i.addClass,a=i.getScrollbarWidth,l=i.getScrollLeft,u=i.getWindowScrollTop,c=i.hasClass,d=i.outerWidth,h=i.innerHeight,f=i.removeClass,p=i.setOverlayPosition,m=i.resetCssTransform,g=(r=e("_base"),r&&r.__esModule&&r||{default:r}).WalkontableOverlay,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.clone=this.makeClone(g.CLONE_LEFT)},v=w;$traceurRuntime.createClass(w,{shouldBeRendered:function(){return!(!this.wot.getSetting("fixedColumnsLeft")&&!this.wot.getSetting("rowHeaders").length)},resetFixedPosition:function(){if(this.needFullRender&&this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=0,n=this.wot.getSetting("preventOverflow");if(this.trimmingContainer!==window||n&&"horizontal"===n)t=this.getScrollPosition(),m(e);else{var o,r,i=this.wot.wtTable.hider.getBoundingClientRect(),s=Math.ceil(i.left),a=Math.ceil(i.right);r=this.wot.wtTable.hider.style.top,r=""===r?0:r,o=s<0&&a-e.offsetWidth>0?-s:0,t=o,o+="px",p(e,o,r)}this.adjustHeaderBordersPosition(t),this.adjustElementsSize()}},setScrollPosition:function(e){this.mainTableScrollableElement===window?window.scrollTo(e,u()):this.mainTableScrollableElement.scrollLeft=e},onScroll:function(){this.wot.getSetting("onScrollVertically")},sumCellSizes:function(e,t){for(var n=0,o=this.wot.wtSettings.defaultColumnWidth;e<t;)n+=this.wot.wtTable.getStretchedColumnWidth(e)||o,e++;return n},adjustElementsSize:function(){var e=void 0!==arguments[0]&&arguments[0];this.updateTrimmingContainer(),(this.needFullRender||e)&&(this.adjustRootElementSize(),this.adjustRootChildrenSize(),e||(this.areElementSizesAdjusted=!0))},adjustRootElementSize:function(){var e,t=this.wot.wtTable.holder,n=t.clientHeight===t.offsetHeight?0:a(),o=this.clone.wtTable.holder.parentNode,r=o.style,i=this.wot.getSetting("preventOverflow");if(this.trimmingContainer!==window||"vertical"===i){var s=this.wot.wtViewport.getWorkspaceHeight()-n;s=Math.min(s,h(this.wot.wtTable.wtRootElement)),r.height=s+"px"}else r.height="";this.clone.wtTable.holder.style.height=r.height,e=d(this.clone.wtTable.TABLE),r.width=(0===e?e:e+4)+"px"},adjustRootChildrenSize:function(){var e=a();this.clone.wtTable.hider.style.height=this.hider.style.height,this.clone.wtTable.holder.style.height=this.clone.wtTable.holder.parentNode.style.height,0===e&&(e=30),this.clone.wtTable.holder.style.width=parseInt(this.clone.wtTable.holder.parentNode.style.width,10)+e+"px"},applyToDOM:function(){var e=this.wot.getSetting("totalColumns");if(this.areElementSizesAdjusted||this.adjustElementsSize(),"number"==typeof this.wot.wtViewport.columnsRenderCalculator.startPosition)this.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+"px";else{if(0!==e)throw new Error("Incorrect value of the columnsRenderCalculator");this.spreader.style.left="0"}this.spreader.style.right="",this.needFullRender&&this.syncOverlayOffset()},syncOverlayOffset:function(){"number"==typeof this.wot.wtViewport.rowsRenderCalculator.startPosition?this.clone.wtTable.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+"px":this.clone.wtTable.spreader.style.top=""},scrollTo:function(e,t){var n=this.getTableParentOffset(),o=this.wot.cloneSource?this.wot.cloneSource:this.wot,r=o.wtTable.holder,i=0;t&&r.offsetWidth!==r.clientWidth&&(i=a()),t?(n+=this.sumCellSizes(0,e+1),n-=this.wot.wtViewport.getViewportWidth()):n+=this.sumCellSizes(this.wot.getSetting("fixedColumnsLeft"),e),n+=i,this.setScrollPosition(n)},getTableParentOffset:function(){var e=this.wot.getSetting("preventOverflow"),t=0;return e||this.trimmingContainer!==window||(t=this.wot.wtTable.holderOffset.left),t},getScrollPosition:function(){return l(this.mainTableScrollableElement)},adjustHeaderBordersPosition:function(e){var t=this.wot.wtTable.holder.parentNode,n=this.wot.getSetting("rowHeaders"),o=this.wot.getSetting("fixedColumnsLeft"),r=this.wot.getSetting("totalRows");if(r?f(t,"emptyRows"):s(t,"emptyRows"),o&&!n.length)s(t,"innerBorderLeft");else if(!o&&n.length){var i=c(t,"innerBorderLeft");e?s(t,"innerBorderLeft"):f(t,"innerBorderLeft"),(!i&&e||i&&!e)&&this.wot.wtOverlays.adjustElementsSize()}}},{},g),window.WalkontableLeftOverlay=w,g.registerOverlay(g.CLONE_LEFT,w)},{_base:12,"helpers/dom/element":47}],15:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableTopOverlay:{get:function(){return w}},__esModule:{value:!0}});var o,r,i=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),s=i.addClass,a=i.getScrollbarWidth,l=i.getScrollTop,u=i.getWindowScrollLeft,c=i.hasClass,d=i.outerHeight,h=i.innerWidth,f=i.removeClass,p=i.setOverlayPosition,m=i.resetCssTransform,g=(r=e("_base"),r&&r.__esModule&&r||{default:r}).WalkontableOverlay,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.clone=this.makeClone(g.CLONE_TOP)},v=w;$traceurRuntime.createClass(w,{shouldBeRendered:function(){return!(!this.wot.getSetting("fixedRowsTop")&&!this.wot.getSetting("columnHeaders").length)},resetFixedPosition:function(){if(this.needFullRender&&this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=0,n=this.wot.getSetting("preventOverflow");if(this.trimmingContainer!==window||n&&"vertical"===n)t=this.getScrollPosition(),m(e);else{var o,r,i=this.wot.wtTable.hider.getBoundingClientRect(),s=Math.ceil(i.top),a=Math.ceil(i.bottom);o=this.wot.wtTable.hider.style.left,o=""===o?0:o,r=s<0&&a-e.offsetHeight>0?-s:0,t=r,r+="px",p(e,o,r)}this.adjustHeaderBordersPosition(t),this.adjustElementsSize()}},setScrollPosition:function(e){this.mainTableScrollableElement===window?window.scrollTo(u(),e):this.mainTableScrollableElement.scrollTop=e},onScroll:function(){this.wot.getSetting("onScrollHorizontally")},sumCellSizes:function(e,t){for(var n=0,o=this.wot.wtSettings.settings.defaultRowHeight;e<t;){var r=this.wot.wtTable.getRowHeight(e);n+=void 0===r?o:r,e++}return n},adjustElementsSize:function(){var e=void 0!==arguments[0]&&arguments[0];this.updateTrimmingContainer(),(this.needFullRender||e)&&(this.adjustRootElementSize(),this.adjustRootChildrenSize(),e||(this.areElementSizesAdjusted=!0))},adjustRootElementSize:function(){var e,t=this.wot.wtTable.holder,n=t.clientWidth===t.offsetWidth?0:a(),o=this.clone.wtTable.holder.parentNode,r=o.style,i=this.wot.getSetting("preventOverflow");if(this.trimmingContainer!==window||"horizontal"===i){var s=this.wot.wtViewport.getWorkspaceWidth()-n;s=Math.min(s,h(this.wot.wtTable.wtRootElement)),r.width=s+"px"}else r.width="";this.clone.wtTable.holder.style.width=r.width,e=d(this.clone.wtTable.TABLE),r.height=(0===e?e:e+4)+"px"},adjustRootChildrenSize:function(){var e=a();this.clone.wtTable.hider.style.width=this.hider.style.width,this.clone.wtTable.holder.style.width=this.clone.wtTable.holder.parentNode.style.width,0===e&&(e=30),this.clone.wtTable.holder.style.height=parseInt(this.clone.wtTable.holder.parentNode.style.height,10)+e+"px"},applyToDOM:function(){var e=this.wot.getSetting("totalRows");if(this.areElementSizesAdjusted||this.adjustElementsSize(),"number"==typeof this.wot.wtViewport.rowsRenderCalculator.startPosition)this.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+"px";else{if(0!==e)throw new Error("Incorrect value of the rowsRenderCalculator");this.spreader.style.top="0"}this.spreader.style.bottom="",this.needFullRender&&this.syncOverlayOffset()},syncOverlayOffset:function(){"number"==typeof this.wot.wtViewport.columnsRenderCalculator.startPosition?this.clone.wtTable.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+"px":this.clone.wtTable.spreader.style.left=""},scrollTo:function(e,t){var n=this.getTableParentOffset(),o=this.wot.cloneSource?this.wot.cloneSource:this.wot,r=o.wtTable.holder,i=0;if(t&&r.offsetHeight!==r.clientHeight&&(i=a()),t){var s=this.wot.getSetting("fixedRowsBottom"),l=(this.wot.getSetting("fixedRowsTop"),this.wot.getSetting("totalRows"));n+=this.sumCellSizes(0,e+1),n-=this.wot.wtViewport.getViewportHeight()-this.sumCellSizes(l-s,l),n+=1}else n+=this.sumCellSizes(this.wot.getSetting("fixedRowsTop"),e);n+=i,this.setScrollPosition(n)},getTableParentOffset:function(){return this.mainTableScrollableElement===window?this.wot.wtTable.holderOffset.top:0},getScrollPosition:function(){return l(this.mainTableScrollableElement)},adjustHeaderBordersPosition:function(e){var t=this.wot.wtTable.holder.parentNode,n=this.wot.getSetting("totalColumns");if(n?f(t,"emptyColumns"):s(t,"emptyColumns"),0===this.wot.getSetting("fixedRowsTop")&&this.wot.getSetting("columnHeaders").length>0){var o=c(t,"innerBorderTop");e||0===this.wot.getSetting("totalRows")?s(t,"innerBorderTop"):f(t,"innerBorderTop"),(!o&&e||o&&!e)&&this.wot.wtOverlays.adjustElementsSize()}if(0===this.wot.getSetting("rowHeaders").length){var r=this.clone.wtTable.THEAD.querySelectorAll("th:nth-of-type(2)");if(r)for(var i=0;i<r.length;i++)r[i].style["border-left-width"]=0}}},{},g),window.WalkontableTopOverlay=w,g.registerOverlay(g.CLONE_TOP,w)},{_base:12,"helpers/dom/element":47}],16:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableTopLeftCornerOverlay:{get:function(){return d}},__esModule:{value:!0}});var o,r,i=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),s=i.outerHeight,a=i.outerWidth,l=i.setOverlayPosition,u=i.resetCssTransform,c=(r=e("_base"),r&&r.__esModule&&r||{default:r}).WalkontableOverlay,d=function(e){$traceurRuntime.superConstructor(h).call(this,e),this.clone=this.makeClone(c.CLONE_TOP_LEFT_CORNER)},h=d;$traceurRuntime.createClass(d,{shouldBeRendered:function(){return!(!this.wot.getSetting("fixedRowsTop")&&!this.wot.getSetting("columnHeaders").length||!this.wot.getSetting("fixedColumnsLeft")&&!this.wot.getSetting("rowHeaders").length)},resetFixedPosition:function(){if(this.updateTrimmingContainer(),this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=s(this.clone.wtTable.TABLE),n=a(this.clone.wtTable.TABLE),o=this.wot.getSetting("preventOverflow");if(this.trimmingContainer===window){var r=this.wot.wtTable.hider.getBoundingClientRect(),i=Math.ceil(r.top),c=Math.ceil(r.left),d=Math.ceil(r.bottom),h=Math.ceil(r.right),f="0",p="0";o&&"vertical"!==o||c<0&&h-e.offsetWidth>0&&(f=-c+"px"),o&&"horizontal"!==o||i<0&&d-e.offsetHeight>0&&(p=-i+"px"),l(e,f,p)}else u(e);e.style.height=(0===t?t:t+4)+"px",e.style.width=(0===n?n:n+4)+"px"}}},{},c),window.WalkontableTopLeftCornerOverlay=d,c.registerOverlay(c.CLONE_TOP_LEFT_CORNER,d)},{_base:12,"helpers/dom/element":47}],17:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableOverlays:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),u=l.getScrollableElement,c=l.getScrollbarWidth,d=l.getScrollLeft,h=l.getScrollTop,f=(r=e("helpers/array"),r&&r.__esModule&&r||{default:r}).arrayEach,p=(i=e("helpers/unicode"),i&&i.__esModule&&i||{default:i}).isKey,m=(s=e("helpers/browser"),s&&s.__esModule&&s||{default:s}).isMobileBrowser,g=(a=e("eventManager"),a&&a.__esModule&&a||{default:a}).EventManager,w=function(e){this.wot=e,this.instance=this.wot,this.eventManager=new g(this.wot),this.wot.update("scrollbarWidth",c()),this.wot.update("scrollbarHeight",c()),this.scrollableElement=u(this.wot.wtTable.TABLE),this.topOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_TOP,this.wot),"undefined"==typeof WalkontableBottomOverlay?this.bottomOverlay={needFullRender:!1}:this.bottomOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_BOTTOM,this.wot),this.leftOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_LEFT,this.wot),this.topOverlay.needFullRender&&this.leftOverlay.needFullRender&&(this.topLeftCornerOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,this.wot)),this.bottomOverlay.needFullRender&&this.leftOverlay.needFullRender&&"undefined"!=typeof WalkontableBottomLeftCornerOverlay?this.bottomLeftCornerOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER,this.wot):this.bottomLeftCornerOverlay={needFullRender:!1},this.wot.getSetting("debug")&&(this.debug=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_DEBUG,this.wot)),this.destroyed=!1,this.keyPressed=!1,this.spreaderLastSize={width:null,height:null},this.overlayScrollPositions={master:{top:0,left:0},top:{top:null,left:0},bottom:{top:null,left:0},left:{top:0,left:null}},this.pendingScrollCallbacks={master:{top:0,left:0},top:{left:0},bottom:{left:0},left:{top:0}},this.verticalScrolling=!1,this.horizontalScrolling=!1,this.delegatedScrollCallback=!1,this.registeredListeners=[],this.registerListeners()};$traceurRuntime.createClass(w,{refreshAll:function(){if(this.wot.drawn){if(!this.wot.wtTable.holder.parentNode)return void this.destroy();this.wot.draw(!0),this.verticalScrolling&&this.leftOverlay.onScroll(),this.horizontalScrolling&&this.topOverlay.onScroll(),this.verticalScrolling=!1,this.horizontalScrolling=!1}},registerListeners:function(){var e=this,t=this.topOverlay.mainTableScrollableElement,n=this.leftOverlay.mainTableScrollableElement,o=[];for(o.push([document.documentElement,"keydown",function(t){return e.onKeyDown(t)}]),o.push([document.documentElement,"keyup",function(){return e.onKeyUp()}]),o.push([document,"visibilitychange",function(){return e.onKeyUp()}]),o.push([t,"scroll",function(t){return e.onTableScroll(t)}]),t!==n&&o.push([n,"scroll",function(t){return e.onTableScroll(t)}]),this.topOverlay.needFullRender&&(o.push([this.topOverlay.clone.wtTable.holder,"scroll",function(t){return e.onTableScroll(t)}]),o.push([this.topOverlay.clone.wtTable.holder,"wheel",function(t){return e.onTableScroll(t)}])),this.bottomOverlay.needFullRender&&(o.push([this.bottomOverlay.clone.wtTable.holder,"scroll",function(t){return e.onTableScroll(t)}]),o.push([this.bottomOverlay.clone.wtTable.holder,"wheel",function(t){return e.onTableScroll(t)}])),this.leftOverlay.needFullRender&&(o.push([this.leftOverlay.clone.wtTable.holder,"scroll",function(t){return e.onTableScroll(t)}]),o.push([this.leftOverlay.clone.wtTable.holder,"wheel",function(t){return e.onTableScroll(t)}])),this.topOverlay.trimmingContainer!==window&&this.leftOverlay.trimmingContainer!==window&&o.push([window,"wheel",function(t){var n,o=t.wheelDeltaY||t.deltaY,r=t.wheelDeltaX||t.deltaX;e.topOverlay.clone.wtTable.holder.contains(t.realTarget)?n="top":e.bottomOverlay.clone&&e.bottomOverlay.clone.wtTable.holder.contains(t.realTarget)?n="bottom":e.leftOverlay.clone.wtTable.holder.contains(t.realTarget)&&(n="left"),"top"==n&&0!==o?t.preventDefault():"left"==n&&0!==r?t.preventDefault():"bottom"==n&&0!==o&&t.preventDefault()}]);o.length;){var r=o.pop();this.eventManager.addEventListener(r[0],r[1],r[2]),this.registeredListeners.push(r)}},deregisterListeners:function(){for(;this.registeredListeners.length;){var e=this.registeredListeners.pop();this.eventManager.removeEventListener(e[0],e[1],e[2])}},onTableScroll:function(e){if(!m()){var t=this.leftOverlay.mainTableScrollableElement,n=this.topOverlay.mainTableScrollableElement,o=e.target;this.keyPressed&&(n!==window&&o!==window&&!e.target.contains(n)||t!==window&&o!==window&&!e.target.contains(t))||("scroll"===e.type?this.syncScrollPositions(e):this.translateMouseWheelToScroll(e))}},onKeyDown:function(e){this.keyPressed=p(e.keyCode,"ARROW_UP|ARROW_RIGHT|ARROW_DOWN|ARROW_LEFT")},onKeyUp:function(){this.keyPressed=!1},translateMouseWheelToScroll:function(e){var t,n=this.topOverlay.clone.wtTable.holder,o=this.bottomOverlay.clone?this.bottomOverlay.clone.wtTable.holder:null,r=this.leftOverlay.clone.wtTable.holder,i={type:"wheel"},s=e.target,a=e.wheelDeltaY||-1*e.deltaY,l=e.wheelDeltaX||-1*e.deltaX;for(1===e.deltaMode&&(a=120*a,l=120*l);s!=document&&null!=s;){if(s.className.indexOf("wtHolder")>-1){t=s;break}s=s.parentNode}return i.target=t,t==n?this.syncScrollPositions(i,-.2*a):t==o?this.syncScrollPositions(i,-.2*a):t==r&&this.syncScrollPositions(i,-.2*l),!1},syncScrollPositions:function(e){var t=void 0!==arguments[1]?arguments[1]:null;if(!this.destroyed){if(0===arguments.length)return void this.syncScrollWithMaster();var n,o,r,i=this.leftOverlay.mainTableScrollableElement,s=this.topOverlay.mainTableScrollableElement,a=e.target,l=0,u=!1,c=!1,f=this.wot.getSetting("preventOverflow");this.topOverlay.needFullRender&&(n=this.topOverlay.clone.wtTable.holder),this.bottomOverlay.needFullRender&&(r=this.bottomOverlay.clone.wtTable.holder),this.leftOverlay.needFullRender&&(o=this.leftOverlay.clone.wtTable.holder),a===document&&(a=window),a===i||a===s?(l=d(f?this.scrollableElement:a),this.horizontalScrolling=!0,this.overlayScrollPositions.master.left=l,u=!0,this.pendingScrollCallbacks.master.left>0?this.pendingScrollCallbacks.master.left--:(n&&n.scrollLeft!==l&&(null==t&&this.pendingScrollCallbacks.top.left++,n.scrollLeft=l,c=i!==window),r&&r.scrollLeft!==l&&(null==t&&this.pendingScrollCallbacks.bottom.left++,r.scrollLeft=l,c=i!==window)),l=h(a),this.verticalScrolling=!0,this.overlayScrollPositions.master.top=l,u=!0,this.pendingScrollCallbacks.master.top>0?this.pendingScrollCallbacks.master.top--:o&&o.scrollTop!==l&&(null==t&&this.pendingScrollCallbacks.left.top++,o.scrollTop=l,c=s!==window)):a===r?(l=d(a),this.horizontalScrolling=!0,this.overlayScrollPositions.bottom.left=l,u=!0,this.pendingScrollCallbacks.bottom.left>0?this.pendingScrollCallbacks.bottom.left--:(null==t&&this.pendingScrollCallbacks.master.left++,i.scrollLeft=l,n&&n.scrollLeft!==l&&(null==t&&this.pendingScrollCallbacks.top.left++,n.scrollLeft=l,c=s!==window)),null!==t&&(u=!0,s.scrollTop+=t)):a===n?(l=d(a),this.horizontalScrolling=!0,this.overlayScrollPositions.top.left=l,u=!0,this.pendingScrollCallbacks.top.left>0?this.pendingScrollCallbacks.top.left--:(null==t&&this.pendingScrollCallbacks.master.left++,i.scrollLeft=l),null!==t&&(u=!0,s.scrollTop+=t),r&&r.scrollLeft!==l&&(null==t&&this.pendingScrollCallbacks.bottom.left++,r.scrollLeft=l,c=s!==window)):a===o&&(l=h(a),this.overlayScrollPositions.left.top!==l&&(this.verticalScrolling=!0,this.overlayScrollPositions.left.top=l,u=!0,this.pendingScrollCallbacks.left.top>0?this.pendingScrollCallbacks.left.top--:(null==t&&this.pendingScrollCallbacks.master.top++,s.scrollTop=l)),null!==t&&(u=!0,s.scrollLeft+=t)),!this.keyPressed&&u&&"scroll"===e.type&&(this.delegatedScrollCallback?this.delegatedScrollCallback=!1:this.refreshAll(),c&&(this.delegatedScrollCallback=!0))}},syncScrollWithMaster:function(){var e=this.topOverlay.mainTableScrollableElement;this.topOverlay.needFullRender&&(this.topOverlay.clone.wtTable.holder.scrollLeft=e.scrollLeft),this.leftOverlay.needFullRender&&(this.leftOverlay.clone.wtTable.holder.scrollTop=e.scrollTop)},updateMainScrollableElements:function(){this.deregisterListeners(),this.leftOverlay.updateMainScrollableElement(),this.topOverlay.updateMainScrollableElement(),this.bottomOverlay.needFullRender&&this.bottomOverlay.updateMainScrollableElement(),this.scrollableElement=u(this.wot.wtTable.TABLE),this.registerListeners()},destroy:function(){this.eventManager.destroy(),this.topOverlay.destroy(),this.bottomOverlay.clone&&this.bottomOverlay.destroy(),this.leftOverlay.destroy(),this.topLeftCornerOverlay&&this.topLeftCornerOverlay.destroy(),this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.clone&&this.bottomLeftCornerOverlay.destroy(),this.debug&&this.debug.destroy(),this.destroyed=!0},refresh:function(){var e=void 0!==arguments[0]&&arguments[0];if(this.topOverlay.areElementSizesAdjusted&&this.leftOverlay.areElementSizesAdjusted){var t=this.wot.wtTable.wtRootElement.parentNode||this.wot.wtTable.wtRootElement,n=t.clientWidth,o=t.clientHeight;n===this.spreaderLastSize.width&&o===this.spreaderLastSize.height||(this.spreaderLastSize.width=n,this.spreaderLastSize.height=o,this.adjustElementsSize())}this.bottomOverlay.clone&&this.bottomOverlay.refresh(e),this.leftOverlay.refresh(e),this.topOverlay.refresh(e),this.topLeftCornerOverlay&&this.topLeftCornerOverlay.refresh(e),this.bottomLeftCornerOverlay&&this.bottomLeftCornerOverlay.clone&&this.bottomLeftCornerOverlay.refresh(e),this.debug&&this.debug.refresh(e)},adjustElementsSize:function(){var e=void 0!==arguments[0]&&arguments[0],t=this.wot.getSetting("totalColumns"),n=this.wot.getSetting("totalRows"),o=this.wot.wtViewport.getRowHeaderWidth(),r=this.wot.wtViewport.getColumnHeaderHeight(),i=this.wot.wtTable.hider.style;i.width=o+this.leftOverlay.sumCellSizes(0,t)+"px",i.height=r+this.topOverlay.sumCellSizes(0,n)+1+"px",this.topOverlay.adjustElementsSize(e),this.leftOverlay.adjustElementsSize(e),this.bottomOverlay.clone&&this.bottomOverlay.adjustElementsSize(e)},applyToDOM:function(){this.topOverlay.areElementSizesAdjusted&&this.leftOverlay.areElementSizesAdjusted||this.adjustElementsSize(),this.topOverlay.applyToDOM(),this.bottomOverlay.clone&&this.bottomOverlay.applyToDOM(),this.leftOverlay.applyToDOM()},getParentOverlay:function(e){if(!e)return null;var t=[this.topOverlay,this.leftOverlay,this.bottomOverlay,this.topLeftCornerOverlay,this.bottomLeftCornerOverlay],n=null;return f(t,function(t,o){t&&t.clone&&t.clone.wtTable.TABLE.contains(e)&&(n=t.clone)}),n}},{}),window.WalkontableOverlays=w},{eventManager:42,"helpers/array":43,"helpers/browser":44,"helpers/dom/element":47,"helpers/unicode":56}],18:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableScroll:{get:function(){return p}},__esModule:{value:!0}});var o,r,i=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),s=i.innerHeight,a=i.innerWidth,l=i.getScrollLeft,u=i.getScrollTop,c=i.offset,d=(r=e("helpers/number"),r&&r.__esModule&&r||{default:r}),h=d.rangeEach,f=d.rangeEachReverse,p=function(e){this.wot=e,this.instance=e};$traceurRuntime.createClass(p,{scrollViewport:function(e){if(this.wot.drawn){var t=this._getVariables(),n=t.topOverlay,o=t.leftOverlay,r=t.totalRows,i=t.totalColumns,s=t.fixedRowsTop,a=t.fixedRowsBottom,l=t.fixedColumnsLeft;if(e.row<0||e.row>Math.max(r-1,0))throw new Error("row "+e.row+" does not exist");if(e.col<0||e.col>Math.max(i-1,0))throw new Error("column "+e.col+" does not exist");e.row>=s&&e.row<this.getFirstVisibleRow()?n.scrollTo(e.row):e.row>this.getLastVisibleRow()&&e.row<r-a&&n.scrollTo(e.row,!0),e.col>=l&&e.col<this.getFirstVisibleColumn()?o.scrollTo(e.col):e.col>this.getLastVisibleColumn()&&o.scrollTo(e.col,!0)}},getFirstVisibleRow:function(){var e=this._getVariables(),t=e.topOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalRows,i=e.fixedRowsTop,a=n.getFirstVisibleRow();if(t.mainTableScrollableElement===window){var l=c(n.wtRootElement),d=s(n.hider),h=s(window),p=u(window);if(l.top+d-h<=p){var m=o.getColumnHeaderHeight();m+=t.sumCellSizes(0,i),f(r,1,function(e){if(m+=t.sumCellSizes(e-1,e),l.top+d-m<=p)return a=e,!1})}}return a},getLastVisibleRow:function(){var e=this._getVariables(),t=e.topOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalRows,i=n.getLastVisibleRow();if(t.mainTableScrollableElement===window){var a=c(n.wtRootElement),l=s(window),d=u(window);if(a.top>d){var f=o.getColumnHeaderHeight();h(1,r,function(e){if(f+=t.sumCellSizes(e-1,e),a.top+f-d>=l)return i=e-2,!1})}}return i},getFirstVisibleColumn:function(){var e=this._getVariables(),t=e.leftOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalColumns,i=(e.fixedColumnsLeft,n.getFirstVisibleColumn());if(t.mainTableScrollableElement===window){var s=c(n.wtRootElement),u=a(n.hider),d=a(window),h=l(window);if(s.left+u-d<=h){var p=o.getRowHeaderWidth();f(r,1,function(e){if(p+=t.sumCellSizes(e-1,e),s.left+u-p<=h)return i=e,!1})}}return i},getLastVisibleColumn:function(){var e=this._getVariables(),t=e.leftOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalColumns,i=n.getLastVisibleColumn();if(t.mainTableScrollableElement===window){var s=c(n.wtRootElement),u=a(window),d=l(window);if(s.left>d){var f=o.getRowHeaderWidth();h(1,r,function(e){if(f+=t.sumCellSizes(e-1,e),s.left+f-d>=u)return i=e-2,!1})}}return i},_getVariables:function(){var e=this.wot,t=e.wtOverlays.topOverlay,n=e.wtOverlays.leftOverlay,o=e.wtTable,r=e.wtViewport,i=e.getSetting("totalRows"),s=e.getSetting("totalColumns"),a=e.getSetting("fixedRowsTop"),l=e.getSetting("fixedRowsBottom"),u=e.getSetting("fixedColumnsLeft");return{topOverlay:t,leftOverlay:n,wtTable:o,wtViewport:r,totalRows:i,totalColumns:s,fixedRowsTop:a,fixedRowsBottom:l,fixedColumnsLeft:u}}},{}),window.WalkontableScroll=p},{"helpers/dom/element":47,"helpers/number":52}],19:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableSelection:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}).addClass,l=(r=e("border"),r&&r.__esModule&&r||{default:r}).WalkontableBorder,u=(i=e("cell/coords"),i&&i.__esModule&&i||{default:i}).WalkontableCellCoords,c=(s=e("cell/range"),s&&s.__esModule&&s||{default:s}).WalkontableCellRange,d=function(e,t){this.settings=e,this.cellRange=t||null,this.instanceBorders={}};$traceurRuntime.createClass(d,{getBorder:function(e){return this.instanceBorders[e.guid]?this.instanceBorders[e.guid]:void(this.instanceBorders[e.guid]=new l(e,this.settings))},isEmpty:function(){return null===this.cellRange},add:function(e){this.isEmpty()?this.cellRange=new c(e,e,e):this.cellRange.expand(e)},replace:function(e,t){if(!this.isEmpty()){if(this.cellRange.from.isEqual(e))return this.cellRange.from=t,!0;if(this.cellRange.to.isEqual(e))return this.cellRange.to=t,!0}return!1},clear:function(){this.cellRange=null},getCorners:function(){var e=this.cellRange.getTopLeftCorner(),t=this.cellRange.getBottomRightCorner();return[e.row,e.col,t.row,t.col]},addClassAtCoords:function(e,t,n,o){var r=e.wtTable.getCell(new u(t,n));"object"==typeof r&&a(r,o)},draw:function(e){if(this.isEmpty()){if(this.settings.border){var t=this.getBorder(e);t&&t.disappear()}}else{for(var n,o,r,i=e.wtTable.getRenderedRowsCount(),s=e.wtTable.getRenderedColumnsCount(),l=this.getCorners(),u=0;u<s;u++)o=e.wtTable.columnFilter.renderedToSource(u),o>=l[1]&&o<=l[3]&&(r=e.wtTable.getColumnHeader(o),r&&this.settings.highlightColumnClassName&&a(r,this.settings.highlightColumnClassName));for(var c=0;c<i;c++){n=e.wtTable.rowFilter.renderedToSource(c),n>=l[0]&&n<=l[2]&&(r=e.wtTable.getRowHeader(n),r&&this.settings.highlightRowClassName&&a(r,this.settings.highlightRowClassName));for(var d=0;d<s;d++)o=e.wtTable.columnFilter.renderedToSource(d),n>=l[0]&&n<=l[2]&&o>=l[1]&&o<=l[3]?this.settings.className&&this.addClassAtCoords(e,n,o,this.settings.className):n>=l[0]&&n<=l[2]?this.settings.highlightRowClassName&&this.addClassAtCoords(e,n,o,this.settings.highlightRowClassName):o>=l[1]&&o<=l[3]&&this.settings.highlightColumnClassName&&this.addClassAtCoords(e,n,o,this.settings.highlightColumnClassName)}if(e.getSetting("onBeforeDrawBorders",l,this.settings.className),this.settings.border){var h=this.getBorder(e);h&&h.appear(l)}}}},{}),window.WalkontableSelection=d},{border:3,"cell/coords":6,"cell/range":7,"helpers/dom/element":47}],20:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableSettings:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}).fastInnerText,i=function(e,t){var n=this;this.wot=e,this.instance=e,this.defaults={table:void 0,debug:!1,externalRowCalculator:!1,stretchH:"none",currentRowClassName:null,currentColumnClassName:null,preventOverflow:function(){return!1},data:void 0,fixedColumnsLeft:0,fixedRowsTop:0,fixedRowsBottom:0,minSpareRows:0,rowHeaders:function(){return[]},columnHeaders:function(){return[]},totalRows:void 0,totalColumns:void 0,cellRenderer:function(e,t,o){
+var i=n.getSetting("data",e,t);r(o,void 0===i||null===i?"":i)},columnWidth:function(e){},rowHeight:function(e){},defaultRowHeight:23,defaultColumnWidth:50,selections:null,hideBorderOnMouseDownOver:!1,viewportRowCalculatorOverride:null,viewportColumnCalculatorOverride:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,onBeforeDrawBorders:null,onScrollVertically:null,onScrollHorizontally:null,onBeforeTouchScroll:null,onAfterMomentumScroll:null,onBeforeStretchingColumnWidth:function(e){return e},scrollbarWidth:10,scrollbarHeight:10,renderAllRows:!1,groups:!1,rowHeaderWidth:null,columnHeaderHeight:null},this.settings={};for(var o in this.defaults)if(this.defaults.hasOwnProperty(o))if(void 0!==t[o])this.settings[o]=t[o];else{if(void 0===this.defaults[o])throw new Error('A required setting "'+o+'" was not provided');this.settings[o]=this.defaults[o]}};$traceurRuntime.createClass(i,{update:function(e,t){if(void 0===t)for(var n in e)e.hasOwnProperty(n)&&(this.settings[n]=e[n]);else this.settings[e]=t;return this.wot},getSetting:function(e,t,n,o,r){return"function"==typeof this.settings[e]?this.settings[e](t,n,o,r):void 0!==t&&Array.isArray(this.settings[e])?this.settings[e][t]:this.settings[e]},has:function(e){return!!this.settings[e]}},{}),window.WalkontableSettings=i},{"helpers/dom/element":47}],21:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableTable:{get:function(){return R}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}),c=u.getStyle,d=u.getTrimmingContainer,h=u.hasClass,f=u.index,p=u.offset,m=u.removeClass,g=u.removeTextNodes,w=u.overlayContainsElement,v=u.closest,y=(r=e("cell/coords"),r&&r.__esModule&&r||{default:r}).WalkontableCellCoords,b=((i=e("cell/range"),i&&i.__esModule&&i||{default:i}).WalkontableCellRange,(s=e("filter/column"),s&&s.__esModule&&s||{default:s}).WalkontableColumnFilter),C=(a=e("filter/row"),a&&a.__esModule&&a||{default:a}).WalkontableRowFilter,_=(l=e("tableRenderer"),l&&l.__esModule&&l||{default:l}).WalkontableTableRenderer,R=function(e,t){this.wot=e,this.instance=this.wot,this.TABLE=t,this.TBODY=null,this.THEAD=null,this.COLGROUP=null,this.tableOffset=0,this.holderOffset=0,g(this.TABLE),this.spreader=this.createSpreader(this.TABLE),this.hider=this.createHider(this.spreader),this.holder=this.createHolder(this.hider),this.wtRootElement=this.holder.parentNode,this.alignOverlaysWithTrimmingContainer(),this.fixTableDomTree(),this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length,this.rowFilter=null,this.columnFilter=null};$traceurRuntime.createClass(R,{fixTableDomTree:function(){this.TBODY=this.TABLE.querySelector("tbody"),this.TBODY||(this.TBODY=document.createElement("tbody"),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.querySelector("thead"),this.THEAD||(this.THEAD=document.createElement("thead"),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.querySelector("colgroup"),this.COLGROUP||(this.COLGROUP=document.createElement("colgroup"),this.TABLE.insertBefore(this.COLGROUP,this.THEAD)),this.wot.getSetting("columnHeaders").length&&!this.THEAD.childNodes.length&&this.THEAD.appendChild(document.createElement("TR"))},createSpreader:function(e){var t,n=e.parentNode;return n&&1===n.nodeType&&h(n,"wtHolder")||(t=document.createElement("div"),t.className="wtSpreader",n&&n.insertBefore(t,e),t.appendChild(e)),t.style.position="relative",t},createHider:function(e){var t,n=e.parentNode;return n&&1===n.nodeType&&h(n,"wtHolder")||(t=document.createElement("div"),t.className="wtHider",n&&n.insertBefore(t,e),t.appendChild(e)),t},createHolder:function(e){var t,n=e.parentNode;return n&&1===n.nodeType&&h(n,"wtHolder")||(t=document.createElement("div"),t.style.position="relative",t.className="wtHolder",n&&n.insertBefore(t,e),this.isWorkingOnClone()||(t.parentNode.className+="ht_master handsontable"),t.appendChild(e)),t},alignOverlaysWithTrimmingContainer:function(){var e=d(this.wtRootElement);if(!this.isWorkingOnClone())if(this.holder.parentNode.style.position="relative",e===window){var t=this.wot.getSetting("preventOverflow");t||(this.holder.style.overflow="visible",this.wtRootElement.style.overflow="visible")}else this.holder.style.width=c(e,"width"),this.holder.style.height=c(e,"height"),this.holder.style.overflow=""},isWorkingOnClone:function(){return!!this.wot.cloneSource},draw:function(e){var t=this.instance.getSetting("totalRows");if(this.isWorkingOnClone()||(this.holderOffset=p(this.holder),e=this.wot.wtViewport.createRenderCalculators(e)),e)this.isWorkingOnClone()||this.wot.wtViewport.createVisibleCalculators(),this.wot.wtOverlays&&this.wot.wtOverlays.refresh(!0);else{this.isWorkingOnClone()?this.tableOffset=this.wot.cloneSource.wtTable.tableOffset:this.tableOffset=p(this.TABLE);var n;n=WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_DEBUG)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP_LEFT_CORNER)?0:WalkontableOverlay.isOverlayTypeOf(this.instance.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM)||WalkontableOverlay.isOverlayTypeOf(this.instance.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER)?Math.max(t-this.wot.getSetting("fixedRowsBottom"),0):this.wot.wtViewport.rowsRenderCalculator.startRow;var o;o=WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_DEBUG)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_LEFT)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP_LEFT_CORNER)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER)?0:this.wot.wtViewport.columnsRenderCalculator.startColumn,this.rowFilter=new C(n,t,this.wot.getSetting("columnHeaders").length),this.columnFilter=new b(o,this.wot.getSetting("totalColumns"),this.wot.getSetting("rowHeaders").length),this.alignOverlaysWithTrimmingContainer(),this._doDraw()}return this.refreshSelections(e),this.isWorkingOnClone()||(this.wot.wtOverlays.topOverlay.resetFixedPosition(),this.wot.wtOverlays.bottomOverlay.clone&&this.wot.wtOverlays.bottomOverlay.resetFixedPosition(),this.wot.wtOverlays.leftOverlay.resetFixedPosition(),this.wot.wtOverlays.topLeftCornerOverlay&&this.wot.wtOverlays.topLeftCornerOverlay.resetFixedPosition(),this.instance.wtOverlays.bottomLeftCornerOverlay&&this.instance.wtOverlays.bottomLeftCornerOverlay.clone&&this.wot.wtOverlays.bottomLeftCornerOverlay.resetFixedPosition()),this.wot.drawn=!0,this},_doDraw:function(){var e=new _(this);e.render()},removeClassFromCells:function(e){for(var t=this.TABLE.querySelectorAll("."+e),n=0,o=t.length;n<o;n++)m(t[n],e)},refreshSelections:function(e){if(this.wot.selections){var t=this.wot.selections.length;if(e)for(var n=0;n<t;n++)this.wot.selections[n].settings.className&&this.removeClassFromCells(this.wot.selections[n].settings.className),this.wot.selections[n].settings.highlightRowClassName&&this.removeClassFromCells(this.wot.selections[n].settings.highlightRowClassName),this.wot.selections[n].settings.highlightColumnClassName&&this.removeClassFromCells(this.wot.selections[n].settings.highlightColumnClassName);for(var o=0;o<t;o++)this.wot.selections[o].draw(this.wot,e)}},getCell:function(e){if(this.isRowBeforeRenderedRows(e.row))return-1;if(this.isRowAfterRenderedRows(e.row))return-2;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e.row)];return t?t.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e.col)]:void 0},getColumnHeader:function(e){var t=void 0!==arguments[1]?arguments[1]:0,n=this.THEAD.childNodes[t];if(n)return n.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e)]},getRowHeader:function(e){if(0===this.columnFilter.sourceColumnToVisibleRowHeadedColumn(0))return null;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)];return t?t.childNodes[0]:void 0},getCoords:function(e){"TD"!==e.nodeName&&"TH"!==e.nodeName&&(e=v(e,["TD","TH"]));var t=e.parentNode,n=t.parentNode,o=f(t),r=e.cellIndex;return w(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,e)||w(WalkontableOverlay.CLONE_TOP,e)?"THEAD"===n.nodeName&&(o-=n.childNodes.length):o=n===this.THEAD?this.rowFilter.visibleColHeadedRowToSourceRow(o):this.rowFilter.renderedToSource(o),r=w(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,e)||w(WalkontableOverlay.CLONE_LEFT,e)?this.columnFilter.offsettedTH(r):this.columnFilter.visibleRowHeadedColumnToSourceColumn(r),new y(o,r)},getTrForRow:function(e){return this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)]},getFirstRenderedRow:function(){return this.wot.wtViewport.rowsRenderCalculator.startRow},getFirstVisibleRow:function(){return this.wot.wtViewport.rowsVisibleCalculator.startRow},getFirstRenderedColumn:function(){return this.wot.wtViewport.columnsRenderCalculator.startColumn},getFirstVisibleColumn:function(){return this.wot.wtViewport.columnsVisibleCalculator.startColumn},getLastRenderedRow:function(){return this.wot.wtViewport.rowsRenderCalculator.endRow},getLastVisibleRow:function(){return this.wot.wtViewport.rowsVisibleCalculator.endRow},getLastRenderedColumn:function(){return this.wot.wtViewport.columnsRenderCalculator.endColumn},getLastVisibleColumn:function(){return this.wot.wtViewport.columnsVisibleCalculator.endColumn},isRowBeforeRenderedRows:function(e){return this.rowFilter.sourceToRendered(e)<0&&e>=0},isRowAfterViewport:function(e){return this.rowFilter.sourceToRendered(e)>this.getLastVisibleRow()},isRowAfterRenderedRows:function(e){return this.rowFilter.sourceToRendered(e)>this.getLastRenderedRow()},isColumnBeforeViewport:function(e){return this.columnFilter.sourceToRendered(e)<0&&e>=0},isColumnAfterViewport:function(e){return this.columnFilter.sourceToRendered(e)>this.getLastVisibleColumn()},isLastRowFullyVisible:function(){return this.getLastVisibleRow()===this.getLastRenderedRow()},isLastColumnFullyVisible:function(){return this.getLastVisibleColumn()===this.getLastRenderedColumn()},getRenderedColumnsCount:function(){var e=this.wot.wtViewport.columnsRenderCalculator.count,t=this.wot.getSetting("totalColumns");if(this.wot.isOverlayName(WalkontableOverlay.CLONE_DEBUG))e=t;else if(this.wot.isOverlayName(WalkontableOverlay.CLONE_LEFT)||this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP_LEFT_CORNER)||this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))return Math.min(this.wot.getSetting("fixedColumnsLeft"),t);return e},getRenderedRowsCount:function(){var e=this.wot.wtViewport.rowsRenderCalculator.count,t=this.wot.getSetting("totalRows");return this.wot.isOverlayName(WalkontableOverlay.CLONE_DEBUG)?e=t:this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP)||this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP_LEFT_CORNER)?e=Math.min(this.wot.getSetting("fixedRowsTop"),t):(this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))&&(e=Math.min(this.wot.getSetting("fixedRowsBottom"),t)),e},getVisibleRowsCount:function(){return this.wot.wtViewport.rowsVisibleCalculator.count},allRowsInViewport:function(){return this.wot.getSetting("totalRows")==this.getVisibleRowsCount()},getRowHeight:function(e){var t=this.wot.wtSettings.settings.rowHeight(e),n=this.wot.wtViewport.oversizedRows[e];return void 0!==n&&(t=void 0===t?n:Math.max(t,n)),t},getColumnHeaderHeight:function(e){var t=this.wot.wtSettings.settings.defaultRowHeight,n=this.wot.wtViewport.oversizedColumnHeaders[e];return void 0!==n&&(t=t?Math.max(t,n):n),t},getVisibleColumnsCount:function(){return this.wot.wtViewport.columnsVisibleCalculator.count},allColumnsInViewport:function(){return this.wot.getSetting("totalColumns")==this.getVisibleColumnsCount()},getColumnWidth:function(e){var t=this.wot.wtSettings.settings.columnWidth;return"function"==typeof t?t=t(e):"object"==typeof t&&(t=t[e]),t||this.wot.wtSettings.settings.defaultColumnWidth},getStretchedColumnWidth:function(e){var t=this.getColumnWidth(e),n=null==t?this.instance.wtSettings.settings.defaultColumnWidth:t,o=this.wot.wtViewport.columnsRenderCalculator;if(o){var r=o.getStretchedColumnWidth(e,n);r&&(n=r)}return n}},{}),window.WalkontableTable=R},{"cell/coords":6,"cell/range":7,"filter/column":10,"filter/row":11,"helpers/dom/element":47,tableRenderer:22}],22:[function(e,t,n){"use strict";function o(e,t){var n=document.createElement("TH");return t.insertBefore(n,e),t.removeChild(e),n}function r(e,t){var n=document.createElement("TD");return t.insertBefore(n,e),t.removeChild(e),n}Object.defineProperties(n,{WalkontableTableRenderer:{get:function(){return p}},__esModule:{value:!0}});var i,s=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),a=s.addClass,l=s.empty,u=s.getScrollbarWidth,c=s.hasClass,d=s.innerHeight,h=s.outerWidth,f=!1,p=function(e){this.wtTable=e,this.wot=e.instance,this.instance=e.instance,this.rowFilter=e.rowFilter,this.columnFilter=e.columnFilter,this.TABLE=e.TABLE,this.THEAD=e.THEAD,this.TBODY=e.TBODY,this.COLGROUP=e.COLGROUP,this.rowHeaders=[],this.rowHeaderCount=0,this.columnHeaders=[],this.columnHeaderCount=0,this.fixedRowsTop=0,this.fixedRowsBottom=0};$traceurRuntime.createClass(p,{render:function(){this.wtTable.isWorkingOnClone()||this.wot.getSetting("beforeDraw",!0),this.rowHeaders=this.wot.getSetting("rowHeaders"),this.rowHeaderCount=this.rowHeaders.length,this.fixedRowsTop=this.wot.getSetting("fixedRowsTop"),this.fixedRowsBottom=this.wot.getSetting("fixedRowsBottom"),this.columnHeaders=this.wot.getSetting("columnHeaders"),this.columnHeaderCount=this.columnHeaders.length;var e,t=this.wtTable.getRenderedColumnsCount(),n=this.wtTable.getRenderedRowsCount(),o=this.wot.getSetting("totalColumns"),r=this.wot.getSetting("totalRows"),i=!1;if((WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))&&(this.columnHeaders=[],this.columnHeaderCount=0),o>=0&&(this.adjustAvailableNodes(),i=!0,this.renderColumnHeaders(),this.renderRows(r,n,t),this.wtTable.isWorkingOnClone()||(e=this.wot.wtViewport.getWorkspaceWidth(),this.wot.wtViewport.containerWidth=null),this.adjustColumnWidths(t),this.markOversizedColumnHeaders(),this.adjustColumnHeaderHeights()),i||this.adjustAvailableNodes(),this.removeRedundantRows(n),this.wtTable.isWorkingOnClone()&&!this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.markOversizedRows(),this.wtTable.isWorkingOnClone())this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)&&this.wot.cloneSource.wtOverlays.adjustElementsSize();else{this.wot.wtViewport.createVisibleCalculators(),this.wot.wtOverlays.refresh(!1);var s=h(this.wtTable.hider),a=h(this.wtTable.TABLE);if(0!==s&&a!==s&&this.adjustColumnWidths(t),this.wot.wtOverlays.applyToDOM(),e!==this.wot.wtViewport.getWorkspaceWidth()){this.wot.wtViewport.containerWidth=null;var l=this.wtTable.getFirstRenderedColumn(),u=this.wtTable.getLastRenderedColumn(),c=this.wot.getSetting("rowHeaderWidth");if(null!=c)for(var d=0;d<this.rowHeaderCount;d++)this.COLGROUP.childNodes[d].style.width=(isNaN(c)?c[d]:c)+"px";for(var f=l;f<u;f++){var p=this.wtTable.getStretchedColumnWidth(f),m=this.columnFilter.sourceToRendered(f);this.COLGROUP.childNodes[m+this.rowHeaderCount].style.width=p+"px"}}this.wot.getSetting("onDraw",!0)}},removeRedundantRows:function(e){for(;this.wtTable.tbodyChildrenLength>e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--},renderRows:function(e,t,n){for(var o,r,i=0,s=this.rowFilter.renderedToSource(i),a=this.wtTable.isWorkingOnClone();s<e&&s>=0&&(!f&&i>1e3&&(f=!0,console.warn('Performance tip: Handsontable rendered more than 1000 visible rows. Consider limiting the number of rendered rows by specifying the table height and/or turning off the "renderAllRows" option.')),void 0===t||i!==t);){if(r=this.getOrCreateTrForRow(i,r),this.renderRowHeaders(s,r),this.adjustColumns(r,n+this.rowHeaderCount),o=this.renderCells(s,r,n),a&&!this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.resetOversizedRow(s),r.firstChild){var l=this.wot.wtTable.getRowHeight(s);l?(l--,r.firstChild.style.height=l+"px"):r.firstChild.style.height=""}i++,s=this.rowFilter.renderedToSource(i)}},resetOversizedRow:function(e){this.wot.getSetting("externalRowCalculator")||this.wot.wtViewport.oversizedRows&&this.wot.wtViewport.oversizedRows[e]&&(this.wot.wtViewport.oversizedRows[e]=void 0)},markOversizedRows:function(){if(!this.wot.getSetting("externalRowCalculator")){var e,t,n,o,r,i=this.instance.wtTable.TBODY.childNodes.length,s=i*this.instance.wtSettings.settings.defaultRowHeight,a=d(this.instance.wtTable.TBODY)-1;this.instance.getSetting("totalRows");if(s!==a||this.instance.getSetting("fixedRowsBottom"))for(;i;)i--,n=this.instance.wtTable.rowFilter.renderedToSource(i),e=this.instance.wtTable.getRowHeight(n),o=this.instance.wtTable.getTrForRow(n),r=o.querySelector("th"),t=r?d(r):d(o)-1,(!e&&this.instance.wtSettings.settings.defaultRowHeight<t||e<t)&&(this.instance.wtViewport.oversizedRows[n]=++t)}},markOversizedColumnHeaders:function(){var e=this.wot.getOverlayName();if(this.columnHeaderCount&&!this.wot.wtViewport.hasOversizedColumnHeadersMarked[e]&&!this.wtTable.isWorkingOnClone()){for(var t=this.wtTable.getRenderedColumnsCount(),n=0;n<this.columnHeaderCount;n++)for(var o=-1*this.rowHeaderCount;o<t;o++)this.markIfOversizedColumnHeader(o);this.wot.wtViewport.hasOversizedColumnHeadersMarked[e]=!0}},adjustColumnHeaderHeights:function(){for(var e=this.wot.getSetting("columnHeaders"),t=this.wot.wtTable.THEAD.childNodes,n=this.wot.wtViewport.oversizedColumnHeaders,o=0,r=e.length;o<r;o++)if(n[o]){if(0===t[o].childNodes.length)return;t[o].childNodes[0].style.height=n[o]+"px"}},markIfOversizedColumnHeader:function(e){for(var t,n,o,r=this.wot.wtTable.columnFilter.renderedToSource(e),i=this.columnHeaderCount,s=this.wot.wtSettings.settings.defaultRowHeight,a=this.wot.getSetting("columnHeaderHeight")||[];i;)i--,t=this.wot.wtTable.getColumnHeaderHeight(i),n=this.wot.wtTable.getColumnHeader(r,i),n&&(o=d(n),(!t&&s<o||t<o)&&(this.wot.wtViewport.oversizedColumnHeaders[i]=o),Array.isArray(a)?null!=a[i]&&(this.wot.wtViewport.oversizedColumnHeaders[i]=a[i]):isNaN(a)||(this.wot.wtViewport.oversizedColumnHeaders[i]=a),this.wot.wtViewport.oversizedColumnHeaders[i]<(a[i]||a)&&(this.wot.wtViewport.oversizedColumnHeaders[i]=a[i]||a))},renderCells:function(e,t,n){for(var o,i,s=0;s<n;s++)i=this.columnFilter.renderedToSource(s),o=0===s?t.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(i)]:o.nextSibling,"TH"==o.nodeName&&(o=r(o,t)),c(o,"hide")||(o.className=""),o.removeAttribute("style"),this.wot.wtSettings.settings.cellRenderer(e,i,o);return o},adjustColumnWidths:function(e){var t=0,n=this.wot.cloneSource?this.wot.cloneSource:this.wot,o=n.wtTable.holder;o.offsetHeight<o.scrollHeight&&(t=u()),this.wot.wtViewport.columnsRenderCalculator.refreshStretching(this.wot.wtViewport.getViewportWidth()-t);var r=this.wot.getSetting("rowHeaderWidth");if(null!=r)for(var i=0;i<this.rowHeaderCount;i++)this.COLGROUP.childNodes[i].style.width=(isNaN(r)?r[i]:r)+"px";for(var s=0;s<e;s++){var a=this.wtTable.getStretchedColumnWidth(this.columnFilter.renderedToSource(s));this.COLGROUP.childNodes[s+this.rowHeaderCount].style.width=a+"px"}},appendToTbody:function(e){this.TBODY.appendChild(e),this.wtTable.tbodyChildrenLength++},getOrCreateTrForRow:function(e,t){var n;return e>=this.wtTable.tbodyChildrenLength?(n=this.createRow(),this.appendToTbody(n)):n=0===e?this.TBODY.firstChild:t.nextSibling,n.className&&n.removeAttribute("class"),n},createRow:function(){for(var e=document.createElement("TR"),t=0;t<this.rowHeaderCount;t++)e.appendChild(document.createElement("TH"));return e},renderRowHeader:function(e,t,n){n.className="",n.removeAttribute("style"),this.rowHeaders[t](e,n,t)},renderRowHeaders:function(e,t){for(var n=t.firstChild,r=0;r<this.rowHeaderCount;r++)n?"TD"==n.nodeName&&(n=o(n,t)):(n=document.createElement("TH"),t.appendChild(n)),this.renderRowHeader(e,r,n),n=n.nextSibling},adjustAvailableNodes:function(){this.adjustColGroups(),this.adjustThead()},renderColumnHeaders:function(){if(this.columnHeaderCount)for(var e=this.wtTable.getRenderedColumnsCount(),t=0;t<this.columnHeaderCount;t++)for(var n=this.getTrForColumnHeaders(t),o=-1*this.rowHeaderCount;o<e;o++){var r=this.columnFilter.renderedToSource(o);this.renderColumnHeader(t,r,n.childNodes[o+this.rowHeaderCount])}},adjustColGroups:function(){for(var e=this.wtTable.getRenderedColumnsCount();this.wtTable.colgroupChildrenLength<e+this.rowHeaderCount;)this.COLGROUP.appendChild(document.createElement("COL")),this.wtTable.colgroupChildrenLength++;for(;this.wtTable.colgroupChildrenLength>e+this.rowHeaderCount;)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.wtTable.colgroupChildrenLength--;this.rowHeaderCount&&a(this.COLGROUP.childNodes[0],"rowHeader")},adjustThead:function(){var e=this.wtTable.getRenderedColumnsCount(),t=this.THEAD.firstChild;if(this.columnHeaders.length){for(var n=0,o=this.columnHeaders.length;n<o;n++){for(t=this.THEAD.childNodes[n],t||(t=document.createElement("TR"),this.THEAD.appendChild(t)),this.theadChildrenLength=t.childNodes.length;this.theadChildrenLength<e+this.rowHeaderCount;)t.appendChild(document.createElement("TH")),this.theadChildrenLength++;for(;this.theadChildrenLength>e+this.rowHeaderCount;)t.removeChild(t.lastChild),this.theadChildrenLength--}var r=this.THEAD.childNodes.length;if(r>this.columnHeaders.length)for(var i=this.columnHeaders.length;i<r;i++)this.THEAD.removeChild(this.THEAD.lastChild)}else t&&l(t)},getTrForColumnHeaders:function(e){return this.THEAD.childNodes[e]},renderColumnHeader:function(e,t,n){return n.className="",n.removeAttribute("style"),this.columnHeaders[e](t,n,e)},adjustColumns:function(e,t){for(var n=e.childNodes.length;n<t;){var o=document.createElement("TD");e.appendChild(o),n++}for(;n>t;)e.removeChild(e.lastChild),n--},removeRedundantColumns:function(e){for(;this.wtTable.tbodyChildrenLength>e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--}},{}),window.WalkontableTableRenderer=p},{"helpers/dom/element":47}],23:[function(e,t,n){"use strict";Object.defineProperties(n,{WalkontableViewport:{get:function(){return v}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,u=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),c=u.getScrollbarWidth,d=(u.getScrollTop,u.getStyle),h=u.offset,f=u.outerHeight,p=u.outerWidth,m=(i=e("eventManager"),i&&i.__esModule&&i||{default:i}).EventManager,g=(s=e("calculator/viewportColumns"),s&&s.__esModule&&s||{default:s}).WalkontableViewportColumnsCalculator,w=(a=e("calculator/viewportRows"),a&&a.__esModule&&a||{default:a}).WalkontableViewportRowsCalculator,v=function(e){var t=this;this.wot=e,this.instance=this.wot,this.oversizedRows=[],this.oversizedColumnHeaders=[],this.hasOversizedColumnHeadersMarked={},this.clientHeight=0,this.containerWidth=NaN,this.rowHeaderWidth=NaN,this.rowsVisibleCalculator=null,this.columnsVisibleCalculator=null,this.eventManager=new m(this.wot),this.eventManager.addEventListener(window,"resize",function(){t.clientHeight=t.getWorkspaceHeight()})};$traceurRuntime.createClass(v,{getWorkspaceHeight:function(){var e,t=this.instance.wtOverlays.topOverlay.trimmingContainer,n=0;return t===window?n=document.documentElement.clientHeight:(e=f(t),n=e>0&&t.clientHeight>0?t.clientHeight:1/0),n},getWorkspaceWidth:function(){var e,t,n=this.wot.getSetting("totalColumns"),o=this.instance.wtOverlays.leftOverlay.trimmingContainer,r=this.wot.getSetting("stretchH"),i=document.documentElement.offsetWidth,s=this.wot.getSetting("preventOverflow");return s?p(this.instance.wtTable.wtRootElement):(e=l.freezeOverlays?Math.min(i-this.getWorkspaceOffset().left,i):Math.min(this.getContainerFillWidth(),i-this.getWorkspaceOffset().left,i),o===window&&n>0&&this.sumColumnWidths(0,n-1)>e?document.documentElement.clientWidth:o!==window&&(t=d(this.instance.wtOverlays.leftOverlay.trimmingContainer,"overflow"),"scroll"==t||"hidden"==t||"auto"==t)?Math.max(e,o.clientWidth):"none"!==r&&r?e:Math.max(e,p(this.instance.wtTable.TABLE)))},hasVerticalScroll:function(){return this.getWorkspaceActualHeight()>this.getWorkspaceHeight()},hasHorizontalScroll:function(){return this.getWorkspaceActualWidth()>this.getWorkspaceWidth()},sumColumnWidths:function(e,t){for(var n=0;e<t;)n+=this.wot.wtTable.getColumnWidth(e),e++;return n},getContainerFillWidth:function(){if(this.containerWidth)return this.containerWidth;var e,t,n=this.instance.wtTable.holder;return t=document.createElement("div"),t.style.width="100%",t.style.height="1px",n.appendChild(t),e=t.offsetWidth,this.containerWidth=e,n.removeChild(t),e},getWorkspaceOffset:function(){return h(this.wot.wtTable.TABLE)},getWorkspaceActualHeight:function(){return f(this.wot.wtTable.TABLE)},getWorkspaceActualWidth:function(){return p(this.wot.wtTable.TABLE)||p(this.wot.wtTable.TBODY)||p(this.wot.wtTable.THEAD)},getColumnHeaderHeight:function(){return isNaN(this.columnHeaderHeight)&&(this.columnHeaderHeight=f(this.wot.wtTable.THEAD)),this.columnHeaderHeight},getViewportHeight:function(){var e,t=this.getWorkspaceHeight();return t===1/0?t:(e=this.getColumnHeaderHeight(),e>0&&(t-=e),t)},getRowHeaderWidth:function(){var e=this.instance.getSetting("rowHeaderWidth"),t=this.instance.getSetting("rowHeaders");if(e){this.rowHeaderWidth=0;for(var n=0,o=t.length;n<o;n++)this.rowHeaderWidth+=e[n]||e}if(this.wot.cloneSource)return this.wot.cloneSource.wtViewport.getRowHeaderWidth();if(isNaN(this.rowHeaderWidth))if(t.length){var r=this.instance.wtTable.TABLE.querySelector("TH");this.rowHeaderWidth=0;for(var i=0,s=t.length;i<s;i++)r?(this.rowHeaderWidth+=p(r),r=r.nextSibling):this.rowHeaderWidth+=50}else this.rowHeaderWidth=0;return this.rowHeaderWidth},getViewportWidth:function(){var e,t=this.getWorkspaceWidth();return t===1/0?t:(e=this.getRowHeaderWidth(),e>0?t-e:t)},createRowsCalculator:function(){var e,t,n,o,r,i,s,a=void 0!==arguments[0]&&arguments[0],l=this;return this.rowHeaderWidth=NaN,e=this.wot.wtSettings.settings.renderAllRows?1/0:this.getViewportHeight(),t=this.wot.wtOverlays.topOverlay.getScrollPosition()-this.wot.wtOverlays.topOverlay.getTableParentOffset(),t<0&&(t=0),n=this.wot.getSetting("fixedRowsTop"),r=this.wot.getSetting("fixedRowsBottom"),s=this.wot.getSetting("totalRows"),n&&(i=this.wot.wtOverlays.topOverlay.sumCellSizes(0,n),t+=i,e-=i),r&&this.wot.wtOverlays.bottomOverlay.clone&&(i=this.wot.wtOverlays.bottomOverlay.sumCellSizes(s-r,s),e-=i),o=this.wot.wtTable.holder.clientHeight===this.wot.wtTable.holder.offsetHeight?0:c(),new w(e,t,this.wot.getSetting("totalRows"),function(e){return l.wot.wtTable.getRowHeight(e)},a?null:this.wot.wtSettings.settings.viewportRowCalculatorOverride,a,o)},createColumnsCalculator:function(){var e,t,n=void 0!==arguments[0]&&arguments[0],o=this,r=this.getViewportWidth();if(this.columnHeaderHeight=NaN,e=this.wot.wtOverlays.leftOverlay.getScrollPosition()-this.wot.wtOverlays.leftOverlay.getTableParentOffset(),e<0&&(e=0),t=this.wot.getSetting("fixedColumnsLeft")){var i=this.wot.wtOverlays.leftOverlay.sumCellSizes(0,t);e+=i,r-=i}return this.wot.wtTable.holder.clientWidth!==this.wot.wtTable.holder.offsetWidth&&(r-=c()),new g(r,e,this.wot.getSetting("totalColumns"),function(e){return o.wot.wtTable.getColumnWidth(e)},n?null:this.wot.wtSettings.settings.viewportColumnCalculatorOverride,n,this.wot.getSetting("stretchH"),function(e,t){return o.wot.getSetting("onBeforeStretchingColumnWidth",e,t)})},createRenderCalculators:function(){var e=void 0!==arguments[0]&&arguments[0];if(e){var t=this.createRowsCalculator(!0),n=this.createColumnsCalculator(!0);this.areAllProposedVisibleRowsAlreadyRendered(t)&&this.areAllProposedVisibleColumnsAlreadyRendered(n)||(e=!1)}return e||(this.rowsRenderCalculator=this.createRowsCalculator(),this.columnsRenderCalculator=this.createColumnsCalculator()),this.rowsVisibleCalculator=null,this.columnsVisibleCalculator=null,e},createVisibleCalculators:function(){this.rowsVisibleCalculator=this.createRowsCalculator(!0),this.columnsVisibleCalculator=this.createColumnsCalculator(!0)},areAllProposedVisibleRowsAlreadyRendered:function(e){return!!this.rowsVisibleCalculator&&(!(e.startRow<this.rowsRenderCalculator.startRow||e.startRow===this.rowsRenderCalculator.startRow&&e.startRow>0)&&!(e.endRow>this.rowsRenderCalculator.endRow||e.endRow===this.rowsRenderCalculator.endRow&&e.endRow<this.wot.getSetting("totalRows")-1))},areAllProposedVisibleColumnsAlreadyRendered:function(e){return!!this.columnsVisibleCalculator&&(!(e.startColumn<this.columnsRenderCalculator.startColumn||e.startColumn===this.columnsRenderCalculator.startColumn&&e.startColumn>0)&&!(e.endColumn>this.columnsRenderCalculator.endColumn||e.endColumn===this.columnsRenderCalculator.endColumn&&e.endColumn<this.wot.getSetting("totalColumns")-1))}},{}),window.WalkontableViewport=v},{browser:24,"calculator/viewportColumns":4,"calculator/viewportRows":5,eventManager:42,"helpers/dom/element":47}],24:[function(e,t,n){"use strict";function o(e,t){var n=new o.Core(e,t||{});return n.init(),n}var r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,S,E,M,T;t.exports=o,o.utils={},r=e("shims/runtime"),r&&r.__esModule&&r||{default:r},i=e("es6collections"),i&&i.__esModule&&i||{default:i};var O=(s=e("pluginHooks"),s&&s.__esModule&&s||{default:s}).Hooks,k=(a=e("numbro"),a&&a.__esModule&&a||{default:a}).default,x=(l=e("moment"),l&&l.__esModule&&l||{default:l}).default;"object"==typeof window&&("undefined"==typeof window.numbro&&(window.numbro=k),"undefined"==typeof window.moment&&(window.moment=x)),o.hooks||(o.hooks=new O),o.utils.Hooks=O,u=e("core"),u&&u.__esModule&&u||{default:u},c=e("renderers/_cellDecorator"),c&&c.__esModule&&c||{default:c},d=e("cellTypes"),d&&d.__esModule&&d||{default:d},h=e("plugins/jqueryHandsontable"),h&&h.__esModule&&h||{default:h};var H=(f=e("helpers/array"),f&&f.__esModule&&f||{default:f}),D=(p=e("helpers/browser"),p&&p.__esModule&&p||{default:p}),A=(m=e("helpers/data"),m&&m.__esModule&&m||{default:m}),P=(g=e("helpers/date"),g&&g.__esModule&&g||{default:g}),N=(w=e("helpers/feature"),w&&w.__esModule&&w||{default:w}),L=(v=e("helpers/function"),v&&v.__esModule&&v||{default:v}),W=(y=e("helpers/mixed"),y&&y.__esModule&&y||{default:y}),I=(b=e("helpers/number"),b&&b.__esModule&&b||{default:b}),j=(C=e("helpers/object"),C&&C.__esModule&&C||{default:C}),V=(_=e("helpers/setting"),_&&_.__esModule&&_||{default:_}),F=(R=e("helpers/string"),R&&R.__esModule&&R||{default:R}),B=(S=e("helpers/unicode"),S&&S.__esModule&&S||{default:S}),z=(E=e("helpers/dom/element"),E&&E.__esModule&&E||{default:E}),Y=(M=e("helpers/dom/event"),M&&M.__esModule&&M||{default:M}),U=[H,D,A,P,N,L,W,I,j,V,F,B],G=[z,Y];o.buildDate="Wed Jul 27 2016 12:03:17 GMT+0200 (CEST)",o.packageName="handsontable",o.version="0.26.1";var $="@@baseVersion";/^@@/.test($)||(o.baseVersion=$),o.plugins={};var K=(T=e("plugins"),T&&T.__esModule&&T||{default:T}).registerPlugin;o.plugins.registerPlugin=K,o.helper={},o.dom={},o.Dom=o.dom,H.arrayEach(U,function(e){H.arrayEach(Object.getOwnPropertyNames(e),function(t){"_"!==t.charAt(0)&&(o.helper[t]=e[t])})}),H.arrayEach(G,function(e){H.arrayEach(Object.getOwnPropertyNames(e),function(t){"_"!==t.charAt(0)&&(o.dom[t]=e[t])})})},{cellTypes:25,core:26,es6collections:"es6collections","helpers/array":43,"helpers/browser":44,"helpers/data":45,"helpers/date":46,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/feature":49,"helpers/function":50,"helpers/mixed":51,"helpers/number":52,"helpers/object":53,"helpers/setting":54,"helpers/string":55,"helpers/unicode":56,
+moment:"moment",numbro:"numbro",pluginHooks:59,plugins:60,"plugins/jqueryHandsontable":2,"renderers/_cellDecorator":106,"shims/runtime":113}],25:[function(e,t,n){"use strict";var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,S,E,M,T=(o=e("helpers/browser"),o&&o.__esModule&&o||{default:o}).isMobileBrowser,O=(r=e("editors"),r&&r.__esModule&&r||{default:r}).getEditorConstructor,k=(i=e("renderers"),i&&i.__esModule&&i||{default:i}).getRenderer,x=((s=e("editors/autocompleteEditor"),s&&s.__esModule&&s||{default:s}).AutocompleteEditor,(a=e("editors/checkboxEditor"),a&&a.__esModule&&a||{default:a}).CheckboxEditor,(l=e("editors/dateEditor"),l&&l.__esModule&&l||{default:l}).DateEditor,(u=e("editors/dropdownEditor"),u&&u.__esModule&&u||{default:u}).DropdownEditor,(c=e("editors/handsontableEditor"),c&&c.__esModule&&c||{default:c}).HandsontableEditor,(d=e("editors/mobileTextEditor"),d&&d.__esModule&&d||{default:d}).MobileTextEditor,(h=e("editors/numericEditor"),h&&h.__esModule&&h||{default:h}).NumericEditor,(f=e("editors/passwordEditor"),f&&f.__esModule&&f||{default:f}).PasswordEditor,(p=e("editors/selectEditor"),p&&p.__esModule&&p||{default:p}).SelectEditor,(m=e("editors/textEditor"),m&&m.__esModule&&m||{default:m}).TextEditor,(g=e("renderers/autocompleteRenderer"),g&&g.__esModule&&g||{default:g}).AutocompleteRenderer,(w=e("renderers/checkboxRenderer"),w&&w.__esModule&&w||{default:w}).CheckboxRenderer,(v=e("renderers/htmlRenderer"),v&&v.__esModule&&v||{default:v}).HtmlRenderer,(y=e("renderers/numericRenderer"),y&&y.__esModule&&y||{default:y}).NumericRenderer,(b=e("renderers/passwordRenderer"),b&&b.__esModule&&b||{default:b}).PasswordRenderer,(C=e("renderers/textRenderer"),C&&C.__esModule&&C||{default:C}).TextRenderer,(_=e("validators/autocompleteValidator"),_&&_.__esModule&&_||{default:_}).AutocompleteValidator,(R=e("validators/dateValidator"),R&&R.__esModule&&R||{default:R}).DateValidator,(S=e("validators/timeValidator"),S&&S.__esModule&&S||{default:S}).TimeValidator,(E=e("validators/numericValidator"),E&&E.__esModule&&E||{default:E}).NumericValidator,(M=e("browser"),M&&M.__esModule&&M||{default:M}).default);x.AutocompleteCell={editor:O("autocomplete"),renderer:k("autocomplete"),validator:x.AutocompleteValidator},x.CheckboxCell={editor:O("checkbox"),renderer:k("checkbox")},x.TextCell={editor:O(T()?"mobile":"text"),renderer:k("text")},x.NumericCell={editor:O("numeric"),renderer:k("numeric"),validator:x.NumericValidator,dataType:"number"},x.DateCell={editor:O("date"),validator:x.DateValidator,renderer:k("autocomplete")},x.TimeCell={editor:O("text"),validator:x.TimeValidator,renderer:k("text")},x.HandsontableCell={editor:O("handsontable"),renderer:k("autocomplete")},x.PasswordCell={editor:O("password"),renderer:k("password"),copyable:!1},x.DropdownCell={editor:O("dropdown"),renderer:k("autocomplete"),validator:x.AutocompleteValidator},x.cellTypes={text:x.TextCell,date:x.DateCell,time:x.TimeCell,numeric:x.NumericCell,checkbox:x.CheckboxCell,autocomplete:x.AutocompleteCell,handsontable:x.HandsontableCell,password:x.PasswordCell,dropdown:x.DropdownCell},x.cellLookup={validator:{numeric:x.NumericValidator,autocomplete:x.AutocompleteValidator}}},{browser:24,editors:30,"editors/autocompleteEditor":32,"editors/checkboxEditor":33,"editors/dateEditor":34,"editors/dropdownEditor":35,"editors/handsontableEditor":36,"editors/mobileTextEditor":37,"editors/numericEditor":38,"editors/passwordEditor":39,"editors/selectEditor":40,"editors/textEditor":41,"helpers/browser":44,renderers:105,"renderers/autocompleteRenderer":107,"renderers/checkboxRenderer":108,"renderers/htmlRenderer":109,"renderers/numericRenderer":110,"renderers/passwordRenderer":111,"renderers/textRenderer":112,"validators/autocompleteValidator":118,"validators/dateValidator":119,"validators/numericValidator":120,"validators/timeValidator":121}],26:[function(e,t,n){"use strict";var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,S,E=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,M=(r=e("numbro"),r&&r.__esModule&&r||{default:r}).default,T=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),O=T.addClass,k=T.empty,x=T.isChildOfWebComponentTable,H=T.removeClass,D=(s=e("helpers/setting"),s&&s.__esModule&&s||{default:s}).columnFactory,A=(a=e("helpers/function"),a&&a.__esModule&&a||{default:a}).isFunction,P=(l=e("helpers/mixed"),l&&l.__esModule&&l||{default:l}),N=P.isDefined,L=P.isUndefined,W=(u=e("helpers/browser"),u&&u.__esModule&&u||{default:u}).isMobileBrowser,I=(c=e("dataMap"),c&&c.__esModule&&c||{default:c}).DataMap,j=(d=e("editorManager"),d&&d.__esModule&&d||{default:d}).EditorManager,V=(h=e("eventManager"),h&&h.__esModule&&h||{default:h}).eventManager,F=(f=e("helpers/object"),f&&f.__esModule&&f||{default:f}),B=F.deepClone,z=F.duckSchema,Y=F.extend,U=F.isObject,G=F.isObjectEquals,$=F.deepObjectSize,K=(p=e("helpers/array"),p&&p.__esModule&&p||{default:p}),X=K.arrayFlatten,q=K.arrayMap,Z=(m=e("plugins"),m&&m.__esModule&&m||{default:m}).getPlugin,J=(g=e("renderers"),g&&g.__esModule&&g||{default:g}).getRenderer,Q=(w=e("helpers/string"),w&&w.__esModule&&w||{default:w}).randomString,ee=(v=e("helpers/number"),v&&v.__esModule&&v||{default:v}).rangeEach,te=(y=e("tableView"),y&&y.__esModule&&y||{default:y}).TableView,ne=(b=e("dataSource"),b&&b.__esModule&&b||{default:b}).DataSource,oe=(C=e("helpers/data"),C&&C.__esModule&&C||{default:C}),re=oe.translateRowsToColumns,ie=oe.cellMethodLookupFactory,se=oe.spreadsheetColumnLabel,ae=(_=e("3rdparty/walkontable/src/cell/coords"),_&&_.__esModule&&_||{default:_}).WalkontableCellCoords,le=(R=e("3rdparty/walkontable/src/cell/range"),R&&R.__esModule&&R||{default:R}).WalkontableCellRange,ue=(S=e("3rdparty/walkontable/src/calculator/viewportColumns"),S&&S.__esModule&&S||{default:S}).WalkontableViewportColumnsCalculator;E.activeGuid=null,E.Core=function(e,t){function n(){var e=!1;return{validatorsInQueue:0,valid:!0,addValidatorToQueue:function(){this.validatorsInQueue++,e=!1},removeValidatorFormQueue:function(){this.validatorsInQueue=this.validatorsInQueue-1<0?0:this.validatorsInQueue-1,this.checkIfQueueIsEmpty()},onQueueEmpty:function(e){},checkIfQueueIsEmpty:function(){0==this.validatorsInQueue&&0==e&&(e=!0,this.onQueueEmpty(this.valid))}}}function o(e,t,o){function r(){var n;e.length&&(n=E.hooks.run(g,"beforeChange",e,t),A(n)?console.warn("Your beforeChange callback returns a function. It's not supported since Handsontable 0.12.1 (and the returned function will not be executed)."):n===!1&&e.splice(0,e.length)),o()}var i=new n;i.onQueueEmpty=r;for(var s=e.length-1;s>=0;s--)if(null===e[s])e.splice(s,1);else{var a=e[s][0],l=d.propToCol(e[s][1]),u=g.getCellMeta(a,l);if("numeric"===u.type&&"string"==typeof e[s][3]&&e[s][3].length>0&&(/^-?[\d\s]*(\.|\,)?\d*$/.test(e[s][3])||u.format)){var c=e[s][3].length;L(u.language)?M.culture("en-US"):e[s][3].indexOf(".")===c-3&&e[s][3].indexOf(",")===-1?M.culture("en-US"):M.culture(u.language);var h=M.cultureData(M.culture()).delimiters;new RegExp("^\\"+h.decimal+"[0-9]+$").test(e[s][3]+"")&&(e[s][3]="0"+e[s][3]),!M.validate(e[s][3])&&isNaN(parseFloat(e[s][3]))||(e[s][3]=M().unformat(e[s][3]))}g.getCellValidator(u)&&(i.addValidatorToQueue(),g.validateCell(e[s][3],u,function(t,n){return function(o){if("boolean"!=typeof o)throw new Error("Validation error: result is not boolean");o===!1&&n.allowInvalid===!1&&(e.splice(t,1),n.valid=!0,--t),i.removeValidatorFormQueue()}}(s,u),t))}i.checkIfQueueIsEmpty()}function r(e,t){var n=e.length-1;if(!(n<0)){for(;0<=n;n--)if(null!==e[n]){if(null!=e[n][2]||null!=e[n][3]){if(c.settings.allowInsertRow)for(;e[n][0]>g.countRows()-1;)d.createRow();if("array"===g.dataType&&(!c.settings.columns||0===c.settings.columns.length)&&c.settings.allowInsertColumn)for(;d.propToCol(e[n][1])>g.countCols()-1;)d.createCol();d.set(e[n][0],e[n][1],e[n][3])}}else e.splice(n,1);g.forceFullRender=!0,f.adjustRowsAndCols(),E.hooks.run(g,"beforeChangeRender",e,t),p.refreshBorders(null,!0),g.view.wt.wtOverlays.adjustElementsSize(),E.hooks.run(g,"afterChange",e,t||"edit")}}function i(e,t,n){return"object"==typeof e?e:[[e,t,n]]}function s(e){if(e.hasOwnProperty("type")){var t,n={};if("object"==typeof e.type)t=e.type;else if("string"==typeof e.type&&(t=E.cellTypes[e.type],void 0===t))throw new Error('You declared cell type "'+e.type+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');for(var o in t)t.hasOwnProperty(o)&&!e.hasOwnProperty(o)&&(n[o]=t[o]);return n}}function a(e){return E.hooks.run(g,"modifyRow",e)}function l(e){return E.hooks.run(g,"modifyCol",e)}function u(){throw new Error("This method cannot be called because this Handsontable instance has been destroyed")}var c,d,h,f,p,m,g=this,w=function(){},v=V(g);Y(w.prototype,ce.prototype),Y(w.prototype,t),Y(w.prototype,s(t)),this.rootElement=e,this.isHotTableEnv=x(this.rootElement),E.eventManager.isHotTableEnv=this.isHotTableEnv,this.container=document.createElement("DIV"),this.renderCall=!1,e.insertBefore(this.container,e.firstChild),this.guid="ht_"+Q(),h=new ne(g),this.rootElement.id&&"ht_"!==this.rootElement.id.substring(0,3)||(this.rootElement.id=this.guid),c={cellSettings:[],columnSettings:[],columnsSettingConflicts:["data","width"],settings:new w,selRange:null,isPopulated:null,scrollable:null,firstRun:!0},f={alter:function(e,t,n,o,r){function i(e,t,n,o){var r=function(){var e;return"array"===o?e=[]:"object"===o&&(e={}),e},i=q(new Array(n),function(){return r()});i.unshift(t,0),e.splice.apply(e,i)}var s;switch(n=n||1,e){case"insert_row":if(g.getSettings().maxRows===g.countSourceRows())return;s=d.createRow(t,n),i(c.cellSettings,t,n,"array"),s&&(p.isSelected()&&c.selRange.from.row>=t?(c.selRange.from.row=c.selRange.from.row+s,p.transformEnd(s,0)):p.refreshBorders());break;case"insert_col":s=d.createCol(t,n);for(var a=0,u=g.countSourceRows();a<u;a++)c.cellSettings[a]&&i(c.cellSettings[a],t,n);if(s){if(Array.isArray(g.getSettings().colHeaders)){var h=[t,0];h.length+=s,Array.prototype.splice.apply(g.getSettings().colHeaders,h)}p.isSelected()&&c.selRange.from.col>=t?(c.selRange.from.col=c.selRange.from.col+s,p.transformEnd(0,s)):p.refreshBorders()}break;case"remove_row":d.removeRow(t,n),c.cellSettings.splice(t,n);var m=g.countRows(),w=g.getSettings().fixedRowsTop;w>=t+1&&(g.getSettings().fixedRowsTop-=Math.min(n,w-t));var v=g.getSettings().fixedRowsBottom;v&&t>=m-v&&(g.getSettings().fixedRowsBottom-=Math.min(n,v)),f.adjustRowsAndCols(),p.refreshBorders();break;case"remove_col":var y=l(t);d.removeCol(t,n);for(var b=0,C=g.countSourceRows();b<C;b++)c.cellSettings[b]&&c.cellSettings[b].splice(y,n);var _=g.getSettings().fixedColumnsLeft;_>=t+1&&(g.getSettings().fixedColumnsLeft-=Math.min(n,_-t)),Array.isArray(g.getSettings().colHeaders)&&("undefined"==typeof y&&(y=-1),g.getSettings().colHeaders.splice(y,n)),f.adjustRowsAndCols(),p.refreshBorders();break;default:throw new Error('There is no such action "'+e+'"')}r||f.adjustRowsAndCols()},adjustRowsAndCols:function(){if(c.settings.minRows){var e=g.countRows();if(e<c.settings.minRows)for(var t=0,n=c.settings.minRows;t<n-e;t++)d.createRow(g.countRows(),1,!0)}if(c.settings.minSpareRows){var o=g.countEmptyRows(!0);if(o<c.settings.minSpareRows)for(;o<c.settings.minSpareRows&&g.countRows()<c.settings.maxRows;o++)d.createRow(g.countRows(),1,!0)}var r;if((c.settings.minCols||c.settings.minSpareCols)&&(r=g.countEmptyCols(!0)),c.settings.minCols&&!c.settings.columns&&g.countCols()<c.settings.minCols)for(;g.countCols()<c.settings.minCols;r++)d.createCol(g.countCols(),1,!0);if(c.settings.minSpareCols&&!c.settings.columns&&"array"===g.dataType&&r<c.settings.minSpareCols)for(;r<c.settings.minSpareCols&&g.countCols()<c.settings.maxCols;r++)d.createCol(g.countCols(),1,!0);var i=g.countRows(),s=g.countCols();if(0!==i&&0!==s||p.deselect(),p.isSelected()){var a=!1,l=c.selRange.from.row,u=c.selRange.from.col,h=c.selRange.to.row,f=c.selRange.to.col;l>i-1?(l=i-1,a=!0,h>l&&(h=l)):h>i-1&&(h=i-1,a=!0,l>h&&(l=h)),u>s-1?(u=s-1,a=!0,f>u&&(f=u)):f>s-1&&(f=s-1,a=!0,u>f&&(u=f)),a&&g.selectCell(l,u,h,f)}g.view&&g.view.wt.wtOverlays.adjustElementsSize()},populateFromArray:function(e,t,n,o,r,i,s){var a,l,u,d,h=[],f={};if(l=t.length,0===l)return!1;var p,m,w,v;({row:null===n?null:n.row,col:null===n?null:n.col});switch(r){case"shift_down":for(p=n?n.col-e.col+1:0,m=n?n.row-e.row+1:0,t=re(t),u=0,d=t.length,w=Math.max(d,p);u<w;u++)if(u<d){for(a=0,l=t[u].length;a<m-l;a++)t[u].push(t[u][a%l]);t[u].unshift(e.col+u,e.row,0),g.spliceCol.apply(g,t[u])}else t[u%d][0]=e.col+u,g.spliceCol.apply(g,t[u%d]);break;case"shift_right":for(p=n?n.col-e.col+1:0,m=n?n.row-e.row+1:0,a=0,l=t.length,v=Math.max(l,m);a<v;a++)if(a<l){for(u=0,d=t[a].length;u<p-d;u++)t[a].push(t[a][u%d]);t[a].unshift(e.row+a,e.col,0),g.spliceRow.apply(g,t[a])}else t[a%l][0]=e.row+a,g.spliceRow.apply(g,t[a%l]);break;case"overwrite":default:f.row=e.row,f.col=e.col;var y,b={row:n&&e?n.row-e.row+1:1,col:n&&e?n.col-e.col+1:1},C=0,_=0,R=!0,S=function(e){var n=void 0!==arguments[1]?arguments[1]:null,o=t[e%t.length];return null!==n?o[n%o.length]:o},E=t.length,M=n?n.row-e.row+1:0;for(l=n?M:Math.max(E,M),a=0;a<l&&!(n&&f.row>n.row&&M>E||!c.settings.allowInsertRow&&f.row>g.countRows()-1||f.row>=c.settings.maxRows);a++){var T=a-C,O=S(T).length,k=n?n.col-e.col+1:0;if(d=n?k:Math.max(O,k),f.col=e.col,y=g.getCellMeta(f.row,f.col),"paste"!==o&&"autofill"!==o||!y.skipRowOnPaste){for(_=0,u=0;u<d&&!(n&&f.col>n.col&&k>O||!c.settings.allowInsertColumn&&f.col>g.countCols()-1||f.col>=c.settings.maxCols);u++)if(y=g.getCellMeta(f.row,f.col),"paste"!==o&&"autofill"!==o||!y.skipColumnOnPaste)if(y.readOnly)f.col++;else{var x=u-_,H=S(T,x),D=g.getDataAtCell(f.row,f.col),A={row:T,col:x};if("autofill"===o){var P=g.runHooks("beforeAutofillInsidePopulate",A,i,t,s,{},b);P&&(H=L(P.value)?H:P.value)}if(null!==H&&"object"==typeof H)if(null===D||"object"!=typeof D)R=!1;else{var N=z(D[0]||D),W=z(H[0]||H);G(N,W)?H=B(H):R=!1}else null!==D&&"object"==typeof D&&(R=!1);R&&h.push([f.row,f.col,H]),R=!0,f.col++}else _++,f.col++,d++;f.row++}else C++,f.row++,l++}g.setDataAtCell(h,null,null,o||"populateFromArray")}}},this.selection=p={inProgress:!1,selectedHeader:{cols:!1,rows:!1},setSelectedHeaders:function(){var e=void 0!==arguments[0]&&arguments[0],t=void 0!==arguments[1]&&arguments[1],n=void 0!==arguments[2]&&arguments[2];g.selection.selectedHeader.rows=e,g.selection.selectedHeader.cols=t,g.selection.selectedHeader.corner=n},begin:function(){g.selection.inProgress=!0},finish:function(){var e=g.getSelected();E.hooks.run(g,"afterSelectionEnd",e[0],e[1],e[2],e[3]),E.hooks.run(g,"afterSelectionEndByProp",e[0],g.colToProp(e[1]),e[2],g.colToProp(e[3])),g.selection.inProgress=!1},isInProgress:function(){return g.selection.inProgress},setRangeStart:function(e,t){E.hooks.run(g,"beforeSetRangeStart",e),c.selRange=new le(e,e,e),p.setRangeEnd(e,null,t)},setRangeStartOnly:function(e){E.hooks.run(g,"beforeSetRangeStartOnly",e),c.selRange=new le(e,e,e)},setRangeEnd:function(e,t,n){if(null!==c.selRange){var o,r=!1,i=!0,s=g.view.wt.wtTable.getFirstVisibleRow(),a=g.view.wt.wtTable.getFirstVisibleColumn(),l={row:null,col:null};E.hooks.run(g,"beforeSetRangeEnd",e),g.selection.begin(),l.row=e.row<0?s:e.row,l.col=e.col<0?a:e.col,c.selRange.to=new ae(l.row,l.col),c.settings.multiSelect||(c.selRange.from=e),g.view.wt.selections.current.clear(),o=g.getCellMeta(c.selRange.highlight.row,c.selRange.highlight.col).disableVisualSelection,"string"==typeof o&&(o=[o]),(o===!1||Array.isArray(o)&&o.indexOf("current")===-1)&&g.view.wt.selections.current.add(c.selRange.highlight),g.view.wt.selections.area.clear(),(o===!1||Array.isArray(o)&&o.indexOf("area")===-1)&&p.isMultiple()&&(g.view.wt.selections.area.add(c.selRange.from),g.view.wt.selections.area.add(c.selRange.to)),(c.settings.currentRowClassName||c.settings.currentColClassName)&&(g.view.wt.selections.highlight.clear(),g.view.wt.selections.highlight.add(c.selRange.from),g.view.wt.selections.highlight.add(c.selRange.to)),E.hooks.run(g,"afterSelection",c.selRange.from.row,c.selRange.from.col,c.selRange.to.row,c.selRange.to.col),E.hooks.run(g,"afterSelectionByProp",c.selRange.from.row,d.colToProp(c.selRange.from.col),c.selRange.to.row,d.colToProp(c.selRange.to.col)),(0===c.selRange.from.row&&c.selRange.to.row===g.countRows()-1&&g.countRows()>1||0===c.selRange.from.col&&c.selRange.to.col===g.countCols()-1&&g.countCols()>1)&&(r=!0),(e.row<0||e.col<0)&&(i=!1),t!==!1&&!r&&i&&(c.selRange.from&&!p.isMultiple()?g.view.scrollViewport(c.selRange.from):g.view.scrollViewport(e)),p.refreshBorders(null,n)}},refreshBorders:function(e,t){t||m.destroyEditor(e),g.view.render(),p.isSelected()&&!t&&m.prepareEditor()},isMultiple:function(){var e=!(c.selRange.to.col===c.selRange.from.col&&c.selRange.to.row===c.selRange.from.row),t=E.hooks.run(g,"afterIsMultipleSelection",e);if(e)return t},transformStart:function(e,t,n,o){var r,i,s,a,l=new ae(e,t),u=0,d=0;g.runHooks("modifyTransformStart",l),r=g.countRows(),i=g.countCols(),a=g.getSettings().fixedRowsBottom,c.selRange.highlight.row+e>r-1?n&&c.settings.minSpareRows>0&&!(a&&c.selRange.highlight.row>=r-a-1)?(g.alter("insert_row",r),r=g.countRows()):c.settings.autoWrapCol&&(l.row=1-r,l.col=c.selRange.highlight.col+l.col==i-1?1-i:1):c.settings.autoWrapCol&&c.selRange.highlight.row+l.row<0&&c.selRange.highlight.col+l.col>=0&&(l.row=r-1,l.col=c.selRange.highlight.col+l.col==0?i-1:-1),c.selRange.highlight.col+l.col>i-1?n&&c.settings.minSpareCols>0?(g.alter("insert_col",i),i=g.countCols()):c.settings.autoWrapRow&&(l.row=c.selRange.highlight.row+l.row==r-1?1-r:1,l.col=1-i):c.settings.autoWrapRow&&c.selRange.highlight.col+l.col<0&&c.selRange.highlight.row+l.row>=0&&(l.row=c.selRange.highlight.row+l.row==0?r-1:-1,l.col=i-1),s=new ae(c.selRange.highlight.row+l.row,c.selRange.highlight.col+l.col),s.row<0?(u=-1,s.row=0):s.row>0&&s.row>=r&&(u=1,s.row=r-1),s.col<0?(d=-1,s.col=0):s.col>0&&s.col>=i&&(d=1,s.col=i-1),g.runHooks("afterModifyTransformStart",s,u,d),p.setRangeStart(s,o)},transformEnd:function(e,t){var n,o,r,i=new ae(e,t),s=0,a=0;g.runHooks("modifyTransformEnd",i),n=g.countRows(),o=g.countCols(),r=new ae(c.selRange.to.row+i.row,c.selRange.to.col+i.col),r.row<0?(s=-1,r.row=0):r.row>0&&r.row>=n&&(s=1,r.row=n-1),r.col<0?(a=-1,r.col=0):r.col>0&&r.col>=o&&(a=1,r.col=o-1),g.runHooks("afterModifyTransformEnd",r,s,a),p.setRangeEnd(r,!0)},isSelected:function(){return null!==c.selRange},inInSelection:function(e){return!!p.isSelected()&&c.selRange.includes(e)},deselect:function(){p.isSelected()&&(g.selection.inProgress=!1,c.selRange=null,g.view.wt.selections.current.clear(),g.view.wt.selections.area.clear(),(c.settings.currentRowClassName||c.settings.currentColClassName)&&g.view.wt.selections.highlight.clear(),m.destroyEditor(),p.refreshBorders(),E.hooks.run(g,"afterDeselect"))},selectAll:function(){c.settings.multiSelect&&(p.setRangeStart(new ae(0,0)),p.setRangeEnd(new ae(g.countRows()-1,g.countCols()-1),!1))},empty:function(){if(p.isSelected()){var e,t,n=c.selRange.getTopLeftCorner(),o=c.selRange.getBottomRightCorner(),r=[];for(e=n.row;e<=o.row;e++)for(t=n.col;t<=o.col;t++)g.getCellMeta(e,t).readOnly||r.push([e,t,""]);g.setDataAtCell(r)}}},this.init=function(){h.setData(c.settings.data),E.hooks.run(g,"beforeInit"),W()&&O(g.rootElement,"mobile"),this.updateSettings(c.settings,!0),this.view=new te(this),m=new j(g,c,p,d),this.forceFullRender=!0,E.hooks.run(g,"init"),this.view.render(),"object"==typeof c.firstRun&&(E.hooks.run(g,"afterChange",c.firstRun[0],c.firstRun[1]),c.firstRun=!1),E.hooks.run(g,"afterInit")},this.validateCell=function(e,t,n,o){function r(e){var o=t.visualCol,r=t.visualRow,i=g.getCell(r,o,!0);i&&"TH"!=i.nodeName&&g.view.wt.wtSettings.settings.cellRenderer(r,o,i),n(e)}var i=g.getCellValidator(t);"[object RegExp]"===Object.prototype.toString.call(i)&&(i=function(e){return function(t,n){n(e.test(t))}}(i)),A(i)?(e=E.hooks.run(g,"beforeValidate",e,t.visualRow,t.prop,o),g._registerTimeout(setTimeout(function(){i.call(t,e,function(n){n=E.hooks.run(g,"afterValidate",n,e,t.visualRow,t.prop,o),t.valid=n,r(n),E.hooks.run(g,"postAfterValidate",n,e,t.visualRow,t.prop,o)})},0))):g._registerTimeout(setTimeout(function(){t.valid=!0,r(t.valid)},0))},this.setDataAtCell=function(e,t,n,s){var a,l,u,c=i(e,t,n),h=[];for(a=0,l=c.length;a<l;a++){if("object"!=typeof c[a])throw new Error("Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter");if("number"!=typeof c[a][1])throw new Error("Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`");u=d.colToProp(c[a][1]),h.push([c[a][0],u,d.get(c[a][0],u),c[a][2]])}s||"object"!=typeof e||(s=t),o(h,s,function(){r(h,s)})},this.setDataAtRowProp=function(e,t,n,s){var a,l,u=i(e,t,n),c=[];for(a=0,l=u.length;a<l;a++)c.push([u[a][0],u[a][1],d.get(u[a][0],u[a][1]),u[a][2]]);s||"object"!=typeof e||(s=t),o(c,s,function(){r(c,s)})},this.listen=function(){E.activeGuid=g.guid},this.unlisten=function(){E.activeGuid=null},this.isListening=function(){return E.activeGuid===g.guid},this.destroyEditor=function(e){p.refreshBorders(e)},this.populateFromArray=function(e,t,n,o,r,i,s,a,l){var u;if("object"!=typeof n||"object"!=typeof n[0])throw new Error("populateFromArray parameter `input` must be an array of arrays");return u="number"==typeof o?new ae(o,r):null,f.populateFromArray(new ae(e,t),n,u,i,s,a,l)},this.spliceCol=function(e,t,n){return d.spliceCol.apply(d,arguments)},this.spliceRow=function(e,t,n){return d.spliceRow.apply(d,arguments)},this.getSelected=function(){if(p.isSelected())return[c.selRange.from.row,c.selRange.from.col,c.selRange.to.row,c.selRange.to.col]},this.getSelectedRange=function(){if(p.isSelected())return c.selRange},this.render=function(){g.view&&(g.renderCall=!0,g.forceFullRender=!0,p.refreshBorders(null,!0))},this.loadData=function(e){function t(){c.cellSettings.length=0}if("object"==typeof e&&null!==e)e.push&&e.splice||(e=[e]);else{if(null!==e)throw new Error("loadData only accepts array of objects or array of arrays ("+typeof e+" given)");e=[];for(var n,o=0,r=c.settings.startRows;o<r;o++){n=[];for(var i=0,s=c.settings.startCols;i<s;i++)n.push(null);e.push(n)}}c.isPopulated=!1,w.prototype.data=e,Array.isArray(c.settings.dataSchema)||Array.isArray(e[0])?g.dataType="array":A(c.settings.dataSchema)?g.dataType="function":g.dataType="object",d&&d.destroy(),d=new I(g,c,w),h.data=e,h.dataType=g.dataType,h.colToProp=d.colToProp.bind(d),h.propToCol=d.propToCol.bind(d),t(),f.adjustRowsAndCols(),E.hooks.run(g,"afterLoadData",c.firstRun),c.firstRun?c.firstRun=[null,"loadData"]:(E.hooks.run(g,"afterChange",null,"loadData"),g.render()),c.isPopulated=!0},this.getData=function(e,t,n,o){return L(e)?d.getAll():d.getRange(new ae(e,t),new ae(n,o),d.DESTINATION_RENDERER)},this.getCopyableText=function(e,t,n,o){return d.getCopyableText(new ae(e,t),new ae(n,o))},this.getCopyableData=function(e,t){return d.getCopyable(e,d.colToProp(t))},this.getSchema=function(){return d.getSchema()},this.updateSettings=function(e,t){var n,o,r,i=!1;if(N(e.rows))throw new Error('"rows" setting is no longer supported. do you mean startRows, minRows or maxRows?');if(N(e.cols))throw new Error('"cols" setting is no longer supported. do you mean startCols, minCols or maxCols?');for(n in e)"data"!==n&&(E.hooks.getRegistered().indexOf(n)>-1?(A(e[n])||Array.isArray(e[n]))&&g.addHook(n,e[n]):!t&&e.hasOwnProperty(n)&&(w.prototype[n]=e[n]));if(void 0===e.data&&void 0===c.settings.data?g.loadData(null):void 0!==e.data?g.loadData(e.data):void 0!==e.columns&&d.createMap(),r=g.countCols(),e.columns&&A(e.columns)&&(r=g.countSourceCols(),i=!0),void 0===e.cell&&void 0===e.cells&&void 0===e.columns||(c.cellSettings.length=0),r>0){var a,l;for(n=0,o=0;n<r;n++)i&&!e.columns(n)||(c.columnSettings[o]=D(w,c.columnsSettingConflicts),a=c.columnSettings[o].prototype,w.prototype.columns&&(l=i?w.prototype.columns(n):w.prototype.columns[o],l&&(Y(a,l),Y(a,s(l)))),o++)}if(N(e.cell))for(var u in e.cell)if(e.cell.hasOwnProperty(u)){var h=e.cell[u];g.setCellMetaObject(h.row,h.col,h)}E.hooks.run(g,"afterCellMetaReset"),N(e.className)&&(w.prototype.className&&H(g.rootElement,w.prototype.className),e.className&&O(g.rootElement,e.className));var m=g.rootElement.style.height;""!==m&&(m=parseInt(g.rootElement.style.height,10));var v=e.height;if(A(v)&&(v=v()),t){var y=g.rootElement.getAttribute("style");y&&g.rootElement.setAttribute("data-initialstyle",g.rootElement.getAttribute("style"))}if(null===v){var b=g.rootElement.getAttribute("data-initialstyle");b&&(b.indexOf("height")>-1||b.indexOf("overflow")>-1)?g.rootElement.setAttribute("style",b):(g.rootElement.style.height="",g.rootElement.style.overflow="")}else void 0!==v&&(g.rootElement.style.height=v+"px",g.rootElement.style.overflow="hidden");if("undefined"!=typeof e.width){var C=e.width;A(C)&&(C=C()),g.rootElement.style.width=C+"px"}t||(d.clearLengthCache(),E.hooks.run(g,"afterUpdateSettings")),f.adjustRowsAndCols(),g.view&&!c.firstRun&&(g.forceFullRender=!0,p.refreshBorders(null,!0)),t||!g.view||""!==m&&""!==v&&void 0!==v||m===v||g.view.wt.wtOverlays.updateMainScrollableElements()},this.getValue=function(){var e=g.getSelected();if(w.prototype.getValue){if(A(w.prototype.getValue))return w.prototype.getValue.call(g);if(e)return g.getData()[e[0]][w.prototype.getValue]}else if(e)return g.getDataAtCell(e[0],e[1])},this.getSettings=function(){return c.settings},this.clear=function(){p.selectAll(),p.empty()},this.alter=function(e,t,n,o,r){f.alter(e,t,n,o,r)},this.getCell=function(e,t,n){return g.view.getCellAtCoords(new ae(e,t),n)},this.getCoords=function(e){return this.view.wt.wtTable.getCoords.call(this.view.wt.wtTable,e)},this.colToProp=function(e){return d.colToProp(e)},this.propToCol=function(e){return d.propToCol(e)},this.getDataAtCell=function(e,t){return d.get(e,d.colToProp(t))},this.getDataAtRowProp=function(e,t){return d.get(e,t)},this.getDataAtCol=function(e){var t=[];return t.concat.apply(t,d.getRange(new ae(0,e),new ae(c.settings.data.length-1,e),d.DESTINATION_RENDERER))},this.getDataAtProp=function(e){var t,n=[];return t=d.getRange(new ae(0,d.propToCol(e)),new ae(c.settings.data.length-1,d.propToCol(e)),d.DESTINATION_RENDERER),n.concat.apply(n,t)},this.getSourceData=function(e,t,n,o){var r;return r=void 0===e?h.getData():h.getByRange(new ae(e,t),new ae(n,o))},this.getSourceDataAtCol=function(e){return h.getAtColumn(e)},this.getSourceDataAtRow=function(e){return h.getAtRow(e)},this.getSourceDataAtCell=function(e,t){return h.getAtCell(e,t)},this.getDataAtRow=function(e){var t=d.getRange(new ae(e,0),new ae(e,this.countCols()-1),d.DESTINATION_RENDERER);return t[0]},this.getDataType=function(e,t,n,o){var r=this,i=null,s=null;void 0===e&&(e=0,n=this.countRows(),t=0,o=this.countCols()),void 0===n&&(n=e),void 0===o&&(o=t);var a="mixed";return ee(Math.min(e,n),Math.max(e,n),function(e){var n=!0;return ee(Math.min(t,o),Math.max(t,o),function(t){var o=r.getCellMeta(e,t);return s=o.type,i?n=i===s:i=s,n}),a=n?s:"mixed",n}),a},this.removeCellMeta=function(e,t,n){var o=g.getCellMeta(e,t);void 0!=o[n]&&delete c.cellSettings[e][t][n]},this.setCellMetaObject=function(e,t,n){if("object"==typeof n)for(var o in n)if(n.hasOwnProperty(o)){var r=n[o];this.setCellMeta(e,t,o,r)}},this.setCellMeta=function(e,t,n,o){c.cellSettings[e]||(c.cellSettings[e]=[]),c.cellSettings[e][t]||(c.cellSettings[e][t]=new c.columnSettings[t]),c.cellSettings[e][t][n]=o,E.hooks.run(g,"afterSetCellMeta",e,t,n,o)},this.getCellsMeta=function(){return X(c.cellSettings)},this.getCellMeta=function(e,t){var n,o=d.colToProp(t),r=e,i=t;if(e=a(e),t=l(t),c.columnSettings[t]||(c.columnSettings[t]=D(w,c.columnsSettingConflicts)),c.cellSettings[e]||(c.cellSettings[e]=[]),c.cellSettings[e][t]||(c.cellSettings[e][t]=new c.columnSettings[t]),n=c.cellSettings[e][t],n.row=e,n.col=t,n.visualRow=r,n.visualCol=i,n.prop=o,n.instance=g,E.hooks.run(g,"beforeGetCellMeta",e,t,n),Y(n,s(n)),n.cells){var u=n.cells.call(n,e,t,o);u&&(Y(n,u),Y(n,s(u)))}return E.hooks.run(g,"afterGetCellMeta",e,t,n),n},this.isColumnModificationAllowed=function(){return!("object"===g.dataType||g.getSettings().columns)};var y=ie("renderer");this.getCellRenderer=function(e,t){var n=y.call(this,e,t);return J(n)},this.getCellEditor=ie("editor"),this.getCellValidator=ie("validator"),this.validateCells=function(e){var t=new n;e&&(t.onQueueEmpty=e);for(var o=g.countRows()-1;o>=0;){for(var r=g.countCols()-1;r>=0;)t.addValidatorToQueue(),g.validateCell(g.getDataAtCell(o,r),g.getCellMeta(o,r),function(e){if("boolean"!=typeof e)throw new Error("Validation error: result is not boolean");e===!1&&(t.valid=!1),t.removeValidatorFormQueue()},"validateCells"),r--;o--}t.checkIfQueueIsEmpty()},this.getRowHeader=function(e){var t=c.settings.rowHeaders;return void 0!==e&&(e=E.hooks.run(g,"modifyRowHeader",e)),void 0===e?(t=[],ee(g.countRows()-1,function(e){t.push(g.getRowHeader(e))})):Array.isArray(t)&&void 0!==t[e]?t=t[e]:A(t)?t=t(e):t&&"string"!=typeof t&&"number"!=typeof t&&(t=e+1),t},this.hasRowHeaders=function(){return!!c.settings.rowHeaders},this.hasColHeaders=function(){if(void 0!==c.settings.colHeaders&&null!==c.settings.colHeaders)return!!c.settings.colHeaders;for(var e=0,t=g.countCols();e<t;e++)if(g.getColHeader(e))return!0;return!1},this.getColHeader=function(e){var t=c.settings.columns&&A(c.settings.columns),n=c.settings.colHeaders;if(e=E.hooks.run(g,"modifyColHeader",e),void 0===e){for(var o=[],r=t?g.countSourceCols():g.countCols(),i=0;i<r;i++)o.push(g.getColHeader(i));n=o}else{var s=function(e){for(var t=[],n=g.countSourceCols(),o=0;o<n;o++)A(g.getSettings().columns)&&g.getSettings().columns(o)&&t.push(o);return t[e]},a=e;e=E.hooks.run(g,"modifyCol",e);var l=s(e);c.settings.columns&&A(c.settings.columns)&&c.settings.columns(l)&&c.settings.columns(l).title?n=c.settings.columns(l).title:c.settings.columns&&c.settings.columns[e]&&c.settings.columns[e].title?n=c.settings.columns[e].title:Array.isArray(c.settings.colHeaders)&&void 0!==c.settings.colHeaders[e]?n=c.settings.colHeaders[e]:A(c.settings.colHeaders)?n=c.settings.colHeaders(e):c.settings.colHeaders&&"string"!=typeof c.settings.colHeaders&&"number"!=typeof c.settings.colHeaders&&(n=se(a))}return n},this._getColWidthFromSettings=function(e){var t=g.getCellMeta(0,e),n=t.width;if(void 0!==n&&n!==c.settings.width||(n=t.colWidths),void 0!==n&&null!==n){switch(typeof n){case"object":n=n[e];break;case"function":n=n(e)}"string"==typeof n&&(n=parseInt(n,10))}return n},this.getColWidth=function(e){var t=g._getColWidthFromSettings(e);return t=E.hooks.run(g,"modifyColWidth",t,e),void 0===t&&(t=ue.DEFAULT_WIDTH),t},this._getRowHeightFromSettings=function(e){var t=c.settings.rowHeights;if(void 0!==t&&null!==t){switch(typeof t){case"object":t=t[e];break;case"function":t=t(e)}"string"==typeof t&&(t=parseInt(t,10))}return t},this.getRowHeight=function(e){var t=g._getRowHeightFromSettings(e);return t=E.hooks.run(g,"modifyRowHeight",t,e)},this.countSourceRows=function(){return g.getSourceData()?g.getSourceData().length:0},this.countSourceCols=function(){var e=0,t=g.getSourceData()&&g.getSourceData()[0]?g.getSourceData()[0]:[];return e=U(t)?$(t):t.length||0},this.countRows=function(){return d.getLength()},this.countCols=function(){var e=!1,t=0;if("array"===g.dataType&&(e=c.settings.data&&c.settings.data[0]&&c.settings.data[0].length),e&&(t=c.settings.data[0].length),c.settings.columns){var n=A(c.settings.columns);if(n)if("array"===g.dataType){for(var o=0,r=0;r<t;r++)c.settings.columns(r)&&o++;t=o}else"object"!==g.dataType&&"function"!==g.dataType||(t=d.colToPropCache.length);else t=c.settings.columns.length}else"object"!==g.dataType&&"function"!==g.dataType||(t=d.colToPropCache.length);return t},this.rowOffset=function(){return g.view.wt.wtTable.getFirstRenderedRow()},this.colOffset=function(){return g.view.wt.wtTable.getFirstRenderedColumn()},this.countRenderedRows=function(){return g.view.wt.drawn?g.view.wt.wtTable.getRenderedRowsCount():-1;
+},this.countVisibleRows=function(){return g.view.wt.drawn?g.view.wt.wtTable.getVisibleRowsCount():-1},this.countRenderedCols=function(){return g.view.wt.drawn?g.view.wt.wtTable.getRenderedColumnsCount():-1},this.countVisibleCols=function(){return g.view.wt.drawn?g.view.wt.wtTable.getVisibleColumnsCount():-1},this.countEmptyRows=function(e){for(var t,n=g.countRows()-1,o=0;n>=0;){if(t=E.hooks.run(this,"modifyRow",n),g.isEmptyRow(t))o++;else if(e)break;n--}return o},this.countEmptyCols=function(e){if(g.countRows()<1)return 0;for(var t=g.countCols()-1,n=0;t>=0;){if(g.isEmptyCol(t))n++;else if(e)break;t--}return n},this.isEmptyRow=function(e){return c.settings.isEmptyRow.call(g,e)},this.isEmptyCol=function(e){return c.settings.isEmptyCol.call(g,e)},this.selectCell=function(e,t,n,o,r,i){var s;if(i=L(i)||i===!0,"number"!=typeof e||e<0||e>=g.countRows())return!1;if("number"!=typeof t||t<0||t>=g.countCols())return!1;if(N(n)){if("number"!=typeof n||n<0||n>=g.countRows())return!1;if("number"!=typeof o||o<0||o>=g.countCols())return!1}return s=new ae(e,t),c.selRange=new le(s,s,s),i&&g.listen(),L(n)?p.setRangeEnd(c.selRange.from,r):p.setRangeEnd(new ae(n,o),r),g.selection.finish(),!0},this.selectCellByProp=function(e,t,n,o,r){return arguments[1]=d.propToCol(arguments[1]),N(arguments[3])&&(arguments[3]=d.propToCol(arguments[3])),g.selectCell.apply(g,arguments)},this.deselectCell=function(){p.deselect()},this.scrollViewportTo=function(e,t){if(void 0!==e&&(e<0||e>=g.countRows()))return!1;if(void 0!==t&&(t<0||t>=g.countCols()))return!1;var n=!1;return void 0!==e&&void 0!==t&&(g.view.wt.scrollVertical(e),g.view.wt.scrollHorizontal(t),n=!0),"number"==typeof e&&"number"!=typeof t&&(g.view.wt.scrollVertical(e),n=!0),"number"==typeof t&&"number"!=typeof e&&(g.view.wt.scrollHorizontal(t),n=!0),n},this.destroy=function(){g._clearTimeouts(),g.view&&g.view.destroy(),h&&h.destroy(),h=null,k(g.rootElement),v.destroy(),E.hooks.run(g,"afterDestroy"),E.hooks.destroy(g);for(var e in g)g.hasOwnProperty(e)&&(A(g[e])?g[e]=u:"guid"!==e&&(g[e]=null));d&&d.destroy(),d=null,c=null,f=null,p=null,m=null,g=null,w=null},this.getActiveEditor=function(){return m.getActiveEditor()},this.getPlugin=function(e){return Z(this,e)},this.getInstance=function(){return g},this.addHook=function(e,t){E.hooks.add(e,t,g)},this.hasHook=function(e){return E.hooks.has(e,g)},this.addHookOnce=function(e,t){E.hooks.once(e,t,g)},this.removeHook=function(e,t){E.hooks.remove(e,t,g)},this.runHooks=function(e,t,n,o,r,i,s){return E.hooks.run(g,e,t,n,o,r,i,s)},this.timeouts=[],this._registerTimeout=function(e){this.timeouts.push(e)},this._clearTimeouts=function(){for(var e=0,t=this.timeouts.length;e<t;e++)clearTimeout(this.timeouts[e])},this.version=E.version,E.hooks.run(g,"construct")};var ce=function(){};ce.prototype={data:void 0,dataSchema:void 0,width:void 0,height:void 0,startRows:5,startCols:5,rowHeaders:void 0,colHeaders:null,colWidths:void 0,rowHeights:void 0,columns:void 0,cells:void 0,cell:[],comments:!1,customBorders:!1,minRows:0,minCols:0,maxRows:1/0,maxCols:1/0,minSpareRows:0,minSpareCols:0,allowInsertRow:!0,allowInsertColumn:!0,allowRemoveRow:!0,allowRemoveColumn:!0,multiSelect:!0,fillHandle:!0,fixedRowsTop:0,fixedRowsBottom:0,fixedColumnsLeft:0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,pasteMode:"overwrite",persistentState:void 0,currentRowClassName:void 0,currentColClassName:void 0,className:void 0,tableClassName:void 0,stretchH:"none",isEmptyRow:function(e){var t,n,o,r;for(t=0,n=this.countCols();t<n;t++)if(o=this.getDataAtCell(e,t),""!==o&&null!==o&&N(o))return"object"==typeof o&&(r=this.getCellMeta(e,t),G(this.getSchema()[r.prop],o));return!0},isEmptyCol:function(e){var t,n,o;for(t=0,n=this.countRows();t<n;t++)if(o=this.getDataAtCell(t,e),""!==o&&null!==o&&N(o))return!1;return!0},observeDOMVisibility:!0,allowInvalid:!0,allowEmpty:!0,invalidCellClassName:"htInvalid",placeholder:!1,placeholderCellClassName:"htPlaceholder",readOnlyCellClassName:"htDimmed",renderer:void 0,commentedCellClassName:"htCommentCell",fragmentSelection:!1,readOnly:!1,skipColumnOnPaste:!1,search:!1,type:"text",copyable:!0,editor:void 0,autoComplete:void 0,visibleRows:10,trimDropdown:!0,debug:!1,wordWrap:!0,noWordWrapClassName:"htNoWrap",contextMenu:void 0,contextMenuCopyPaste:void 0,copyPaste:void 0,undo:void 0,columnSorting:void 0,manualColumnMove:void 0,manualColumnResize:void 0,manualRowMove:void 0,manualRowResize:void 0,mergeCells:!1,viewportRowRenderingOffset:"auto",viewportColumnRenderingOffset:"auto",validator:void 0,disableVisualSelection:!1,sortIndicator:void 0,manualColumnFreeze:void 0,trimWhitespace:!0,settings:void 0,source:void 0,title:void 0,checkedTemplate:void 0,uncheckedTemplate:void 0,label:void 0,format:void 0,language:void 0,selectOptions:void 0,autoColumnSize:void 0,autoRowSize:void 0,dateFormat:void 0,correctFormat:!1,defaultDate:void 0,strict:void 0,renderAllRows:void 0,preventOverflow:!1,bindRowsWithHeaders:void 0,collapsibleColumns:void 0,columnSummary:void 0,dropdownMenu:void 0,filters:void 0,ganttChart:void 0,headerTooltips:void 0,hiddenColumns:void 0,hiddenRows:void 0,nestedHeaders:void 0,trimRows:void 0,rowHeaderWidth:void 0,columnHeaderHeight:void 0,observeChanges:void 0,sortFunction:void 0,sortByRelevance:!0,filter:!0,filteringCaseSensitive:!1},E.DefaultSettings=ce},{"3rdparty/walkontable/src/calculator/viewportColumns":4,"3rdparty/walkontable/src/cell/coords":6,"3rdparty/walkontable/src/cell/range":7,browser:24,dataMap:27,dataSource:28,editorManager:29,eventManager:42,"helpers/array":43,"helpers/browser":44,"helpers/data":45,"helpers/dom/element":47,"helpers/function":50,"helpers/mixed":51,"helpers/number":52,"helpers/object":53,"helpers/setting":54,"helpers/string":55,numbro:"numbro",plugins:60,renderers:105,tableView:114}],27:[function(e,t,n){"use strict";function o(e,t,n){var o=this;this.instance=e,this.priv=t,this.GridSettings=n,this.dataSource=this.instance.getSettings().data,this.cachedLength=null,this.latestSourceRowsCount=0,this.dataSource[0]?this.duckSchema=this.recursiveDuckSchema(this.dataSource[0]):this.duckSchema={},this.createMap(),this.interval=M.create(function(){return o.clearLengthCache()},"15fps")}Object.defineProperties(n,{DataMap:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d,h,f=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,p=(i=e("SheetClip"),i&&i.__esModule&&i||{default:i}).default,m=(s=e("helpers/data"),s&&s.__esModule&&s||{default:s}).cellMethodLookupFactory,g=(a=e("helpers/setting"),a&&a.__esModule&&a||{default:a}).columnFactory,w=(l=e("helpers/object"),l&&l.__esModule&&l||{default:l}),v=w.duckSchema,y=w.deepExtend,b=w.deepClone,C=w.isObject,_=w.deepObjectSize,R=(u=e("helpers/array"),u&&u.__esModule&&u||{default:u}),S=R.extendArray,E=R.to2dArray,M=(c=e("utils/interval"),c&&c.__esModule&&c||{default:c}).Interval,T=(d=e("helpers/number"),d&&d.__esModule&&d||{default:d}).rangeEach,O=(h=e("multiMap"),h&&h.__esModule&&h||{default:h}).MultiMap;o.prototype.DESTINATION_RENDERER=1,o.prototype.DESTINATION_CLIPBOARD_GENERATOR=2,o.prototype.recursiveDuckSchema=function(e){return v(e)},o.prototype.recursiveDuckColumns=function(e,t,n){var o,r;if("undefined"==typeof t&&(t=0,n=""),"object"==typeof e&&!Array.isArray(e))for(r in e)e.hasOwnProperty(r)&&(null===e[r]?(o=n+r,this.colToPropCache.push(o),this.propToColCache.set(o,t),t++):t=this.recursiveDuckColumns(e[r],t,r+"."));return t},o.prototype.createMap=function(){var e,t=this.getSchema();if("undefined"==typeof t)throw new Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");this.colToPropCache=[],this.propToColCache=new O;var n=this.instance.getSettings().columns;if(n){var o=n.length,r=0,i=!1,s=_(t);for("function"==typeof n&&(o=s>0?s:this.instance.countSourceCols(),i=!0),e=0;e<o;e++){var a=i?n(e):n[e];if(C(a)){if("undefined"!=typeof a.data){var l=i?r:e;this.colToPropCache[l]=a.data,this.propToColCache.set(a.data,l)}r++}}}else this.recursiveDuckColumns(t)},o.prototype.colToProp=function(e){return e=f.hooks.run(this.instance,"modifyCol",e),this.colToPropCache&&"undefined"!=typeof this.colToPropCache[e]?this.colToPropCache[e]:e},o.prototype.propToCol=function(e){var t;return t="undefined"==typeof this.propToColCache.get(e)?e:this.propToColCache.get(e),t=f.hooks.run(this.instance,"unmodifyCol",t)},o.prototype.getSchema=function(){var e=this.instance.getSettings().dataSchema;return e?"function"==typeof e?e():e:this.duckSchema},o.prototype.createRow=function(e,t,n){var o,r,i=this.instance.countCols(),s=0;t||(t=1),("number"!=typeof e||e>=this.instance.countSourceRows())&&(e=this.instance.countSourceRows()),r=e;for(var a=this.instance.getSettings().maxRows;s<t&&this.instance.countSourceRows()<a;)"array"===this.instance.dataType?this.instance.getSettings().dataSchema?o=b(this.getSchema()):(o=[],T(i-1,function(){return o.push(null)})):"function"===this.instance.dataType?o=this.instance.getSettings().dataSchema(e):(o={},y(o,this.getSchema())),e===this.instance.countSourceRows()?this.dataSource.push(o):this.dataSource.splice(e,0,o),s++,r++;return f.hooks.run(this.instance,"afterCreateRow",e,s,n),this.instance.forceFullRender=!0,s},o.prototype.createCol=function(e,t,n){if(!this.instance.isColumnModificationAllowed())throw new Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting.If you want to be able to add new columns, you have to use array datasource.");var o,r,i=this.instance.countSourceRows(),s=this.dataSource,a=0;t||(t=1),("number"!=typeof e||e>=this.instance.countCols())&&(e=this.instance.countCols()),r=e;for(var l=this.instance.getSettings().maxCols;a<t&&this.instance.countCols()<l;){if(o=g(this.GridSettings,this.priv.columnsSettingConflicts),"number"!=typeof e||e>=this.instance.countCols()){if(i>0)for(var u=0;u<i;u++)"undefined"==typeof s[u]&&(s[u]=[]),s[u].push(null);else s.push([null]);this.priv.columnSettings.push(o)}else{for(var u=0;u<i;u++)s[u].splice(r,0,null);this.priv.columnSettings.splice(r,0,o)}a++,r++}return f.hooks.run(this.instance,"afterCreateCol",e,a,n),this.instance.forceFullRender=!0,a},o.prototype.removeRow=function(e,t){t||(t=1),"number"!=typeof e&&(e=-t),e=(this.instance.countSourceRows()+e)%this.instance.countSourceRows();var n=this.physicalRowsToLogical(e,t),o=(n.slice(0).sort(function(e,t){return t-e}),f.hooks.run(this.instance,"beforeRemoveRow",e,t,n));if(o!==!1){var r,i=this.dataSource;r=i.filter(function(e,t){return n.indexOf(t)==-1}),i.length=0,Array.prototype.push.apply(i,r),f.hooks.run(this.instance,"afterRemoveRow",e,t,n),this.instance.forceFullRender=!0}},o.prototype.removeCol=function(e,t){if("object"===this.instance.dataType||this.instance.getSettings().columns)throw new Error("cannot remove column with object data source or columns option specified");t||(t=1),"number"!=typeof e&&(e=-t),e=(this.instance.countCols()+e)%this.instance.countCols();var n=this.physicalColumnsToLogical(e,t),o=n.slice(0).sort(function(e,t){return t-e}),r=f.hooks.run(this.instance,"beforeRemoveCol",e,t,n);if(r!==!1){for(var i=!0,s=o.length,a=this.dataSource,l=0;l<s;l++)i&&n[0]!==n[l]-l&&(i=!1);if(i)for(var u=0,c=this.instance.countSourceRows();u<c;u++)a[u].splice(n[0],t);else{for(var d=0,h=this.instance.countSourceRows();d<h;d++)for(var p=0;p<s;p++)a[d].splice(o[p],1);for(var m=0;m<s;m++)this.priv.columnSettings.splice(n[m],1)}f.hooks.run(this.instance,"afterRemoveCol",e,t),this.instance.forceFullRender=!0}},o.prototype.spliceCol=function(e,t,n){var o=4<=arguments.length?[].slice.call(arguments,3):[],r=this.instance.getDataAtCol(e),i=r.slice(t,t+n),s=r.slice(t+n);S(o,s);for(var a=0;a<n;)o.push(null),a++;return E(o),this.instance.populateFromArray(t,e,o,null,null,"spliceCol"),i},o.prototype.spliceRow=function(e,t,n){var o=4<=arguments.length?[].slice.call(arguments,3):[],r=this.instance.getSourceDataAtRow(e),i=r.slice(t,t+n),s=r.slice(t+n);S(o,s);for(var a=0;a<n;)o.push(null),a++;return this.instance.populateFromArray(e,t,[o],null,null,"spliceRow"),i},o.prototype.get=function(e,t){e=f.hooks.run(this.instance,"modifyRow",e);var n=this.dataSource[e];if(n&&n.hasOwnProperty&&n.hasOwnProperty(t))return n[t];if("string"==typeof t&&t.indexOf(".")>-1){var o=t.split("."),r=n;if(!r)return null;for(var i=0,s=o.length;i<s;i++)if(r=r[o[i]],"undefined"==typeof r)return null;return r}return"function"==typeof t?t(this.dataSource.slice(e,e+1)[0]):null};var k=m("copyable",!1);o.prototype.getCopyable=function(e,t){return k.call(this.instance,e,this.propToCol(t))?this.get(e,t):""},o.prototype.set=function(e,t,n,o){e=f.hooks.run(this.instance,"modifyRow",e,o||"datamapGet");var r=this.dataSource[e];if(r&&r.hasOwnProperty&&r.hasOwnProperty(t))r[t]=n;else if("string"==typeof t&&t.indexOf(".")>-1){for(var i=t.split("."),s=r,a=0,l=i.length-1;a<l;a++)"undefined"==typeof s[i[a]]&&(s[i[a]]={}),s=s[i[a]];s[i[a]]=n}else"function"==typeof t?t(this.dataSource.slice(e,e+1)[0],n):r[t]=n},o.prototype.physicalRowsToLogical=function(e,t){for(var n,o=this.instance.countSourceRows(),r=(o+e)%o,i=[],s=t;r<o&&s;)n=f.hooks.run(this.instance,"modifyRow",r),i.push(n),s--,r++;return i},o.prototype.physicalColumnsToLogical=function(e,t){for(var n=this.instance.countCols(),o=(n+e)%n,r=[],i=t;o<n&&i;){var s=f.hooks.run(this.instance,"modifyCol",o);r.push(s),i--,o++}return r},o.prototype.clear=function(){for(var e=0;e<this.instance.countSourceRows();e++)for(var t=0;t<this.instance.countCols();t++)this.set(e,this.colToProp(t),"")},o.prototype.clearLengthCache=function(){this.cachedLength=null},o.prototype.getLength=function(){var e=this,t=this.instance.countSourceRows();if(f.hooks.has("modifyRow",this.instance)){var n=!1;this.interval.start(),t!==this.latestSourceRowsCount&&(n=!0),this.latestSourceRowsCount=t,null===this.cachedLength||n?(T(t-1,function(n){n=f.hooks.run(e.instance,"modifyRow",n),null===n&&--t}),this.cachedLength=t):t=this.cachedLength}else this.interval.stop();return t},o.prototype.getAll=function(){var e={row:0,col:0},t={row:Math.max(this.instance.countSourceRows()-1,0),col:Math.max(this.instance.countCols()-1,0)};return e.row-t.row!==0||this.instance.countSourceRows()?this.getRange(e,t,o.prototype.DESTINATION_RENDERER):[]},o.prototype.getRange=function(e,t,n){var o,r,i,s,a,l=[],u=n===this.DESTINATION_CLIPBOARD_GENERATOR?this.getCopyable:this.get;for(r=Math.max(e.row,t.row),s=Math.max(e.col,t.col),o=Math.min(e.row,t.row);o<=r;o++){a=[];var c=f.hooks.run(this.instance,"modifyRow",o);for(i=Math.min(e.col,t.col);i<=s;i++){if(null===c)break;a.push(u.call(this,o,this.colToProp(i)))}null!==c&&l.push(a)}return l},o.prototype.getText=function(e,t){return p.stringify(this.getRange(e,t,this.DESTINATION_RENDERER))},o.prototype.getCopyableText=function(e,t){return p.stringify(this.getRange(e,t,this.DESTINATION_CLIPBOARD_GENERATOR))},o.prototype.destroy=function(){this.interval.stop(),this.interval=null,this.instance=null,this.priv=null,this.GridSettings=null,this.dataSource=null,this.cachedLength=null,this.duckSchema=null}},{SheetClip:"SheetClip",browser:24,"helpers/array":43,"helpers/data":45,"helpers/number":52,"helpers/object":53,"helpers/setting":54,multiMap:58,"utils/interval":116}],28:[function(e,t,n){"use strict";Object.defineProperties(n,{DataSource:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s,a,l=((o=e("helpers/data"),o&&o.__esModule&&o||{default:o}).cellMethodLookupFactory,(r=e("helpers/setting"),r&&r.__esModule&&r||{default:r}).columnFactory,i=e("helpers/object"),i&&i.__esModule&&i||{default:i}),u=(l.duckSchema,l.deepExtend,l.getProperty),c=(s=e("helpers/array"),s&&s.__esModule&&s||{default:s}),d=(c.extendArray,c.arrayEach),h=(a=e("helpers/number"),a&&a.__esModule&&a||{default:a}).rangeEach,f=function(e){var t=void 0!==arguments[1]?arguments[1]:[];this.hot=e,this.data=t,this.dataType="array",this.colToProp=function(){},this.propToCol=function(){}};$traceurRuntime.createClass(f,{getData:function(){return this.data},setData:function(e){this.data=e},getAtColumn:function(e){var t=this,n=[];return d(this.data,function(o){var r=t.colToProp(e);o="string"==typeof r?u(o,r):o[r],n.push(o)}),n},getAtRow:function(e){return this.data[e]},getAtCell:function(e,t){return this.data[e][this.colToProp(t)]},getByRange:function(e,t){var n=this,o=Math.min(e.row,t.row),r=Math.min(e.col,t.col),i=Math.max(e.row,t.row),s=Math.max(e.col,t.col),a=[];return h(o,i,function(e){var t,o=n.getAtRow(e);"array"===n.dataType?t=o.slice(r,s):"object"===n.dataType&&(t={},h(r,s,function(e){var r=n.colToProp(e);t[r]=o[r]})),a.push(t)}),a},destroy:function(){this.data=null,this.hot=null}},{})},{"helpers/array":43,"helpers/data":45,"helpers/number":52,"helpers/object":53,"helpers/setting":54}],29:[function(e,t,n){"use strict";function o(e,t,n){function o(e){var o="function"==typeof t.settings.enterMoves?t.settings.enterMoves(event):t.settings.enterMoves;e?n.transformStart(-o.row,-o.col):n.transformStart(o.row,o.col,!0)}function r(e){e?n.transformEnd(-1,0):n.transformStart(-1,0)}function i(e){e?n.transformEnd(1,0):n.transformStart(1,0)}function s(e){e?n.transformEnd(0,1):n.transformStart(0,1)}function a(e){e?n.transformEnd(0,-1):n.transformStart(0,-1)}function l(l){var u,h;if(e.isListening()&&(c.hooks.run(e,"beforeKeyDown",l),!_&&!y(l)&&(t.lastKeyCode=l.keyCode,n.isSelected()))){if(u=(l.ctrlKey||l.metaKey)&&!l.altKey,g&&!g.isWaiting()&&!(p(l.keyCode)||m(l.keyCode)||u||C.isEditorOpened()))return void C.openEditor("",l);switch(h=l.shiftKey?n.setRangeEnd:n.setRangeStart,l.keyCode){case f.A:!C.isEditorOpened()&&u&&(n.selectAll(),l.preventDefault(),w(l));break;case f.ARROW_UP:C.isEditorOpened()&&!g.isWaiting()&&C.closeEditorAndSaveChanges(u),r(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_DOWN:C.isEditorOpened()&&!g.isWaiting()&&C.closeEditorAndSaveChanges(u),i(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_RIGHT:C.isEditorOpened()&&!g.isWaiting()&&C.closeEditorAndSaveChanges(u),s(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_LEFT:C.isEditorOpened()&&!g.isWaiting()&&C.closeEditorAndSaveChanges(u),a(l.shiftKey),l.preventDefault(),w(l);break;case f.TAB:var b="function"==typeof t.settings.tabMoves?t.settings.tabMoves(l):t.settings.tabMoves;l.shiftKey?n.transformStart(-b.row,-b.col):n.transformStart(b.row,b.col,!0),l.preventDefault(),w(l);break;case f.BACKSPACE:case f.DELETE:n.empty(l),C.prepareEditor(),l.preventDefault();break;case f.F2:C.openEditor(null,l),g&&g.enableFullEditMode(),l.preventDefault();break;case f.ENTER:C.isEditorOpened()?(g&&g.state!==c.EditorState.WAITING&&C.closeEditorAndSaveChanges(u),o(l.shiftKey)):e.getSettings().enterBeginsEditing?(C.openEditor(null,l),g&&g.enableFullEditMode()):o(l.shiftKey),l.preventDefault(),v(l);break;case f.ESCAPE:C.isEditorOpened()&&C.closeEditorAndRestoreOriginalValue(u),l.preventDefault();break;case f.HOME:h(l.ctrlKey||l.metaKey?new d(0,t.selRange.from.col):new d(t.selRange.from.row,0)),l.preventDefault(),w(l);break;case f.END:h(l.ctrlKey||l.metaKey?new d(e.countRows()-1,t.selRange.from.col):new d(t.selRange.from.row,e.countCols()-1)),l.preventDefault(),w(l);break;case f.PAGE_UP:n.transformStart(-e.countVisibleRows(),0),l.preventDefault(),w(l);break;case f.PAGE_DOWN:n.transformStart(e.countVisibleRows(),0),l.preventDefault(),w(l)}}}function u(){function t(e,t,n){"TD"==n.nodeName&&(C.openEditor(),g&&g.enableFullEditMode())}e.addHook("afterDocumentKeyDown",l),h.addEventListener(document.documentElement,"keydown",function(t){e.runHooks("afterDocumentKeyDown",t)}),e.view.wt.update("onCellDblClick",t),e.addHook("afterDestroy",function(){_=!0})}var h,g,C=this,_=!1;h=b(e),this.destroyEditor=function(e){this.closeEditor(e)},this.getActiveEditor=function(){return g},this.prepareEditor=function(){var n,o,r,i,s,a,l;return g&&g.isWaiting()?void this.closeEditor(!1,!1,function(e){e&&C.prepareEditor()}):(n=t.selRange.highlight.row,o=t.selRange.highlight.col,r=e.colToProp(o),i=e.getCell(n,o),s=e.getDataAtCell(n,o),a=e.getCellMeta(n,o),l=e.getCellEditor(a),void(l?(g=c.editors.getEditor(l,e),g.prepare(n,o,r,i,s,a)):g=void 0))},this.isEditorOpened=function(){return g&&g.isOpened()},this.openEditor=function(e,t){g&&!g.cellProperties.readOnly?g.beginEditing(e,t):g&&g.cellProperties.readOnly&&t&&t.keyCode===f.ENTER&&o()},this.closeEditor=function(e,t,n){g?g.finishEditing(e,t,n):n&&n(!1)},this.closeEditorAndSaveChanges=function(e){return this.closeEditor(!1,e)},this.closeEditorAndRestoreOriginalValue=function(e){return this.closeEditor(!0,e)},u()}Object.defineProperties(n,{EditorManager:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,d=(i=e("3rdparty/walkontable/src/cell/coords"),i&&i.__esModule&&i||{default:i}).WalkontableCellCoords,h=(s=e("helpers/unicode"),s&&s.__esModule&&s||{default:s}),f=h.KEY_CODES,p=h.isMetaKey,m=h.isCtrlKey,g=(a=e("helpers/dom/event"),a&&a.__esModule&&a||{default:a}),w=g.stopPropagation,v=g.stopImmediatePropagation,y=g.isImmediatePropagationStopped,b=((l=e("editors"),l&&l.__esModule&&l||{default:l}).getEditor,(u=e("eventManager"),u&&u.__esModule&&u||{default:u}).eventManager);c.EditorManager=o},{"3rdparty/walkontable/src/cell/coords":6,browser:24,editors:30,eventManager:42,"helpers/dom/event":48,"helpers/unicode":56}],30:[function(e,t,n){"use strict";function o(e){var t,n;n={},t=e,this.getConstructor=function(){return e},this.getInstance=function(e){return e.guid in n||(n[e.guid]=new t(e)),n[e.guid]}}function r(e,t){var n=new o(t);"string"==typeof e&&(h[e]=n,c.editors[d(e)+"Editor"]=t),f.set(t,n)}function i(e,t){var n;if("function"==typeof e)f.get(e)||r(null,e),n=f.get(e);else{if("string"!=typeof e)throw Error('Only strings and functions can be passed as "editor" parameter ');n=h[e]}if(!n)throw Error('No editor registered under name "'+e+'"');return n.getInstance(t)}function s(e){var t;if("string"!=typeof e)throw Error('Only strings and functions can be passed as "editor" parameter ');if(t=h[e],!t)throw Error('No editor registered under name "'+e+'"');return t.getConstructor()}function a(e){return!!h[e]}Object.defineProperties(n,{registerEditor:{get:function(){return r}},getEditor:{get:function(){return i}},hasEditor:{get:function(){return a}},getEditorConstructor:{get:function(){return s}},__esModule:{value:!0}});var l,u,c=(l=e("browser"),l&&l.__esModule&&l||{default:l}).default,d=(u=e("helpers/string"),u&&u.__esModule&&u||{default:u}).toUpperCaseFirst,h={},f=new WeakMap;c.editors=c.editors||{},c.editors.registerEditor=r,c.editors.getEditor=i},{browser:24,"helpers/string":55}],31:[function(e,t,n){"use strict";function o(e){this.instance=e,this.state=a.EditorState.VIRGIN,this._opened=!1,this._fullEditMode=!1,this._closeCallback=null,this.init()}Object.defineProperties(n,{BaseEditor:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,l=(i=e("helpers/mixed"),i&&i.__esModule&&i||{default:i}).stringify,u=(s=e("3rdparty/walkontable/src/cell/coords"),s&&s.__esModule&&s||{default:s}).WalkontableCellCoords;a.editors=a.editors||{},a.editors.BaseEditor=o,a.EditorState={VIRGIN:"STATE_VIRGIN",EDITING:"STATE_EDITING",WAITING:"STATE_WAITING",FINISHED:"STATE_FINISHED"},o.prototype._fireCallbacks=function(e){this._closeCallback&&(this._closeCallback(e),this._closeCallback=null)},o.prototype.init=function(){},o.prototype.getValue=function(){throw Error("Editor getValue() method unimplemented")},o.prototype.setValue=function(e){throw Error("Editor setValue() method unimplemented")},o.prototype.open=function(){throw Error("Editor open() method unimplemented")},o.prototype.close=function(){throw Error("Editor close() method unimplemented")},o.prototype.prepare=function(e,t,n,o,r,i){this.TD=o,this.row=e,this.col=t,this.prop=n,this.originalValue=r,this.cellProperties=i,this.instance.view.isMouseDown()&&document.activeElement&&document.activeElement!==document.body?document.activeElement.blur():document.activeElement||document.body.focus(),this.state=a.EditorState.VIRGIN},o.prototype.extend=function(){function e(){n.apply(this,arguments)}function t(e,t){function n(){}return n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e}var n=this.constructor;return t(e,n)},o.prototype.saveValue=function(e,t){var n,o;t?(n=this.instance.getSelected(),n[0]>n[2]&&(o=n[0],n[0]=n[2],n[2]=o),n[1]>n[3]&&(o=n[1],n[1]=n[3],n[3]=o),this.instance.populateFromArray(n[0],n[1],e,n[2],n[3],"edit")):this.instance.populateFromArray(this.row,this.col,e,null,null,"edit")},o.prototype.beginEditing=function(e,t){this.state==a.EditorState.VIRGIN&&(this.instance.view.scrollViewport(new u(this.row,this.col)),this.instance.view.render(),this.state=a.EditorState.EDITING,e="string"==typeof e?e:this.originalValue,this.setValue(l(e)),this.open(t),this._opened=!0,this.focus(),this.instance.view.render())},o.prototype.finishEditing=function(e,t,n){var o,r=this;if(n){var i=this._closeCallback;this._closeCallback=function(e){i&&i(e),n(e)}}if(!this.isWaiting()){if(this.state==a.EditorState.VIRGIN)return void this.instance._registerTimeout(setTimeout(function(){r._fireCallbacks(!0)},0));if(this.state==a.EditorState.EDITING){if(e)return this.cancelChanges(),void this.instance.view.render();var s=this.getValue();o=this.instance.getSettings().trimWhitespace?[["string"==typeof s?String.prototype.trim.call(s||""):s]]:[[s]],this.state=a.EditorState.WAITING,this.saveValue(o,t),this.instance.getCellValidator(this.cellProperties)?this.instance.addHookOnce("postAfterValidate",function(e){r.state=a.EditorState.FINISHED,r.discardEditor(e)}):(this.state=a.EditorState.FINISHED,this.discardEditor(!0))}}},o.prototype.cancelChanges=function(){this.state=a.EditorState.FINISHED,this.discardEditor()},o.prototype.discardEditor=function(e){this.state===a.EditorState.FINISHED&&(e===!1&&this.cellProperties.allowInvalid!==!0?(this.instance.selectCell(this.row,this.col),this.focus(),this.state=a.EditorState.EDITING,this._fireCallbacks(!1)):(this.close(),this._opened=!1,this._fullEditMode=!1,this.state=a.EditorState.VIRGIN,this._fireCallbacks(!0)))},o.prototype.enableFullEditMode=function(){this._fullEditMode=!0},o.prototype.isInFullEditMode=function(){return this._fullEditMode},o.prototype.isOpened=function(){return this._opened},o.prototype.isWaiting=function(){return this.state===a.EditorState.WAITING},o.prototype.checkEditorSection=function(){var e=this.instance.countRows(),t="";return this.row<this.instance.getSettings().fixedRowsTop?t=this.col<this.instance.getSettings().fixedColumnsLeft?"top-left-corner":"top":this.instance.getSettings().fixedRowsBottom&&this.row>=e-this.instance.getSettings().fixedRowsBottom?t=this.col<this.instance.getSettings().fixedColumnsLeft?"bottom-left-corner":"bottom":this.col<this.instance.getSettings().fixedColumnsLeft&&(t="left"),t}},{"3rdparty/walkontable/src/cell/coords":6,browser:24,"helpers/mixed":51}],32:[function(e,t,n){"use strict";function o(e){k=!1;var t=this.getActiveEditor();if(f(e.keyCode)||e.keyCode===h.BACKSPACE||e.keyCode===h.DELETE||e.keyCode===h.INSERT){var n=0;if(e.keyCode===h.C&&(e.ctrlKey||e.metaKey))return;t.isOpened()||(n+=10),t.htEditor&&t.instance._registerTimeout(setTimeout(function(){t.queryChoices(t.TEXTAREA.value),k=!0},n))}}Object.defineProperties(n,{AutocompleteEditor:{get:function(){return O}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d=((r=e("browser"),r&&r.__esModule&&r||{default:r}).default,i=e("helpers/unicode"),i&&i.__esModule&&i||{default:i}),h=d.KEY_CODES,f=d.isPrintableChar,p=(s=e("helpers/mixed"),s&&s.__esModule&&s||{default:s}).stringify,m=(a=e("helpers/array"),a&&a.__esModule&&a||{default:a}).pivot,g=(l=e("helpers/dom/element"),l&&l.__esModule&&l||{default:l}),w=g.addClass,v=g.getCaretPosition,y=g.getScrollbarWidth,b=g.getSelectionEndPosition,C=g.outerWidth,_=g.outerHeight,R=g.offset,S=g.getTrimmingContainer,E=g.setCaretPosition,M=(u=e("editors"),u&&u.__esModule&&u||{default:u}).registerEditor,T=(c=e("handsontableEditor"),c&&c.__esModule&&c||{default:c}).HandsontableEditor,O=T.prototype.extend();O.prototype.init=function(){T.prototype.init.apply(this,arguments),this.query=null,this.choices=[]},O.prototype.createElements=function(){T.prototype.createElements.apply(this,arguments),w(this.htContainer,"autocompleteEditor"),w(this.htContainer,window.navigator.platform.indexOf("Mac")===-1?"":"htMacScroll")};var k=!1;O.prototype.prepare=function(){this.instance.addHook("beforeKeyDown",o),T.prototype.prepare.apply(this,arguments)},O.prototype.open=function(){this.TEXTAREA_PARENT.style.overflow="auto",T.prototype.open.apply(this,arguments),this.TEXTAREA_PARENT.style.overflow="";var e=this.htEditor.getInstance(),t=this,n=void 0===this.cellProperties.trimDropdown||this.cellProperties.trimDropdown;this.TEXTAREA.style.visibility="visible",this.focus(),e.updateSettings({colWidths:n?[C(this.TEXTAREA)-2]:void 0,width:n?C(this.TEXTAREA)+y()+2:void 0,afterRenderer:function(e,n,o,r,i){var s,a,l=this.getCellMeta(n,o).filteringCaseSensitive===!0;i=p(i),i&&(s=l?i.indexOf(this.query):i.toLowerCase().indexOf(t.query.toLowerCase()),s!=-1&&(a=i.substr(s,t.query.length),e.innerHTML=i.replace(a,"<strong>"+a+"</strong>")))},autoColumnSize:!0,modifyColWidth:function(e,t){var o=this.getPlugin("autoColumnSize").widths;return o[t]&&(e=o[t]),n?e:e+15}}),this.htEditor.view.wt.wtTable.holder.parentNode.style["padding-right"]=y()+2+"px",k&&(k=!1),t.instance._registerTimeout(setTimeout(function(){t.queryChoices(t.TEXTAREA.value)},0))},O.prototype.close=function(){T.prototype.close.apply(this,arguments)},O.prototype.queryChoices=function(e){this.query=e;var t=this.cellProperties.source,n=this.cellProperties.filter,o=this.cellProperties.filteringCaseSensitive;if("function"==typeof t){var r=this;t.call(this.cellProperties,e,function(e){r.updateChoicesList(e)})}else if(Array.isArray(t)){var i;if(e&&n!==!1){var s=e.toLowerCase();i=t.filter(function(t){return o?t.indexOf(e)!=-1:t.toLowerCase().indexOf(s)!=-1})}else i=t;this.updateChoicesList(i)}else this.updateChoicesList([])},O.prototype.updateChoicesList=function(e){var t=v(this.TEXTAREA),n=b(this.TEXTAREA),o=this.cellProperties.sortByRelevance,r=this.cellProperties.filter,i=null,s=null;if(o&&(i=O.sortByRelevance(this.getValue(),e,this.cellProperties.filteringCaseSensitive)),r===!1)s=i?i[0]:0;else{for(var a=[],l=0,u=e.length;l<u;l++)i?a.push(e[i[l]]):a.push(e[l]);s=0,e=a}this.choices=e,this.htEditor.loadData(m([e])),this.updateDropdownHeight(),this.flipDropdownIfNeeded(),this.cellProperties.strict===!0&&this.highlightBestMatchingChoice(s),this.instance.listen(),this.TEXTAREA.focus(),E(this.TEXTAREA,t,t===n?void 0:n)},O.prototype.flipDropdownIfNeeded=function(){var e=R(this.TEXTAREA),t=_(this.TEXTAREA),n=this.getDropdownHeight(),o=S(this.instance.view.wt.wtTable.TABLE),r={row:0,col:0};o!==window&&(r=R(o));var i=r.top+(o.scrollHeight-o.scrollTop),s=r.top+o.scrollHeight,a=e.top+t+n>i;a&&s>i?this.flipDropdown(n):this.unflipDropdown()},O.prototype.flipDropdown=function(e){var t=this.htEditor.rootElement.style;t.position="absolute",t.top=-e+"px",this.htEditor.flipped=!0},O.prototype.unflipDropdown=function(){var e=this.htEditor.rootElement.style;"absolute"===e.position&&(e.position="",e.top=""),this.htEditor.flipped=void 0},O.prototype.updateDropdownHeight=function(){var e=this.htEditor.getColWidth(0)+y()+2,t=this.cellProperties.trimDropdown;this.htEditor.updateSettings({height:this.getDropdownHeight(),width:t?void 0:e}),this.htEditor.view.wt.wtTable.alignOverlaysWithTrimmingContainer()},O.prototype.finishEditing=function(e){e||this.instance.removeHook("beforeKeyDown",o),T.prototype.finishEditing.apply(this,arguments)},O.prototype.highlightBestMatchingChoice=function(e){"number"==typeof e?this.htEditor.selectCell(e,0):this.htEditor.deselectCell()},O.sortByRelevance=function(e,t,n){var o,r,i,s,a=[],l=e.length,u=[],c=t.length;
+if(0===l){for(s=0;s<c;s++)u.push(s);return u}for(s=0;s<c;s++)o=p(t[s]),r=n?o.indexOf(e):o.toLowerCase().indexOf(e.toLowerCase()),r!=-1&&(i=o.length-r-l,a.push({baseIndex:s,index:r,charsLeft:i,value:o}));for(a.sort(function(e,t){return t.index===-1?-1:e.index===-1?1:e.index<t.index?-1:t.index<e.index?1:e.index===t.index?e.charsLeft<t.charsLeft?-1:e.charsLeft>t.charsLeft?1:0:void 0}),s=0,c=a.length;s<c;s++)u.push(a[s].baseIndex);return u},O.prototype.getDropdownHeight=function(){var e=this.htEditor.getInstance().getRowHeight(0)||23,t=this.cellProperties.visibleRows;return this.choices.length>=t?t*e:this.choices.length*e+8},O.prototype.allowKeyEventPropagation=function(e){var t={row:this.htEditor.getSelectedRange()?this.htEditor.getSelectedRange().from.row:-1},n=!1;return e===h.ARROW_DOWN&&t.row>0&&t.row<this.htEditor.countRows()-1&&(n=!0),e===h.ARROW_UP&&t.row>-1&&(n=!0),n},M("autocomplete",O)},{browser:24,editors:30,handsontableEditor:36,"helpers/array":43,"helpers/dom/element":47,"helpers/mixed":51,"helpers/unicode":56}],33:[function(e,t,n){"use strict";Object.defineProperties(n,{CheckboxEditor:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e("editors"),o&&o.__esModule&&o||{default:o}).registerEditor,a=(r=e("_baseEditor"),r&&r.__esModule&&r||{default:r}).BaseEditor,l=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}).hasClass,u=function(){$traceurRuntime.superConstructor(c).apply(this,arguments)},c=u;$traceurRuntime.createClass(u,{beginEditing:function(e,t){if(void 0===t){var n=this.TD.querySelector('input[type="checkbox"]');l(n,"htBadValue")||n.click()}},finishEditing:function(){},init:function(){},open:function(){},close:function(){},getValue:function(){},setValue:function(){},focus:function(){}},{},a),s("checkbox",u)},{_baseEditor:31,editors:30,"helpers/dom/element":47}],34:[function(e,t,n){"use strict";Object.defineProperties(n,{DateEditor:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,p=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),m=p.addClass,g=p.outerHeight,w=(i=e("helpers/object"),i&&i.__esModule&&i||{default:i}).deepExtend,v=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).EventManager,y=(a=e("editors"),a&&a.__esModule&&a||{default:a}),b=(y.getEditor,y.registerEditor),C=(l=e("helpers/unicode"),l&&l.__esModule&&l||{default:l}).isMetaKey,_=(u=e("helpers/dom/event"),u&&u.__esModule&&u||{default:u}).stopPropagation,R=(c=e("textEditor"),c&&c.__esModule&&c||{default:c}).TextEditor,S=(d=e("moment"),d&&d.__esModule&&d||{default:d}).default,E=(h=e("pikaday"),h&&h.__esModule&&h||{default:h}).default;f.editors=f.editors||{},f.editors.DateEditor=M;var M=function(e){this.$datePicker=null,this.datePicker=null,this.datePickerStyle=null,this.defaultDateFormat="DD/MM/YYYY",this.isCellEdited=!1,this.parentDestroyed=!1,$traceurRuntime.superConstructor(T).call(this,e)},T=M;$traceurRuntime.createClass(M,{init:function(){var e=this;if("function"!=typeof S)throw new Error("You need to include moment.js to your project.");if("function"!=typeof E)throw new Error("You need to include Pikaday to your project.");$traceurRuntime.superGet(this,T.prototype,"init").call(this),this.instance.addHook("afterDestroy",function(){e.parentDestroyed=!0,e.destroyElements()})},createElements:function(){$traceurRuntime.superGet(this,T.prototype,"createElements").call(this),this.datePicker=document.createElement("DIV"),this.datePickerStyle=this.datePicker.style,this.datePickerStyle.position="absolute",this.datePickerStyle.top=0,this.datePickerStyle.left=0,this.datePickerStyle.zIndex=9999,m(this.datePicker,"htDatepickerHolder"),document.body.appendChild(this.datePicker),this.$datePicker=new E(this.getDatePickerConfig());var e=new v(this);e.addEventListener(this.datePicker,"mousedown",function(e){return _(e)}),this.hideDatepicker()},destroyElements:function(){this.$datePicker.destroy()},prepare:function(e,t,n,o,r,i){this._opened=!1,$traceurRuntime.superGet(this,T.prototype,"prepare").call(this,e,t,n,o,r,i)},open:function(){var e=void 0!==arguments[0]?arguments[0]:null;$traceurRuntime.superGet(this,T.prototype,"open").call(this),this.showDatepicker(e)},close:function(){var e=this;this._opened=!1,this.instance._registerTimeout(setTimeout(function(){e.instance.selection.refreshBorders()},0)),$traceurRuntime.superGet(this,T.prototype,"close").call(this)},finishEditing:function(){var e=void 0!==arguments[0]&&arguments[0],t=void 0!==arguments[1]&&arguments[1];if(e){var n=this.originalValue;void 0!==n&&this.setValue(n)}this.hideDatepicker(),$traceurRuntime.superGet(this,T.prototype,"finishEditing").call(this,e,t)},showDatepicker:function(e){this.$datePicker.config(this.getDatePickerConfig());var t,n=this.TD.getBoundingClientRect(),o=this.cellProperties.dateFormat||this.defaultDateFormat,r=this.$datePicker.config(),i=this.instance.view.isMouseDown(),s=!!e&&C(e.keyCode);this.datePickerStyle.top=window.pageYOffset+n.top+g(this.TD)+"px",this.datePickerStyle.left=window.pageXOffset+n.left+"px",this.$datePicker._onInputFocus=function(){},r.format=o,this.originalValue?(t=this.originalValue,S(t,o,!0).isValid()&&this.$datePicker.setMoment(S(t,o),!0),this.getValue()!==this.originalValue&&this.setValue(this.originalValue),s||i||this.setValue("")):this.cellProperties.defaultDate?(t=this.cellProperties.defaultDate,r.defaultDate=t,S(t,o,!0).isValid()&&this.$datePicker.setMoment(S(t,o),!0),s||i||this.setValue("")):this.$datePicker.gotoToday(),this.datePickerStyle.display="block",this.$datePicker.show()},hideDatepicker:function(){this.datePickerStyle.display="none",this.$datePicker.hide()},getDatePickerConfig:function(){var e=this,t=this.TEXTAREA,n={};this.cellProperties&&this.cellProperties.datePickerConfig&&w(n,this.cellProperties.datePickerConfig);var o=n.onSelect,r=n.onClose;return n.field=t,n.trigger=t,n.container=this.datePicker,n.bound=!1,n.format=n.format||this.defaultDateFormat,n.reposition=n.reposition||!1,n.onSelect=function(t){isNaN(t.getTime())||(t=S(t).format(e.cellProperties.dateFormat||e.defaultDateFormat)),e.setValue(t),e.hideDatepicker(),o&&o()},n.onClose=function(){e.parentDestroyed||e.finishEditing(!1),r&&r()},n}},{},R),b("date",M)},{browser:24,editors:30,eventManager:42,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/object":53,"helpers/unicode":56,moment:"moment",pikaday:"pikaday",textEditor:41}],35:[function(e,t,n){"use strict";Object.defineProperties(n,{DropdownEditor:{get:function(){return c}},__esModule:{value:!0}});var o,r,i,s=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,a=(r=e("editors"),r&&r.__esModule&&r||{default:r}),l=(a.getEditor,a.registerEditor),u=(a.getEditorConstructor,(i=e("autocompleteEditor"),i&&i.__esModule&&i||{default:i}).AutocompleteEditor),c=function(){$traceurRuntime.superConstructor(d).apply(this,arguments)},d=c;$traceurRuntime.createClass(c,{prepare:function(e,t,n,o,r,i){$traceurRuntime.superGet(this,d.prototype,"prepare").call(this,e,t,n,o,r,i),this.cellProperties.filter=!1,this.cellProperties.strict=!0}},{},u),s.hooks.add("beforeValidate",function(e,t,n,o){var r=this.getCellMeta(t,this.propToCol(n));r.editor===s.editors.DropdownEditor&&void 0===r.strict&&(r.filter=!1,r.strict=!0)}),l("dropdown",c)},{autocompleteEditor:32,browser:24,editors:30}],36:[function(e,t,n){"use strict";Object.defineProperties(n,{HandsontableEditor:{get:function(){return b}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,d=(r=e("helpers/unicode"),r&&r.__esModule&&r||{default:r}).KEY_CODES,h=(i=e("helpers/object"),i&&i.__esModule&&i||{default:i}).extend,f=(s=e("helpers/dom/element"),s&&s.__esModule&&s||{default:s}).setCaretPosition,p=(a=e("helpers/dom/event"),a&&a.__esModule&&a||{default:a}),m=p.stopImmediatePropagation,g=p.isImmediatePropagationStopped,w=(l=e("editors"),l&&l.__esModule&&l||{default:l}),v=(w.getEditor,w.registerEditor),y=(u=e("textEditor"),u&&u.__esModule&&u||{default:u}).TextEditor,b=y.prototype.extend();b.prototype.createElements=function(){y.prototype.createElements.apply(this,arguments);var e=document.createElement("DIV");e.className="handsontableEditor",this.TEXTAREA_PARENT.appendChild(e),this.htContainer=e,this.assignHooks()},b.prototype.prepare=function(e,t,n,o,r,i){y.prototype.prepare.apply(this,arguments);var s=this,a={startRows:0,startCols:0,minRows:0,minCols:0,className:"listbox",copyPaste:!1,autoColumnSize:!1,autoRowSize:!1,readOnly:!0,fillHandle:!1,afterOnCellMouseDown:function(){var e=this.getValue();void 0!==e&&s.setValue(e),s.instance.destroyEditor()}};this.cellProperties.handsontable&&h(a,i.handsontable),this.htOptions=a};var C=function(e){if(!g(e)){var t,n=this.getActiveEditor(),o=n.htEditor.getInstance();if(e.keyCode==d.ARROW_DOWN)if(o.getSelected()||o.flipped){if(o.getSelected())if(o.flipped)t=o.getSelected()[0]+1;else if(!o.flipped){var r=o.getSelected()[0],i=o.countRows()-1;t=Math.min(i,r+1)}}else t=0;else if(e.keyCode==d.ARROW_UP)if(!o.getSelected()&&o.flipped)t=o.countRows()-1;else if(o.getSelected())if(o.flipped){var r=o.getSelected()[0];t=Math.max(0,r-1)}else{var r=o.getSelected()[0];t=r-1}void 0!==t&&(t<0||o.flipped&&t>o.countRows()-1?o.deselectCell():o.selectCell(t,0),o.getData().length&&(e.preventDefault(),m(e),n.instance.listen(),n.TEXTAREA.focus()))}};b.prototype.open=function(){this.instance.addHook("beforeKeyDown",C),y.prototype.open.apply(this,arguments),this.htEditor&&this.htEditor.destroy(),this.htEditor=new c(this.htContainer,this.htOptions),this.cellProperties.strict?(this.htEditor.selectCell(0,0),this.TEXTAREA.style.visibility="hidden"):(this.htEditor.deselectCell(),this.TEXTAREA.style.visibility="visible"),f(this.TEXTAREA,0,this.TEXTAREA.value.length)},b.prototype.close=function(){this.instance.removeHook("beforeKeyDown",C),this.instance.listen(),y.prototype.close.apply(this,arguments)},b.prototype.focus=function(){this.instance.listen(),y.prototype.focus.apply(this,arguments)},b.prototype.beginEditing=function(e){var t=this.instance.getSettings().onBeginEditing;t&&t()===!1||y.prototype.beginEditing.apply(this,arguments)},b.prototype.finishEditing=function(e,t){if(this.htEditor&&this.htEditor.isListening()&&this.instance.listen(),this.htEditor&&this.htEditor.getSelected()){var n=this.htEditor.getInstance().getValue();void 0!==n&&this.setValue(n)}return y.prototype.finishEditing.apply(this,arguments)},b.prototype.assignHooks=function(){var e=this;this.instance.addHook("afterDestroy",function(){e.htEditor&&e.htEditor.destroy()})},v("handsontable",b)},{browser:24,editors:30,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/object":53,"helpers/unicode":56,textEditor:41}],37:[function(e,t,n){"use strict";Object.defineProperties(n,{MobileTextEditor:{get:function(){return k}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=((o=e("browser"),o&&o.__esModule&&o||{default:o}).default,(r=e("helpers/unicode"),r&&r.__esModule&&r||{default:r}).KEY_CODES),d=(i=e("helpers/dom/event"),i&&i.__esModule&&i||{default:i}),h=d.stopImmediatePropagation,f=d.isImmediatePropagationStopped,p=(s=e("helpers/dom/element"),s&&s.__esModule&&s||{default:s}),m=p.addClass,g=p.getScrollLeft,w=p.getScrollTop,v=p.hasClass,y=p.isChildOf,b=p.offset,C=p.outerHeight,_=p.outerWidth,R=p.removeClass,S=p.setCaretPosition,E=(a=e("editors"),a&&a.__esModule&&a||{default:a}),M=(E.getEditor,E.registerEditor),T=(l=e("_baseEditor"),l&&l.__esModule&&l||{default:l}).BaseEditor,O=(u=e("eventManager"),u&&u.__esModule&&u||{default:u}).eventManager,k=T.prototype.extend(),x={},H=function(){this.controls={},this.controls.leftButton=document.createElement("DIV"),this.controls.leftButton.className="leftButton",this.controls.rightButton=document.createElement("DIV"),this.controls.rightButton.className="rightButton",this.controls.upButton=document.createElement("DIV"),this.controls.upButton.className="upButton",this.controls.downButton=document.createElement("DIV"),this.controls.downButton.className="downButton";for(var e in this.controls)this.controls.hasOwnProperty(e)&&this.positionControls.appendChild(this.controls[e])};k.prototype.valueChanged=function(){return this.initValue!=this.getValue()},k.prototype.init=function(){var e=this;this.eventManager=O(this.instance),this.createElements(),this.bindEvents(),this.instance.addHook("afterDestroy",function(){e.destroy()})},k.prototype.getValue=function(){return this.TEXTAREA.value},k.prototype.setValue=function(e){this.initValue=e,this.TEXTAREA.value=e},k.prototype.createElements=function(){this.editorContainer=document.createElement("DIV"),this.editorContainer.className="htMobileEditorContainer",this.cellPointer=document.createElement("DIV"),this.cellPointer.className="cellPointer",this.moveHandle=document.createElement("DIV"),this.moveHandle.className="moveHandle",this.inputPane=document.createElement("DIV"),this.inputPane.className="inputs",this.positionControls=document.createElement("DIV"),this.positionControls.className="positionControls",this.TEXTAREA=document.createElement("TEXTAREA"),m(this.TEXTAREA,"handsontableInput"),this.inputPane.appendChild(this.TEXTAREA),this.editorContainer.appendChild(this.cellPointer),this.editorContainer.appendChild(this.moveHandle),this.editorContainer.appendChild(this.inputPane),this.editorContainer.appendChild(this.positionControls),H.call(this),document.body.appendChild(this.editorContainer)},k.prototype.onBeforeKeyDown=function(e){var t=this,n=t.getActiveEditor();if(e.target===n.TEXTAREA&&!f(e))switch(e.keyCode){case c.ENTER:n.close(),e.preventDefault();break;case c.BACKSPACE:h(e)}},k.prototype.open=function(){this.instance.addHook("beforeKeyDown",this.onBeforeKeyDown),m(this.editorContainer,"active"),R(this.cellPointer,"hidden"),this.updateEditorPosition()},k.prototype.focus=function(){this.TEXTAREA.focus(),S(this.TEXTAREA,this.TEXTAREA.value.length)},k.prototype.close=function(){this.TEXTAREA.blur(),this.instance.removeHook("beforeKeyDown",this.onBeforeKeyDown),R(this.editorContainer,"active")},k.prototype.scrollToView=function(){var e=this.instance.getSelectedRange().highlight;this.instance.view.scrollViewport(e)},k.prototype.hideCellPointer=function(){v(this.cellPointer,"hidden")||m(this.cellPointer,"hidden")},k.prototype.updateEditorPosition=function(e,t){if(e&&t)e=parseInt(e,10),t=parseInt(t,10),this.editorContainer.style.top=t+"px",this.editorContainer.style.left=e+"px";else{var n=this.instance.getSelected(),o=this.instance.getCell(n[0],n[1]);if(x.cellPointer||(x.cellPointer={height:C(this.cellPointer),width:_(this.cellPointer)}),x.editorContainer||(x.editorContainer={width:_(this.editorContainer)}),void 0!==o){var r=this.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer==window?0:g(this.instance.view.wt.wtOverlays.leftOverlay.holder),i=this.instance.view.wt.wtOverlays.topOverlay.trimmingContainer==window?0:w(this.instance.view.wt.wtOverlays.topOverlay.holder),s=b(o),a=_(o),l={x:r,y:i};this.editorContainer.style.top=parseInt(s.top+C(o)-l.y+x.cellPointer.height,10)+"px",this.editorContainer.style.left=parseInt(window.innerWidth/2-x.editorContainer.width/2,10)+"px",s.left+a/2>parseInt(this.editorContainer.style.left,10)+x.editorContainer.width?this.editorContainer.style.left=window.innerWidth-x.editorContainer.width+"px":s.left+a/2<parseInt(this.editorContainer.style.left,10)+20&&(this.editorContainer.style.left="0px"),this.cellPointer.style.left=parseInt(s.left-x.cellPointer.width/2-b(this.editorContainer).left+a/2-l.x,10)+"px"}}},k.prototype.updateEditorData=function(){var e=this.instance.getSelected(),t=this.instance.getDataAtCell(e[0],e[1]);this.row=e[0],this.col=e[1],this.setValue(t),this.updateEditorPosition()},k.prototype.prepareAndSave=function(){var e;return!this.valueChanged()||(e=this.instance.getSettings().trimWhitespace?[[String.prototype.trim.call(this.getValue())]]:[[this.getValue()]],void this.saveValue(e))},k.prototype.bindEvents=function(){var e=this;this.eventManager.addEventListener(this.controls.leftButton,"touchend",function(t){e.prepareAndSave(),e.instance.selection.transformStart(0,-1,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.rightButton,"touchend",function(t){e.prepareAndSave(),e.instance.selection.transformStart(0,1,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.upButton,"touchend",function(t){e.prepareAndSave(),e.instance.selection.transformStart(-1,0,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.downButton,"touchend",function(t){e.prepareAndSave(),e.instance.selection.transformStart(1,0,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.moveHandle,"touchstart",function(t){if(1==t.touches.length){var n=t.touches[0],o={x:e.editorContainer.offsetLeft,y:e.editorContainer.offsetTop},r={x:n.pageX-o.x,y:n.pageY-o.y};e.eventManager.addEventListener(this,"touchmove",function(t){var n=t.touches[0];e.updateEditorPosition(n.pageX-r.x,n.pageY-r.y),e.hideCellPointer(),t.preventDefault()})}}),this.eventManager.addEventListener(document.body,"touchend",function(t){y(t.target,e.editorContainer)||y(t.target,e.instance.rootElement)||e.close()}),this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.leftOverlay.holder,"scroll",function(t){e.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer!=window&&e.hideCellPointer()}),this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.topOverlay.holder,"scroll",function(t){e.instance.view.wt.wtOverlays.topOverlay.trimmingContainer!=window&&e.hideCellPointer()})},k.prototype.destroy=function(){this.eventManager.clear(),this.editorContainer.parentNode.removeChild(this.editorContainer)},M("mobile",k)},{_baseEditor:31,browser:24,editors:30,eventManager:42,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/unicode":56}],38:[function(e,t,n){"use strict";Object.defineProperties(n,{NumericEditor:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e("numbro"),o&&o.__esModule&&o||{default:o}).default,a=(r=e("editors"),r&&r.__esModule&&r||{default:r}).registerEditor,l=(i=e("textEditor"),i&&i.__esModule&&i||{default:i}).TextEditor,u=function(){$traceurRuntime.superConstructor(c).apply(this,arguments)},c=u;$traceurRuntime.createClass(u,{beginEditing:function(e){if("undefined"==typeof e&&this.originalValue){"undefined"!=typeof this.cellProperties.language&&s.culture(this.cellProperties.language);var t=s.cultureData().delimiters.decimal;e=(""+this.originalValue).replace(".",t)}$traceurRuntime.superGet(this,c.prototype,"beginEditing").call(this,e)}},{},l),a("numeric",u)},{editors:30,numbro:"numbro",textEditor:41}],39:[function(e,t,n){"use strict";Object.defineProperties(n,{PasswordEditor:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=((o=e("browser"),o&&o.__esModule&&o||{default:o}).default,(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}).empty),l=(i=e("editors"),i&&i.__esModule&&i||{default:i}),u=(l.getEditor,l.registerEditor),c=(s=e("textEditor"),s&&s.__esModule&&s||{default:s}).TextEditor,d=function(){$traceurRuntime.superConstructor(h).apply(this,arguments)},h=d;$traceurRuntime.createClass(d,{createElements:function(){$traceurRuntime.superGet(this,h.prototype,"createElements").call(this),this.TEXTAREA=document.createElement("input"),this.TEXTAREA.setAttribute("type","password"),this.TEXTAREA.className="handsontableInput",this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,a(this.TEXTAREA_PARENT),this.TEXTAREA_PARENT.appendChild(this.TEXTAREA)}},{},c),u("password",d)},{browser:24,editors:30,"helpers/dom/element":47,textEditor:41}],40:[function(e,t,n){"use strict";Object.defineProperties(n,{SelectEditor:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,c=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),d=c.addClass,h=c.empty,f=c.fastInnerHTML,p=c.getComputedStyle,m=c.getCssTransform,g=c.getScrollableElement,w=c.offset,v=c.outerHeight,y=c.outerWidth,b=c.resetCssTransform,C=(i=e("helpers/dom/event"),i&&i.__esModule&&i||{default:i}).stopImmediatePropagation,_=(s=e("helpers/unicode"),s&&s.__esModule&&s||{default:s}).KEY_CODES,R=(a=e("editors"),a&&a.__esModule&&a||{default:a}),S=(R.getEditor,R.registerEditor),E=(l=e("_baseEditor"),l&&l.__esModule&&l||{default:l}).BaseEditor,M=E.prototype.extend();M.prototype.init=function(){this.select=document.createElement("SELECT"),d(this.select,"htSelectEditor"),this.select.style.display="none",this.instance.rootElement.appendChild(this.select),this.registerHooks()},M.prototype.registerHooks=function(){var e=this;this.instance.addHook("afterScrollHorizontally",function(){return e.refreshDimensions()}),this.instance.addHook("afterScrollVertically",function(){return e.refreshDimensions()}),this.instance.addHook("afterColumnResize",function(){return e.refreshDimensions()}),this.instance.addHook("afterRowResize",function(){return e.refreshDimensions()})},M.prototype.prepare=function(){E.prototype.prepare.apply(this,arguments);var e,t=this.cellProperties.selectOptions;e="function"==typeof t?this.prepareOptions(t(this.row,this.col,this.prop)):this.prepareOptions(t),h(this.select);for(var n in e)if(e.hasOwnProperty(n)){var o=document.createElement("OPTION");o.value=n,f(o,e[n]),this.select.appendChild(o)}},M.prototype.prepareOptions=function(e){var t={};if(Array.isArray(e))for(var n=0,o=e.length;n<o;n++)t[e[n]]=e[n];else"object"==typeof e&&(t=e);return t},M.prototype.getValue=function(){return this.select.value},M.prototype.setValue=function(e){this.select.value=e};var T=function(e){var t=this,n=t.getActiveEditor();switch(e.keyCode){case _.ARROW_UP:var o=n.select.selectedIndex-1;o>=0&&(n.select[o].selected=!0),C(e),e.preventDefault();break;case _.ARROW_DOWN:var r=n.select.selectedIndex+1;r<=n.select.length-1&&(n.select[r].selected=!0),C(e),e.preventDefault()}};M.prototype.open=function(){this._opened=!0,this.refreshDimensions(),this.select.style.display="",this.instance.addHook("beforeKeyDown",T)},M.prototype.close=function(){this._opened=!1,this.select.style.display="none",this.instance.removeHook("beforeKeyDown",T)},M.prototype.focus=function(){this.select.focus()},M.prototype.refreshDimensions=function(){if(this.state===u.EditorState.EDITING){if(this.TD=this.getEditedCell(),!this.TD)return void this.close();var e,t=y(this.TD)+1,n=v(this.TD)+1,o=w(this.TD),r=w(this.instance.rootElement),i=g(this.TD),s=o.top-r.top-1-(i.scrollTop||0),a=o.left-r.left-1-(i.scrollLeft||0),l=this.checkEditorSection(),c=this.instance.getSettings();c.rowHeaders?1:0,c.colHeaders?1:0;switch(l){case"top":e=m(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case"left":e=m(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);break;case"top-left-corner":e=m(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case"bottom-left-corner":e=m(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case"bottom":e=m(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode)}0===this.instance.getSelected()[0]&&(s+=1),0===this.instance.getSelected()[1]&&(a+=1);var d=this.select.style;e&&e!=-1?d[e[0]]=e[1]:b(this.select);var h=p(this.TD);parseInt(h.borderTopWidth,10)>0&&(n-=1),parseInt(h.borderLeftWidth,10)>0&&(t-=1),d.height=n+"px",d.minWidth=t+"px",d.top=s+"px",d.left=a+"px",d.margin="0px"}},M.prototype.getEditedCell=function(){var e,t=this.checkEditorSection();switch(t){case"top":e=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=101;break;case"corner":e=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=103;break;case"left":e=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=102;break;default:e=this.instance.getCell(this.row,this.col),this.select.style.zIndex=""}return e!=-1&&e!=-2?e:void 0},S("select",M)},{_baseEditor:31,browser:24,editors:30,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/unicode":56}],41:[function(e,t,n){"use strict";Object.defineProperties(n,{TextEditor:{get:function(){return N}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,h=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),f=h.addClass,p=h.getCaretPosition,m=h.getComputedStyle,g=h.getCssTransform,w=h.getScrollableElement,v=h.getScrollbarWidth,y=h.innerWidth,b=h.offset,C=h.resetCssTransform,_=h.setCaretPosition,R=h.hasVerticalScrollbar,S=h.hasHorizontalScrollbar,E=(i=e("autoResize"),i&&i.__esModule&&i||{default:i}).default,M=(s=e("_baseEditor"),s&&s.__esModule&&s||{default:s}).BaseEditor,T=(a=e("eventManager"),a&&a.__esModule&&a||{default:a}).eventManager,O=(l=e("editors"),l&&l.__esModule&&l||{default:l}),k=(O.getEditor,O.registerEditor),x=(u=e("helpers/unicode"),u&&u.__esModule&&u||{default:u}).KEY_CODES,H=(c=e("helpers/dom/event"),c&&c.__esModule&&c||{default:c}),D=H.stopPropagation,A=H.stopImmediatePropagation,P=H.isImmediatePropagationStopped,N=M.prototype.extend();N.prototype.init=function(){var e=this;this.createElements(),this.eventManager=T(this),this.bindEvents(),this.autoResize=E(),this.instance.addHook("afterDestroy",function(){e.destroy()})},N.prototype.getValue=function(){return this.TEXTAREA.value},N.prototype.setValue=function(e){this.TEXTAREA.value=e};var L=function(e){var t,n=this,o=n.getActiveEditor();if(t=(e.ctrlKey||e.metaKey)&&!e.altKey,e.target===o.TEXTAREA&&!P(e)){if(17===e.keyCode||224===e.keyCode||91===e.keyCode||93===e.keyCode)return void A(e);switch(e.keyCode){case x.ARROW_RIGHT:o.isInFullEditMode()&&(!o.isWaiting()&&!o.allowKeyEventPropagation||!o.isWaiting()&&o.allowKeyEventPropagation&&!o.allowKeyEventPropagation(e.keyCode))&&A(e);break;case x.ARROW_LEFT:o.isInFullEditMode()&&(!o.isWaiting()&&!o.allowKeyEventPropagation||!o.isWaiting()&&o.allowKeyEventPropagation&&!o.allowKeyEventPropagation(e.keyCode))&&A(e);break;case x.ARROW_UP:case x.ARROW_DOWN:o.isInFullEditMode()&&(!o.isWaiting()&&!o.allowKeyEventPropagation||!o.isWaiting()&&o.allowKeyEventPropagation&&!o.allowKeyEventPropagation(e.keyCode))&&A(e);break;case x.ENTER:var r=o.instance.getSelected(),i=!(r[0]===r[2]&&r[1]===r[3]);if(t&&!i||e.altKey){if(o.isOpened()){var s=p(o.TEXTAREA),a=o.getValue(),l=a.slice(0,s)+"\n"+a.slice(s);o.setValue(l),_(o.TEXTAREA,s+1)}else o.beginEditing(o.originalValue+"\n");A(e)}e.preventDefault();break;case x.A:case x.X:case x.C:case x.V:t&&A(e);break;case x.BACKSPACE:case x.DELETE:case x.HOME:case x.END:A(e)}[x.ARROW_UP,x.ARROW_RIGHT,x.ARROW_DOWN,x.ARROW_LEFT].indexOf(e.keyCode)===-1&&o.autoResize.resize(String.fromCharCode(e.keyCode))}};N.prototype.open=function(){this.refreshDimensions(),this.instance.addHook("beforeKeyDown",L)},N.prototype.close=function(e){this.textareaParentStyle.display="none",this.autoResize.unObserve(),document.activeElement===this.TEXTAREA&&this.instance.listen(),this.instance.removeHook("beforeKeyDown",L)},N.prototype.focus=function(){this.TEXTAREA.focus(),_(this.TEXTAREA,this.TEXTAREA.value.length)},N.prototype.createElements=function(){this.TEXTAREA=document.createElement("TEXTAREA"),f(this.TEXTAREA,"handsontableInput"),this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,this.TEXTAREA_PARENT=document.createElement("DIV"),f(this.TEXTAREA_PARENT,"handsontableInputHolder"),this.textareaParentStyle=this.TEXTAREA_PARENT.style,this.textareaParentStyle.top=0,this.textareaParentStyle.left=0,this.textareaParentStyle.display="none",this.TEXTAREA_PARENT.appendChild(this.TEXTAREA),this.instance.rootElement.appendChild(this.TEXTAREA_PARENT);var e=this;this.instance._registerTimeout(setTimeout(function(){e.refreshDimensions()},0))},N.prototype.getEditedCell=function(){var e,t=this.checkEditorSection();switch(t){case"top":e=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=101;break;case"top-left-corner":e=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=103;break;case"bottom-left-corner":e=this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=103;break;case"left":e=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=102;break;case"bottom":e=this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=102;break;default:e=this.instance.getCell(this.row,this.col),this.textareaParentStyle.zIndex=""}return e!=-1&&e!=-2?e:void 0},N.prototype.refreshDimensions=function(){if(this.state===d.EditorState.EDITING){if(this.TD=this.getEditedCell(),!this.TD)return void this.close(!0);var e,t=b(this.TD),n=b(this.instance.rootElement),o=w(this.TD),r=this.instance.countRows(),i=t.top-n.top-1-(o.scrollTop||0),s=t.left-n.left-1-(o.scrollLeft||0),a=this.instance.getSettings(),l=(this.instance.hasRowHeaders(),this.instance.hasColHeaders()),u=this.checkEditorSection(),c=this.TD.style.backgroundColor;switch(u){case"top":e=g(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case"left":e=g(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);break;case"top-left-corner":e=g(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case"bottom-left-corner":e=g(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case"bottom":e=g(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode)}(l&&0===this.instance.getSelected()[0]||a.fixedRowsBottom&&this.instance.getSelected()[0]===r-a.fixedRowsBottom)&&(i+=1),0===this.instance.getSelected()[1]&&(s+=1),e&&e!=-1?this.textareaParentStyle[e[0]]=e[1]:C(this.TEXTAREA_PARENT),this.textareaParentStyle.top=i+"px",this.textareaParentStyle.left=s+"px";var h=this.instance.view.wt.wtViewport.rowsRenderCalculator.startPosition,f=this.instance.view.wt.wtViewport.columnsRenderCalculator.startPosition,p=this.instance.view.wt.wtOverlays.leftOverlay.getScrollPosition(),_=this.instance.view.wt.wtOverlays.topOverlay.getScrollPosition(),E=v(),M=this.TD.offsetTop+h-_,T=this.TD.offsetLeft+f-p,O=y(this.TD)-8,k=R(o)?E:0,x=S(o)?E:0,H=this.instance.view.maximumVisibleElementWidth(T)-9-k,D=this.TD.scrollHeight+1,A=Math.max(this.instance.view.maximumVisibleElementHeight(M)-x,23),P=m(this.TD);this.TEXTAREA.style.fontSize=P.fontSize,this.TEXTAREA.style.fontFamily=P.fontFamily,this.TEXTAREA.style.backgroundColor="",this.TEXTAREA.style.backgroundColor=c?c:m(this.TEXTAREA).backgroundColor,this.autoResize.init(this.TEXTAREA,{minHeight:Math.min(D,A),maxHeight:A,minWidth:Math.min(O,H),maxWidth:H},!0),this.textareaParentStyle.display="block"}},N.prototype.bindEvents=function(){var e=this;this.eventManager.addEventListener(this.TEXTAREA,"cut",function(e){D(e)}),this.eventManager.addEventListener(this.TEXTAREA,"paste",function(e){D(e)}),this.instance.addHook("afterScrollHorizontally",function(){e.refreshDimensions()}),this.instance.addHook("afterScrollVertically",function(){e.refreshDimensions()}),this.instance.addHook("afterColumnResize",function(){e.refreshDimensions(),e.focus()}),this.instance.addHook("afterRowResize",function(){e.refreshDimensions(),e.focus()}),this.instance.addHook("afterDestroy",function(){e.eventManager.destroy()})},N.prototype.destroy=function(){this.eventManager.destroy()},k("text",N)},{_baseEditor:31,autoResize:"autoResize",browser:24,editors:30,
+eventManager:42,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/unicode":56}],42:[function(e,t,n){"use strict";function o(e,t){var n,o,r,i,s,a,l="HOT-TABLE";if(t.isTargetWebComponent=!1,t.realTarget=t.target,a=t.stopImmediatePropagation,t.stopImmediatePropagation=function(){a.apply(this),p(this)},!u.eventManager.isHotTableEnv)return t;for(t=d(t),s=t.path?t.path.length:0;s--;){if(t.path[s].nodeName===l)n=!0;else if(n&&t.path[s].shadowRoot){i=t.path[s];break}0!==s||i||(i=t.path[s])}return i||(i=t.target),t.isTargetWebComponent=!0,f()?t.realTarget=t.srcElement||t.toElement:(e instanceof u.Core||e instanceof Walkontable)&&(e instanceof u.Core?o=e.view?e.view.wt.wtTable.TABLE:null:e instanceof Walkontable&&(o=e.wtTable.TABLE.parentNode.parentNode),r=h(t.target,[l],o),r?t.realTarget=o.querySelector(l)||t.target:t.realTarget=t.target),Object.defineProperty(t,"target",{get:function(){return d(i)},enumerable:!0,configurable:!0}),t}function r(e){return new m(e)}Object.defineProperties(n,{EventManager:{get:function(){return m}},eventManager:{get:function(){return r}},__esModule:{value:!0}});var i,s,a,l,u=(i=e("browser"),i&&i.__esModule&&i||{default:i}).default,c=(s=e("helpers/dom/element"),s&&s.__esModule&&s||{default:s}),d=c.polymerWrap,h=c.closest,f=(a=e("helpers/feature"),a&&a.__esModule&&a||{default:a}).isWebComponentSupportedNatively,p=(l=e("helpers/dom/event"),l&&l.__esModule&&l||{default:l}).stopImmediatePropagation,m=function(){var e=void 0!==arguments[0]?arguments[0]:null;this.context=e||this,this.context.eventListeners||(this.context.eventListeners=[])};$traceurRuntime.createClass(m,{addEventListener:function(e,t,n){function r(e){e=o(s,e),n.call(this,e)}var i=this,s=this.context;return this.context.eventListeners.push({element:e,event:t,callback:n,callbackProxy:r}),window.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r),u.countEventManagerListeners++,function(){i.removeEventListener(e,t,n)}},removeEventListener:function(e,t,n){for(var o,r=this.context.eventListeners.length;r--;)if(o=this.context.eventListeners[r],o.event==t&&o.element==e){if(n&&n!=o.callback)continue;this.context.eventListeners.splice(r,1),o.element.removeEventListener?o.element.removeEventListener(o.event,o.callbackProxy,!1):o.element.detachEvent("on"+o.event,o.callbackProxy),u.countEventManagerListeners--}},clearEvents:function(){if(this.context)for(var e=this.context.eventListeners.length;e--;){var t=this.context.eventListeners[e];t&&this.removeEventListener(t.element,t.event,t.callback)}},clear:function(){this.clearEvents()},destroy:function(){this.clearEvents(),this.context=null},fireEvent:function(e,t){var n,o={bubbles:!0,cancelable:"mousemove"!==t,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};document.createEvent?(n=document.createEvent("MouseEvents"),n.initMouseEvent(t,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget||document.body.parentNode)):n=document.createEventObject(),e.dispatchEvent?e.dispatchEvent(n):e.fireEvent("on"+t,n)}},{}),u.countEventManagerListeners=0,u.eventManager=r},{browser:24,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/feature":49}],43:[function(e,t,n){"use strict";function o(e){for(var t=0,n=e.length;t<n;)e[t]=[e[t]],t++}function r(e,t){for(var n=0,o=t.length;n<o;)e.push(t[n]),n++}function i(e){var t=[];if(!e||0===e.length||!e[0]||0===e[0].length)return t;for(var n=e.length,o=e[0].length,r=0;r<n;r++)for(var i=0;i<o;i++)t[i]||(t[i]=[]),t[i][r]=e[r][i];return t}function s(e,t,n,o){var r=-1,i=e.length;for(o&&i&&(n=e[++r]);++r<i;)n=t(n,e[r],r,e);return n}function a(e,t){for(var n=-1,o=e.length,r=-1,i=[];++n<o;){var s=e[n];t(s,n,e)&&(i[++r]=s)}return i}function l(e,t){for(var n=-1,o=e.length,r=-1,i=[];++n<o;){var s=e[n];i[++r]=t(s,n,e)}return i}function u(e,t){for(var n=-1,o=e.length;++n<o&&t(e[n],n,e)!==!1;);return e}function c(e){return s(e,function(e,t){return e+t},0)}function d(e){return s(e,function(e,t){return e>t?e:t},Array.isArray(e)?e[0]:void 0)}function h(e){return s(e,function(e,t){return e<t?e:t},Array.isArray(e)?e[0]:void 0)}function f(e){return e.length?c(e)/e.length:0}function p(e){return s(e,function(e,t){return e.concat(Array.isArray(t)?p(t):t)},[])}function m(e){var t=[];return u(e,function(e){t.indexOf(e)===-1&&t.push(e)}),t}Object.defineProperties(n,{to2dArray:{get:function(){return o}},extendArray:{get:function(){return r}},pivot:{get:function(){return i}},arrayReduce:{get:function(){return s}},arrayFilter:{get:function(){return a}},arrayMap:{get:function(){return l}},arrayEach:{get:function(){return u}},arraySum:{get:function(){return c}},arrayMax:{get:function(){return d}},arrayMin:{get:function(){return h}},arrayAvg:{get:function(){return f}},arrayFlatten:{get:function(){return p}},arrayUnique:{get:function(){return m}},__esModule:{value:!0}})},{}],44:[function(e,t,n){"use strict";function o(){return l}function r(){return u}function i(){return c}function s(){return d}function a(e){return e||(e=navigator.userAgent),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}Object.defineProperties(n,{isIE8:{get:function(){return o}},isIE9:{get:function(){return r}},isSafari:{get:function(){return i}},isChrome:{get:function(){return s}},isMobileBrowser:{get:function(){return a}},__esModule:{value:!0}});var l=!document.createTextNode("test").textContent,u=!!document.documentMode,c=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),d=/Chrome/.test(navigator.userAgent)&&/Google/.test(navigator.vendor)},{}],45:[function(e,t,n){"use strict";function o(e){for(var t,n=e+1,o="";n>0;)t=(n-1)%26,o=String.fromCharCode(65+t)+o,n=parseInt((n-t)/26,10);return o}function r(e,t){e="number"==typeof e?e:100,t="number"==typeof t?t:4;var n,r,i=[];for(n=0;n<e;n++){var s=[];for(r=0;r<t;r++)s.push(o(r)+(n+1));i.push(s)}return i}function i(e,t){e="number"==typeof e?e:100,t="number"==typeof t?t:4;var n,r,i=[];for(n=0;n<e;n++){var s={};for(r=0;r<t;r++)s["prop"+r]=o(r)+(n+1);i.push(s)}return i}function s(e,t){for(var n,o=[],r=0;r<e;r++){n=[];for(var i=0;i<t;i++)n.push("");o.push(n)}return o}function a(e){var t,n,o,r,i=[],s=0;for(t=0,n=e.length;t<n;t++)for(o=0,r=e[t].length;o<r;o++)o==s&&(i.push([]),s++),i[o].push(e[t][o]);return i}function l(e,t){function n(e){var t=d.cellTypes[e];if("undefined"==typeof t)throw new Error('You declared cell type "'+e+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');return t}return t="undefined"==typeof t||t,function(o,r){return function o(r){if(r){if(r.hasOwnProperty(e)&&void 0!==r[e])return r[e];if(r.hasOwnProperty("type")&&r.type){var i;if("string"!=typeof r.type)throw new Error("Cell type must be a string ");if(i=n(r.type),i.hasOwnProperty(e))return i[e];if(t)return}return o(h(r))}}("number"==typeof o?this.getCellMeta(o,r):o)}}Object.defineProperties(n,{spreadsheetColumnLabel:{get:function(){return o}},createSpreadsheetData:{get:function(){return r}},createSpreadsheetObjectData:{get:function(){return i}},createEmptySpreadsheetData:{get:function(){return s}},translateRowsToColumns:{get:function(){return a}},cellMethodLookupFactory:{get:function(){return l}},__esModule:{value:!0}});var u,c,d=(u=e("browser"),u&&u.__esModule&&u||{default:u}).default,h=(c=e("object"),c&&c.__esModule&&c||{default:c}).getPrototypeOf},{browser:24,object:53}],46:[function(e,t,n){"use strict";function o(e){var t=new Date(e);return isNaN(new Date(e+"T00:00").getDate())?t:new Date(t.getTime()+6e4*t.getTimezoneOffset())}Object.defineProperties(n,{getNormalizedDate:{get:function(){return o}},__esModule:{value:!0}})},{}],47:[function(e,t,n){"use strict";function o(e,t,n){for(;null!=e&&e!==n;){if(e.nodeType===Node.ELEMENT_NODE&&(t.indexOf(e.nodeName)>-1||t.indexOf(e)>-1))return e;e=e.host&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.host:e.parentNode}return null}function r(e,t,n){for(var r=[];e&&(e=o(e,t,n),e&&(!n||n.contains(e)));)r.push(e),e=e.host&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.host:e.parentNode;var i=r.length;return i?r[i-1]:null}function i(e,t){var n=e.parentNode,o=[];for("string"==typeof t?o=Array.prototype.slice.call(document.querySelectorAll(t),0):o.push(t);null!=n;){if(o.indexOf(n)>-1)return!0;n=n.parentNode}return!1}function s(e){function t(e){return e.nodeType===Node.ELEMENT_NODE&&e.nodeName===o.toUpperCase()}var n,o="hot-table",r=!1;for(n=a(e);null!=n;){if(t(n)){r=!0;break}if(n.host&&n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){if(r=t(n.host))break;n=n.host}n=n.parentNode}return r}function a(e){return"undefined"!=typeof Polymer&&"function"==typeof wrap?wrap(e):e}function l(e){return"undefined"!=typeof Polymer&&"function"==typeof unwrap?unwrap(e):e}function u(e){var t=0;if(e.previousSibling)for(;e=e.previousSibling;)++t;return t}function c(e,t){var n=document.querySelector(".ht_clone_"+e);return n?n.contains(t):null}function d(e){var t=0,n=[];if(!e||!e.length)return n;for(;e[t];)n.push(e[t]),t++;return n}function h(e,t){return q(e,t)}function f(e,t){return Z(e,t)}function p(e,t){return J(e,t)}function m(e,t){if(3===e.nodeType)t.removeChild(e);else if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(e.nodeName)>-1)for(var n=e.childNodes,o=n.length-1;o>=0;o--)m(n[o],e)}function g(e){for(var t;t=e.lastChild;)e.removeChild(t)}function w(e,t){le.test(t)?e.innerHTML=t:v(e,t)}function v(e,t){var n=e.firstChild;n&&3===n.nodeType&&null===n.nextSibling?ue?n.textContent=t:n.data=t:(g(e),e.appendChild(document.createTextNode(t)))}function y(e){for(var t=e;l(t)!==document.documentElement;){if(null===t)return!1;if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){if(t.host){if(t.host.impl)return y(t.host.impl);if(t.host)return y(t.host);throw new Error("Lost in Web Components world")}return!1}if("none"===t.style.display)return!1;t=t.parentNode}return!0}function b(e){var t,n,o,r,i;if(r=document.documentElement,oe()&&e.firstChild&&"CAPTION"===e.firstChild.nodeName)return i=e.getBoundingClientRect(),{top:i.top+(window.pageYOffset||r.scrollTop)-(r.clientTop||0),left:i.left+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0)};for(t=e.offsetLeft,n=e.offsetTop,o=e;(e=e.offsetParent)&&e!==document.body;)t+=e.offsetLeft,n+=e.offsetTop,o=e;return o&&"fixed"===o.style.position&&(t+=window.pageXOffset||r.scrollLeft,n+=window.pageYOffset||r.scrollTop),{left:t,top:n}}function C(){var e=window.scrollY;return void 0===e&&(e=document.documentElement.scrollTop),e}function _(){var e=window.scrollX;return void 0===e&&(e=document.documentElement.scrollLeft),e}function R(e){return e===window?C():e.scrollTop}function S(e){return e===window?_():e.scrollLeft}function E(e){for(var t,n,o,r=e.parentNode,i=["auto","scroll"],s="",a="",l="",u="";r&&r.style&&document.body!==r;){if(t=r.style.overflow,n=r.style.overflowX,o=r.style.overflowY,"scroll"==t||"scroll"==n||"scroll"==o)return r;if(window.getComputedStyle&&(s=window.getComputedStyle(r),a=s.getPropertyValue("overflow"),l=s.getPropertyValue("overflow-y"),u=s.getPropertyValue("overflow-x"),"scroll"===a||"scroll"===u||"scroll"===l))return r;if(r.clientHeight<=r.scrollHeight&&(i.indexOf(o)!==-1||i.indexOf(t)!==-1||i.indexOf(a)!==-1||i.indexOf(l)!==-1))return r;if(r.clientWidth<=r.scrollWidth&&(i.indexOf(n)!==-1||i.indexOf(t)!==-1||i.indexOf(a)!==-1||i.indexOf(u)!==-1))return r;r=r.parentNode}return window}function M(e){for(var t=e.parentNode;t&&t.style&&document.body!==t;){if("visible"!==t.style.overflow&&""!==t.style.overflow)return t;if(window.getComputedStyle){var n=window.getComputedStyle(t);if("visible"!==n.getPropertyValue("overflow")&&""!==n.getPropertyValue("overflow"))return t}t=t.parentNode}return window}function T(e,t){if(e){if(e!==window){var n,o=e.style[t];return""!==o&&void 0!==o?o:(n=O(e),""!==n[t]&&void 0!==n[t]?n[t]:void 0)}if("width"===t)return window.innerWidth+"px";if("height"===t)return window.innerHeight+"px"}}function O(e){return e.currentStyle||document.defaultView.getComputedStyle(e)}function k(e){return e.offsetWidth}function x(e){return oe()&&e.firstChild&&"CAPTION"===e.firstChild.nodeName?e.offsetHeight+e.firstChild.offsetHeight:e.offsetHeight}function H(e){return e.clientHeight||e.innerHeight}function D(e){return e.clientWidth||e.innerWidth}function A(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function P(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function N(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),o=n.duplicate();return n.moveToBookmark(t.getBookmark()),o.setEndPoint("EndToStart",n),o.text.length}return 0}function L(e){if(e.selectionEnd)return e.selectionEnd;if(document.selection){var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange();return n.text.indexOf(t.text)+t.text.length}}function W(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!==document.selection.type&&(e=document.selection.createRange().text),e}function I(e,t,n){if(void 0===n&&(n=t),e.setSelectionRange){e.focus();try{e.setSelectionRange(t,n)}catch(i){var o=e.parentNode,r=o.style.display;o.style.display="block",e.setSelectionRange(t,n),o.style.display=r}}else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()}}function j(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),(document.body||document.documentElement).appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var o=e.offsetWidth;return n==o&&(o=t.clientWidth),(document.body||document.documentElement).removeChild(t),n-o}function V(){return void 0===ae&&(ae=j()),ae}function F(e){return e.offsetWidth!==e.clientWidth}function B(e){return e.offsetHeight!==e.clientHeight}function z(e,t,n){ee()||te()?(e.style.top=n,e.style.left=t):ne()?e.style["-webkit-transform"]="translate3d("+t+","+n+",0)":e.style.transform="translate3d("+t+","+n+",0)"}function Y(e){var t;return e.style.transform&&""!==(t=e.style.transform)?["transform",t]:e.style["-webkit-transform"]&&""!==(t=e.style["-webkit-transform"])?["-webkit-transform",t]:-1}function U(e){e.style.transform&&""!==e.style.transform?e.style.transform="":e.style["-webkit-transform"]&&""!==e.style["-webkit-transform"]&&(e.style["-webkit-transform"]="")}function G(e){var t=["INPUT","SELECT","TEXTAREA"];return e&&(t.indexOf(e.nodeName)>-1||"true"===e.contentEditable)}function $(e){return G(e)&&e.className.indexOf("handsontableInput")==-1&&e.className.indexOf("copyPaste")==-1}Object.defineProperties(n,{closest:{get:function(){return o}},closestDown:{get:function(){return r}},isChildOf:{get:function(){return i}},isChildOfWebComponentTable:{get:function(){return s}},polymerWrap:{get:function(){return a}},polymerUnwrap:{get:function(){return l}},index:{get:function(){return u}},overlayContainsElement:{get:function(){return c}},hasClass:{get:function(){return h}},addClass:{get:function(){return f}},removeClass:{get:function(){return p}},removeTextNodes:{get:function(){return m}},empty:{get:function(){return g}},HTML_CHARACTERS:{get:function(){return le}},fastInnerHTML:{get:function(){return w}},fastInnerText:{get:function(){return v}},isVisible:{get:function(){return y}},offset:{get:function(){return b}},getWindowScrollTop:{get:function(){return C}},getWindowScrollLeft:{get:function(){return _}},getScrollTop:{get:function(){return R}},getScrollLeft:{get:function(){return S}},getScrollableElement:{get:function(){return E}},getTrimmingContainer:{get:function(){return M}},getStyle:{get:function(){return T}},getComputedStyle:{get:function(){return O}},outerWidth:{get:function(){return k}},outerHeight:{get:function(){return x}},innerHeight:{get:function(){return H}},innerWidth:{get:function(){return D}},addEvent:{get:function(){return A}},removeEvent:{get:function(){return P}},getCaretPosition:{get:function(){return N}},getSelectionEndPosition:{get:function(){return L}},getSelectionText:{get:function(){return W}},setCaretPosition:{get:function(){return I}},getScrollbarWidth:{get:function(){return V}},hasVerticalScrollbar:{get:function(){return F}},hasHorizontalScrollbar:{get:function(){return B}},setOverlayPosition:{get:function(){return z}},getCssTransform:{get:function(){return Y}},resetCssTransform:{get:function(){return U}},isInput:{get:function(){return G}},isOutsideInput:{get:function(){return $}},__esModule:{value:!0}});var K,X,q,Z,J,Q=(K=e("../browser"),K&&K.__esModule&&K||{default:K}),ee=Q.isIE8,te=Q.isIE9,ne=Q.isSafari,oe=(X=e("../feature"),X&&X.__esModule&&X||{default:X}).hasCaptionProblem,re=!!document.documentElement.classList;if(re){var ie=function(){var e=document.createElement("div");return e.classList.add("test","test2"),e.classList.contains("test2")}();q=function(e,t){return""!==t&&e.classList.contains(t)},Z=function(e,t){var n=0;if("string"==typeof t&&(t=t.split(" ")),t=d(t),ie)e.classList.add.apply(e.classList,t);else for(;t&&t[n];)e.classList.add(t[n]),n++},J=function(e,t){var n=0;if("string"==typeof t&&(t=t.split(" ")),t=d(t),ie)e.classList.remove.apply(e.classList,t);else for(;t&&t[n];)e.classList.remove(t[n]),n++}}else{var se=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)")};q=function(e,t){return!!e.className.match(se(t))},Z=function(e,t){var n=0,o=e.className;if("string"==typeof t&&(t=t.split(" ")),""===o)o=t.join(" ");else for(;t&&t[n];)se(t[n]).test(o)||(o+=" "+t[n]),n++;e.className=o},J=function(e,t){var n=0,o=e.className;for("string"==typeof t&&(t=t.split(" "));t&&t[n];)o=o.replace(se(t[n])," ").trim(),n++;e.className!==o&&(e.className=o)}}var ae,le=/(<(.*)>|&(.*);)/,ue=!!document.createTextNode("test").textContent},{"../browser":44,"../feature":49}],48:[function(e,t,n){"use strict";function o(e){e.isImmediatePropagationEnabled=!1,e.cancelBubble=!0}function r(e){return e.isImmediatePropagationEnabled===!1}function i(e){"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function s(e){return e.pageX?e.pageX:e.clientX+f()}function a(e){return e.pageY?e.pageY:e.clientY+h()}function l(e){return 2===e.button}function u(e){return 0===e.button}Object.defineProperties(n,{stopImmediatePropagation:{get:function(){return o}},isImmediatePropagationStopped:{get:function(){return r}},stopPropagation:{get:function(){return i}},pageX:{get:function(){return s}},pageY:{get:function(){return a}},isRightClick:{get:function(){return l}},isLeftClick:{get:function(){return u}},__esModule:{value:!0}});var c,d=(c=e("element"),c&&c.__esModule&&c||{default:c}),h=d.getWindowScrollTop,f=d.getWindowScrollLeft},{element:47}],49:[function(e,t,n){"use strict";function o(e){return h.call(window,e)}function r(e){f.call(window,e)}function i(){return"ontouchstart"in window}function s(){var e=document.createElement("div");return!(!e.createShadowRoot||!e.createShadowRoot.toString().match(/\[native code\]/))}function a(){var e=document.createElement("TABLE");e.style.borderSpacing=0,e.style.borderWidth=0,e.style.padding=0;var t=document.createElement("TBODY");e.appendChild(t),t.appendChild(document.createElement("TR")),t.firstChild.appendChild(document.createElement("TD")),t.firstChild.firstChild.innerHTML="<tr><td>t<br>t</td></tr>";var n=document.createElement("CAPTION");n.innerHTML="c<br>c<br>c<br>c",n.style.padding=0,n.style.margin=0,e.insertBefore(n,t),document.body.appendChild(e),m=e.offsetHeight<2*e.lastChild.offsetHeight,document.body.removeChild(e)}function l(){return void 0===m&&a(),m}function u(e){var t=void 0!==arguments[1]?arguments[1]:{};return g?g:g="object"==typeof Intl?new Intl.Collator(e,t).compare:"function"==typeof String.prototype.localeCompare?function(e,t){return(e+"").localeCompare(t)}:function(e,t){return e===t?0:e>t?-1:1}}Object.defineProperties(n,{requestAnimationFrame:{get:function(){return o}},cancelAnimationFrame:{get:function(){return r}},isTouchSupported:{get:function(){return i}},isWebComponentSupportedNatively:{get:function(){return s}},hasCaptionProblem:{get:function(){return l}},getComparisonFunction:{get:function(){return u}},__esModule:{value:!0}});for(var c=0,d=["ms","moz","webkit","o"],h=window.requestAnimationFrame,f=window.cancelAnimationFrame,p=0;p<d.length&&!h;++p)h=window[d[p]+"RequestAnimationFrame"],f=window[d[p]+"CancelAnimationFrame"]||window[d[p]+"CancelRequestAnimationFrame"];h||(h=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-c)),o=window.setTimeout(function(){e(t+n)},n);return c=t+n,o}),f||(f=function(e){clearTimeout(e)});var m,g},{}],50:[function(e,t,n){"use strict";function o(e){return"function"==typeof e}function r(e,t){return function(){return e.apply(t,arguments)}}function i(e){function t(){var t=this,s=arguments,a=Date.now(),l=!1;r.lastCallThrottled=!0,o||(o=a,l=!0);var u=n-(a-o);return l?(r.lastCallThrottled=!1,e.apply(this,s)):(i&&clearTimeout(i),i=setTimeout(function(){r.lastCallThrottled=!1,e.apply(t,s),o=0,i=void 0},u)),r}var n=void 0!==arguments[1]?arguments[1]:200,o=0,r={lastCallThrottled:!0},i=null;return t}function s(e){function t(){a=r}function n(){return a?(a--,e.apply(this,arguments)):s.apply(this,arguments)}var o=void 0!==arguments[1]?arguments[1]:200,r=void 0!==arguments[2]?arguments[2]:10,s=i(e,o),a=r;return n.clearHits=t,n}function a(e){function t(){var t=this,i=arguments;return r&&clearTimeout(r),r=setTimeout(function(){n=e.apply(t,i)},o),n}var n,o=void 0!==arguments[1]?arguments[1]:200,r=null;return t}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e,o=n[0],r=Array.prototype.slice.call(n,1);return function(){return f(r,function(e,t){return t(e)},o.apply(this,arguments))}}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return e.apply(this,t.concat(n))}}function c(e){function t(o){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s,a=o.concat(r);return s=a.length>=n?e.apply(this,a):t(a)}}var n=e.length;return t([])}function d(e){function t(o){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s,a=o.concat(r.reverse());return s=a.length>=n?e.apply(this,a):t(a)}}var n=e.length;return t([])}Object.defineProperties(n,{isFunction:{get:function(){return o}},proxy:{get:function(){return r}},throttle:{get:function(){return i}},throttleAfterHits:{get:function(){return s}},debounce:{get:function(){return a}},pipe:{get:function(){return l}},partial:{get:function(){return u}},curry:{get:function(){return c}},curryRight:{get:function(){return d}},__esModule:{value:!0}});var h,f=(h=e("array"),h&&h.__esModule&&h||{default:h}).arrayReduce},{array:43}],51:[function(e,t,n){"use strict";function o(e){switch(typeof e){case"string":case"number":return e+"";case"object":return null===e?"":e.toString();case"undefined":return"";default:return e.toString()}}function r(e){return"undefined"!=typeof e}function i(e){return"undefined"==typeof e}Object.defineProperties(n,{stringify:{get:function(){return o}},isDefined:{get:function(){return r}},isUndefined:{get:function(){return i}},__esModule:{value:!0}})},{}],52:[function(e,t,n){"use strict";function o(e){var t=typeof e;return"number"==t?!isNaN(e)&&isFinite(e):"string"==t?!!e.length&&(1==e.length?/\d/.test(e):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(e)):"object"==t&&!(!e||"number"!=typeof e.valueOf()||e instanceof Date)}function r(e,t,n){var o=-1;for("function"==typeof t?(n=t,t=e):o=e-1;++o<=t&&n(o)!==!1;);}function i(e,t,n){var o=e+1;for("function"==typeof t&&(n=t,t=0);--o>=t&&n(o)!==!1;);}function s(e,t){return t=parseInt(t.toString().replace("%",""),10),t=parseInt(e*t/100)}Object.defineProperties(n,{isNumeric:{get:function(){return o}},rangeEach:{get:function(){return r}},rangeEachReverse:{get:function(){return i}},valueAccordingPercent:{get:function(){return s}},__esModule:{value:!0}})},{}],53:[function(e,t,n){"use strict";function o(e){var t;return Array.isArray(e)?t=[]:(t={},p(e,function(e,n){e&&"object"==typeof e&&!Array.isArray(e)?t[n]=o(e):Array.isArray(e)?e.length&&"object"==typeof e[0]&&!Array.isArray(e[0])?t[n]=[o(e[0])]:t[n]=[]:t[n]=null})),t}function r(e,t){return t.prototype.constructor=t,e.prototype=new t,e.prototype.constructor=e,e}function i(e,t){return p(t,function(t,n){e[n]=t}),e}function s(e,t){p(t,function(n,o){t[o]&&"object"==typeof t[o]?(e[o]||(Array.isArray(t[o])?e[o]=[]:"[object Date]"===Object.prototype.toString.call(t[o])?e[o]=t[o]:e[o]={}),s(e[o],t[o])):e[o]=t[o]})}function a(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function l(e){var t={};return p(e,function(e,n){t[n]=e}),t}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.MIXINS||(e.MIXINS=[]),v(t,function(t){e.MIXINS.push(t.MIXIN_NAME),p(t,function(t,n){if(void 0!==e.prototype[n])throw new Error("Mixin conflict. Property '"+n+"' already exist and cannot be overwritten.");if("function"==typeof t)e.prototype[n]=t;else{var o=function(e,t){e="_"+e;var n=function(e){return(Array.isArray(e)||d(e))&&(e=a(e)),e};return function(){return void 0===this[e]&&(this[e]=n(t)),this[e]}},r=function(e){return e="_"+e,function(t){this[e]=t}};Object.defineProperty(e.prototype,n,{get:o(n,t),set:r(n),configurable:!0})}})}),e}function c(e,t){return JSON.stringify(e)===JSON.stringify(t)}function d(e){return"[object Object]"==Object.prototype.toString.call(e)}function h(e){var t;if("object"==typeof e.__proto__)t=e.__proto__;else{var n,o=e.constructor;"function"==typeof e.constructor&&(n=o,delete e.constructor&&(o=e.constructor,e.constructor=n)),t=o?o.prototype:null}return t}function f(e,t,n,o){o.value=n,o.writable=o.writable!==!1,o.enumerable=o.enumerable!==!1,o.configurable=o.configurable!==!1,Object.defineProperty(e,t,o)}function p(e,t){for(var n in e)if((!e.hasOwnProperty||e.hasOwnProperty&&e.hasOwnProperty(n))&&t(e[n],n,e)===!1)break;return e}function m(e,t){var n=t.split("."),o=e;return p(n,function(e){if(o=o[e],void 0===o)return o=void 0,!1}),o}function g(e){if(!d(e))return 0;var t=function(e){var n=0;return d(e)?p(e,function(e){n+=t(e)}):n++,n};return t(e)}Object.defineProperties(n,{duckSchema:{get:function(){return o}},inherit:{get:function(){return r}},extend:{get:function(){return i}},deepExtend:{get:function(){return s}},deepClone:{get:function(){return a}},clone:{get:function(){return l}},mixin:{get:function(){return u}},isObjectEquals:{get:function(){return c}},isObject:{get:function(){return d}},getPrototypeOf:{get:function(){return h}},defineGetter:{get:function(){return f}},objectEach:{get:function(){return p}},getProperty:{get:function(){return m}},deepObjectSize:{get:function(){return g}},__esModule:{value:!0}});var w,v=(w=e("array"),w&&w.__esModule&&w||{default:w}).arrayEach},{array:43}],54:[function(e,t,n){"use strict";function o(e,t){function n(){}i(n,e);for(var o=0,r=t.length;o<r;o++)n.prototype[t[o]]=void 0;return n}Object.defineProperties(n,{columnFactory:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("object"),r&&r.__esModule&&r||{default:r}).inherit},{object:53}],55:[function(e,t,n){"use strict";function o(e){return e[0].toUpperCase()+e.substr(1)}function r(e,t){var n=!0;return p(t.length-1,function(o){if(e.charAt(o)!==t.charAt(o))return n=!1,!1}),n}function i(e,t){var n=!0,o=t.length-1,r=e.length-1;return p(o,function(i){var s=r-i,a=o-i;if(e.charAt(s)!==t.charAt(a))return n=!1,!1}),n}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],o=e.length;o--;){var r=f(e[o]).toLowerCase();n.indexOf(r)===-1&&n.push(r)}return 1===n.length}function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()}function l(e){return/^([0-9][0-9]?\%$)|(^100\%$)/.test(e)}function u(e){var t=void 0!==arguments[1]?arguments[1]:{};return(e+"").replace(/(?:\\)?\[([^\[\]]+)]/g,function(e,n){return"\\"===e.charAt(0)?e.substr(1,e.length-1):void 0===t[n]?"":t[n]})}function c(e,t){var n=void 0!==arguments[2]?arguments[2]:" ";if(e+="",e.length>=t)return e;n=String(n);var o=n.length;o||(n=" ");var r=t-e.length,i=Math.ceil(r/n.length),s="";return p(i,function(e){s+=n}),s=s.slice(0,r),s+e}Object.defineProperties(n,{toUpperCaseFirst:{get:function(){return o}},startsWith:{get:function(){return r}},endsWith:{get:function(){return i}},equalsIgnoreCase:{get:function(){return s}},randomString:{get:function(){return a}},isPercentValue:{get:function(){return l}},substitute:{get:function(){return u}},padStart:{get:function(){return c}},__esModule:{value:!0}});var d,h,f=(d=e("mixed"),d&&d.__esModule&&d||{default:d}).stringify,p=(h=e("number"),h&&h.__esModule&&h||{default:h}).rangeEach},{mixed:51,number:52}],56:[function(e,t,n){"use strict";function o(e){return 32==e||e>=48&&e<=57||e>=96&&e<=111||e>=186&&e<=192||e>=219&&e<=222||e>=226||e>=65&&e<=90}function r(e){var t=[u.ARROW_DOWN,u.ARROW_UP,u.ARROW_LEFT,u.ARROW_RIGHT,u.HOME,u.END,u.DELETE,u.BACKSPACE,u.F1,u.F2,u.F3,u.F4,u.F5,u.F6,u.F7,u.F8,u.F9,u.F10,u.F11,u.F12,u.TAB,u.PAGE_DOWN,u.PAGE_UP,u.ENTER,u.ESCAPE,u.SHIFT,u.CAPS_LOCK,u.ALT];return t.indexOf(e)!==-1}function i(e){return[u.CONTROL_LEFT,224,u.COMMAND_LEFT,u.COMMAND_RIGHT].indexOf(e)!==-1}function s(e,t){var n=t.split("|"),o=!1;return l(n,function(t){if(e===u[t])return o=!0,!1}),o}Object.defineProperties(n,{KEY_CODES:{get:function(){return u}},isPrintableChar:{get:function(){return o}},isMetaKey:{get:function(){return r}},isCtrlKey:{get:function(){return i}},isKey:{get:function(){return s}},__esModule:{value:!0}});var a,l=(a=e("array"),a&&a.__esModule&&a||{default:a}).arrayEach,u={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,A:65,X:88,C:67,V:86}},{array:43}],57:[function(e,t,n){"use strict";Object.defineProperties(n,{localHooks:{get:function(){return c}},__esModule:{value:!0}});var o,r,i,s=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,a=(r=e("helpers/array"),r&&r.__esModule&&r||{default:r}).arrayEach,l=(i=e("helpers/object"),i&&i.__esModule&&i||{default:i}).defineGetter,u="localHooks",c={_localHooks:Object.create(null),addLocalHook:function(e,t){this._localHooks[e]||(this._localHooks[e]=[]),this._localHooks[e].push(t)},runLocalHooks:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this;this._localHooks[e]&&a(this._localHooks[e],function(e){return e.apply(o,t)})},clearLocalHooks:function(){this._localHooks={}}};l(c,"MIXIN_NAME",u,{writable:!1,enumerable:!1}),s.utils.localHooks=c},{browser:24,"helpers/array":43,"helpers/object":53}],58:[function(e,t,n){"use strict";function o(){function e(e){return null!==e&&!n(e)&&("string"==typeof e||"number"==typeof e)}function t(e){return null!==e&&("object"==typeof e||"function"==typeof e)}function n(e){return e!==e}var o={arrayMap:[],weakMap:new WeakMap};return{get:function(n){return e(n)?o.arrayMap[n]:t(n)?o.weakMap.get(n):void 0},set:function(n,r){if(e(n))o.arrayMap[n]=r;else{if(!t(n))throw new Error("Invalid key type");o.weakMap.set(n,r)}},delete:function(n){e(n)?delete o.arrayMap[n]:t(n)&&o.weakMap.delete(n)}}}Object.defineProperties(n,{MultiMap:{get:function(){return o}},__esModule:{value:!0}}),window.MultiMap=o},{}],59:[function(e,t,n){"use strict";Object.defineProperties(n,{Hooks:{get:function(){
+return l}},__esModule:{value:!0}});var o,r,i=["afterCellMetaReset","afterChange","afterChangesObserved","afterContextMenuDefaultOptions","afterContextMenuHide","afterContextMenuShow","afterCopyLimit","afterCreateCol","afterCreateRow","afterDeselect","afterDestroy","afterDocumentKeyDown","afterGetCellMeta","afterGetColHeader","afterGetRowHeader","afterInit","afterLoadData","afterMomentumScroll","afterOnCellCornerMouseDown","afterOnCellMouseDown","afterOnCellMouseOver","afterRemoveCol","afterRemoveRow","afterRender","beforeRenderer","afterRenderer","afterScrollHorizontally","afterScrollVertically","afterSelection","afterSelectionByProp","afterSelectionEnd","afterSelectionEndByProp","afterSetCellMeta","afterUpdateSettings","afterValidate","beforeAutofill","beforeCellAlignment","beforeChange","beforeChangeRender","beforeDrawBorders","beforeGetCellMeta","beforeInit","beforeInitWalkontable","beforeKeyDown","beforeOnCellMouseDown","beforeOnCellMouseOver","beforeRemoveCol","beforeRemoveRow","beforeRender","beforeSetRangeStart","beforeSetRangeEnd","beforeTouchScroll","beforeValidate","construct","init","modifyCol","unmodifyCol","modifyColHeader","modifyColWidth","modifyRow","modifyRowHeader","modifyRowHeight","persistentStateLoad","persistentStateReset","persistentStateSave","beforeColumnSort","afterColumnSort","afterAutofillApplyValues","modifyCopyableRange","beforeColumnMove","afterColumnMove","beforeRowMove","afterRowMove","beforeColumnResize","afterColumnResize","beforeRowResize","afterRowResize","afterGetColumnHeaderRenderers","afterGetRowHeaderRenderers","beforeStretchingColumnWidth","beforeFilter","afterFilter","modifyColumnHeaderHeight"],s=(o=e("helpers/array"),o&&o.__esModule&&o||{default:o}).arrayEach,a=(r=e("helpers/object"),r&&r.__esModule&&r||{default:r}).objectEach,l=function(){this.globalBucket=this.createEmptyBucket()};$traceurRuntime.createClass(l,{createEmptyBucket:function(){var e=Object.create(null);return s(i,function(t){return e[t]=[]}),e},getBucket:function(){var e=void 0!==arguments[0]?arguments[0]:null;return e?(e.pluginHookBucket||(e.pluginHookBucket=this.createEmptyBucket()),e.pluginHookBucket):this.globalBucket},add:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this;if(Array.isArray(t))s(t,function(t){return o.add(e,t,n)});else{var r=this.getBucket(n);"undefined"==typeof r[e]&&(this.register(e),r[e]=[]),t.skip=!1,r[e].indexOf(t)===-1&&r[e].push(t)}return this},once:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this;Array.isArray(t)?s(t,function(t){return o.once(e,t,n)}):(t.runOnce=!0,this.add(e,t,n))},remove:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this.getBucket(n);return"undefined"!=typeof o[e]&&o[e].indexOf(t)>=0&&(t.skip=!0,!0)},has:function(e){var t=void 0!==arguments[1]?arguments[1]:null,n=this.getBucket(t);return!(void 0===n[e]||!n[e].length)},run:function(e,t,n,o,r,i,s,a){var l=this.globalBucket[t],u=-1,c=l?l.length:0;if(c)for(;++u<c;)if(l[u]&&!l[u].skip){var d=l[u].call(e,n,o,r,i,s,a);void 0!==d&&(n=d),l[u]&&l[u].runOnce&&this.remove(t,l[u])}var h=this.getBucket(e)[t],f=-1,p=h?h.length:0;if(p)for(;++f<p;)if(h[f]&&!h[f].skip){var m=h[f].call(e,n,o,r,i,s,a);void 0!==m&&(n=m),h[f]&&h[f].runOnce&&this.remove(t,h[f],e)}return n},destroy:function(){var e=void 0!==arguments[0]?arguments[0]:null;a(this.getBucket(e),function(e,t,n){return n[t].length=0})},register:function(e){this.isRegistered(e)||i.push(e)},deregister:function(e){this.isRegistered(e)&&i.splice(i.indexOf(e),1)},isRegistered:function(e){return i.indexOf(e)>=0},getRegistered:function(){return i}},{})},{"helpers/array":43,"helpers/object":53}],60:[function(e,t,n){"use strict";function o(e,t){e=h(e),c.plugins[e]=t,c.hooks.add("construct",function(){var n;f.has(this)||f.set(this,{}),n=f.get(this),n[e]||(n[e]=new t(this))}),c.hooks.add("afterDestroy",function(){if(f.has(this)){var e=f.get(this);d(e,function(e){return e.destroy()}),f.delete(this)}})}function r(e,t){if("string"!=typeof t)throw Error('Only strings can be passed as "plugin" parameter');var n=h(t);if(f.has(e)&&f.get(e)[n])return f.get(e)[n]}function i(e){return f.has(e)?Object.keys(f.get(e)):[]}function s(e,t){var n=null;return f.has(e)&&d(f.get(e),function(e,o){e===t&&(n=o)}),n}Object.defineProperties(n,{registerPlugin:{get:function(){return o}},getPlugin:{get:function(){return r}},getRegistredPluginNames:{get:function(){return i}},getPluginName:{get:function(){return s}},__esModule:{value:!0}});var a,l,u,c=(a=e("browser"),a&&a.__esModule&&a||{default:a}).default,d=(l=e("helpers/object"),l&&l.__esModule&&l||{default:l}).objectEach,h=(u=e("helpers/string"),u&&u.__esModule&&u||{default:u}).toUpperCaseFirst,f=new WeakMap},{browser:24,"helpers/object":53,"helpers/string":55}],61:[function(e,t,n){"use strict";Object.defineProperties(n,{default:{get:function(){return v}},__esModule:{value:!0}});var o,r,i,s,a=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,l=(r=e("helpers/object"),r&&r.__esModule&&r||{default:r}),u=l.defineGetter,c=l.objectEach,d=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}).arrayEach,h=(s=e("plugins"),s&&s.__esModule&&s||{default:s}),f=h.getRegistredPluginNames,p=h.getPluginName,m=new WeakMap,g=null,w=function(e){var t=this;u(this,"hot",e,{writable:!1}),m.set(this,{hooks:{}}),g=null,this.pluginName=null,this.pluginsInitializedCallbacks=[],this.isPluginsReady=!1,this.enabled=!1,this.initialized=!1,this.hot.addHook("afterPluginsInitialized",function(){return t.onAfterPluginsInitialized()}),this.hot.addHook("afterUpdateSettings",function(){return t.onUpdateSettings()}),this.hot.addHook("beforeInit",function(){return t.init()})};$traceurRuntime.createClass(w,{init:function(){this.pluginName=p(this.hot,this),this.isEnabled&&this.isEnabled()&&this.enablePlugin(),g||(g=f(this.hot)),g.indexOf(this.pluginName)>=0&&g.splice(g.indexOf(this.pluginName),1),g.length||this.hot.runHooks("afterPluginsInitialized"),this.initialized=!0},enablePlugin:function(){this.enabled=!0},disablePlugin:function(){this.eventManager&&this.eventManager.clear(),this.clearHooks(),this.enabled=!1},addHook:function(e,t){var n=m.get(this).hooks[e]=m.get(this).hooks[e]||[];this.hot.addHook(e,t),n.push(t),m.get(this).hooks[e]=n},removeHooks:function(e){var t=this;d(m.get(this).hooks[e]||[],function(n){t.hot.removeHook(e,n)})},clearHooks:function(){var e=this,t=m.get(this).hooks;c(t,function(t,n){return e.removeHooks(n)}),t.length=0},callOnPluginsReady:function(e){this.isPluginsReady?e():this.pluginsInitializedCallbacks.push(e)},onAfterPluginsInitialized:function(){d(this.pluginsInitializedCallbacks,function(e){return e()}),this.pluginsInitializedCallbacks.length=0,this.isPluginsReady=!0},onUpdateSettings:function(){this.isEnabled&&(this.enabled&&!this.isEnabled()&&this.disablePlugin(),!this.enabled&&this.isEnabled()&&this.enablePlugin(),this.enabled&&this.isEnabled()&&this.updatePlugin())},updatePlugin:function(){},destroy:function(){var e=this;this.eventManager&&this.eventManager.destroy(),this.clearHooks(),c(this,function(t,n){"hot"!==n&&(e[n]=null)}),delete this.hot}},{});var v=w;a.plugins.BasePlugin=w},{browser:24,"helpers/array":43,"helpers/object":53,plugins:60}],62:[function(e,t,n){"use strict";Object.defineProperties(n,{AutoColumnSize:{get:function(){return D}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p=(o=e("_base"),o&&o.__esModule&&o||{default:o}).default,m=(r=e("helpers/array"),r&&r.__esModule&&r||{default:r}),g=m.arrayEach,w=m.arrayFilter,v=(i=e("helpers/feature"),i&&i.__esModule&&i||{default:i}),y=v.cancelAnimationFrame,b=v.requestAnimationFrame,C=(s=e("helpers/dom/element"),s&&s.__esModule&&s||{default:s}).isVisible,_=(a=e("utils/ghostTable"),a&&a.__esModule&&a||{default:a}).GhostTable,R=(l=e("helpers/object"),l&&l.__esModule&&l||{default:l}),S=R.isObject,E=(R.objectEach,u=e("helpers/number"),u&&u.__esModule&&u||{default:u}),M=E.valueAccordingPercent,T=E.rangeEach,O=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,k=(d=e("utils/samplesGenerator"),d&&d.__esModule&&d||{default:d}).SamplesGenerator,x=(h=e("helpers/string"),h&&h.__esModule&&h||{default:h}).isPercentValue,H=(f=e("3rdparty/walkontable/src/calculator/viewportColumns"),f&&f.__esModule&&f||{default:f}).WalkontableViewportColumnsCalculator,D=function(e){var t=this;$traceurRuntime.superConstructor(A).call(this,e),this.widths=[],this.ghostTable=new _(this.hot),this.samplesGenerator=new k(function(e,n){return t.hot.getDataAtCell(e,n)}),this.firstCalculation=!0,this.inProgress=!1,this.addHook("beforeColumnResize",function(e,n,o){return t.onBeforeColumnResize(e,n,o)})},A=D;$traceurRuntime.createClass(D,{isEnabled:function(){return this.hot.getSettings().autoColumnSize!==!1&&!this.hot.getSettings().colWidths},enablePlugin:function(){var e=this;if(!this.enabled){var t=this.hot.getSettings().autoColumnSize,n=t&&t.hasOwnProperty("samplingRatio")?this.hot.getSettings().autoColumnSize.samplingRatio:void 0;n&&!isNaN(n)&&(this.samplesGenerator.customSampleCount=parseInt(n,10)),t&&null!=t.useHeaders&&this.ghostTable.setSetting("useHeaders",t.useHeaders),this.addHook("afterLoadData",function(){return e.onAfterLoadData()}),this.addHook("beforeChange",function(t){return e.onBeforeChange(t)}),this.addHook("beforeRender",function(t){return e.onBeforeRender(t)}),this.addHook("modifyColWidth",function(t,n){return e.getColumnWidth(n,t)}),$traceurRuntime.superGet(this,A.prototype,"enablePlugin").call(this)}},disablePlugin:function(){$traceurRuntime.superGet(this,A.prototype,"disablePlugin").call(this)},calculateColumnsWidth:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countCols()-1},t=void 0!==arguments[1]?arguments[1]:{from:0,to:this.hot.countRows()-1},n=void 0!==arguments[2]&&arguments[2],o=this;"number"==typeof e&&(e={from:e,to:e}),"number"==typeof t&&(t={from:t,to:t}),T(e.from,e.to,function(e){if(n||void 0===o.widths[e]&&!o.hot._getColWidthFromSettings(e)){var r=o.samplesGenerator.generateColumnSamples(e,t);r.forEach(function(e,t){return o.ghostTable.addColumn(t,e)})}}),this.ghostTable.columns.length&&(this.ghostTable.getWidths(function(e,t){return o.widths[e]=t}),this.ghostTable.clean())},calculateAllColumnsWidth:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countRows()-1},t=this,n=0,o=this.hot.countCols()-1,r=null;this.inProgress=!0;var i=function(){return t.hot?(t.calculateColumnsWidth({from:n,to:Math.min(n+A.CALCULATION_STEP,o)},e),n=n+A.CALCULATION_STEP+1,void(n<o?r=b(i):(y(r),t.inProgress=!1,t.hot.view.wt.wtOverlays.adjustElementsSize(!0),t.hot.view.wt.wtOverlays.leftOverlay.needFullRender&&t.hot.view.wt.wtOverlays.leftOverlay.clone.draw()))):(y(r),void(t.inProgress=!1))};this.firstCalculation&&this.getSyncCalculationLimit()&&(this.calculateColumnsWidth({from:0,to:this.getSyncCalculationLimit()},e),this.firstCalculation=!1,n=this.getSyncCalculationLimit()+1),n<o?i():this.inProgress=!1},recalculateAllColumnsWidth:function(){this.hot.view&&C(this.hot.view.wt.wtTable.TABLE)&&(this.clearCache(),this.calculateAllColumnsWidth())},getSyncCalculationLimit:function(){var e=A.SYNC_CALCULATION_LIMIT,t=this.hot.countCols()-1;return S(this.hot.getSettings().autoColumnSize)&&(e=this.hot.getSettings().autoColumnSize.syncLimit,x(e)?e=M(t,e):e>>=0),Math.min(e,t)},getColumnWidth:function(e){var t=arguments[1],n=void 0===arguments[2]||arguments[2],o=t;return void 0===o&&(o=this.widths[e],n&&"number"==typeof o&&(o=Math.max(o,H.DEFAULT_WIDTH))),o},getFirstVisibleColumn:function(){var e=this.hot.view.wt;return e.wtViewport.columnsVisibleCalculator?e.wtTable.getFirstVisibleColumn():e.wtViewport.columnsRenderCalculator?e.wtTable.getFirstRenderedColumn():-1},getLastVisibleColumn:function(){var e=this.hot.view.wt;return e.wtViewport.columnsVisibleCalculator?e.wtTable.getLastVisibleColumn():e.wtViewport.columnsRenderCalculator?e.wtTable.getLastRenderedColumn():-1},clearCache:function(){this.widths.length=0},isNeedRecalculate:function(){return!!w(this.widths,function(e){return void 0===e}).length},onBeforeRender:function(){var e=this.hot.renderCall,t=this.hot.countRows();t&&(this.calculateColumnsWidth({from:this.getFirstVisibleColumn(),to:this.getLastVisibleColumn()},void 0,e),this.isNeedRecalculate()&&!this.inProgress&&this.calculateAllColumnsWidth())},onAfterLoadData:function(){var e=this;this.hot.view?this.recalculateAllColumnsWidth():setTimeout(function(){e.hot&&e.recalculateAllColumnsWidth()},0)},onBeforeChange:function(e){var t=this;g(e,function(e){return t.widths[t.hot.propToCol(e[1])]=void 0})},onBeforeColumnResize:function(e,t,n){return n&&(this.calculateColumnsWidth(e,void 0,!0),t=this.getColumnWidth(e,void 0,!1)),t},destroy:function(){this.ghostTable.clean(),$traceurRuntime.superGet(this,A.prototype,"destroy").call(this)}},{get CALCULATION_STEP(){return 50},get SYNC_CALCULATION_LIMIT(){return 50}},p),O("autoColumnSize",D)},{"3rdparty/walkontable/src/calculator/viewportColumns":4,_base:61,"helpers/array":43,"helpers/dom/element":47,"helpers/feature":49,"helpers/number":52,"helpers/object":53,"helpers/string":55,plugins:60,"utils/ghostTable":115,"utils/samplesGenerator":117}],63:[function(e,t,n){"use strict";Object.defineProperties(n,{AutoRowSize:{get:function(){return k}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e("_base"),o&&o.__esModule&&o||{default:o}).default,p=(r=e("helpers/array"),r&&r.__esModule&&r||{default:r}),m=(p.arrayEach,p.arrayFilter),g=(i=e("helpers/feature"),i&&i.__esModule&&i||{default:i}),w=g.cancelAnimationFrame,v=g.requestAnimationFrame,y=(s=e("helpers/dom/element"),s&&s.__esModule&&s||{default:s}).isVisible,b=(a=e("utils/ghostTable"),a&&a.__esModule&&a||{default:a}).GhostTable,C=(l=e("helpers/object"),l&&l.__esModule&&l||{default:l}),_=C.isObject,R=(C.objectEach,u=e("helpers/number"),u&&u.__esModule&&u||{default:u}),S=R.valueAccordingPercent,E=R.rangeEach,M=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,T=(d=e("utils/samplesGenerator"),d&&d.__esModule&&d||{default:d}).SamplesGenerator,O=(h=e("helpers/string"),h&&h.__esModule&&h||{default:h}).isPercentValue,k=function(e){var t=this;$traceurRuntime.superConstructor(x).call(this,e),this.heights=[],this.ghostTable=new b(this.hot),this.samplesGenerator=new T(function(e,n){return e>=0?t.hot.getDataAtCell(e,n):e===-1?t.hot.getColHeader(n):null}),this.firstCalculation=!0,this.inProgress=!1,this.addHook("beforeRowResize",function(e,n,o){return t.onBeforeRowResize(e,n,o)})},x=k;$traceurRuntime.createClass(k,{isEnabled:function(){return this.hot.getSettings().autoRowSize===!0||_(this.hot.getSettings().autoRowSize)},enablePlugin:function(){var e=this;if(!this.enabled){var t=this.hot.getSettings().autoRowSize,n=t&&t.hasOwnProperty("samplingRatio")?this.hot.getSettings().autoRowSize.samplingRatio:void 0;n&&!isNaN(n)&&(this.samplesGenerator.customSampleCount=parseInt(n,10)),this.addHook("afterLoadData",function(){return e.onAfterLoadData()}),this.addHook("beforeChange",function(t){return e.onBeforeChange(t)}),this.addHook("beforeColumnMove",function(){return e.recalculateAllRowsHeight()}),this.addHook("beforeColumnResize",function(){return e.recalculateAllRowsHeight()}),this.addHook("beforeColumnSort",function(){return e.clearCache()}),this.addHook("beforeRender",function(t){return e.onBeforeRender(t)}),this.addHook("beforeRowMove",function(t,n){return e.onBeforeRowMove(t,n)}),this.addHook("modifyRowHeight",function(t,n){return e.getRowHeight(n,t)}),this.addHook("modifyColumnHeaderHeight",function(){return e.getColumnHeaderHeight()}),$traceurRuntime.superGet(this,x.prototype,"enablePlugin").call(this)}},disablePlugin:function(){$traceurRuntime.superGet(this,x.prototype,"disablePlugin").call(this)},calculateRowsHeight:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countRows()-1},t=void 0!==arguments[1]?arguments[1]:{from:0,to:this.hot.countCols()-1},n=void 0!==arguments[2]&&arguments[2],o=this;if("number"==typeof e&&(e={from:e,to:e}),"number"==typeof t&&(t={from:t,to:t}),null!==this.hot.getColHeader(0)){var r=this.samplesGenerator.generateRowSamples(-1,t);this.ghostTable.addColumnHeadersRow(r.get(-1))}E(e.from,e.to,function(e){if(n||void 0===o.heights[e]){var r=o.samplesGenerator.generateRowSamples(e,t);r.forEach(function(e,t){return o.ghostTable.addRow(t,e)})}}),this.ghostTable.rows.length&&(this.ghostTable.getHeights(function(e,t){return o.heights[e]=t}),this.ghostTable.clean())},calculateAllRowsHeight:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countCols()-1},t=this,n=0,o=this.hot.countRows()-1,r=null;this.inProgress=!0;var i=function(){return t.hot?(t.calculateRowsHeight({from:n,to:Math.min(n+x.CALCULATION_STEP,o)},e),n=n+x.CALCULATION_STEP+1,void(n<o?r=v(i):(w(r),t.inProgress=!1,t.hot.view.wt.wtOverlays.adjustElementsSize(!0),t.hot.view.wt.wtOverlays.leftOverlay.needFullRender&&t.hot.view.wt.wtOverlays.leftOverlay.clone.draw()))):(w(r),void(t.inProgress=!1))};this.firstCalculation&&this.getSyncCalculationLimit()&&(this.calculateRowsHeight({from:0,to:this.getSyncCalculationLimit()},e),this.firstCalculation=!1,n=this.getSyncCalculationLimit()+1),n<o?i():this.inProgress=!1},recalculateAllRowsHeight:function(){y(this.hot.view.wt.wtTable.TABLE)&&(this.clearCache(),this.calculateAllRowsHeight())},getSyncCalculationLimit:function(){var e=x.SYNC_CALCULATION_LIMIT,t=this.hot.countRows()-1;return _(this.hot.getSettings().autoRowSize)&&(e=this.hot.getSettings().autoRowSize.syncLimit,O(e)?e=S(t,e):e>>=0),Math.min(e,t)},getRowHeight:function(e){var t=arguments[1],n=t;return void 0!==this.heights[e]&&this.heights[e]>(t||0)&&(n=this.heights[e]),n},getColumnHeaderHeight:function(){return this.heights[-1]},getFirstVisibleRow:function(){var e=this.hot.view.wt;return e.wtViewport.rowsVisibleCalculator?e.wtTable.getFirstVisibleRow():e.wtViewport.rowsRenderCalculator?e.wtTable.getFirstRenderedRow():-1},getLastVisibleRow:function(){var e=this.hot.view.wt;return e.wtViewport.rowsVisibleCalculator?e.wtTable.getLastVisibleRow():e.wtViewport.rowsRenderCalculator?e.wtTable.getLastRenderedRow():-1},clearCache:function(){this.heights.length=0,this.heights[-1]=void 0},clearCacheByRange:function(e){var t=this;"number"==typeof e&&(e={from:e,to:e}),E(Math.min(e.from,e.to),Math.max(e.from,e.to),function(e){return t.heights[e]=void 0})},isNeedRecalculate:function(){return!!m(this.heights,function(e){return void 0===e}).length},onBeforeRender:function(){var e=this.hot.renderCall;this.calculateRowsHeight({from:this.getFirstVisibleRow(),to:this.getLastVisibleRow()},void 0,e);var t=this.hot.getSettings().fixedRowsBottom;if(t){var n=this.hot.countRows()-1;this.calculateRowsHeight({from:n-t,to:n})}this.isNeedRecalculate()&&!this.inProgress&&this.calculateAllRowsHeight()},onBeforeRowMove:function(e,t){this.clearCacheByRange({from:e,to:t}),this.calculateAllRowsHeight()},onBeforeRowResize:function(e,t,n){return n&&(this.calculateRowsHeight(e,void 0,!0),t=this.getRowHeight(e)),t},onAfterLoadData:function(){var e=this;this.hot.view?this.recalculateAllRowsHeight():setTimeout(function(){e.hot&&e.recalculateAllRowsHeight()},0)},onBeforeChange:function(e){var t=null;1===e.length?t=e[0][0]:e.length>1&&(t={from:e[0][0],to:e[e.length-1][0]}),null!==t&&this.clearCacheByRange(t)},destroy:function(){this.ghostTable.clean(),$traceurRuntime.superGet(this,x.prototype,"destroy").call(this)}},{get CALCULATION_STEP(){return 50},get SYNC_CALCULATION_LIMIT(){return 500}},f),M("autoRowSize",k)},{_base:61,"helpers/array":43,"helpers/dom/element":47,"helpers/feature":49,"helpers/number":52,"helpers/object":53,"helpers/string":55,plugins:60,"utils/ghostTable":115,"utils/samplesGenerator":117}],64:[function(e,t,n){"use strict";function o(e,t,n,o){var r,i,s,a,l,u=n.length,c=n?n[0].length:0,d=[],h=[];if(r=t.row-e.row,i=t.col-e.col,["down","up"].indexOf(o)!==-1){for(var f=0;f<=i;f++)s=parseInt(n[0][f],10),a=parseInt(n[u-1][f],10),l=("down"===o?a-s:s-a)/(u-1)||0,h.push(l);d.push(h)}if(["right","left"].indexOf(o)!==-1)for(var p=0;p<=r;p++)s=parseInt(n[p][0],10),a=parseInt(n[p][c-1],10),l=("right"===o?a-s:s-a)/(c-1)||0,h=[],h.push(l),d.push(h);return d}function r(e){function t(t){return!e.autofill||void(e.autofill.handle&&e.autofill.handle.isDragged&&(e.autofill.handle.isDragged>1&&e.autofill.apply(),e.autofill.handle.isDragged=0,a=!1))}function n(e){var t,n;return!!s.instance.autofill&&(t=f(s.instance.table).top-(window.pageYOffset||document.documentElement.scrollTop)+p(s.instance.table),n=f(s.instance.table).left-(window.pageXOffset||document.documentElement.scrollLeft)+m(s.instance.table),s.addingStarted===!1&&s.instance.autofill.handle.isDragged>0&&e.clientY>t&&e.clientX<=n?(s.instance.mouseDragOutside=!0,s.addingStarted=!0):s.instance.mouseDragOutside=!1,void(s.instance.mouseDragOutside&&v("autoInsertRow")&&setTimeout(function(){s.addingStarted=!1,s.instance.alter("insert_row")},200)))}var o,r,i,s=this,a=!1;this.instance=e,this.addingStarted=!1,i=g(e),i.addEventListener(document,"mouseup",t),i.addEventListener(document,"mousemove",n),o=this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown,this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown=function(t){e.autofill.handle.isDragged=1,a=!0,o(t)},r=this.instance.view.wt.wtSettings.settings.onCellMouseOver,this.instance.view.wt.wtSettings.settings.onCellMouseOver=function(t,n,o,i){e.autofill&&a&&!e.view.isMouseDown()&&e.autofill.handle&&e.autofill.handle.isDragged&&(e.autofill.handle.isDragged++,e.autofill.showBorder(n),e.autofill.checkIfNewRowNeeded()),r(t,n,o,i)},this.instance.view.wt.wtSettings.settings.onCellCornerDblClick=function(){e.autofill.selectAdjacent()}}function i(e){return function(t){var n;return"direction"===t?n="string"==typeof e?e:"object"!=typeof e||void 0===e[t]||e[t]:"autoInsertRow"===t?n="object"!=typeof e||void 0===e[t]||e[t]:"fillHandle"===t&&(n=!!e),n}}Object.defineProperties(n,{Autofill:{get:function(){return r}},__esModule:{value:!0}});var s,a,l,u,c,d=(s=e("browser"),s&&s.__esModule&&s||{default:s}).default,h=(a=e("helpers/dom/element"),a&&a.__esModule&&a||{default:a}),f=h.offset,p=h.outerHeight,m=h.outerWidth,g=(l=e("eventManager"),l&&l.__esModule&&l||{default:l}).eventManager,w=((u=e("plugins"),u&&u.__esModule&&u||{default:u}).registerPlugin,(c=e("3rdparty/walkontable/src/cell/coords"),c&&c.__esModule&&c||{default:c}).WalkontableCellCoords);r.prototype.init=function(){this.handle={}},r.prototype.disable=function(){this.handle.disabled=!0},r.prototype.selectAdjacent=function(){var e,t,n,o,r;e=this.instance.selection.isMultiple()?this.instance.view.wt.selections.area.getCorners():this.instance.view.wt.selections.current.getCorners(),t=this.instance.getData();e:for(n=e[2]+1;n<this.instance.countRows();n++){for(r=e[1];r<=e[3];r++)if(t[n][r])break e;(t[n][e[1]-1]||t[n][e[3]+1])&&(o=n)}o&&(this.instance.view.wt.selections.fill.clear(),this.instance.view.wt.selections.fill.add(new w(e[0],e[1])),this.instance.view.wt.selections.fill.add(new w(o,e[3])),this.apply())},r.prototype.apply=function(){var e,t,n,r,i,s,a,l;this.handle.isDragged=0,this.instance.view.wt.selections.fill.isEmpty()||(e=this.instance.view.wt.selections.fill.getCorners(),this.instance.view.wt.selections.fill.clear(),t=this.instance.selection.isMultiple()?this.instance.view.wt.selections.area.getCorners():this.instance.view.wt.selections.current.getCorners(),d.hooks.run(this.instance,"afterAutofillApplyValues",t,e),e[0]===t[0]&&e[1]<t[1]?(s="left",n=new w(e[0],e[1]),r=new w(e[2],t[1]-1)):e[0]===t[0]&&e[3]>t[3]?(s="right",n=new w(e[0],t[3]+1),r=new w(e[2],e[3])):e[0]<t[0]&&e[1]===t[1]?(s="up",n=new w(e[0],e[1]),r=new w(t[0]-1,e[3])):e[2]>t[2]&&e[1]===t[1]&&(s="down",n=new w(t[2]+1,e[1]),r=new w(e[2],e[3])),n&&n.row>-1&&n.col>-1?(l={from:this.instance.getSelectedRange().from,to:this.instance.getSelectedRange().to},i=this.instance.getData(l.from.row,l.from.col,l.to.row,l.to.col),a=o(n,r,i,s),d.hooks.run(this.instance,"beforeAutofill",n,r,i),this.instance.populateFromArray(n.row,n.col,i,r.row,r.col,"autofill",null,s,a),this.instance.selection.setRangeStart(new w(e[0],e[1])),this.instance.selection.setRangeEnd(new w(e[2],e[3]))):this.instance.selection.refreshBorders())},r.prototype.showBorder=function(e){var t=this.instance.getSelectedRange().getTopLeftCorner(),n=this.instance.getSelectedRange().getBottomRightCorner();if("horizontal"!==v("direction")&&(n.row<e.row||t.row>e.row))e=new w(e.row,n.col);else{if("vertical"===v("direction"))return;e=new w(n.row,e.col)}this.instance.view.wt.selections.fill.clear(),this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().from),this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().to),this.instance.view.wt.selections.fill.add(e),this.instance.view.render()},r.prototype.checkIfNewRowNeeded=function(){var e,t,n=this.instance.countRows(),o=this;this.instance.view.wt.selections.fill.cellRange&&this.addingStarted===!1&&v("autoInsertRow")&&(t=this.instance.getSelected(),e=this.instance.view.wt.selections.fill.getCorners(),t[2]<n-1&&e[2]===n-1&&(this.addingStarted=!0,this.instance._registerTimeout(setTimeout(function(){o.instance.alter("insert_row"),o.addingStarted=!1},200))))},d.hooks.add("afterInit",function(){var e=new r(this);v=i(this.getSettings().fillHandle),void 0!==v("fillHandle")&&(e.handle&&v("fillHandle")===!1?e.disable():e.handle||v("fillHandle")===!1||(this.autofill=e,this.autofill.init()))});var v;d.Autofill=r},{"3rdparty/walkontable/src/cell/coords":6,browser:24,eventManager:42,"helpers/dom/element":47,plugins:60}],65:[function(e,t,n){"use strict";Object.defineProperties(n,{ColumnSorting:{get:function(){return _}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,c=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),d=c.addClass,h=c.closest,f=c.hasClass,p=c.index,m=c.removeClass,g=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}),w=(g.arrayEach,g.arrayMap),v=g.arrayReduce,y=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).eventManager,b=(a=e("_base"),a&&a.__esModule&&a||{default:a}).default,C=(l=e("plugins"),l&&l.__esModule&&l||{default:l}).registerPlugin;u.hooks.register("beforeColumnSort"),u.hooks.register("afterColumnSort");var _=function(e){$traceurRuntime.superConstructor(R).call(this,e),this.sortIndicators=[],this.lastSortedColumn=null},R=_;$traceurRuntime.createClass(_,{isEnabled:function(){return!!this.hot.getSettings().columnSorting},enablePlugin:function(){var e=this;if(!this.enabled){var t=this;this.hot.sortIndex=[],this.hot.sort=function(){var e=Array.prototype.slice.call(arguments);return t.sortByColumn.apply(t,e)},"undefined"==typeof this.hot.getSettings().observeChanges&&this.enableObserveChangesPlugin(),this.bindColumnSortingAfterClick(),this.addHook("afterTrimRow",function(t){return e.sort()}),this.addHook("afterUntrimRow",function(t){return e.sort()}),this.addHook("modifyRow",function(t){return e.translateRow(t)}),this.addHook("afterUpdateSettings",function(){return e.onAfterUpdateSettings()}),this.addHook("afterGetColHeader",function(t,n){return e.getColHeader(t,n)}),this.addHook("afterCreateRow",function(){t.afterCreateRow.apply(t,arguments)}),this.addHook("afterRemoveRow",function(){t.afterRemoveRow.apply(t,arguments)}),this.addHook("afterInit",function(){return e.sortBySettings()}),this.addHook("afterLoadData",function(){e.hot.sortIndex=[],e.hot.view&&e.sortBySettings()}),this.hot.view&&this.sortBySettings(),$traceurRuntime.superGet(this,R.prototype,"enablePlugin").call(this)}},disablePlugin:function(){this.hot.sort=void 0,$traceurRuntime.superGet(this,R.prototype,"disablePlugin").call(this)},onAfterUpdateSettings:function(){this.sortBySettings()},sortBySettings:function(){var e,t,n=this.hot.getSettings().columnSorting,o=this.loadSortingState();"undefined"==typeof o?(e=n.column,t=n.sortOrder):(e=o.sortColumn,t=o.sortOrder),"number"==typeof e&&(this.lastSortedColumn=e,this.sortByColumn(e,t))},setSortingColumn:function(e,t){return"undefined"==typeof e?(this.hot.sortColumn=void 0,void(this.hot.sortOrder=void 0)):(this.hot.sortColumn===e&&"undefined"==typeof t?this.hot.sortOrder===!1?this.hot.sortOrder=void 0:this.hot.sortOrder=!this.hot.sortOrder:this.hot.sortOrder="undefined"==typeof t||t,void(this.hot.sortColumn=e))},sortByColumn:function(e,t){if(this.setSortingColumn(e,t),"undefined"!=typeof this.hot.sortColumn){var n=u.hooks.run(this.hot,"beforeColumnSort",this.hot.sortColumn,this.hot.sortOrder);n!==!1&&this.sort(),this.updateOrderClass(),this.updateSortIndicator(),this.hot.render(),this.saveSortingState(),u.hooks.run(this.hot,"afterColumnSort",this.hot.sortColumn,this.hot.sortOrder)}},saveSortingState:function(){var e={};"undefined"!=typeof this.hot.sortColumn&&(e.sortColumn=this.hot.sortColumn),"undefined"!=typeof this.hot.sortOrder&&(e.sortOrder=this.hot.sortOrder),(e.hasOwnProperty("sortColumn")||e.hasOwnProperty("sortOrder"))&&u.hooks.run(this.hot,"persistentStateSave","columnSorting",e)},loadSortingState:function(){var e={};return u.hooks.run(this.hot,"persistentStateLoad","columnSorting",e),e.value},updateOrderClass:function(){var e;this.hot.sortOrder===!0?e="ascending":this.hot.sortOrder===!1&&(e="descending"),this.sortOrderClass=e},bindColumnSortingAfterClick:function(){function e(){var e=r.hot.view.TBODY.querySelector("tr"),t=1;return e&&(t=e.querySelectorAll("th").length),t}function t(t){var n=h(t,"TH");return r.hot.view.wt.wtTable.getFirstRenderedColumn()+p(n)-e()}var n=this;if(!this.bindedSortEvent){var o=y(this.hot),r=this;this.bindedSortEvent=!0,o.addEventListener(this.hot.rootElement,"click",function(e){if(f(e.target,"columnSorting")){var o=t(e.target);o!==n.lastSortedColumn&&(n.hot.sortOrder=!0),n.lastSortedColumn=o,n.sortByColumn(o)}})}},enableObserveChangesPlugin:function(){var e=this;this.hot._registerTimeout(setTimeout(function(){e.hot.updateSettings({observeChanges:!0})},0))},defaultSort:function(e){return function(t,n){return"string"==typeof t[1]&&(t[1]=t[1].toLowerCase()),"string"==typeof n[1]&&(n[1]=n[1].toLowerCase()),t[1]===n[1]?0:null===t[1]||""===t[1]?1:null===n[1]||""===n[1]?-1:isNaN(t[1])&&!isNaN(n[1])?e?1:-1:!isNaN(t[1])&&isNaN(n[1])?e?-1:1:(isNaN(t[1])||isNaN(n[1])||(t[1]=parseFloat(t[1]),n[1]=parseFloat(n[1])),t[1]<n[1]?e?-1:1:t[1]>n[1]?e?1:-1:0)}},dateSort:function(e){return function(t,n){if(t[1]===n[1])return 0;if(null===t[1]||""===t[1])return 1;if(null===n[1]||""===n[1])return-1;var o=new Date(t[1]),r=new Date(n[1]);return o<r?e?-1:1:o>r?e?1:-1:0}},numericSort:function(e){return function(t,n){var o=parseFloat(t[1]),r=parseFloat(n[1]);return o===r||isNaN(o)&&isNaN(r)?0:isNaN(o)?1:isNaN(r)?-1:o<r?e?-1:1:o>r?e?1:-1:0}},sort:function(){if("undefined"==typeof this.hot.sortOrder)return void(this.hot.sortIndex.length=0);var e,t;this.hot.sortingEnabled=!1,this.hot.sortIndex.length=0;for(var n=0,o=this.hot.countRows()-this.hot.getSettings().minSpareRows;n<o;n++)this.hot.sortIndex.push([n,this.hot.getDataAtCell(n,this.hot.sortColumn)]);if(e=this.hot.getCellMeta(0,this.hot.sortColumn),e.sortFunction)t=e.sortFunction;else switch(e.type){case"date":t=this.dateSort;break;case"numeric":t=this.numericSort;break;default:t=this.defaultSort}this.hot.sortIndex.sort(t(this.hot.sortOrder));for(var r=this.hot.sortIndex.length;r<this.hot.countRows();r++)this.hot.sortIndex.push([r,this.hot.getDataAtCell(r,this.hot.sortColumn)]);this.hot.sortingEnabled=!0},updateSortIndicator:function(){if("undefined"!=typeof this.hot.sortOrder){var e=this.hot.getCellMeta(0,this.hot.sortColumn);this.sortIndicators[this.hot.sortColumn]=e.sortIndicator}},translateRow:function(e){return this.hot.sortingEnabled&&"undefined"!=typeof this.hot.sortOrder&&this.hot.sortIndex&&this.hot.sortIndex.length&&this.hot.sortIndex[e]?this.hot.sortIndex[e][0]:e},untranslateRow:function(e){if(this.hot.sortingEnabled&&this.hot.sortIndex&&this.hot.sortIndex.length)for(var t=0;t<this.hot.sortIndex.length;t++)if(this.hot.sortIndex[t][0]==e)return t},getColHeader:function(e,t){if(e<0||!t.parentNode)return!1;var n=t.querySelector(".colHeader"),o=(t.getAttribute("colspan"),
+t.parentNode.parentNode.childNodes),r=Array.prototype.indexOf.call(o,t.parentNode);r-=o.length,n&&(this.hot.getSettings().columnSorting&&e>=0&&r===-1&&d(n,"columnSorting"),m(n,"descending"),m(n,"ascending"),this.sortIndicators[e]&&e===this.hot.sortColumn&&("ascending"===this.sortOrderClass?d(n,"ascending"):"descending"===this.sortOrderClass&&d(n,"descending")))},isSorted:function(){return"undefined"!=typeof this.hot.sortColumn},afterCreateRow:function(e,t){if(this.isSorted()){for(var n=0;n<this.hot.sortIndex.length;n++)this.hot.sortIndex[n][0]>=e&&(this.hot.sortIndex[n][0]+=t);for(var n=0;n<t;n++)this.hot.sortIndex.splice(e+n,0,[e+n,this.hot.getSourceData()[e+n][this.hot.sortColumn+this.hot.colOffset()]]);this.saveSortingState()}},afterRemoveRow:function(e,t){function n(e){return v(o,function(t,n){return e>n&&t++,t},0)}if(this.isSorted()){var o=this.hot.sortIndex.splice(e,t);o=w(o,function(e){return e[0]}),this.hot.sortIndex=w(this.hot.sortIndex,function(e,t){var o=n(e[0]);return o&&(e[0]-=o),e}),this.saveSortingState()}}},{},b),C("columnSorting",_)},{_base:61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,plugins:60}],66:[function(e,t,n){"use strict";Object.defineProperties(n,{CommentEditor:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e("helpers/dom/element"),o&&o.__esModule&&o||{default:o}).addClass,i=function(){this.editor=this.createEditor(),this.editorStyle=this.editor.style,this.editorStyle.position="absolute",this.editorStyle.zIndex=100,this.hide()},s=i;$traceurRuntime.createClass(i,{setPosition:function(e,t){this.editorStyle.left=e+"px",this.editorStyle.top=t+"px"},show:function(){this.editorStyle.display="block"},hide:function(){this.editorStyle.display="none"},isVisible:function(){return"block"===this.editorStyle.display},setValue:function(){var e=void 0!==arguments[0]?arguments[0]:"";e=e||"",this.getInputElement().value=e},getValue:function(){return this.getInputElement().value},isFocused:function(){return document.activeElement===this.getInputElement()},focus:function(){this.getInputElement().focus()},createEditor:function(){var e,t,n=document.querySelector("."+s.CLASS_EDITOR_CONTAINER);return n||(n=document.createElement("div"),r(n,s.CLASS_EDITOR_CONTAINER),document.body.appendChild(n)),e=document.createElement("div"),r(e,s.CLASS_EDITOR),t=document.createElement("textarea"),r(t,s.CLASS_INPUT),e.appendChild(t),n.appendChild(e),e},getInputElement:function(){return this.editor.querySelector("."+s.CLASS_INPUT)},destroy:function(){this.editor.parentNode.removeChild(this.editor),this.editor=null,this.editorStyle=null}},{get CLASS_EDITOR_CONTAINER(){return"htCommentsContainer"},get CLASS_EDITOR(){return"htComments"},get CLASS_INPUT(){return"htCommentTextArea"},get CLASS_CELL(){return"htCommentCell"}})},{"helpers/dom/element":47}],67:[function(e,t,n){"use strict";Object.defineProperties(n,{Comments:{get:function(){return R}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,d=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),h=d.addClass,f=d.closest,p=d.getWindowScrollLeft,m=d.getWindowScrollTop,g=d.hasClass,w=d.offset,v=(i=e("eventManager"),i&&i.__esModule&&i||{default:i}).EventManager,y=(s=e("3rdparty/walkontable/src/cell/coords"),s&&s.__esModule&&s||{default:s}).WalkontableCellCoords,b=(a=e("plugins"),a&&a.__esModule&&a||{default:a}).registerPlugin,C=(l=e("_base"),l&&l.__esModule&&l||{default:l}).default,_=(u=e("commentEditor"),u&&u.__esModule&&u||{default:u}).CommentEditor,R=function(e){$traceurRuntime.superConstructor(S).call(this,e),this.editor=null,this.eventManager=null,this.range={},this.mouseDown=!1,this.contextMenuEvent=!1,this.timer=null},S=R;$traceurRuntime.createClass(R,{isEnabled:function(){return this.hot.getSettings().comments},enablePlugin:function(){var e=this;this.enabled||(this.editor||(this.editor=new _),this.eventManager||(this.eventManager=new v(this)),this.addHook("afterContextMenuDefaultOptions",function(t){return e.addToContextMenu(t)}),this.addHook("afterRenderer",function(t,n,o,r,i,s){return e.onAfterRenderer(t,s)}),this.addHook("afterScrollHorizontally",function(){return e.refreshEditorPosition()}),this.addHook("afterScrollVertically",function(){return e.refreshEditorPosition()}),this.addHook("afterColumnResize",function(){return e.refreshEditorPosition()}),this.addHook("afterRowResize",function(){return e.refreshEditorPosition()}),this.registerListeners(),$traceurRuntime.superGet(this,S.prototype,"enablePlugin").call(this))},disablePlugin:function(){$traceurRuntime.superGet(this,S.prototype,"disablePlugin").call(this)},registerListeners:function(){var e=this;this.eventManager.addEventListener(document,"mouseover",function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(document,"mousedown",function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(document,"mousemove",function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(document,"mouseup",function(t){return e.onMouseUp(t)}),this.eventManager.addEventListener(this.editor.getInputElement(),"blur",function(t){return e.onEditorBlur(t)})},setRange:function(e){this.range=e},clearRange:function(){this.range={}},targetIsCellWithComment:function(e){return!(!g(e.target,"htCommentCell")||!f(e.target,[this.hot.rootElement]))},targetIsCommentTextArea:function(e){return this.editor.getInputElement()===e.target},saveComment:function(){if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');var e=this.editor.getValue(),t=this.range.from.row,n=this.range.from.col;this.hot.setCellMeta(t,n,"comment",e),this.hot.render()},saveCommentAtCell:function(e,t){this.setRange({from:new y(e,t)}),this.saveComment()},removeComment:function(){if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');this.hot.removeCellMeta(this.range.from.row,this.range.from.col,"comment"),this.hot.render(),this.hide()},removeCommentAtCell:function(e,t){this.setRange({from:new y(e,t)}),this.removeComment()},show:function(){if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin("comment").setRange())');var e=this.hot.getCellMeta(this.range.from.row,this.range.from.col);return this.refreshEditorPosition(!0),this.editor.setValue(e.comment||""),this.editor.show(),!0},showAtCell:function(e,t){return this.setRange({from:new y(e,t)}),this.show()},hide:function(){this.editor.hide()},refreshEditorPosition:function(){var e=void 0!==arguments[0]&&arguments[0];if(e||this.range.from&&this.editor.isVisible()){var t=this.hot.view.wt.wtTable.getCell(this.range.from),n=w(t),o=this.hot.getColWidth(this.range.from.col),r=n.top,i=n.left,s=0,a=0;this.hot.view.wt.wtViewport.hasVerticalScroll()&&(r-=this.hot.view.wt.wtOverlays.topOverlay.getScrollPosition(),s=20),this.hot.view.wt.wtViewport.hasHorizontalScroll()&&(i-=this.hot.view.wt.wtOverlays.leftOverlay.getScrollPosition(),a=20);var l=i+o,u=r,c=this.hot.view.wt.wtTable.holder.getBoundingClientRect(),d={left:c.left+p()+a,right:c.right+p()-15,top:c.top+m()+s,bottom:c.bottom+m()};l<=d.left||l>d.right||u<=d.top||u>d.bottom?this.hide():this.editor.setPosition(l,u)}},onMouseDown:function(e){this.mouseDown=!0,this.hot.view&&this.hot.view.wt&&(this.contextMenuEvent||this.targetIsCommentTextArea(e)||this.targetIsCellWithComment(e)||this.hide(),this.contextMenuEvent=!1)},onMouseOver:function(e){if(!this.mouseDown&&!this.editor.isFocused())if(this.targetIsCellWithComment(e)){var t=this.hot.view.wt.wtTable.getCoords(e.target),n={from:new y(t.row,t.col)};this.setRange(n),this.show()}else this.targetIsCommentTextArea(e)||this.editor.isFocused()||this.hide()},onMouseMove:function(e){var t=this;this.targetIsCommentTextArea(e)&&(this.mouseDown=!0,clearTimeout(this.timer),this.timer=setTimeout(function(){t.mouseDown=!1},200))},onMouseUp:function(e){this.mouseDown=!1},onAfterRenderer:function(e,t){t.comment&&h(e,t.commentedCellClassName)},onEditorBlur:function(e){this.saveComment()},checkSelectionCommentsConsistency:function(){var e=this.hot.getSelectedRange();if(!e)return!1;var t=!1,n=e.from;return this.hot.getCellMeta(n.row,n.col).comment&&(t=!0),t},onContextMenuAddComment:function(){var e=this,t=this.hot.getSelectedRange();this.contextMenuEvent=!0,this.setRange({from:t.from}),this.show(),setTimeout(function(){e.hot&&(e.hot.deselectCell(),e.editor.focus())},10)},onContextMenuRemoveComment:function(e,t){this.contextMenuEvent=!0,this.removeCommentAtCell(t.start.row,t.start.col)},addToContextMenu:function(e){var t=this;e.items.push(c.plugins.ContextMenu.SEPARATOR,{key:"commentsAddEdit",name:function(){return t.checkSelectionCommentsConsistency()?"Edit Comment":"Add Comment"},callback:function(){return t.onContextMenuAddComment()},disabled:function(){return!(this.getSelected()&&!this.selection.selectedHeader.corner)}},{key:"commentsRemove",name:function(){return"Delete Comment"},callback:function(e,n){return t.onContextMenuRemoveComment(e,n)},disabled:function(){return t.hot.selection.selectedHeader.corner||!t.checkSelectionCommentsConsistency()}})},destroy:function(){this.editor&&this.editor.destroy(),$traceurRuntime.superGet(this,S.prototype,"destroy").call(this)}},{},C),b("comments",R)},{"3rdparty/walkontable/src/cell/coords":6,_base:61,browser:24,commentEditor:66,eventManager:42,"helpers/dom/element":47,plugins:60}],68:[function(e,t,n){"use strict";function o(e,t){var n;return i(t,function(t){var o=t.key?t.key.split(":"):null;if(Array.isArray(o)&&o[1]===e)return n=t,!1}),n}Object.defineProperties(n,{CommandExecutor:{get:function(){return s}},__esModule:{value:!0}});var r,i=(r=e("helpers/array"),r&&r.__esModule&&r||{default:r}).arrayEach,s=function(e){this.hot=e,this.commands={},this.commonCallback=null};$traceurRuntime.createClass(s,{registerCommand:function(e,t){this.commands[e]=t},setCommonCallback:function(e){this.commonCallback=e},execute:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this,s=e.split(":");e=s[0];var a=2===s.length?s[1]:null,l=this.commands[e];if(!l)throw new Error("Menu command '"+e+"' not exists.");if(a&&l.submenu&&(l=o(a,l.submenu.items)),l.disabled!==!0&&("function"!=typeof l.disabled||l.disabled.call(this.hot)!==!0)&&!l.hasOwnProperty("submenu")){var u=[];"function"==typeof l.callback&&u.push(l.callback),"function"==typeof this.commonCallback&&u.push(this.commonCallback),t.unshift(s.join(":")),i(u,function(e){return e.apply(r.hot,t)})}}},{})},{"helpers/array":43}],69:[function(e,t,n){"use strict";Object.defineProperties(n,{ContextMenu:{get:function(){return B}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,l,f,p=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,m=(r=e("_base"),r&&r.__esModule&&r||{default:r}).default,g=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}).arrayEach,w=(s=e("commandExecutor"),s&&s.__esModule&&s||{default:s}).CommandExecutor,v=(a=e("eventManager"),a&&a.__esModule&&a||{default:a}).EventManager,y=(l=e("helpers/dom/element"),l&&l.__esModule&&l||{default:l}).hasClass,b=(u=e("itemsFactory"),u&&u.__esModule&&u||{default:u}).ItemsFactory,C=(c=e("menu"),c&&c.__esModule&&c||{default:c}).Menu,_=(d=e("plugins"),d&&d.__esModule&&d||{default:d}).registerPlugin,R=(h=e("helpers/dom/event"),h&&h.__esModule&&h||{default:h}),S=R.stopPropagation,E=R.pageX,M=R.pageY,T=(l=e("helpers/dom/element"),l&&l.__esModule&&l||{default:l}),O=T.getWindowScrollLeft,k=T.getWindowScrollTop,x=(f=e("predefinedItems"),f&&f.__esModule&&f||{default:f}),H=x.ROW_ABOVE,D=x.ROW_BELOW,A=x.COLUMN_LEFT,P=x.COLUMN_RIGHT,N=x.REMOVE_ROW,L=x.REMOVE_COLUMN,W=x.UNDO,I=x.REDO,j=x.READ_ONLY,V=x.ALIGNMENT,F=x.SEPARATOR,B=function(e){$traceurRuntime.superConstructor(z).call(this,e),this.eventManager=new v(this),this.commandExecutor=new w(this.hot),this.itemsFactory=null,this.menu=null},z=B;$traceurRuntime.createClass(B,{isEnabled:function(){return this.hot.getSettings().contextMenu},enablePlugin:function(){var e=this;if(!this.enabled){this.itemsFactory=new b(this.hot,z.DEFAULT_ITEMS);var t=this.hot.getSettings().contextMenu,n={items:this.itemsFactory.getItems(t)};this.registerEvents(),"function"==typeof t.callback&&this.commandExecutor.setCommonCallback(t.callback),$traceurRuntime.superGet(this,z.prototype,"enablePlugin").call(this),this.callOnPluginsReady(function(){e.hot.runHooks("afterContextMenuDefaultOptions",n),e.itemsFactory.setPredefinedItems(n.items);var o=e.itemsFactory.getItems(t);e.menu=new C(e.hot,{className:"htContextMenu",keepInViewport:!0}),e.menu.setMenuItems(o),e.menu.addLocalHook("afterOpen",function(){return e.onMenuAfterOpen()}),e.menu.addLocalHook("afterClose",function(){return e.onMenuAfterClose()}),e.menu.addLocalHook("executeCommand",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.executeCommand.apply(e,t)}),g(o,function(t){return e.commandExecutor.registerCommand(t.key,t)})})}},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,z.prototype,"updatePlugin").call(this)},disablePlugin:function(){this.close(),this.menu&&(this.menu.destroy(),this.menu=null),$traceurRuntime.superGet(this,z.prototype,"disablePlugin").call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,"contextmenu",function(t){return e.onContextMenu(t)})},open:function(e){this.menu&&(this.menu.open(),this.menu.setPosition({top:parseInt(M(e),10)-k(),left:parseInt(E(e),10)-O()}),this.menu.hotMenu.isHotTableEnv=this.hot.isHotTableEnv,p.eventManager.isHotTableEnv=this.hot.isHotTableEnv)},close:function(){this.menu&&this.menu.close()},executeCommand:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.commandExecutor.execute.apply(this.commandExecutor,e)},onContextMenu:function(e){function t(e){return"TD"===e.nodeName||"TD"===e.parentNode.nodeName}var n=this.hot.getSettings(),o=n.rowHeaders,r=n.colHeaders,i=e.realTarget;this.close(),e.preventDefault(),S(e),(o||r||t(i)||y(i,"current")&&y(i,"wtBorder"))&&this.open(e)},onMenuAfterOpen:function(){this.hot.runHooks("afterContextMenuShow",this)},onMenuAfterClose:function(){this.hot.listen(),this.hot.runHooks("afterContextMenuHide",this)},destroy:function(){this.close(),this.menu&&this.menu.destroy(),$traceurRuntime.superGet(this,z.prototype,"destroy").call(this)}},{get DEFAULT_ITEMS(){return[H,D,F,A,P,F,N,L,F,W,I,F,j,F,V]}},m),B.SEPARATOR={name:F},p.hooks.register("afterContextMenuDefaultOptions"),p.hooks.register("afterContextMenuShow"),p.hooks.register("afterContextMenuHide"),p.hooks.register("afterContextMenuExecute"),_("contextMenu",B)},{_base:61,browser:24,commandExecutor:68,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,itemsFactory:71,menu:72,plugins:60,predefinedItems:73}],70:[function(e,t,n){"use strict";Object.defineProperties(n,{Cursor:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,a=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),l=a.getWindowScrollLeft,u=a.getWindowScrollTop,c=(i=e("helpers/dom/event"),i&&i.__esModule&&i||{default:i}),d=c.pageX,h=c.pageY,f=function(e){var t,n,o,r,i,s,a=u(),c=l();this.type=this.getSourceType(e),"literal"===this.type?(t=parseInt(e.top,10),o=parseInt(e.left,10),i=e.height||0,s=e.width||0,n=t,r=o,t+=a,o+=c):"event"===this.type&&(t=parseInt(h(e),10),o=parseInt(d(e),10),i=e.target.clientHeight,s=e.target.clientWidth,n=t-a,r=o-c),this.top=t,this.topRelative=n,this.left=o,this.leftRelative=r,this.scrollTop=a,this.scrollLeft=c,this.cellHeight=i,this.cellWidth=s};$traceurRuntime.createClass(f,{getSourceType:function(e){var t="literal";return e instanceof Event&&(t="event"),t},fitsAbove:function(e){return this.topRelative>=e.offsetHeight},fitsBelow:function(e){var t=void 0!==arguments[1]?arguments[1]:window.innerHeight;return this.topRelative+e.offsetHeight<=t},fitsOnRight:function(e){var t=void 0!==arguments[1]?arguments[1]:window.innerWidth;return this.leftRelative+this.cellWidth+e.offsetWidth<=t},fitsOnLeft:function(e){return this.leftRelative>=e.offsetWidth}},{}),s.plugins.utils=s.plugins.utils||{},s.plugins.utils.Cursor=f},{browser:24,"helpers/dom/element":47,"helpers/dom/event":48}],71:[function(e,t,n){"use strict";function o(){var e=void 0!==arguments[0]?arguments[0]:null,t=void 0!==arguments[1]?arguments[1]:[],n=void 0!==arguments[2]?arguments[2]:{},o=[];return e&&e.items?e=e.items:Array.isArray(e)||(e=t),u(e)?l(e,function(e,t){var r=n["string"==typeof e?e:t];r||(r=e),u(e)?c(r,e):"string"==typeof r&&(r={name:r}),void 0===r.key&&(r.key=t),o.push(r)}):d(e,function(e,t){var r=n[e];!r&&p.indexOf(e)>=0||(r||(r={name:e,key:t+""}),u(e)&&c(r,e),void 0===r.key&&(r.key=t),o.push(r))}),o}Object.defineProperties(n,{ItemsFactory:{get:function(){return g}},__esModule:{value:!0}});var r,i,s,a=(r=e("helpers/object"),r&&r.__esModule&&r||{default:r}),l=a.objectEach,u=a.isObject,c=a.extend,d=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}).arrayEach,h=(s=e("predefinedItems"),s&&s.__esModule&&s||{default:s}),f=h.SEPARATOR,p=h.ITEMS,m=h.predefinedItems,g=function(e){var t=void 0!==arguments[1]?arguments[1]:null;this.hot=e,this.predefinedItems=m(),this.defaultOrderPattern=t};$traceurRuntime.createClass(g,{setPredefinedItems:function(e){var t=this,n={};this.defaultOrderPattern.length=0,l(e,function(e,o){var r="";e.name===f?(n[f]=e,r=f):isNaN(parseInt(o,10))?(e.key=void 0===e.key?o:e.key,n[o]=e,r=e.key):(n[e.key]=e,r=e.key),t.defaultOrderPattern.push(r)}),this.predefinedItems=n},getItems:function(){var e=void 0!==arguments[0]?arguments[0]:null;return o(e,this.defaultOrderPattern,this.predefinedItems)}},{})},{"helpers/array":43,"helpers/object":53,predefinedItems:73}],72:[function(e,t,n){"use strict";Object.defineProperties(n,{Menu:{get:function(){return z}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p,m=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,g=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),w=g.addClass,v=g.empty,y=g.fastInnerHTML,b=g.getScrollbarWidth,C=g.isChildOf,_=g.removeClass,R=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}),S=R.arrayEach,E=R.arrayFilter,M=R.arrayReduce,T=(s=e("cursor"),s&&s.__esModule&&s||{default:s}).Cursor,O=(a=e("eventManager"),a&&a.__esModule&&a||{default:a}).EventManager,k=(l=e("helpers/object"),l&&l.__esModule&&l||{default:l}).mixin,x=(u=e("helpers/function"),u&&u.__esModule&&u||{default:u}).debounce,H=(c=e("utils"),c&&c.__esModule&&c||{default:c}),D=H.filterSeparators,A=H.hasSubMenu,P=H.isDisabled,N=H.isItemHidden,L=H.isSeparator,W=H.isSelectionDisabled,I=H.normalizeSelection,j=(d=e("helpers/unicode"),d&&d.__esModule&&d||{default:d}).KEY_CODES,V=(h=e("mixins/localHooks"),h&&h.__esModule&&h||{default:h}).localHooks,F=(f=e("predefinedItems"),f&&f.__esModule&&f||{default:f}).SEPARATOR,B=(p=e("helpers/dom/event"),p&&p.__esModule&&p||{default:p}).stopImmediatePropagation,z=function(e,t){this.hot=e,this.options=t||{parent:null,name:null,className:"",keepInViewport:!0,standalone:!1},this.eventManager=new O(this),this.container=this.createContainer(this.options.name),this.hotMenu=null,this.hotSubMenus={},this.parentMenu=this.options.parent||null,this.menuItems=null,this.origOutsideClickDeselects=null,this.offset={above:0,below:0,left:0,right:0},this._afterScrollCallback=null,this.registerEvents()},Y=z;$traceurRuntime.createClass(z,{registerEvents:function(){var e=this;this.eventManager.addEventListener(document.documentElement,"mousedown",function(t){return e.onDocumentMouseDown(t)})},setMenuItems:function(e){this.menuItems=e},setOffset:function(e){var t=void 0!==arguments[1]?arguments[1]:0;this.offset[e]=t},isSubMenu:function(){return null!==this.parentMenu},open:function(){var e=this;this.container.removeAttribute("style"),this.container.style.display="block";var t=x(function(t){return e.openSubMenu(t)},300),n=E(this.menuItems,function(t){return N(t,e.hot)});n=D(n,F);var o={data:n,colHeaders:!1,colWidths:[200],autoRowSize:!1,readOnly:!0,copyPaste:!1,columns:[{data:"name",renderer:function(t,n,o,r,i,s){return e.menuItemRenderer(t,n,o,r,i,s)}}],renderAllRows:!0,fragmentSelection:"cell",disableVisualSelection:"area",beforeKeyDown:function(t){return e.onBeforeKeyDown(t)},afterOnCellMouseOver:function(n,o,r){e.isAllSubMenusClosed()?t(o.row):e.openSubMenu(o.row)}};this.origOutsideClickDeselects=this.hot.getSettings().outsideClickDeselects,this.hot.getSettings().outsideClickDeselects=!1,this.hotMenu=new m.Core(this.container,o),this.hotMenu.addHook("afterInit",function(){return e.onAfterInit()}),this.hotMenu.init(),this.hotMenu.listen(),this.blockMainTableCallbacks(),this.runLocalHooks("afterOpen")},close:function(){var e=void 0!==arguments[0]&&arguments[0];this.isOpened()&&(e&&this.parentMenu?this.parentMenu.close():(this.closeAllSubMenus(),this.container.style.display="none",this.releaseMainTableCallbacks(),this.hotMenu.destroy(),this.hotMenu=null,this.hot.getSettings().outsideClickDeselects=this.origOutsideClickDeselects,this.runLocalHooks("afterClose")))},openSubMenu:function(e){if(!this.hotMenu)return!1;var t=this.hotMenu.getCell(e,0);if(this.closeAllSubMenus(),!t||!A(t))return!1;var n=this.hotMenu.getSourceDataAtRow(e),o=new Y(this.hot,{parent:this,name:n.name,className:this.options.className,keepInViewport:!0});return o.setMenuItems(n.submenu.items),o.open(),o.setPosition(t.getBoundingClientRect()),this.hotSubMenus[n.key]=o,o},closeSubMenu:function(e){var t=this.hotMenu.getSourceDataAtRow(e),n=this.hotSubMenus[t.key];n&&(n.destroy(),delete this.hotSubMenus[t.key])},closeAllSubMenus:function(){var e=this;S(this.hotMenu.getData(),function(t,n){return e.closeSubMenu(n)})},isAllSubMenusClosed:function(){return 0===Object.keys(this.hotSubMenus).length},destroy:function(){this.clearLocalHooks(),this.close(),this.parentMenu=null,this.eventManager.destroy()},isOpened:function(){return null!==this.hotMenu},executeCommand:function(e){if(this.isOpened()&&this.hotMenu.getSelected()){var t=this.hotMenu.getSourceDataAtRow(this.hotMenu.getSelected()[0]);if(this.runLocalHooks("select",t,e),t.isCommand!==!1&&t.name!==F){var n=this.hot.getSelectedRange(),o=n?I(n):{},r=!0;(t.disabled===!0||"function"==typeof t.disabled&&t.disabled.call(this.hot)===!0||t.submenu)&&(r=!1),this.runLocalHooks("executeCommand",t.key,o,e),this.isSubMenu()&&this.parentMenu.runLocalHooks("executeCommand",t.key,o,e),r&&this.close(!0)}}},setPosition:function(e){var t=new T(e);this.options.keepInViewport?(t.fitsBelow(this.container)?this.setPositionBelowCursor(t):t.fitsAbove(this.container)?this.setPositionAboveCursor(t):this.setPositionBelowCursor(t),t.fitsOnRight(this.container)?this.setPositionOnRightOfCursor(t):this.setPositionOnLeftOfCursor(t)):(this.setPositionBelowCursor(t),this.setPositionOnRightOfCursor(t))},setPositionAboveCursor:function(e){var t=this.offset.above+e.top-this.container.offsetHeight;this.isSubMenu()&&(t=e.top+e.cellHeight-this.container.offsetHeight+3),this.container.style.top=t+"px"},setPositionBelowCursor:function(e){var t=this.offset.below+e.top;this.isSubMenu()&&(t=e.top-1),this.container.style.top=t+"px"},setPositionOnRightOfCursor:function(e){var t;t=this.isSubMenu()?1+e.left+e.cellWidth:this.offset.right+1+e.left,this.container.style.left=t+"px"},setPositionOnLeftOfCursor:function(e){var t=this.offset.left+e.left-this.container.offsetWidth+b()+4;this.container.style.left=t+"px"},selectFirstCell:function(){var e=this.hotMenu.getCell(0,0);L(e)||P(e)||W(e)?this.selectNextCell(0,0):this.hotMenu.selectCell(0,0)},selectLastCell:function(){var e=this.hotMenu.countRows()-1,t=this.hotMenu.getCell(e,0);L(t)||P(t)||W(t)?this.selectPrevCell(e,0):this.hotMenu.selectCell(e,0)},selectNextCell:function(e,t){var n=e+1,o=n<this.hotMenu.countRows()?this.hotMenu.getCell(n,t):null;o&&(L(o)||P(o)||W(o)?this.selectNextCell(n,t):this.hotMenu.selectCell(n,t))},selectPrevCell:function(e,t){var n=e-1,o=n>=0?this.hotMenu.getCell(n,t):null;o&&(L(o)||P(o)||W(o)?this.selectPrevCell(n,t):this.hotMenu.selectCell(n,t))},menuItemRenderer:function(e,t,n,o,r,i){var s=this,a=e.getSourceDataAtRow(n),l=document.createElement("div"),u=function(e){return e.hasOwnProperty("submenu")},c=function(e){return new RegExp(F,"i").test(e.name)},d=function(e){return e.disabled===!0||"function"==typeof e.disabled&&e.disabled.call(s.hot)===!0},h=function(e){return e.disableSelection};"function"==typeof i&&(i=i.call(this.hot)),v(t),w(l,"htItemWrapper"),t.appendChild(l),c(a)?w(t,"htSeparator"):"function"==typeof a.renderer?(w(t,"htCustomMenuRenderer"),t.appendChild(a.renderer(e,l,n,o,r,i))):y(l,i),d(a)?(w(t,"htDisabled"),this.eventManager.addEventListener(t,"mouseenter",function(){return e.deselectCell()})):h(a)?(w(t,"htSelectionDisabled"),this.eventManager.addEventListener(t,"mouseenter",function(){return e.deselectCell()})):u(a)?(w(t,"htSubmenu"),h(a)?this.eventManager.addEventListener(t,"mouseenter",function(){return e.deselectCell()}):this.eventManager.addEventListener(t,"mouseenter",function(){return e.selectCell(n,o,void 0,void 0,!1,!1)})):(_(t,"htSubmenu"),_(t,"htDisabled"),h(a)?this.eventManager.addEventListener(t,"mouseenter",function(){return e.deselectCell()}):this.eventManager.addEventListener(t,"mouseenter",function(){return e.selectCell(n,o,void 0,void 0,!1,!1)}))},createContainer:function(){var e=void 0!==arguments[0]?arguments[0]:null;e&&(e=e.replace(/ /g,"_"),e=this.options.className+"Sub_"+e);var t;return t=e?document.querySelector("."+this.options.className+"."+e):document.querySelector("."+this.options.className),t||(t=document.createElement("div"),w(t,"htMenu "+this.options.className),e&&w(t,e),document.getElementsByTagName("body")[0].appendChild(t)),t},blockMainTableCallbacks:function(){this._afterScrollCallback=function(){},this.hot.addHook("afterScrollVertically",this._afterScrollCallback),this.hot.addHook("afterScrollHorizontally",this._afterScrollCallback)},releaseMainTableCallbacks:function(){this._afterScrollCallback&&(this.hot.removeHook("afterScrollVertically",this._afterScrollCallback),this.hot.removeHook("afterScrollHorizontally",this._afterScrollCallback),this._afterScrollCallback=null)},onBeforeKeyDown:function(e){var t=this.hotMenu.getSelected(),n=!1;switch(e.keyCode){case j.ESCAPE:this.close(),n=!0;break;case j.ENTER:t&&(this.hotMenu.getSourceDataAtRow(t[0]).submenu?n=!0:(this.executeCommand(e),this.close(!0)));break;case j.ARROW_DOWN:t?this.selectNextCell(t[0],t[1]):this.selectFirstCell(),n=!0;break;case j.ARROW_UP:t?this.selectPrevCell(t[0],t[1]):this.selectLastCell(),n=!0;break;case j.ARROW_RIGHT:if(t){var o=this.openSubMenu(t[0]);o&&o.selectFirstCell()}n=!0;break;case j.ARROW_LEFT:t&&this.isSubMenu()&&(this.close(),this.parentMenu&&this.parentMenu.hotMenu.listen(),n=!0)}n&&(e.preventDefault(),B(e))},onAfterInit:function(){var e=this.hotMenu.getSettings().data,t=this.hotMenu.view.wt.wtTable.hider.style,n=this.hotMenu.view.wt.wtTable.holder.style,o=parseInt(t.width,10),r=M(e,function(e,t){return e+(t.name===F?1:26)},0);n.width=o+22+"px",n.height=r+4+"px"},onDocumentMouseDown:function(e){this.isOpened()&&(this.container&&C(e.target,this.container)&&this.executeCommand(e),this.options.standalone&&this.hotMenu&&!C(e.target,this.hotMenu.rootElement)?this.close(!0):(this.isAllSubMenusClosed()||this.isSubMenu())&&!C(e.target,".htMenu")&&C(e.target,document)&&this.close(!0))}},{}),k(z,V)},{browser:24,cursor:70,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/function":50,"helpers/object":53,"helpers/unicode":56,"mixins/localHooks":57,predefinedItems:73,utils:86}],73:[function(e,t,n){"use strict";function o(){var e={};return y(oe,function(t,n){return e[n]=t()}),e}function r(e,t){ne.indexOf(e)===-1&&(oe[e]=t)}var i;Object.defineProperties(n,{ALIGNMENT:{get:function(){return a.KEY}},CLEAR_COLUMN:{get:function(){return l.KEY}},COLUMN_LEFT:{get:function(){return u.KEY}},COLUMN_RIGHT:{get:function(){return c.KEY}},READ_ONLY:{get:function(){return d.KEY}},REDO:{get:function(){return h.KEY}},REMOVE_COLUMN:{get:function(){return f.KEY}},REMOVE_ROW:{get:function(){return p.KEY}},ROW_ABOVE:{get:function(){return m.KEY}},ROW_BELOW:{get:function(){return g.KEY}},SEPARATOR:{get:function(){return w.KEY}},UNDO:{get:function(){return v.KEY}},ITEMS:{get:function(){return ne}},predefinedItems:{get:function(){return o}},addItem:{get:function(){return r}},__esModule:{value:!0}});var s,a,l,u,c,d,h,f,p,m,g,w,v,a,l,u,c,d,h,f,p,m,g,w,v,y=(s=e("helpers/object"),s&&s.__esModule&&s||{default:s}).objectEach,b=(a=e("predefinedItems/alignment"),a&&a.__esModule&&a||{default:a}),C=b.alignmentItem,_=b.KEY,R=(l=e("predefinedItems/clearColumn"),l&&l.__esModule&&l||{default:l}),S=R.clearColumnItem,E=R.KEY,M=(u=e("predefinedItems/columnLeft"),u&&u.__esModule&&u||{default:u}),T=M.columnLeftItem,O=M.KEY,k=(c=e("predefinedItems/columnRight"),c&&c.__esModule&&c||{default:c}),x=k.columnRightItem,H=k.KEY,D=(d=e("predefinedItems/readOnly"),d&&d.__esModule&&d||{default:d}),A=D.readOnlyItem,P=D.KEY,N=(h=e("predefinedItems/redo"),h&&h.__esModule&&h||{default:h}),L=N.redoItem,W=N.KEY,I=(f=e("predefinedItems/removeColumn"),f&&f.__esModule&&f||{default:f}),j=I.removeColumnItem,V=I.KEY,F=(p=e("predefinedItems/removeRow"),p&&p.__esModule&&p||{default:p}),B=F.removeRowItem,z=F.KEY,Y=(m=e("predefinedItems/rowAbove"),m&&m.__esModule&&m||{default:m}),U=Y.rowAboveItem,G=Y.KEY,$=(g=e("predefinedItems/rowBelow"),g&&g.__esModule&&g||{default:g}),K=$.rowBelowItem,X=$.KEY,q=(w=e("predefinedItems/separator"),w&&w.__esModule&&w||{default:w}),Z=q.separatorItem,J=q.KEY,Q=(v=e("predefinedItems/undo"),v&&v.__esModule&&v||{default:v}),ee=Q.undoItem,te=Q.KEY,a=(a=e("predefinedItems/alignment"),a&&a.__esModule&&a||{default:a}),l=(l=e("predefinedItems/clearColumn"),l&&l.__esModule&&l||{default:l}),u=(u=e("predefinedItems/columnLeft"),u&&u.__esModule&&u||{default:u}),c=(c=e("predefinedItems/columnRight"),c&&c.__esModule&&c||{default:c}),d=(d=e("predefinedItems/readOnly"),d&&d.__esModule&&d||{default:d}),h=(h=e("predefinedItems/redo"),h&&h.__esModule&&h||{default:h}),f=(f=e("predefinedItems/removeColumn"),f&&f.__esModule&&f||{default:f}),p=(p=e("predefinedItems/removeRow"),p&&p.__esModule&&p||{default:p}),m=(m=e("predefinedItems/rowAbove"),m&&m.__esModule&&m||{default:m}),g=(g=e("predefinedItems/rowBelow"),g&&g.__esModule&&g||{default:g}),w=(w=e("predefinedItems/separator"),w&&w.__esModule&&w||{default:w}),v=(v=e("predefinedItems/undo"),v&&v.__esModule&&v||{default:v}),ne=[G,X,O,H,E,z,V,te,W,P,_,J],oe=(i={},Object.defineProperty(i,J,{value:Z,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,G,{value:U,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,X,{value:K,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,O,{value:T,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,H,{value:x,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,E,{value:S,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,z,{value:B,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,V,{value:j,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,te,{value:ee,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,W,{value:L,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,P,{value:A,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,_,{value:C,configurable:!0,enumerable:!0,writable:!0}),i)},{"helpers/object":53,"predefinedItems/alignment":74,"predefinedItems/clearColumn":75,"predefinedItems/columnLeft":76,"predefinedItems/columnRight":77,"predefinedItems/readOnly":78,"predefinedItems/redo":79,"predefinedItems/removeColumn":80,"predefinedItems/removeRow":81,"predefinedItems/rowAbove":82,"predefinedItems/rowBelow":83,"predefinedItems/separator":84,"predefinedItems/undo":85}],74:[function(e,t,n){"use strict";
+function o(){return{key:h,name:"Alignment",disabled:function(){return!(this.getSelectedRange()&&!this.selection.selectedHeader.corner)},submenu:{items:[{key:h+":left",name:function(){var e=this,t="Left",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htLeft")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="horizontal",r="htLeft";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+":center",name:function(){var e=this,t="Center",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htCenter")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="horizontal",r="htCenter";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+":right",name:function(){var e=this,t="Right",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htRight")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="horizontal",r="htRight";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+":justify",name:function(){var e=this,t="Justify",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htJustify")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="horizontal",r="htJustify";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{name:d},{key:h+":top",name:function(){var e=this,t="Top",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htTop")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="vertical",r="htTop";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+":middle",name:function(){var e=this,t="Middle",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htMiddle")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="vertical",r="htMiddle";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+":bottom",name:function(){var e=this,t="Bottom",n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&&o.indexOf("htBottom")!==-1)return!0});return n&&(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o="vertical",r="htBottom";this.runHooks("beforeCellAlignment",n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1}]}}}Object.defineProperties(n,{KEY:{get:function(){return h}},alignmentItem:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e("utils"),r&&r.__esModule&&r||{default:r}),a=s.align,l=s.getAlignmentClasses,u=s.checkSelectionConsistency,c=s.markLabelAsSelected,d=(i=e("separator"),i&&i.__esModule&&i||{default:i}).KEY,h="alignment"},{separator:84,utils:86}],75:[function(e,t,n){"use strict";function o(){return{key:s,name:"Clear column",callback:function(e,t){var n=t.start.col;this.countRows()&&this.populateFromArray(0,n,[[null]],Math.max(t.start.row,t.end.row),n)},disabled:function(){var e=i(this);if(!e)return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(",");return e[1]<0||this.countCols()>=this.getSettings().maxCols||n}}}Object.defineProperties(n,{KEY:{get:function(){return s}},clearColumnItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="clear_column"},{utils:86}],76:[function(e,t,n){"use strict";function o(){return{key:s,name:"Insert column on the left",callback:function(e,t){this.alter("insert_col",t.start.col)},disabled:function(){var e=i(this);if(!e)return!0;if(!this.isColumnModificationAllowed())return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(","),o=1===this.countCols();return e[1]<0||this.countCols()>=this.getSettings().maxCols||!o&&n},hidden:function(){return!this.getSettings().allowInsertColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},columnLeftItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="col_left"},{utils:86}],77:[function(e,t,n){"use strict";function o(){return{key:s,name:"Insert column on the right",callback:function(e,t){this.alter("insert_col",t.end.col+1)},disabled:function(){var e=i(this);if(!e)return!0;if(!this.isColumnModificationAllowed())return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(","),o=1===this.countCols();return e[1]<0||this.countCols()>=this.getSettings().maxCols||!o&&n},hidden:function(){return!this.getSettings().allowInsertColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},columnRightItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="col_right"},{utils:86}],78:[function(e,t,n){"use strict";function o(){return{key:l,name:function(){var e=this,t="Read only",n=s(this.getSelectedRange(),function(t,n){return e.getCellMeta(t,n).readOnly});return n&&(t=a(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=s(t,function(t,n){return e.getCellMeta(t,n).readOnly});t.forAll(function(t,o){e.getCellMeta(t,o).readOnly=!n}),this.render()},disabled:function(){return!(this.getSelectedRange()&&!this.selection.selectedHeader.corner)}}}Object.defineProperties(n,{KEY:{get:function(){return l}},readOnlyItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}),s=i.checkSelectionConsistency,a=i.markLabelAsSelected,l="make_read_only"},{utils:86}],79:[function(e,t,n){"use strict";function o(){return{key:r,name:"Redo",callback:function(){this.redo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isRedoAvailable()}}}Object.defineProperties(n,{KEY:{get:function(){return r}},redoItem:{get:function(){return o}},__esModule:{value:!0}});var r="redo"},{}],80:[function(e,t,n){"use strict";function o(){return{key:s,name:"Remove column",callback:function(e,t){var n=t.end.col-t.start.col+1;this.alter("remove_col",t.start.col,n)},disabled:function(){var e=i(this),t=this.countCols();return!e||this.selection.selectedHeader.rows||this.selection.selectedHeader.corner||!this.isColumnModificationAllowed()||!t},hidden:function(){return!this.getSettings().allowRemoveColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},removeColumnItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="remove_col"},{utils:86}],81:[function(e,t,n){"use strict";function o(){return{key:s,name:"Remove row",callback:function(e,t){var n=t.end.row-t.start.row+1;this.alter("remove_row",t.start.row,n)},disabled:function(){var e=i(this),t=this.countRows();return!e||this.selection.selectedHeader.cols||this.selection.selectedHeader.corner||!t},hidden:function(){return!this.getSettings().allowRemoveRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},removeRowItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="remove_row"},{utils:86}],82:[function(e,t,n){"use strict";function o(){return{key:s,name:"Insert row above",callback:function(e,t){this.alter("insert_row",t.start.row)},disabled:function(){var e=i(this);return!e||this.selection.selectedHeader.cols||this.countRows()>=this.getSettings().maxRows},hidden:function(){return!this.getSettings().allowInsertRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},rowAboveItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="row_above"},{utils:86}],83:[function(e,t,n){"use strict";function o(){return{key:s,name:"Insert row below",callback:function(e,t){this.alter("insert_row",t.end.row+1)},disabled:function(){var e=i(this);return!e||this.selection.selectedHeader.cols||this.countRows()>=this.getSettings().maxRows},hidden:function(){return!this.getSettings().allowInsertRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},rowBelowItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e("utils"),r&&r.__esModule&&r||{default:r}).getValidSelection,s="row_below"},{utils:86}],84:[function(e,t,n){"use strict";function o(){return{name:r}}Object.defineProperties(n,{KEY:{get:function(){return r}},separatorItem:{get:function(){return o}},__esModule:{value:!0}});var r="---------"},{}],85:[function(e,t,n){"use strict";function o(){return{key:r,name:"Undo",callback:function(){this.undo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isUndoAvailable()}}}Object.defineProperties(n,{KEY:{get:function(){return r}},undoItem:{get:function(){return o}},__esModule:{value:!0}});var r="undo"},{}],86:[function(e,t,n){"use strict";function o(e){return{start:e.getTopLeftCorner(),end:e.getBottomRightCorner()}}function r(e){return E(e,"htSeparator")}function i(e){return E(e,"htSubmenu")}function s(e){return E(e,"htDisabled")}function a(e){return E(e,"htSelectionDisabled")}function l(e){var t=e.getSelected();return t?t[0]<0?null:t:null}function u(e,t){return e.indexOf(t)!=-1?e:(e=e.replace("htTop","").replace("htMiddle","").replace("htBottom","").replace("  ",""),e+=" "+t)}function c(e,t){return e.indexOf(t)!=-1?e:(e=e.replace("htLeft","").replace("htCenter","").replace("htRight","").replace("htJustify","").replace("  ",""),e+=" "+t)}function d(e,t){for(var n={},o=e.from.row;o<=e.to.row;o++)for(var r=e.from.col;r<=e.to.col;r++)n[o]||(n[o]=[]),n[o][r]=t(o,r);return n}function h(e,t,n,o){if(e.from.row==e.to.row&&e.from.col==e.to.col)f(e.from.row,e.from.col,t,n,o);else for(var r=e.from.row;r<=e.to.row;r++)for(var i=e.from.col;i<=e.to.col;i++)f(r,i,t,n,o)}function f(e,t,n,o,r){var i=r(e,t),s=o;i.className&&(s="vertical"===n?u(i.className,o):c(i.className,o)),i.className=s}function p(e,t){var n=!1;return e&&e.forAll(function(e,o){if(t(e,o))return n=!0,!1}),n}function m(e){return'<span class="selected">'+String.fromCharCode(10003)+"</span>"+e}function g(e,t){return!e.hidden||!("function"==typeof e.hidden&&e.hidden.call(t))}function w(e,t){for(var n=e.slice(0),o=0;o<n.length&&n[o].name===t;)n.shift();return n}function v(e,t){var n=e.slice(0);return n.reverse(),n=w(n,t),n.reverse(),n}function y(e){var t=[];return S(e,function(e,n){n>0?t[t.length-1].name!==e.name&&t.push(e):t.push(e)}),t}function b(e){var t=void 0!==arguments[1]?arguments[1]:M,n=e.slice(0);return n=w(n,t),n=v(n,t),n=y(n)}Object.defineProperties(n,{normalizeSelection:{get:function(){return o}},isSeparator:{get:function(){return r}},hasSubMenu:{get:function(){return i}},isDisabled:{get:function(){return s}},isSelectionDisabled:{get:function(){return a}},getValidSelection:{get:function(){return l}},prepareVerticalAlignClass:{get:function(){return u}},prepareHorizontalAlignClass:{get:function(){return c}},getAlignmentClasses:{get:function(){return d}},align:{get:function(){return h}},checkSelectionConsistency:{get:function(){return p}},markLabelAsSelected:{get:function(){return m}},isItemHidden:{get:function(){return g}},filterSeparators:{get:function(){return b}},__esModule:{value:!0}});var C,_,R,S=(C=e("helpers/array"),C&&C.__esModule&&C||{default:C}).arrayEach,E=(_=e("helpers/dom/element"),_&&_.__esModule&&_||{default:_}).hasClass,M=(R=e("predefinedItems/separator"),R&&R.__esModule&&R||{default:R}).KEY},{"helpers/array":43,"helpers/dom/element":47,"predefinedItems/separator":84}],87:[function(e,t,n){"use strict";Object.defineProperties(n,{ContextMenuCopyPaste:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,d=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}).removeClass,h=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}).arrayEach,f=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).EventManager,p=(a=e("plugins"),a&&a.__esModule&&a||{default:a}).registerPlugin,m=(l=e("_base"),l&&l.__esModule&&l||{default:l}).default,g=(u=e("zeroclipboard"),u&&u.__esModule&&u||{default:u}).default,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.eventManager=new f(this),this.swfPath=null,this.outsideClickDeselectsCache=null},v=w;$traceurRuntime.createClass(w,{isEnabled:function(){return this.hot.getSettings().contextMenuCopyPaste},enablePlugin:function(){var e=this;if(!this.enabled){"object"==typeof this.hot.getSettings().contextMenuCopyPaste&&(this.swfPath=this.hot.getSettings().contextMenuCopyPaste.swfPath),"undefined"==typeof g&&console.error("To be able to use the Copy/Paste feature from the context menu, you need to manually include ZeroClipboard.js file to your website.");try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){"undefined"==typeof navigator.mimeTypes["application/x-shockwave-flash"]&&console.error("To be able to use the Copy/Paste feature from the context menu, your browser needs to have Flash Plugin installed.")}this.swfPath&&g.config({swfPath:this.swfPath}),this.hot.addHook("afterContextMenuShow",function(){return e.onAfterContextMenuShow()}),this.hot.addHook("afterContextMenuDefaultOptions",function(t){return e.onAfterContextMenuDefaultOptions(t)}),this.registerEvents(),$traceurRuntime.superGet(this,v.prototype,"enablePlugin").call(this)}},disablePlugin:function(){$traceurRuntime.superGet(this,v.prototype,"disablePlugin").call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(document,"mouseenter",function(){return e.removeCurrentClass()}),this.eventManager.addEventListener(document,"mouseleave",function(){return e.removeZeroClipboardClass()})},getCopyValue:function(){return this.hot.copyPaste.setCopyableText(),this.hot.copyPaste.copyPasteInstance.elTextarea.value},onAfterContextMenuDefaultOptions:function(e){e.items.unshift({key:"copy",name:"Copy",disabled:function(){return this.selection.selectedHeader.corner}},{key:"paste",name:"Paste",callback:function(){this.copyPaste.triggerPaste()},disabled:function(){return this.selection.selectedHeader.corner}},c.plugins.ContextMenu.SEPARATOR)},onAfterContextMenuShow:function(){var e=this,t=this.hot.getPlugin("contextMenu"),n=t.menu.hotMenu.getSourceData();h(n,function(n,o){if("copy"===n.key){var r=new g(t.menu.hotMenu.getCell(o,0));return r.off(),r.on("copy",function(t){var n=t.clipboardData;n.setData("text/plain",e.getCopyValue()),e.hot.getSettings().outsideClickDeselects=e.outsideClickDeselectsCache}),!1}})},removeCurrentClass:function(){var e=this.hot.getPlugin("contextMenu");if(e.menu.isOpened()){var t=e.menu.hotMenu.rootElement.querySelector("td.current");t&&d(t,"current")}this.outsideClickDeselectsCache=this.hot.getSettings().outsideClickDeselects,this.hot.getSettings().outsideClickDeselects=!1},removeZeroClipboardClass:function(){var e=this.hot.getPlugin("contextMenu");if(e.menu.isOpened()){var t=e.menu.hotMenu.rootElement.querySelector("td.zeroclipboard-is-hover");t&&d(t,"zeroclipboard-is-hover")}this.hot.getSettings().outsideClickDeselects=this.outsideClickDeselectsCache}},{},m),p("contextMenuCopyPaste",w)},{_base:61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,plugins:60,zeroclipboard:"zeroclipboard"}],88:[function(e,t,n){"use strict";function o(e){function t(){e.isListening()&&e.selection.empty()}function n(t){var n,o,r,i,s,a,l,u,c,d;if(e.isListening()&&e.selection.isSelected()){n=t,o=y.parse(n),r=e.getSelected(),i=new x(r[0],r[1]),s=new x(r[2],r[3]),a=new H(i,i,s),l=a.getTopLeftCorner(),u=a.getBottomRightCorner(),c=l,d=new x(Math.max(u.row,o.length-1+l.row),Math.max(u.col,o[0].length-1+l.col));var h=s.row-i.row>=o.length-1,f=s.col-i.col>=o[0].length-1;e.addHookOnce("afterChange",function(t,n){var o=t?t.length:0;if(o){var r={row:0,col:0},i=-1;R(t,function(e,n){var s=o>n+1?t[n+1]:null;s&&(h||(r.row=r.row+Math.max(s[0]-e[0]-1,0)),!f&&e[1]>i&&(i=e[1],r.col=r.col+Math.max(s[1]-e[1]-1,0)))}),e.selectCell(c.row,c.col,d.row+r.row,d.col+r.col)}}),e.populateFromArray(c.row,c.col,o,d.row,d.col,"paste",e.getSettings().pasteMode)}}function o(t){if(e.getSelected()&&!(e.getActiveEditor()&&e.getActiveEditor().isOpened()||T(t))){if(_(t.keyCode)){if(e.getSettings().fragmentSelection&&O())return;return r.setCopyableText(),void M(t)}var n=(t.ctrlKey||t.metaKey)&&!t.altKey;t.keyCode==C.A&&n&&e._registerTimeout(setTimeout(k(r.setCopyableText,r),0))}}var r=this;this.copyPasteInstance=v(),this.copyPasteInstance.onCut(t),this.copyPasteInstance.onPaste(n),this.onPaste=n,e.addHook("beforeKeyDown",o),this.destroy=function(){this.copyPasteInstance&&(this.copyPasteInstance.removeCallback(t),this.copyPasteInstance.removeCallback(n),this.copyPasteInstance.destroy(),this.copyPasteInstance=null),e.removeHook("beforeKeyDown",o)},e.addHook("afterDestroy",k(this.destroy,this)),this.triggerPaste=k(this.copyPasteInstance.triggerPaste,this.copyPasteInstance),this.triggerCut=k(this.copyPasteInstance.triggerCut,this.copyPasteInstance),this.setCopyableText=function(){var t=e.getSettings(),n=t.copyRowsLimit,o=t.copyColsLimit,r=e.getSelectedRange(),i=r.getTopLeftCorner(),s=r.getBottomRightCorner(),a=i.row,l=i.col,u=s.row,c=s.col,d=Math.min(u,a+n-1),h=Math.min(c,l+o-1),f=[];f.push({startRow:a,startCol:l,endRow:d,endCol:h}),f=w.hooks.run(e,"modifyCopyableRange",f);var p=this.getRangedCopyableData(f);e.copyPaste.copyPasteInstance.copyable(p),u===d&&c===h||w.hooks.run(e,"afterCopyLimit",u-a+1,c-l+1,n,o)},this.getRangedCopyableData=function(t){var n=[],o=[],r=[];return R(t,function(e){S(e.startRow,e.endRow,function(e){o.indexOf(e)===-1&&o.push(e)}),S(e.startCol,e.endCol,function(e){r.indexOf(e)===-1&&r.push(e)})}),R(o,function(t){var o=[];R(r,function(n){o.push(e.getCopyableData(t,n))}),n.push(o)}),y.stringify(n)}}function r(){var e=this,t=e.getSettings().copyPaste!==!1;t&&!e.copyPaste?e.copyPaste=new o(e):!t&&e.copyPaste&&(e.copyPaste.destroy(),e.copyPaste=null)}Object.defineProperties(n,{CopyPastePlugin:{get:function(){return o}},__esModule:{value:!0}});var i,s,a,l,u,c,d,h,f,p,m,g,w=(i=e("browser"),i&&i.__esModule&&i||{default:i}).default,v=(s=e("copyPaste"),s&&s.__esModule&&s||{default:s}).default,y=(a=e("SheetClip"),a&&a.__esModule&&a||{default:a}).default,b=(l=e("helpers/unicode"),l&&l.__esModule&&l||{default:l}),C=b.KEY_CODES,_=b.isCtrlKey,R=(u=e("helpers/array"),u&&u.__esModule&&u||{default:u}).arrayEach,S=(c=e("helpers/number"),c&&c.__esModule&&c||{default:c}).rangeEach,E=(d=e("helpers/dom/event"),d&&d.__esModule&&d||{default:d}),M=E.stopImmediatePropagation,T=E.isImmediatePropagationStopped,O=(h=e("helpers/dom/element"),h&&h.__esModule&&h||{default:h}).getSelectionText,k=(f=e("helpers/function"),f&&f.__esModule&&f||{default:f}).proxy,x=((p=e("plugins"),p&&p.__esModule&&p||{default:p}).registerPlugin,(m=e("3rdparty/walkontable/src/cell/coords"),m&&m.__esModule&&m||{default:m}).WalkontableCellCoords),H=(g=e("3rdparty/walkontable/src/cell/range"),g&&g.__esModule&&g||{default:g}).WalkontableCellRange;w.hooks.add("afterInit",r),w.hooks.add("afterUpdateSettings",r),w.hooks.register("afterCopyLimit"),w.hooks.register("modifyCopyableRange")},{"3rdparty/walkontable/src/cell/coords":6,"3rdparty/walkontable/src/cell/range":7,SheetClip:"SheetClip",browser:24,copyPaste:"copyPaste","helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/function":50,"helpers/number":52,"helpers/unicode":56,plugins:60}],89:[function(e,t,n){"use strict";function o(){}var r,i,s,a,l,u=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,c=((i=e("plugins"),i&&i.__esModule&&i||{default:i}).registerPlugin,(s=e("3rdparty/walkontable/src/cell/range"),s&&s.__esModule&&s||{default:s}).WalkontableCellRange),d=(a=e("3rdparty/walkontable/src/selection"),a&&a.__esModule&&a||{default:a}).WalkontableSelection,h=function(e){return"boolean"==typeof e&&e===!0||"object"==typeof e&&e.length>0},f=function(){h(this.getSettings().customBorders)&&(this.customBorders||(l=this,this.customBorders=new o))},p=function(e){for(var t=0;t<l.view.wt.selections.length;t++)if(l.view.wt.selections[t].settings.className==e)return t;return-1},m=function(e){var t={row:e.row,col:e.col},n=new d(e,new c(t,t,t)),o=p(e.className);o>=0?l.view.wt.selections[o]=n:l.view.wt.selections.push(n)},g=function(e,t,n){var o=_(e,t);o=R(o,n),this.setCellMeta(e,t,"borders",o),m(o)},w=function(e){for(var t=e.range,n=t.from.row;n<=t.to.row;n++)for(var o=t.from.col;o<=t.to.col;o++){var r=_(n,o),i=0;n==t.from.row&&(i++,e.hasOwnProperty("top")&&(r.top=e.top)),n==t.to.row&&(i++,e.hasOwnProperty("bottom")&&(r.bottom=e.bottom)),o==t.from.col&&(i++,e.hasOwnProperty("left")&&(r.left=e.left)),o==t.to.col&&(i++,e.hasOwnProperty("right")&&(r.right=e.right)),i>0&&(this.setCellMeta(n,o,"borders",r),m(r))}},v=function(e,t){return"border_row"+e+"col"+t},y=function(){return{width:1,color:"#000"}},b=function(){return{hide:!0}},C=function(){return{width:1,color:"#000",cornerVisible:!1}},_=function(e,t){return{className:v(e,t),border:C(),row:e,col:t,top:b(),right:b(),bottom:b(),left:b()}},R=function(e,t){return t.hasOwnProperty("border")&&(e.border=t.border),t.hasOwnProperty("top")&&(e.top=t.top),t.hasOwnProperty("right")&&(e.right=t.right),t.hasOwnProperty("bottom")&&(e.bottom=t.bottom),t.hasOwnProperty("left")&&(e.left=t.left),e},S=function(e){for(var t=document.querySelectorAll("."+e),n=0;n<t.length;n++)if(t[n]&&"TD"!=t[n].nodeName){var o=t[n].parentNode;o.parentNode&&o.parentNode.removeChild(o)}},E=function(e,t){var n=v(e,t);S(n),this.removeCellMeta(e,t,"borders")},M=function(e,t,n,o){var r=this.getCellMeta(e,t).borders;r&&void 0!=r.border||(r=_(e,t)),o?r[n]=b():r[n]=y(),this.setCellMeta(e,t,"borders",r);var i=v(e,t);S(i),m(r),this.render()},T=function(e,t,n){if(e.from.row==e.to.row&&e.from.col==e.to.col)"noBorders"==t?E.call(this,e.from.row,e.from.col):M.call(this,e.from.row,e.from.col,t,n);else switch(t){case"noBorders":for(var o=e.from.col;o<=e.to.col;o++)for(var r=e.from.row;r<=e.to.row;r++)E.call(this,r,o);break;case"top":for(var i=e.from.col;i<=e.to.col;i++)M.call(this,e.from.row,i,t,n);break;case"right":for(var s=e.from.row;s<=e.to.row;s++)M.call(this,s,e.to.col,t);break;case"bottom":for(var a=e.from.col;a<=e.to.col;a++)M.call(this,e.to.row,a,t);break;case"left":for(var l=e.from.row;l<=e.to.row;l++)M.call(this,l,e.from.col,t)}},O=function(e,t){var n=!1;return e.getSelectedRange().forAll(function(o,r){var i=e.getCellMeta(o,r).borders;if(i){if(!t)return n=!0,!1;if(!i[t].hasOwnProperty("hide"))return n=!0,!1}}),n},k=function(e){return'<span class="selected">'+String.fromCharCode(10003)+"</span>"+e},x=function(e){this.getSettings().customBorders&&(e.items.push(u.plugins.ContextMenu.SEPARATOR),e.items.push({key:"borders",name:"Borders",disabled:function(){return this.selection.selectedHeader.corner},submenu:{items:[{key:"borders:top",name:function(){var e="Top",t=O(this,"top");return t&&(e=k(e)),e},callback:function(){var e=O(this,"top");T.call(this,this.getSelectedRange(),"top",e)}},{key:"borders:right",name:function(){var e="Right",t=O(this,"right");return t&&(e=k(e)),e},callback:function(){var e=O(this,"right");T.call(this,this.getSelectedRange(),"right",e)}},{key:"borders:bottom",name:function(){var e="Bottom",t=O(this,"bottom");return t&&(e=k(e)),e},callback:function(){var e=O(this,"bottom");T.call(this,this.getSelectedRange(),"bottom",e)}},{key:"borders:left",name:function(){var e="Left",t=O(this,"left");return t&&(e=k(e)),e},callback:function(){var e=O(this,"left");T.call(this,this.getSelectedRange(),"left",e)}},{key:"borders:no_borders",name:"Remove border(s)",callback:function(){T.call(this,this.getSelectedRange(),"noBorders")},disabled:function(){return!O(this)}}]}}))};u.hooks.add("beforeInit",f),u.hooks.add("afterContextMenuDefaultOptions",x),u.hooks.add("afterInit",function(){var e=this.getSettings().customBorders;if(e){for(var t=0;t<e.length;t++)e[t].range?w.call(this,e[t]):g.call(this,e[t].row,e[t].col,e[t]);this.render(),this.view.wt.draw(!0)}}),u.CustomBorders=o},{"3rdparty/walkontable/src/cell/range":7,"3rdparty/walkontable/src/selection":19,browser:24,plugins:60}],90:[function(e,t,n){"use strict";function o(){this.boundaries=null,this.callback=null}Object.defineProperties(n,{DragToScroll:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,l=(i=e("eventManager"),i&&i.__esModule&&i||{default:i}).eventManager;(s=e("plugins"),s&&s.__esModule&&s||{default:s}).registerPlugin;a.plugins.DragToScroll=o,o.prototype.setBoundaries=function(e){this.boundaries=e},o.prototype.setCallback=function(e){this.callback=e},o.prototype.check=function(e,t){var n=0,o=0;t<this.boundaries.top?o=t-this.boundaries.top:t>this.boundaries.bottom&&(o=t-this.boundaries.bottom),e<this.boundaries.left?n=e-this.boundaries.left:e>this.boundaries.right&&(n=e-this.boundaries.right),this.callback(n,o)};var u,c=function(e){e.dragToScrollListening=!1;var t=e.view.wt.wtTable.holder;u=new o,t!==window&&(u.setBoundaries(t.getBoundingClientRect()),u.setCallback(function(e,n){e<0?t.scrollLeft-=50:e>0&&(t.scrollLeft+=50),n<0?t.scrollTop-=20:n>0&&(t.scrollTop+=20)}),e.dragToScrollListening=!0)};a.hooks.add("afterInit",function(){var e=this,t=l(this);t.addEventListener(document,"mouseup",function(){e.dragToScrollListening=!1}),t.addEventListener(document,"mousemove",function(t){e.dragToScrollListening&&u.check(t.clientX,t.clientY)})}),a.hooks.add("afterDestroy",function(){l(this).clear()}),a.hooks.add("afterOnCellMouseDown",function(){c(this)}),a.hooks.add("afterOnCellCornerMouseDown",function(){c(this)}),a.plugins.DragToScroll=o},{browser:24,eventManager:42,plugins:60}],91:[function(e,t,n){"use strict";Object.defineProperties(n,{ManualColumnFreeze:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,a=(r=e("_base"),r&&r.__esModule&&r||{default:r}).default,l=(i=e("plugins"),i&&i.__esModule&&i||{default:i}).registerPlugin,u=function(e){$traceurRuntime.superConstructor(c).call(this,e),this.manualColumnMovePlugin=null,this.frozenColumnsBasePositions=[]},c=u;$traceurRuntime.createClass(u,{isEnabled:function(){return!!this.hot.getSettings().manualColumnFreeze},enablePlugin:function(){var e=this;this.enabled||(this.addHook("modifyCol",function(t){return e.onModifyCol(t)}),this.addHook("afterContextMenuDefaultOptions",function(t){return e.addContextMenuEntry(t)}),$traceurRuntime.superGet(this,c.prototype,"enablePlugin").call(this))},init:function(){$traceurRuntime.superGet(this,c.prototype,"init").call(this),this.fixedColumnsCount=this.hot.getSettings().fixedColumnsLeft},getManualColumnMovePlugin:function(){return this.manualColumnMovePlugin||(this.manualColumnMovePlugin=this.hot.getPlugin("manualColumnMove")),this.manualColumnMovePlugin},onModifyCol:function(e){return this.getManualColumnMovePlugin().isEnabled()?e:this.getLogicalColumnIndex(e)},addContextMenuEntry:function(e){var t=this;e.items.push(s.plugins.ContextMenu.SEPARATOR,{key:"freeze_column",name:function(){var e=t.hot.getSelected()[1];return e>t.fixedColumnsCount-1?"Freeze this column":"Unfreeze this column"},disabled:function(){var e=t.hot.getSelected();return e[1]!==e[3]},callback:function(){var e=t.hot.getSelected()[1];e>t.fixedColumnsCount-1?t.freezeColumn(e):t.unfreezeColumn(e)}})},freezeColumn:function(e){e<=this.fixedColumnsCount-1||(e!==this.getLogicalColumnIndex(e)&&(this.frozenColumnsBasePositions[this.fixedColumnsCount]=e),this.changeColumnPositions(e,this.fixedColumnsCount),this.addFixedColumn(),this.hot.view.wt.wtOverlays.leftOverlay.refresh(),this.hot.view.wt.wtOverlays.adjustElementsSize())},unfreezeColumn:function(e){if(!(e>this.fixedColumnsCount-1)){var t=this.getBestColumnReturnPosition(e);this.changeColumnPositions(e,t),this.removeFixedColumn(),this.hot.view.wt.wtOverlays.leftOverlay.refresh(),this.hot.view.wt.wtOverlays.adjustElementsSize()}},addFixedColumn:function(){this.hot.updateSettings({fixedColumnsLeft:this.fixedColumnsCount+1}),this.fixedColumnsCount++},removeFixedColumn:function(){this.hot.updateSettings({fixedColumnsLeft:this.fixedColumnsCount-1}),this.fixedColumnsCount--},getBestColumnReturnPosition:function(e){var t,n=this.fixedColumnsCount,o=this.getLogicalColumnIndex(n);if(null==this.frozenColumnsBasePositions[e])for(t=this.getLogicalColumnIndex(e);o<t;)n++,o=this.getLogicalColumnIndex(n);else{for(t=this.frozenColumnsBasePositions[e],this.frozenColumnsBasePositions[e]=void 0;o<=t;)n++,o=this.getLogicalColumnIndex(n);n=o}return n-1},getVisibleColumnIndex:function(e){return this.getManualColumnMovePlugin().getVisibleColumnIndex(e)},getLogicalColumnIndex:function(e){return this.getManualColumnMovePlugin().getLogicalColumnIndex(e)},changeColumnPositions:function(e,t){this.getManualColumnMovePlugin().changeColumnPositions(e,t)}},{},a),l("manualColumnFreeze",u)},{_base:61,browser:24,plugins:60}],92:[function(e,t,n){"use strict";Object.defineProperties(n,{ManualColumnMove:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e("_base.js"),o&&o.__esModule&&o||{default:o}).default,h=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,f=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerHeight,v=(s=e("helpers/array"),s&&s.__esModule&&s||{default:s}),y=v.arrayEach,b=v.arrayMap,C=(a=e("helpers/number"),a&&a.__esModule&&a||{default:a}).rangeEach,_=(l=e("eventManager"),l&&l.__esModule&&l||{default:l}).eventManager,R=(u=e("helpers/dom/event"),u&&u.__esModule&&u||{default:u}).pageX,S=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,E=new WeakMap,M=function(e){var t=this;$traceurRuntime.superConstructor(T).call(this,e),E.set(this,{guideClassName:"manualColumnMoverGuide",handleClassName:"manualColumnMover",startOffset:null,pressed:null,startCol:null,endCol:null,currentCol:null,startX:null,startY:null}),this.guideElement=null,this.handleElement=null,this.currentTH=null,this.columnPositions=[],this.eventManager=_(this),this.addHook("init",function(){return t.onInit()})},T=M;$traceurRuntime.createClass(M,{isEnabled:function(){return!!this.hot.getSettings().manualColumnMove},enablePlugin:function(){var e=this,t=E.get(this),n=this.hot.getSettings().manualColumnMove,o=this.loadManualColumnPositions();this.handleElement=document.createElement("DIV"),this.handleElement.className=t.handleClassName,this.guideElement=document.createElement("DIV"),this.guideElement.className=t.guideClassName,this.addHook("modifyCol",function(t){return e.onModifyCol(t)}),this.addHook("unmodifyCol",function(t){return e.onUnmodifyCol(t)}),this.addHook("afterRemoveCol",function(t,n){return e.onAfterRemoveCol(t,n)}),this.addHook("afterCreateCol",function(t,n){return e.onAfterCreateCol(t,n)}),this.registerEvents(),"undefined"!=typeof o?this.columnPositions=o:Array.isArray(n)?this.columnPositions=n:n&&void 0!==this.columnPositions||(this.columnPositions=[]),$traceurRuntime.superGet(this,T.prototype,"enablePlugin").call(this)},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,T.prototype,"updatePlugin").call(this)},disablePlugin:function(){
+var e=this.hot.getSettings().manualColumnMove;Array.isArray(e)&&(this.unregisterEvents(),this.columnPositions=[]),$traceurRuntime.superGet(this,T.prototype,"disablePlugin").call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,"mouseover",function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,"mousedown",function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,"mousemove",function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,"mouseup",function(t){return e.onMouseUp(t)})},unregisterEvents:function(){this.eventManager.clear()},saveManualColumnPositions:function(){h.hooks.run(this.hot,"persistentStateSave","manualColumnPositions",this.columnPositions)},loadManualColumnPositions:function(){var e={};return h.hooks.run(this.hot,"persistentStateLoad","manualColumnPositions",e),e.value},completeSettingsArray:function(){var e=this,t=this.hot.countCols();this.columnPositions.length!==t&&C(0,t-1,function(t){e.columnPositions.indexOf(t)===-1&&e.columnPositions.push(t)})},setupHandlePosition:function(e){this.currentTH=e;var t=E.get(this),n=this.hot.view.wt.wtTable.getCoords(e).col,o=w(this.currentTH);if(n>=0){var r=this.currentTH.getBoundingClientRect();t.currentCol=n,t.startOffset=r.left,this.handleElement.style.top=r.top+"px",this.handleElement.style.left=t.startOffset+"px",this.handleElement.style.height=o+"px",this.hot.rootElement.appendChild(this.handleElement)}},refreshHandlePosition:function(e,t){var n=e.getBoundingClientRect(),o=6;t>0?this.handleElement.style.left=n.left+n.width-o+"px":this.handleElement.style.left=n.left+"px"},setupGuidePosition:function(){var e=this.currentTH.getBoundingClientRect(),t=E.get(this),n=parseInt(w(this.handleElement),10),o=parseInt(this.handleElement.style.top,10)+n,r=parseInt(this.hot.view.maximumVisibleElementHeight(0),10);p(this.handleElement,"active"),p(this.guideElement,"active"),this.guideElement.style.width=e.width+"px",this.guideElement.style.height=r-n+"px",this.guideElement.style.top=o+"px",this.guideElement.style.left=t.startOffset+"px",this.hot.rootElement.appendChild(this.guideElement)},refreshGuidePosition:function(e){var t=E.get(this);this.guideElement.style.left=t.startOffset+e+"px"},hideHandleAndGuide:function(){g(this.handleElement,"active"),g(this.guideElement,"active")},checkColumnHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return"THEAD"===t.tagName||this.checkColumnHeader(t)}return!1},createPositionData:function(e){var t=this.columnPositions;t.length<e&&C(t.length,e-1,function(e){t[e]=e})},getTHFromTargetElement:function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},changeColumnPositions:function(e,t){var n=Math.max(e,t);n>this.columnPositions.length-1&&this.createPositionData(n+1),this.columnPositions.splice(t,0,this.columnPositions.splice(e,1)[0])},getVisibleColumnIndex:function(e){var t=this.columnPositions.indexOf(e);return t===-1?void 0:t},getLogicalColumnIndex:function(e){return this.columnPositions[e]},onMouseOver:function(e){var t=E.get(this);if(this.checkColumnHeader(e.target)){var n=this.getTHFromTargetElement(e.target);if(n)if(t.pressed){var o=this.hot.view.wt.wtTable.getCoords(n).col;o>=0&&(t.endCol=o,this.refreshHandlePosition(n,t.endCol-t.startCol))}else this.setupHandlePosition(n)}},onMouseDown:function(e){var t=E.get(this);m(e.target,t.handleClassName)&&(t.startX=R(e),this.setupGuidePosition(),t.pressed=this.hot,t.startCol=t.currentCol,t.endCol=t.currentCol)},onMouseMove:function(e){var t=E.get(this);t.pressed&&this.refreshGuidePosition(R(e)-t.startX)},onMouseUp:function(e){var t=E.get(this);t.pressed&&(this.hideHandleAndGuide(),t.pressed=!1,this.createPositionData(this.hot.countCols()),this.changeColumnPositions(t.startCol,t.endCol),h.hooks.run(this.hot,"beforeColumnMove",t.startCol,t.endCol),this.hot.forceFullRender=!0,this.hot.view.render(),this.saveManualColumnPositions(),h.hooks.run(this.hot,"afterColumnMove",t.startCol,t.endCol),this.setupHandlePosition(this.currentTH))},onModifyCol:function(e){return this.getLogicalColumnIndex(e)},onUnmodifyCol:function(e){return this.getVisibleColumnIndex(e)},onAfterRemoveCol:function(e,t){if(this.isEnabled()){var n,o=this.columnPositions;n=o.splice(e,t),o=b(o,function(e,t){var o=e;return y(n,function(t,n){e>t&&o--}),o}),this.columnPositions=o}},onAfterCreateCol:function(e,t){if(this.isEnabled()){var n=this.columnPositions;if(n.length){var o=[];C(0,t-1,function(t){o.push(e+t)}),e>=n.length?n=n.concat(o):(n=b(n,function(n,o){return n>=e?n+t:n}),n.splice.apply(n,[e,0].concat(o))),this.columnPositions=n}}},onInit:function(){this.completeSettingsArray()}},{},d),S("manualColumnMove",M),h.hooks.register("beforeColumnMove"),h.hooks.register("afterColumnMove"),h.hooks.register("unmodifyCol")},{"_base.js":61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/number":52,plugins:60}],93:[function(e,t,n){"use strict";Object.defineProperties(n,{ManualColumnResize:{get:function(){return S}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,h=(r=e("_base.js"),r&&r.__esModule&&r||{default:r}).default,f=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerHeight,v=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).eventManager,y=(a=e("helpers/dom/event"),a&&a.__esModule&&a||{default:a}),b=y.pageX,C=(y.pageY,(l=e("helpers/array"),l&&l.__esModule&&l||{default:l}).arrayEach),_=(u=e("helpers/number"),u&&u.__esModule&&u||{default:u}).rangeEach,R=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,S=function(e){$traceurRuntime.superConstructor(E).call(this,e),this.currentTH=null,this.currentCol=null,this.selectedCols=[],this.currentWidth=null,this.newSize=null,this.startY=null,this.startWidth=null,this.startOffset=null,this.handle=document.createElement("DIV"),this.guide=document.createElement("DIV"),this.eventManager=v(this),this.pressed=null,this.dblclick=0,this.autoresizeTimeout=null,this.manualColumnWidths=[],p(this.handle,"manualColumnResizer"),p(this.guide,"manualColumnResizerGuide")},E=S;$traceurRuntime.createClass(S,{isEnabled:function(){return this.hot.getSettings().manualColumnResize},enablePlugin:function(){var e=this;if(!this.enabled){this.manualColumnWidths=[];var t=this.hot.getSettings().manualColumnResize,n=this.loadManualColumnWidths();this.addHook("modifyColWidth",function(t,n){return e.onModifyColWidth(t,n)}),this.addHook("beforeStretchingColumnWidth",function(t,n){return e.onBeforeStretchingColumnWidth(t,n)}),this.addHook("beforeColumnResize",function(t,n,o){return e.onBeforeColumnResize(t,n,o)}),"undefined"!=typeof n?this.manualColumnWidths=n:Array.isArray(t)?this.manualColumnWidths=t:this.manualColumnWidths=[],d.hooks.register("beforeColumnResize"),d.hooks.register("afterColumnResize"),this.bindEvents(),$traceurRuntime.superGet(this,E.prototype,"enablePlugin").call(this)}},updatePlugin:function(){var e=this.hot.getSettings().manualColumnResize;Array.isArray(e)?this.manualColumnWidths=e:e||(this.manualColumnWidths=[])},disablePlugin:function(){$traceurRuntime.superGet(this,E.prototype,"disablePlugin").call(this)},saveManualColumnWidths:function(){this.hot.runHooks("persistentStateSave","manualColumnWidths",this.manualColumnWidths)},loadManualColumnWidths:function(){var e={};return this.hot.runHooks("persistentStateLoad","manualColumnWidths",e),e.value},setupHandlePosition:function(e){var t=this;if(!e.parentNode)return!1;this.currentTH=e;var n=this.hot.view.wt.wtTable.getCoords(e).col,o=w(this.currentTH);if(n>=0){var r=this.currentTH.getBoundingClientRect();if(this.currentCol=n,this.selectedCols=[],this.hot.selection.isSelected()&&this.hot.selection.selectedHeader.cols){var i=this.hot.getSelectedRange(),s=i.from,a=i.to,l=s.col,u=a.col;l>=u&&(l=a.col,u=s.col),this.currentCol>=l&&this.currentCol<=u?_(l,u,function(e){return t.selectedCols.push(e)}):this.selectedCols.push(this.currentCol)}else this.selectedCols.push(this.currentCol);this.startOffset=r.left-6,this.startWidth=parseInt(r.width,10),this.handle.style.top=r.top+"px",this.handle.style.left=this.startOffset+this.startWidth+"px",this.handle.style.height=o+"px",this.hot.rootElement.appendChild(this.handle)}},refreshHandlePosition:function(){this.handle.style.left=this.startOffset+this.currentWidth+"px"},setupGuidePosition:function(){var e=parseInt(w(this.handle),10),t=parseInt(this.handle.style.top,10)+e,n=parseInt(this.hot.view.maximumVisibleElementHeight(0),10);p(this.handle,"active"),p(this.guide,"active"),this.guide.style.top=t+"px",this.guide.style.left=this.handle.style.left,this.guide.style.height=n-e+"px",this.hot.rootElement.appendChild(this.guide)},refreshGuidePosition:function(){this.guide.style.left=this.handle.style.left},hideHandleAndGuide:function(){g(this.handle,"active"),g(this.guide,"active")},checkIfColumnHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return"THEAD"===t.tagName||this.checkIfColumnHeader(t)}return!1},getTHFromTargetElement:function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},onMouseOver:function(e){if(this.checkIfColumnHeader(e.target)){var t=this.getTHFromTargetElement(e.target);if(!t)return;var n=t.getAttribute("colspan");!t||null!==n&&1!==n||this.pressed||this.setupHandlePosition(t)}},afterMouseDownTimeout:function(){var e=this,t=function(){e.hot.forceFullRender=!0,e.hot.view.render(),e.hot.view.wt.wtOverlays.adjustElementsSize(!0)},n=function(n,o){var r=e.hot.runHooks("beforeColumnResize",n,e.newSize,!0);void 0!==r&&(e.newSize=r),"all"===e.hot.getSettings().stretchH?e.clearManualSize(n):e.setManualSize(n,e.newSize),o&&t(),e.saveManualColumnWidths(),e.hot.runHooks("afterColumnResize",n,e.newSize,!0)};if(this.dblclick>=2){var o=this.selectedCols.length;o>1?(C(this.selectedCols,function(e){n(e)}),t()):C(this.selectedCols,function(e){n(e,!0)})}this.dblclick=0,this.autoresizeTimeout=null},onMouseDown:function(e){var t=this;m(e.target,"manualColumnResizer")&&(this.setupGuidePosition(),this.pressed=this.hot,null===this.autoresizeTimeout&&(this.autoresizeTimeout=setTimeout(function(){return t.afterMouseDownTimeout()},500),this.hot._registerTimeout(this.autoresizeTimeout)),this.dblclick++,this.startX=b(e),this.newSize=this.startWidth)},onMouseMove:function(e){var t=this;this.pressed&&(this.currentWidth=this.startWidth+(b(e)-this.startX),C(this.selectedCols,function(e){t.newSize=t.setManualSize(e,t.currentWidth)}),this.refreshHandlePosition(),this.refreshGuidePosition())},onMouseUp:function(e){var t=this,n=function(){t.hot.forceFullRender=!0,t.hot.view.render(),t.hot.view.wt.wtOverlays.adjustElementsSize(!0)},o=function(e,o){t.hot.runHooks("beforeColumnResize",e,t.newSize),o&&n(),t.saveManualColumnWidths(),t.hot.runHooks("afterColumnResize",e,t.newSize)};if(this.pressed){if(this.hideHandleAndGuide(),this.pressed=!1,this.newSize!=this.startWidth){var r=this.selectedCols.length;r>1?(C(this.selectedCols,function(e){o(e)}),n()):C(this.selectedCols,function(e){o(e,!0)})}this.setupHandlePosition(this.currentTH)}},bindEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,"mouseover",function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,"mousedown",function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,"mousemove",function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,"mouseup",function(t){return e.onMouseUp(t)})},setManualSize:function(e,t){return t=Math.max(t,20),e=this.hot.runHooks("modifyCol",e),this.manualColumnWidths[e]=t,t},clearManualSize:function(e){e=this.hot.runHooks("modifyCol",e),this.manualColumnWidths[e]=void 0},onModifyColWidth:function(e,t){return this.enabled&&(t=this.hot.runHooks("modifyCol",t),this.hot.getSettings().manualColumnResize&&this.manualColumnWidths[t])?this.manualColumnWidths[t]:e},onBeforeStretchingColumnWidth:function(e,t){var n=this.manualColumnWidths[t];return void 0===n&&(n=e),n},onBeforeColumnResize:function(){this.hot.view.wt.wtViewport.hasOversizedColumnHeadersMarked={}}},{},h),R("manualColumnResize",S)},{"_base.js":61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/number":52,plugins:60}],94:[function(e,t,n){"use strict";Object.defineProperties(n,{ManualRowMove:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e("_base.js"),o&&o.__esModule&&o||{default:o}).default,h=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,f=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerWidth,v=(s=e("helpers/array"),s&&s.__esModule&&s||{default:s}),y=v.arrayEach,b=v.arrayMap,C=(a=e("helpers/number"),a&&a.__esModule&&a||{default:a}).rangeEach,_=(l=e("eventManager"),l&&l.__esModule&&l||{default:l}).eventManager,R=(u=e("helpers/dom/event"),u&&u.__esModule&&u||{default:u}).pageY,S=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,E=new WeakMap,M=function(e){$traceurRuntime.superConstructor(T).call(this,e),E.set(this,{guideClassName:"manualRowMoverGuide",handleClassName:"manualRowMover",startOffset:null,pressed:null,startRow:null,endRow:null,currentRow:null,startX:null,startY:null}),this.guideElement=null,this.handleElement=null,this.currentTH=null,this.rowPositions=[],this.eventManager=_(this)},T=M;$traceurRuntime.createClass(M,{isEnabled:function(){return!!this.hot.getSettings().manualRowMove},enablePlugin:function(){var e=this,t=E.get(this),n=this.hot.getSettings().manualRowMove,o=this.loadManualRowPositions();this.handleElement=document.createElement("DIV"),this.handleElement.className=t.handleClassName,this.guideElement=document.createElement("DIV"),this.guideElement.className=t.guideClassName,this.addHook("modifyRow",function(t){return e.onModifyRow(t)}),this.addHook("afterRemoveRow",function(t,n){return e.onAfterRemoveRow(t,n)}),this.addHook("afterCreateRow",function(t,n){return e.onAfterCreateRow(t,n)}),this.addHook("init",function(){return e.onInit()}),this.registerEvents(),"undefined"!=typeof o?this.rowPositions=o:Array.isArray(n)?this.rowPositions=n:n&&void 0!==this.rowPositions||(this.rowPositions=[]),$traceurRuntime.superGet(this,T.prototype,"enablePlugin").call(this)},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,T.prototype,"updatePlugin").call(this)},disablePlugin:function(){var e=this.hot.getSettings().manualRowMove;Array.isArray(e)&&(this.unregisterEvents(),this.rowPositions=[]),$traceurRuntime.superGet(this,T.prototype,"disablePlugin").call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,"mouseover",function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,"mousedown",function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,"mousemove",function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,"mouseup",function(t){return e.onMouseUp(t)})},unregisterEvents:function(){this.eventManager.clear()},saveManualRowPositions:function(){h.hooks.run(this.hot,"persistentStateSave","manualRowPositions",this.rowPositions)},loadManualRowPositions:function(){var e={};return h.hooks.run(this.hot,"persistentStateLoad","manualRowPositions",e),e.value},completeSettingsArray:function(){var e=this,t=this.hot.countRows();this.rowPositions.length!==t&&C(0,t-1,function(t){e.rowPositions.indexOf(t)===-1&&e.rowPositions.push(t)})},setupHandlePosition:function(e){this.currentTH=e;var t=E.get(this),n=this.hot.view.wt.wtTable.getCoords(e).row,o=w(this.currentTH);if(n>=0){var r=this.currentTH.getBoundingClientRect();t.currentRow=n,t.startOffset=r.top,this.handleElement.style.top=t.startOffset+"px",this.handleElement.style.left=r.left+"px",this.handleElement.style.width=o+"px",this.hot.rootElement.appendChild(this.handleElement)}},refreshHandlePosition:function(e,t){var n=e.getBoundingClientRect(),o=6;t>0?this.handleElement.style.top=n.top+n.height-o+"px":this.handleElement.style.top=n.top+"px"},setupGuidePosition:function(){var e=this.currentTH.getBoundingClientRect(),t=E.get(this),n=parseInt(w(this.handleElement),10),o=parseInt(this.handleElement.style.left,10)+n,r=parseInt(this.hot.view.maximumVisibleElementWidth(0),10);p(this.handleElement,"active"),p(this.guideElement,"active"),this.guideElement.style.height=e.height+"px",this.guideElement.style.width=r-n+"px",this.guideElement.style.top=t.startOffset+"px",this.guideElement.style.left=o+"px",this.hot.rootElement.appendChild(this.guideElement)},refreshGuidePosition:function(e){var t=E.get(this);this.guideElement.style.top=t.startOffset+e+"px"},hideHandleAndGuide:function(){g(this.handleElement,"active"),g(this.guideElement,"active")},checkRowHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return"TBODY"===t.tagName||this.checkRowHeader(t)}return!1},createPositionData:function(e){var t=this.rowPositions;t.length<e&&C(t.length,e-1,function(e){t[e]=e})},getTHFromTargetElement:function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},changeRowPositions:function(e,t){var n=Math.max(e,t);n>this.rowPositions.length-1&&this.createPositionData(n+1),this.rowPositions.splice(t,0,this.rowPositions.splice(e,1)[0])},getVisibleRowIndex:function(e){var t=this.rowPositions.indexOf(e);return t===-1?void 0:t},getLogicalRowIndex:function(e){return this.rowPositions[e]},onMouseOver:function(e){var t=E.get(this);if(this.checkRowHeader(e.target)){var n=this.getTHFromTargetElement(e.target);n&&(t.pressed?(t.endRow=this.hot.view.wt.wtTable.getCoords(n).row,this.refreshHandlePosition(n,t.endRow-t.startRow)):this.setupHandlePosition(n))}},onMouseDown:function(e){var t=E.get(this);m(e.target,t.handleClassName)&&(t.startY=R(e),this.setupGuidePosition(),t.pressed=this.hot,t.startRow=t.currentRow,t.endRow=t.currentRow)},onMouseMove:function(e){var t=E.get(this);t.pressed&&this.refreshGuidePosition(R(e)-t.startY)},onMouseUp:function(e){var t=E.get(this);t.pressed&&(this.hideHandleAndGuide(),t.pressed=!1,this.createPositionData(this.hot.countRows()),this.changeRowPositions(t.startRow,t.endRow),h.hooks.run(this.hot,"beforeRowMove",t.startRow,t.endRow),this.hot.forceFullRender=!0,this.hot.view.render(),this.saveManualRowPositions(),h.hooks.run(this.hot,"afterRowMove",t.startRow,t.endRow),this.setupHandlePosition(this.currentTH))},onModifyRow:function(e){return this.getLogicalRowIndex(e)},onAfterRemoveRow:function(e,t){if(this.isEnabled()){var n,o=this.rowPositions;n=o.splice(e,t),o=b(o,function(e,t){var o=e;return y(n,function(t,n){e>t&&o--}),o}),this.rowPositions=o}},onAfterCreateRow:function(e,t){if(this.isEnabled()){var n=this.rowPositions;if(n.length){for(var o=[],r=0;r<t;r++)o.push(e+r);e>=n.length?n=n.concat(o):(n=b(n,function(n,o){return n>=e?n+t:n}),n.splice.apply(n,[e,0].concat(o))),this.rowPositions=n}}},onInit:function(){this.completeSettingsArray()}},{},d),S("ManualRowMove",M),h.hooks.register("beforeRowMove"),h.hooks.register("afterRowMove")},{"_base.js":61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/number":52,plugins:60}],95:[function(e,t,n){"use strict";Object.defineProperties(n,{ManualRowResize:{get:function(){return S}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,h=(r=e("_base.js"),r&&r.__esModule&&r||{default:r}).default,f=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerWidth,v=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).eventManager,y=(a=e("helpers/dom/event"),a&&a.__esModule&&a||{default:a}),b=(y.pageX,y.pageY),C=(l=e("helpers/array"),l&&l.__esModule&&l||{default:l}).arrayEach,_=(u=e("helpers/number"),u&&u.__esModule&&u||{default:u}).rangeEach,R=(c=e("plugins"),c&&c.__esModule&&c||{default:c}).registerPlugin,S=function(e){$traceurRuntime.superConstructor(E).call(this,e),this.currentTH=null,this.currentRow=null,this.selectedRows=[],this.currentHeight=null,this.newSize=null,this.startY=null,this.startHeight=null,this.startOffset=null,this.handle=document.createElement("DIV"),this.guide=document.createElement("DIV"),this.eventManager=v(this),this.pressed=null,this.dblclick=0,this.autoresizeTimeout=null,this.manualRowHeights=[],p(this.handle,"manualRowResizer"),p(this.guide,"manualRowResizerGuide")},E=S;$traceurRuntime.createClass(S,{isEnabled:function(){return this.hot.getSettings().manualRowResize},enablePlugin:function(){var e=this;if(!this.enabled){this.manualRowHeights=[];var t=this.hot.getSettings().manualRowResize,n=this.loadManualRowHeights();"undefined"!=typeof n?this.manualRowHeights=n:Array.isArray(t)?this.manualRowHeights=t:this.manualRowHeights=[],this.addHook("modifyRowHeight",function(t,n){return e.onModifyRowHeight(t,n)}),d.hooks.register("beforeRowResize"),d.hooks.register("afterRowResize"),this.bindEvents(),$traceurRuntime.superGet(this,E.prototype,"enablePlugin").call(this)}},updatePlugin:function(){var e=this.hot.getSettings().manualRowResize;Array.isArray(e)?this.manualRowHeights=e:e||(this.manualRowHeights=[])},disablePlugin:function(){$traceurRuntime.superGet(this,E.prototype,"disablePlugin").call(this)},saveManualRowHeights:function(){this.hot.runHooks("persistentStateSave","manualRowHeights",this.manualRowHeights)},loadManualRowHeights:function(){var e={};return this.hot.runHooks("persistentStateLoad","manualRowHeights",e),e.value},setupHandlePosition:function(e){var t=this;this.currentTH=e;var n=this.hot.view.wt.wtTable.getCoords(e).row,o=w(this.currentTH);if(n>=0){var r=this.currentTH.getBoundingClientRect();if(this.currentRow=n,this.selectedRows=[],this.hot.selection.isSelected()&&this.hot.selection.selectedHeader.rows){var i=this.hot.getSelectedRange(),s=i.from,a=i.to,l=s.row,u=a.row;l>=u&&(l=a.row,u=s.row),this.currentRow>=l&&this.currentRow<=u?_(l,u,function(e){return t.selectedRows.push(e)}):this.selectedRows.push(this.currentRow)}else this.selectedRows.push(this.currentRow);this.startOffset=r.top-6,this.startHeight=parseInt(r.height,10),this.handle.style.left=r.left+"px",this.handle.style.top=this.startOffset+this.startHeight+"px",this.handle.style.width=o+"px",this.hot.rootElement.appendChild(this.handle)}},refreshHandlePosition:function(){this.handle.style.top=this.startOffset+this.currentHeight+"px"},setupGuidePosition:function(){var e=parseInt(w(this.handle),10),t=parseInt(this.handle.style.left,10)+e,n=parseInt(this.hot.view.maximumVisibleElementWidth(0),10);p(this.handle,"active"),p(this.guide,"active"),this.guide.style.top=this.handle.style.top,this.guide.style.left=t+"px",this.guide.style.width=n-e+"px",this.hot.rootElement.appendChild(this.guide)},refreshGuidePosition:function(){this.guide.style.top=this.handle.style.top},hideHandleAndGuide:function(){g(this.handle,"active"),g(this.guide,"active")},checkIfRowHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return"TBODY"===t.tagName||this.checkIfRowHeader(t)}return!1},getTHFromTargetElement:function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},onMouseOver:function(e){if(this.checkIfRowHeader(e.target)){var t=this.getTHFromTargetElement(e.target);t&&(this.pressed||this.setupHandlePosition(t))}},afterMouseDownTimeout:function(){var e=this,t=function(){e.hot.forceFullRender=!0,e.hot.view.render(),e.hot.view.wt.wtOverlays.adjustElementsSize(!0)},n=function(n,o){var r=e.hot.runHooks("beforeRowResize",n,e.newSize,!0);void 0!==r&&(e.newSize=r),e.setManualSize(n,e.newSize),o&&t(),e.hot.runHooks("afterRowResize",n,e.newSize,!0)};if(this.dblclick>=2){var o=this.selectedRows.length;o>1?(C(this.selectedRows,function(e){n(e)}),t()):C(this.selectedRows,function(e){n(e,!0)})}this.dblclick=0,this.autoresizeTimeout=null},onMouseDown:function(e){var t=this;m(e.target,"manualRowResizer")&&(this.setupGuidePosition(),this.pressed=this.hot,null==this.autoresizeTimeout&&(this.autoresizeTimeout=setTimeout(function(){return t.afterMouseDownTimeout()},500),this.hot._registerTimeout(this.autoresizeTimeout)),this.dblclick++,this.startY=b(e),this.newSize=this.startHeight)},onMouseMove:function(e){var t=this;this.pressed&&(this.currentHeight=this.startHeight+(b(e)-this.startY),C(this.selectedRows,function(e){t.newSize=t.setManualSize(e,t.currentHeight)}),this.refreshHandlePosition(),this.refreshGuidePosition())},onMouseUp:function(e){var t=this,n=function(){t.hot.forceFullRender=!0,t.hot.view.render(),t.hot.view.wt.wtOverlays.adjustElementsSize(!0)},o=function(e,o){t.hot.runHooks("beforeRowResize",e,t.newSize),o&&n(),t.saveManualRowHeights(),t.hot.runHooks("afterRowResize",e,t.newSize)};if(this.pressed){if(this.hideHandleAndGuide(),this.pressed=!1,this.newSize!=this.startHeight){var r=this.selectedRows.length;r>1?(C(this.selectedRows,function(e){o(e)}),n()):C(this.selectedRows,function(e){o(e,!0)})}this.setupHandlePosition(this.currentTH)}},bindEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,"mouseover",function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,"mousedown",function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,"mousemove",function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,"mouseup",function(t){return e.onMouseUp(t)})},setManualSize:function(e,t){return e=this.hot.runHooks("modifyRow",e),this.manualRowHeights[e]=t,t},onModifyRowHeight:function(e,t){if(this.enabled){var n=this.hot.getPlugin("autoRowSize"),o=n?n.heights[t]:null;t=this.hot.runHooks("modifyRow",t);var r=this.manualRowHeights[t];if(void 0!==r&&(r===o||r>(e||0)))return r}return e}},{},h),R("manualRowResize",S)},{"_base.js":61,browser:24,eventManager:42,"helpers/array":43,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/number":52,plugins:60}],96:[function(e,t,n){"use strict";function o(){var e=[];return e.getInfo=function(e,t){for(var n=0,o=this.length;n<o;n++)if(this[n].row<=e&&this[n].row+this[n].rowspan-1>=e&&this[n].col<=t&&this[n].col+this[n].colspan-1>=t)return this[n]},e.setInfo=function(e){for(var t=0,n=this.length;t<n;t++)if(this[t].row===e.row&&this[t].col===e.col)return void(this[t]=e);this.push(e)},e.removeInfo=function(e,t){for(var n=0,o=this.length;n<o;n++)if(this[n].row===e&&this[n].col===t){this.splice(n,1);break}},e}function r(e){if(this.mergedCellInfoCollection=new o,Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.mergedCellInfoCollection.setInfo(e[t])}function i(e,t){var n=this.getSettings().mergeCells;if(n&&!this.selection.isMultiple()){var o=this.mergeCells.mergedCellInfoCollection.getInfo(e[0],e[1]);o&&(e[0]=o.row,e[1]=o.col,e[2]=o.row+o.rowspan-1,e[3]=o.col+o.colspan-1)}}function s(e,t){this.mergeCells&&this.mergeCells.shiftCollection("right",e,t)}function a(e,t){this.mergeCells&&this.mergeCells.shiftCollection("left",e,t)}function l(e,t){this.mergeCells&&this.mergeCells.shiftCollection("down",e,t)}function u(e,t){this.mergeCells&&this.mergeCells.shiftCollection("up",e,t)}Object.defineProperties(n,{MergeCells:{get:function(){return r}},__esModule:{value:!0}});var c,d,h,f,p,m,g=(c=e("browser"),c&&c.__esModule&&c||{default:c}).default,w=((d=e("plugins"),d&&d.__esModule&&d||{default:d}).registerPlugin,(h=e("helpers/dom/event"),h&&h.__esModule&&h||{default:h}).stopImmediatePropagation),v=(f=e("3rdparty/walkontable/src/cell/coords"),f&&f.__esModule&&f||{default:f}).WalkontableCellCoords,y=(p=e("3rdparty/walkontable/src/cell/range"),p&&p.__esModule&&p||{default:p}).WalkontableCellRange,b=(m=e("3rdparty/walkontable/src/table"),m&&m.__esModule&&m||{default:m}).WalkontableTable;r.prototype.canMergeRange=function(e){return!e.isSingle()},r.prototype.mergeRange=function(e){if(this.canMergeRange(e)){var t=e.getTopLeftCorner(),n=e.getBottomRightCorner(),o={};o.row=t.row,o.col=t.col,o.rowspan=n.row-t.row+1,o.colspan=n.col-t.col+1,this.mergedCellInfoCollection.setInfo(o)}},r.prototype.mergeOrUnmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.from.row,e.from.col);t?this.unmergeSelection(e.from):this.mergeSelection(e)},r.prototype.mergeSelection=function(e){this.mergeRange(e)},r.prototype.unmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.row,e.col);this.mergedCellInfoCollection.removeInfo(t.row,t.col)},r.prototype.applySpanProperties=function(e,t,n){var o=this.mergedCellInfoCollection.getInfo(t,n);o?o.row===t&&o.col===n?(e.setAttribute("rowspan",o.rowspan),e.setAttribute("colspan",o.colspan)):(e.removeAttribute("rowspan"),e.removeAttribute("colspan"),e.style.display="none"):(e.removeAttribute("rowspan"),e.removeAttribute("colspan"))},r.prototype.modifyTransform=function(e,t,n){var o=function(e,t){return t.row>=e.row&&t.row<=e.row+e.rowspan-1},r=function(e,t){return t.col>=e.col&&t.col<=e.col+e.colspan-1},i=function(e){return new v(t.to.row+e.row,t.to.col+e.col)},s={row:n.row,col:n.col};if("modifyTransformStart"==e){this.lastDesiredCoords||(this.lastDesiredCoords=new v(null,null));for(var a,l=new v(t.highlight.row,t.highlight.col),u=this.mergedCellInfoCollection.getInfo(l.row,l.col),c=0,d=this.mergedCellInfoCollection.length;c<d;c++){var h=this.mergedCellInfoCollection[c];if(h=new v(h.row+h.rowspan-1,h.col+h.colspan-1),t.includes(h)){a=!0;break}}if(u){var f=new v(u.row,u.col),p=new v(u.row+u.rowspan-1,u.col+u.colspan-1),m=new y(f,f,p);m.includes(this.lastDesiredCoords)||(this.lastDesiredCoords=new v(null,null)),s.row=this.lastDesiredCoords.row?this.lastDesiredCoords.row-l.row:s.row,s.col=this.lastDesiredCoords.col?this.lastDesiredCoords.col-l.col:s.col,n.row>0?s.row=u.row+u.rowspan-1-l.row+n.row:n.row<0&&(s.row=l.row-u.row+n.row),n.col>0?s.col=u.col+u.colspan-1-l.col+n.col:n.col<0&&(s.col=l.col-u.col+n.col)}var g=new v(t.highlight.row+s.row,t.highlight.col+s.col),w=this.mergedCellInfoCollection.getInfo(g.row,g.col);w&&(this.lastDesiredCoords=g,s={row:w.row-l.row,col:w.col-l.col})}else if("modifyTransformEnd"==e)for(var c=0,d=this.mergedCellInfoCollection.length;c<d;c++){var b=this.mergedCellInfoCollection[c],f=new v(b.row,b.col),p=new v(b.row+b.rowspan-1,b.col+b.colspan-1),C=new y(f,f,p),_=t.getBordersSharedWith(C);if(C.isEqual(t))t.setDirection("NW-SE");else if(_.length>0){var R=t.highlight.isEqual(C.from);_.indexOf("top")>-1?t.to.isSouthEastOf(C.from)&&R?t.setDirection("NW-SE"):t.to.isSouthWestOf(C.from)&&R&&t.setDirection("NE-SW"):_.indexOf("bottom")>-1&&(t.to.isNorthEastOf(C.from)&&R?t.setDirection("SW-NE"):t.to.isNorthWestOf(C.from)&&R&&t.setDirection("SE-NW"))}var g=i(s),S=o(b,g),E=r(b,g);t.includesRange(C)&&(C.includes(g)||S||E)&&(S&&(s.row<0?s.row-=b.rowspan-1:s.row>0&&(s.row+=b.rowspan-1)),E&&(s.col<0?s.col-=b.colspan-1:s.col>0&&(s.col+=b.colspan-1)))}0!==s.row&&(n.row=s.row),0!==s.col&&(n.col=s.col)},r.prototype.shiftCollection=function(e,t,n){var o=[0,0];switch(e){case"right":o[0]+=1;break;case"left":o[0]-=1;break;case"down":o[1]+=1;break;case"up":o[1]-=1}for(var r=0;r<this.mergedCellInfoCollection.length;r++){var i=this.mergedCellInfoCollection[r];"right"===e||"left"===e?t<=i.col&&(i.col+=o[0]):t<=i.row&&(i.row+=o[1])}};var C=function(){var e=this,t=e.getSettings().mergeCells;t&&(e.mergeCells||(e.mergeCells=new r(t)))},_=function(){var e=this;e.mergeCells&&(e.view.wt.wtTable.getCell=function(t){if(e.getSettings().mergeCells){var n=e.mergeCells.mergedCellInfoCollection.getInfo(t.row,t.col);n&&(t=n)}return b.prototype.getCell.call(this,t)})},R=function(){var e=this,t=e.getSettings().mergeCells;if(t)if(e.mergeCells){if(e.mergeCells.mergedCellInfoCollection=new o,Array.isArray(t))for(var n=0,i=t.length;n<i;n++)e.mergeCells.mergedCellInfoCollection.setInfo(t[n])}else e.mergeCells=new r(t);else e.mergeCells&&(e.mergeCells.mergedCellInfoCollection=new o);
+},S=function(e){if(this.mergeCells){var t=(e.ctrlKey||e.metaKey)&&!e.altKey;t&&77===e.keyCode&&(this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render(),w(e))}},E=function(e){this.getSettings().mergeCells&&(e.items.push(g.plugins.ContextMenu.SEPARATOR),e.items.push({key:"mergeCells",name:function(){var e=this.getSelected(),t=this.mergeCells.mergedCellInfoCollection.getInfo(e[0],e[1]);return t?"Unmerge cells":"Merge cells"},callback:function(){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render()},disabled:function(){return this.selection.selectedHeader.corner}}))},M=function(e,t,n,o,r,i){this.mergeCells&&this.mergeCells.applySpanProperties(e,t,n)},T=function(e){return function(t){var n=this.getSettings().mergeCells;if(n){var o=this.getSelectedRange();if(this.mergeCells.modifyTransform(e,o,t),"modifyTransformEnd"===e){var r=this.countRows(),i=this.countCols();o.from.row<0?o.from.row=0:o.from.row>0&&o.from.row>=r&&(o.from.row=o.from-1),o.from.col<0?o.from.col=0:o.from.col>0&&o.from.col>=i&&(o.from.col=i-1)}}}},O=function(e){this.lastDesiredCoords=null;var t=this.getSettings().mergeCells;if(t){var n=this.getSelectedRange();n.highlight=new v(n.highlight.row,n.highlight.col),n.to=e;var o=!1;do{o=!1;for(var r=0,i=this.mergeCells.mergedCellInfoCollection.length;r<i;r++){var s=this.mergeCells.mergedCellInfoCollection[r],a=new v(s.row,s.col),l=new v(s.row+s.rowspan-1,s.col+s.colspan-1),u=new y(a,a,l);n.expandByRange(u)&&(e.row=n.to.row,e.col=n.to.col,o=!0)}}while(o)}},k=function(e,t){if(t&&"area"==t){var n=this.getSettings().mergeCells;if(n)for(var o=this.getSelectedRange(),r=new y(o.from,o.from,o.from),i=new y(o.to,o.to,o.to),s=0,a=this.mergeCells.mergedCellInfoCollection.length;s<a;s++){var l=this.mergeCells.mergedCellInfoCollection[s],u=new v(l.row,l.col),c=new v(l.row+l.rowspan-1,l.col+l.colspan-1),d=new y(u,u,c);r.expandByRange(d)&&(e[0]=r.from.row,e[1]=r.from.col),i.expandByRange(d)&&(e[2]=i.from.row,e[3]=i.from.col)}}},x=function(e,t,n){var o=this.getSettings().mergeCells;if(o){var r=this.mergeCells.mergedCellInfoCollection.getInfo(e,t);!r||r.row==e&&r.col==t||(n.copyable=!1)}},H=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countCols(),r=0;r<o;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.startRow,r),n&&n.row<e.startRow)return e.startRow=n.row,H.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.endRow,r)){var i=n.row+n.rowspan-1;if(i>e.endRow)return e.endRow=i,H.call(this,e)}}},D=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countRows(),r=0;r<o;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.startColumn),n&&n.col<e.startColumn)return e.startColumn=n.col,D.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.endColumn)){var i=n.col+n.colspan-1;if(i>e.endColumn)return e.endColumn=i,D.call(this,e)}}},A=function(e){if(e&&this.mergeCells){var t=this.mergeCells.mergedCellInfoCollection,n=this.getSelectedRange();for(var o in t)if(n.highlight.row==t[o].row&&n.highlight.col==t[o].col&&n.to.row==t[o].row+t[o].rowspan-1&&n.to.col==t[o].col+t[o].colspan-1)return!1}return e};g.hooks.add("beforeInit",C),g.hooks.add("afterInit",_),g.hooks.add("afterUpdateSettings",R),g.hooks.add("beforeKeyDown",S),g.hooks.add("modifyTransformStart",T("modifyTransformStart")),g.hooks.add("modifyTransformEnd",T("modifyTransformEnd")),g.hooks.add("beforeSetRangeEnd",O),g.hooks.add("beforeDrawBorders",k),g.hooks.add("afterIsMultipleSelection",A),g.hooks.add("afterRenderer",M),g.hooks.add("afterContextMenuDefaultOptions",E),g.hooks.add("afterGetCellMeta",x),g.hooks.add("afterViewportRowCalculatorOverride",H),g.hooks.add("afterViewportColumnCalculatorOverride",D),g.hooks.add("afterAutofillApplyValues",i),g.hooks.add("afterCreateCol",s),g.hooks.add("afterRemoveCol",a),g.hooks.add("afterCreateRow",l),g.hooks.add("afterRemoveRow",u),g.MergeCells=r},{"3rdparty/walkontable/src/cell/coords":6,"3rdparty/walkontable/src/cell/range":7,"3rdparty/walkontable/src/table":21,browser:24,"helpers/dom/event":48,plugins:60}],97:[function(e,t,n){"use strict";Object.defineProperties(n,{MultipleSelectionHandles:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l,u=((o=e("browser"),o&&o.__esModule&&o||{default:o}).default,r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),c=u.getWindowScrollTop,d=u.hasClass,h=u.getWindowScrollLeft,f=(i=e("helpers/browser"),i&&i.__esModule&&i||{default:i}).isMobileBrowser,p=(s=e("_base"),s&&s.__esModule&&s||{default:s}).default,m=(a=e("eventManager"),a&&a.__esModule&&a||{default:a}).EventManager,g=(l=e("plugins"),l&&l.__esModule&&l||{default:l}).registerPlugin,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.dragged=[],this.eventManager=null,this.lastSetCell=null},v=w;$traceurRuntime.createClass(w,{isEnabled:function(){return f()},enablePlugin:function(){this.enabled||(this.eventManager||(this.eventManager=new m(this)),this.registerListeners(),$traceurRuntime.superGet(this,v.prototype,"enablePlugin").call(this))},registerListeners:function(){function e(e){if(1===t.dragged.length)return t.dragged.splice(0,t.dragged.length),!0;var n=t.dragged.indexOf(e);return n!=-1&&void(0===n?t.dragged=t.dragged.slice(0,1):1==n&&(t.dragged=t.dragged.slice(-1)))}var t=this;this.eventManager.addEventListener(this.hot.rootElement,"touchstart",function(e){var n;return d(e.target,"topLeftSelectionHandle-HitArea")?(n=t.hot.getSelectedRange(),t.dragged.push("topLeft"),t.touchStartRange={width:n.getWidth(),height:n.getHeight(),direction:n.getDirection()},e.preventDefault(),!1):d(e.target,"bottomRightSelectionHandle-HitArea")?(n=t.hot.getSelectedRange(),t.dragged.push("bottomRight"),t.touchStartRange={width:n.getWidth(),height:n.getHeight(),direction:n.getDirection()},e.preventDefault(),!1):void 0}),this.eventManager.addEventListener(this.hot.rootElement,"touchend",function(n){return d(n.target,"topLeftSelectionHandle-HitArea")?(e.call(t,"topLeft"),t.touchStartRange=void 0,n.preventDefault(),!1):d(n.target,"bottomRightSelectionHandle-HitArea")?(e.call(t,"bottomRight"),t.touchStartRange=void 0,n.preventDefault(),!1):void 0}),this.eventManager.addEventListener(this.hot.rootElement,"touchmove",function(e){var n,o,r,i,s,a,l,u=c(),d=h();0!==t.dragged.length&&(n=document.elementFromPoint(e.touches[0].screenX-d,e.touches[0].screenY-u),n&&n!==t.lastSetCell&&("TD"!=n.nodeName&&"TH"!=n.nodeName||(o=t.hot.getCoords(n),o.col==-1&&(o.col=0),r=t.hot.getSelectedRange(),i=r.getWidth(),s=r.getHeight(),a=r.getDirection(),1==i&&1==s&&t.hot.selection.setRangeEnd(o),l=t.getCurrentRangeCoords(r,o,t.touchStartRange.direction,a,t.dragged[0]),null!==l.start&&t.hot.selection.setRangeStart(l.start),t.hot.selection.setRangeEnd(l.end),t.lastSetCell=n),e.preventDefault()))})},getCurrentRangeCoords:function(e,t,n,o,r){var i=e.getTopLeftCorner(),s=e.getBottomRightCorner(),a=e.getBottomLeftCorner(),l=e.getTopRightCorner(),u={start:null,end:null};switch(n){case"NE-SW":switch(o){case"NE-SW":case"NW-SE":u="topLeft"==r?{start:new WalkontableCellCoords(t.row,e.highlight.col),end:new WalkontableCellCoords(a.row,t.col)}:{start:new WalkontableCellCoords(e.highlight.row,t.col),end:new WalkontableCellCoords(t.row,i.col)};break;case"SE-NW":"bottomRight"==r&&(u={start:new WalkontableCellCoords(s.row,t.col),end:new WalkontableCellCoords(t.row,i.col)})}break;case"NW-SE":switch(o){case"NE-SW":"topLeft"==r?u={start:t,end:a}:u.end=t;break;case"NW-SE":"topLeft"==r?u={start:t,end:s}:u.end=t;break;case"SE-NW":"topLeft"==r?u={start:t,end:i}:u.end=t;break;case"SW-NE":"topLeft"==r?u={start:t,end:l}:u.end=t}break;case"SW-NE":switch(o){case"NW-SE":u="bottomRight"==r?{start:new WalkontableCellCoords(t.row,i.col),end:new WalkontableCellCoords(a.row,t.col)}:{start:new WalkontableCellCoords(i.row,t.col),end:new WalkontableCellCoords(t.row,s.col)};break;case"SW-NE":u="topLeft"==r?{start:new WalkontableCellCoords(e.highlight.row,t.col),end:new WalkontableCellCoords(t.row,s.col)}:{start:new WalkontableCellCoords(t.row,i.col),end:new WalkontableCellCoords(i.row,t.col)};break;case"SE-NW":"bottomRight"==r?u={start:new WalkontableCellCoords(t.row,l.col),end:new WalkontableCellCoords(i.row,t.col)}:"topLeft"==r&&(u={start:a,end:t})}break;case"SE-NW":switch(o){case"NW-SE":case"NE-SW":case"SW-NE":"topLeft"==r&&(u.end=t);break;case"SE-NW":"topLeft"==r?u.end=t:u={start:t,end:i}}}return u},isDragged:function(){return this.dragged.length>0}},{},p),g("multipleSelectionHandles",w)},{_base:61,browser:24,eventManager:42,"helpers/browser":44,"helpers/dom/element":47,plugins:60}],98:[function(e,t,n){"use strict";Object.defineProperties(n,{DataObserver:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=(o=e("jsonpatch"),o&&o.__esModule&&o||{default:o}).default,l=(r=e("../../mixins/localHooks"),r&&r.__esModule&&r||{default:r}).localHooks,u=(i=e("../../helpers/object"),i&&i.__esModule&&i||{default:i}).mixin,c=(s=e("utils"),s&&s.__esModule&&s||{default:s}).cleanPatches,d=function(e){this.observedData=null,this.observer=null,this.paused=!1,this.setObservedData(e)};$traceurRuntime.createClass(d,{setObservedData:function(e){var t=this;this.observer&&a.unobserve(this.observedData,this.observer),this.observedData=e,this.observer=a.observe(this.observedData,function(e){return t.onChange(e)})},isPaused:function(){return this.paused},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onChange:function(e){this.runLocalHooks("change",c(e))},destroy:function(){a.unobserve(this.observedData,this.observer),this.observedData=null,this.observer=null}},{}),u(d,l)},{"../../helpers/object":53,"../../mixins/localHooks":57,jsonpatch:"jsonpatch",utils:100}],99:[function(e,t,n){"use strict";Object.defineProperties(n,{ObserveChanges:{get:function(){return p}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,c=(r=e("_base"),r&&r.__esModule&&r||{default:r}).default,d=((i=e("jsonpatch"),i&&i.__esModule&&i||{default:i}).default,(s=e("dataObserver"),s&&s.__esModule&&s||{default:s}).DataObserver),h=(a=e("helpers/array"),a&&a.__esModule&&a||{default:a}).arrayEach,f=(l=e("plugins"),l&&l.__esModule&&l||{default:l}).registerPlugin;u.hooks.register("afterChangesObserved");var p=function(e){$traceurRuntime.superConstructor(m).call(this,e),this.observer=null},m=p;$traceurRuntime.createClass(p,{isEnabled:function(){return this.hot.getSettings().observeChanges},enablePlugin:function(){var e=this;this.enabled||(this.observer||(this.observer=new d(this.hot.getSourceData()),this._exposePublicApi()),this.observer.addLocalHook("change",function(t){return e.onDataChange(t)}),this.addHook("afterCreateRow",function(){return e.onAfterTableAlter()}),this.addHook("afterRemoveRow",function(){return e.onAfterTableAlter()}),this.addHook("afterCreateCol",function(){return e.onAfterTableAlter()}),this.addHook("afterRemoveCol",function(){return e.onAfterTableAlter()}),this.addHook("afterChange",function(t,n){return e.onAfterTableAlter(n)}),this.addHook("afterLoadData",function(t){return e.onAfterLoadData(t)}),$traceurRuntime.superGet(this,m.prototype,"enablePlugin").call(this))},disablePlugin:function(){this.observer&&(this.observer.destroy(),this.observer=null,this._deletePublicApi()),$traceurRuntime.superGet(this,m.prototype,"disablePlugin").call(this)},onDataChange:function(e){var t=this;if(!this.observer.isPaused()){var n={add:function(e){isNaN(e.col)?t.hot.runHooks("afterCreateRow",e.row):t.hot.runHooks("afterCreateCol",e.col)},remove:function(e){isNaN(e.col)?t.hot.runHooks("afterRemoveRow",e.row,1):t.hot.runHooks("afterRemoveCol",e.col,1)},replace:function(e){t.hot.runHooks("afterChange",[e.row,e.col,null,e.value],"external")}};h(e,function(e){n[e.op]&&n[e.op](e)}),this.hot.render()}this.hot.runHooks("afterChangesObserved")},onAfterTableAlter:function(e){var t=this;"loadData"!==e&&(this.observer.pause(),this.hot.addHookOnce("afterChangesObserved",function(){return t.observer.resume()}))},onAfterLoadData:function(e){e||this.observer.setObservedData(this.hot.getSourceData())},destroy:function(){this.observer&&(this.observer.destroy(),this._deletePublicApi()),$traceurRuntime.superGet(this,m.prototype,"destroy").call(this)},_exposePublicApi:function(){var e=this,t=this.hot;t.pauseObservingChanges=function(){return e.observer.pause()},t.resumeObservingChanges=function(){return e.observer.resume()},t.isPausedObservingChanges=function(){return e.observer.isPaused()}},_deletePublicApi:function(){var e=this.hot;delete e.pauseObservingChanges,delete e.resumeObservingChanges,delete e.isPausedObservingChanges}},{},c),f("observeChanges",p)},{_base:61,browser:24,dataObserver:98,"helpers/array":43,jsonpatch:"jsonpatch",plugins:60}],100:[function(e,t,n){"use strict";function o(e){var t=[];return e=a(e,function(e){return!/[\/]length/gi.test(e.path)&&!!r(e.path)}),e=l(e,function(e){var t=r(e.path);return e.row=t.row,e.col=t.col,e}),e=a(e,function(e){if(["add","remove"].indexOf(e.op)!==-1&&!isNaN(e.col)){if(t.indexOf(e.col)!==-1)return!1;t.push(e.col)}return!0}),t.length=0,e}function r(e){var t=e.match(/^\/(\d+)\/?(.*)?$/);if(!t)return null;var n=t,o=n[1],r=n[2];return{row:parseInt(o,10),col:/^\d*$/.test(r)?parseInt(r,10):r}}Object.defineProperties(n,{cleanPatches:{get:function(){return o}},parsePath:{get:function(){return r}},__esModule:{value:!0}});var i,s=(i=e("../../helpers/array"),i&&i.__esModule&&i||{default:i}),a=s.arrayFilter,l=s.arrayMap},{"../../helpers/array":43}],101:[function(e,t,n){"use strict";function o(e){var t,n=function(){window.localStorage[e+"__persistentStateKeys"]=JSON.stringify(t)},o=function(){var n=window.localStorage[e+"__persistentStateKeys"],o="string"==typeof n?JSON.parse(n):void 0;t=o?o:[]},r=function(){t=[],n()};o(),this.saveValue=function(o,r){window.localStorage[e+"_"+o]=JSON.stringify(r),t.indexOf(o)==-1&&(t.push(o),n())},this.loadValue=function(t,n){t="undefined"==typeof t?n:t;var o=window.localStorage[e+"_"+t];return"undefined"==typeof o?void 0:JSON.parse(o)},this.reset=function(t){window.localStorage.removeItem(e+"_"+t)},this.resetAll=function(){for(var n=0;n<t.length;n++)window.localStorage.removeItem(e+"_"+t[n]);r()}}function r(){function e(){var e=this;for(var t in r)r.hasOwnProperty(t)&&e.addHook(t,r[t])}function t(){var e=this;for(var t in r)r.hasOwnProperty(t)&&e.removeHook(t,r[t])}var n=this;this.init=function(){var r=this,i=r.getSettings().persistentState;return n.enabled=!!i,n.enabled?(r.storage||(r.storage=new o(r.rootElement.id)),r.resetState=n.resetValue,void e.call(r)):void t.call(r)},this.saveValue=function(e,t){var n=this;n.storage.saveValue(e,t)},this.loadValue=function(e,t){var n=this;t.value=n.storage.loadValue(e)},this.resetValue=function(e){var t=this;"undefined"==typeof e?t.storage.resetAll():t.storage.reset(e)};var r={persistentStateSave:n.saveValue,persistentStateLoad:n.loadValue,persistentStateReset:n.resetValue};for(var i in r)r.hasOwnProperty(i)&&a.hooks.register(i)}Object.defineProperties(n,{HandsontablePersistentState:{get:function(){return r}},__esModule:{value:!0}});var i,s,a=(i=e("browser"),i&&i.__esModule&&i||{default:i}).default,l=((s=e("plugins"),s&&s.__esModule&&s||{default:s}).registerPlugin,new r);a.hooks.add("beforeInit",l.init),a.hooks.add("afterUpdateSettings",l.init)},{browser:24,plugins:60}],102:[function(e,t,n){"use strict";function o(){var e=this,t=!!e.getSettings().search;t?e.search=new a.Search(e):delete e.search}var r,i,s,a=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,l=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),u=l.addClass,c=l.removeClass,d=(s=e("renderers"),s&&s.__esModule&&s||{default:s}),h=d.registerRenderer,f=d.getRenderer;a.Search=function(e){this.query=function(t,n,o){var r=e.countRows(),i=e.countCols(),s=[];n||(n=a.Search.global.getDefaultCallback()),o||(o=a.Search.global.getDefaultQueryMethod());for(var l=0;l<r;l++)for(var u=0;u<i;u++){var c=e.getDataAtCell(l,u),d=e.getCellMeta(l,u),h=d.search.callback||n,f=d.search.queryMethod||o,p=f(t,c);if(p){var m={row:l,col:u,data:c};s.push(m)}h&&h(e,l,u,c,p)}return s}},a.Search.DEFAULT_CALLBACK=function(e,t,n,o,r){e.getCellMeta(t,n).isSearchResult=r},a.Search.DEFAULT_QUERY_METHOD=function(e,t){return!("undefined"==typeof e||null==e||!e.toLowerCase||0===e.length)&&("undefined"!=typeof t&&null!=t&&t.toString().toLowerCase().indexOf(e.toLowerCase())!=-1)},a.Search.DEFAULT_SEARCH_RESULT_CLASS="htSearchResult",a.Search.global=function(){var e=a.Search.DEFAULT_CALLBACK,t=a.Search.DEFAULT_QUERY_METHOD,n=a.Search.DEFAULT_SEARCH_RESULT_CLASS;return{getDefaultCallback:function(){return e},setDefaultCallback:function(t){e=t},getDefaultQueryMethod:function(){return t},setDefaultQueryMethod:function(e){t=e},getDefaultSearchResultClass:function(){return n},setDefaultSearchResultClass:function(e){n=e}}}(),a.SearchCellDecorator=function(e,t,n,o,r,i,s){var l=null!==s.search&&"object"==typeof s.search&&s.search.searchResultClass||a.Search.global.getDefaultSearchResultClass();s.isSearchResult?u(t,l):c(t,l)};var p=f("base");h("base",function(e,t,n,o,r,i,s){p.apply(this,arguments),a.SearchCellDecorator.apply(this,arguments)}),a.hooks.add("afterInit",o),a.hooks.add("afterUpdateSettings",o)},{browser:24,"helpers/dom/element":47,renderers:105}],103:[function(e,t,n){"use strict";Object.defineProperties(n,{TouchScroll:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s,a=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,l=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),u=l.addClass,c=l.removeClass,d=(i=e("_base"),i&&i.__esModule&&i||{default:i}).default,h=(s=e("plugins"),s&&s.__esModule&&s||{default:s}).registerPlugin,f=function(e){var t=this;$traceurRuntime.superConstructor(p).call(this,e),this.hot.addHook("afterInit",function(){return t.afterInit()}),this.hot.addHook("afterUpdateSettings",function(){return t.onAfterUpdateSettings()}),this.scrollbars=[],this.clones=[]},p=f;$traceurRuntime.createClass(f,{afterInit:function(){this.registerEvents(),this.onAfterUpdateSettings()},onAfterUpdateSettings:function(){var e=this;this.hot.addHookOnce("afterRender",function(){var t=e.hot.view.wt.wtOverlays;e.scrollbars=[],e.scrollbars.push(t.topOverlay),t.bottomOverlay.clone&&e.scrollbars.push(t.bottomOverlay),e.scrollbars.push(t.leftOverlay),t.topLeftCornerOverlay&&e.scrollbars.push(t.topLeftCornerOverlay),t.bottomLeftCornerOverlay&&t.bottomLeftCornerOverlay.clone&&e.scrollbars.push(t.bottomLeftCornerOverlay),e.clones=[],t.topOverlay.needFullRender&&e.clones.push(t.topOverlay.clone.wtTable.holder.parentNode),t.bottomOverlay.needFullRender&&e.clones.push(t.bottomOverlay.clone.wtTable.holder.parentNode),t.leftOverlay.needFullRender&&e.clones.push(t.leftOverlay.clone.wtTable.holder.parentNode),t.topLeftCornerOverlay&&e.clones.push(t.topLeftCornerOverlay.clone.wtTable.holder.parentNode),t.bottomLeftCornerOverlay&&t.bottomLeftCornerOverlay.clone&&e.clones.push(t.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode)})},registerEvents:function(){var e=this;this.hot.addHook("beforeTouchScroll",function(){return e.onBeforeTouchScroll()}),this.hot.addHook("afterMomentumScroll",function(){return e.onAfterMomentumScroll()})},onBeforeTouchScroll:function(){a.freezeOverlays=!0;for(var e=0,t=this.clones.length;e<t;e++)u(this.clones[e],"hide-tween")},onAfterMomentumScroll:function(){a.freezeOverlays=!1;for(var e=this,t=0,n=this.clones.length;t<n;t++)c(this.clones[t],"hide-tween");for(var o=0,r=this.clones.length;o<r;o++)u(this.clones[o],"show-tween");setTimeout(function(){for(var t=0,n=e.clones.length;t<n;t++)c(e.clones[t],"show-tween")},400);for(var i=0,s=this.scrollbars.length;i<s;i++)this.scrollbars[i].refresh(),this.scrollbars[i].resetFixedPosition();this.hot.view.wt.wtOverlays.syncScrollWithMaster()}},{},d),h("touchScroll",f)},{_base:61,browser:24,"helpers/dom/element":47,plugins:60}],104:[function(e,t,n){"use strict";function o(){var e=this,t="undefined"==typeof e.getSettings().undo||e.getSettings().undo;t?e.undoRedo||(e.undoRedo=new f.UndoRedo(e),s(e),e.addHook("beforeKeyDown",r),e.addHook("afterChange",i)):e.undoRedo&&(delete e.undoRedo,a(e),e.removeHook("beforeKeyDown",r),e.removeHook("afterChange",i))}function r(e){var t=this,n=(e.ctrlKey||e.metaKey)&&!e.altKey;n&&(89===e.keyCode||e.shiftKey&&90===e.keyCode?(t.undoRedo.redo(),y(e)):90===e.keyCode&&(t.undoRedo.undo(),y(e)))}function i(e,t){var n=this;if("loadData"==t)return n.undoRedo.clear()}function s(e){e.undo=function(){return e.undoRedo.undo()},e.redo=function(){return e.undoRedo.redo()},e.isUndoAvailable=function(){return e.undoRedo.isUndoAvailable()},e.isRedoAvailable=function(){return e.undoRedo.isRedoAvailable()},e.clearUndo=function(){return e.undoRedo.clear()}}function a(e){delete e.undo,delete e.redo,delete e.isUndoAvailable,delete e.isRedoAvailable,delete e.clearUndo}var l,u,c,d,h,f=(l=e("browser"),l&&l.__esModule&&l||{default:l}).default,p=(u=e("helpers/array"),u&&u.__esModule&&u||{default:u}).arrayMap,m=(c=e("helpers/number"),c&&c.__esModule&&c||{default:c}).rangeEach,g=(d=e("helpers/object"),d&&d.__esModule&&d||{default:d}),w=g.inherit,v=g.deepClone,y=(h=e("helpers/dom/event"),h&&h.__esModule&&h||{default:h}).stopImmediatePropagation;f.UndoRedo=function(e){var t=this;this.instance=e,this.doneActions=[],this.undoneActions=[],this.ignoreNewActions=!1,e.addHook("afterChange",function(e,n){if(e){var o=new f.UndoRedo.ChangeAction(e);t.done(o)}}),e.addHook("afterCreateRow",function(e,n,o){if(!o){var r=new f.UndoRedo.CreateRowAction(e,n);t.done(r)}}),e.addHook("beforeRemoveRow",function(e,n){var o=t.instance.getSourceData();e=(o.length+e)%o.length;var r=o.slice(e,e+n),i=new f.UndoRedo.RemoveRowAction(e,r);t.done(i)}),e.addHook("afterCreateCol",function(e,n,o){if(!o){var r=new f.UndoRedo.CreateColumnAction(e,n);t.done(r)}}),e.addHook("beforeRemoveCol",function(n,o){var r=t.instance.getData();n=(t.instance.countCols()+n)%t.instance.countCols();var i=[],s=[],a=[];m(0,r.length-1,function(e){i[e]=r[e].slice(n,n+o)}),m(0,o-1,function(t){a.push(e.runHooks("modifyCol",n+t))}),Array.isArray(e.getSettings().colHeaders)&&m(0,o-1,function(t){s.push(e.getSettings().colHeaders[e.runHooks("modifyCol",n+t)]||null)});var l=t.instance.getPlugin("manualColumnMove"),u=new f.UndoRedo.RemoveColumnAction(a,i,s,l?l.columnPositions:[]);t.done(u)}),e.addHook("beforeCellAlignment",function(e,n,o,r){var i=new f.UndoRedo.CellAlignmentAction(e,n,o,r);t.done(i)}),e.addHook("beforeFilter",function(e){t.done(new f.UndoRedo.FiltersAction(e))})},f.UndoRedo.prototype.done=function(e){this.ignoreNewActions||(this.doneActions.push(e),this.undoneActions.length=0)},f.UndoRedo.prototype.undo=function(){if(this.isUndoAvailable()){var e=this.doneActions.pop();this.ignoreNewActions=!0;var t=this;e.undo(this.instance,function(){t.ignoreNewActions=!1,t.undoneActions.push(e)})}},f.UndoRedo.prototype.redo=function(){if(this.isRedoAvailable()){var e=this.undoneActions.pop();this.ignoreNewActions=!0;var t=this;e.redo(this.instance,function(){t.ignoreNewActions=!1,t.doneActions.push(e)})}},f.UndoRedo.prototype.isUndoAvailable=function(){return this.doneActions.length>0},f.UndoRedo.prototype.isRedoAvailable=function(){return this.undoneActions.length>0},f.UndoRedo.prototype.clear=function(){this.doneActions.length=0,this.undoneActions.length=0},f.UndoRedo.Action=function(){},f.UndoRedo.Action.prototype.undo=function(){},f.UndoRedo.Action.prototype.redo=function(){},f.UndoRedo.ChangeAction=function(e){this.changes=e},w(f.UndoRedo.ChangeAction,f.UndoRedo.Action),f.UndoRedo.ChangeAction.prototype.undo=function(e,t){for(var n=v(this.changes),o=e.countEmptyRows(!0),r=e.countEmptyCols(!0),i=0,s=n.length;i<s;i++)n[i].splice(3,1);e.addHookOnce("afterChange",t),e.setDataAtRowProp(n,null,null,"undo");for(var i=0,s=n.length;i<s;i++)e.getSettings().minSpareRows&&n[i][0]+1+e.getSettings().minSpareRows===e.countRows()&&o==e.getSettings().minSpareRows&&(e.alter("remove_row",parseInt(n[i][0]+1,10),e.getSettings().minSpareRows),e.undoRedo.doneActions.pop()),e.getSettings().minSpareCols&&n[i][1]+1+e.getSettings().minSpareCols===e.countCols()&&r==e.getSettings().minSpareCols&&(e.alter("remove_col",parseInt(n[i][1]+1,10),e.getSettings().minSpareCols),e.undoRedo.doneActions.pop())},f.UndoRedo.ChangeAction.prototype.redo=function(e,t){for(var n=v(this.changes),o=0,r=n.length;o<r;o++)n[o].splice(2,1);e.addHookOnce("afterChange",t),e.setDataAtRowProp(n,null,null,"redo")},f.UndoRedo.CreateRowAction=function(e,t){this.index=e,this.amount=t},w(f.UndoRedo.CreateRowAction,f.UndoRedo.Action),f.UndoRedo.CreateRowAction.prototype.undo=function(e,t){var n=e.countRows(),o=e.getSettings().minSpareRows;this.index>=n&&this.index-o<n&&(this.index-=o),e.addHookOnce("afterRemoveRow",t),e.alter("remove_row",this.index,this.amount)},f.UndoRedo.CreateRowAction.prototype.redo=function(e,t){e.addHookOnce("afterCreateRow",t),e.alter("insert_row",this.index+1,this.amount)},f.UndoRedo.RemoveRowAction=function(e,t){this.index=e,this.data=t},w(f.UndoRedo.RemoveRowAction,f.UndoRedo.Action),f.UndoRedo.RemoveRowAction.prototype.undo=function(e,t){var n=[this.index,0];Array.prototype.push.apply(n,this.data),Array.prototype.splice.apply(e.getSourceData(),n),e.addHookOnce("afterRender",t),e.render()},f.UndoRedo.RemoveRowAction.prototype.redo=function(e,t){e.addHookOnce("afterRemoveRow",t),e.alter("remove_row",this.index,this.data.length)},f.UndoRedo.CreateColumnAction=function(e,t){this.index=e,this.amount=t},w(f.UndoRedo.CreateColumnAction,f.UndoRedo.Action),f.UndoRedo.CreateColumnAction.prototype.undo=function(e,t){e.addHookOnce("afterRemoveCol",t),e.alter("remove_col",this.index,this.amount)},f.UndoRedo.CreateColumnAction.prototype.redo=function(e,t){e.addHookOnce("afterCreateCol",t),e.alter("insert_col",this.index+1,this.amount)},f.UndoRedo.CellAlignmentAction=function(e,t,n,o){this.stateBefore=e,this.range=t,this.type=n,this.alignment=o},f.UndoRedo.CellAlignmentAction.prototype.undo=function(e,t){if(e.getPlugin("contextMenu").isEnabled()){for(var n=this.range.from.row;n<=this.range.to.row;n++)for(var o=this.range.from.col;o<=this.range.to.col;o++)e.setCellMeta(n,o,"className",this.stateBefore[n][o]||" htLeft");e.addHookOnce("afterRender",t),e.render()}},f.UndoRedo.CellAlignmentAction.prototype.redo=function(e,t){e.getPlugin("contextMenu").isEnabled()&&(e.selectCell(this.range.from.row,this.range.from.col,this.range.to.row,this.range.to.col),e.getPlugin("contextMenu").executeCommand("alignment:"+this.alignment.replace("ht","").toLowerCase()),e.addHookOnce("afterRender",t),e.render())},f.UndoRedo.RemoveColumnAction=function(e,t,n,o){this.indexes=e,this.data=t,this.amount=this.data[0].length,this.headers=n,this.columnPositions=o.slice(0)},w(f.UndoRedo.RemoveColumnAction,f.UndoRedo.Action),f.UndoRedo.RemoveColumnAction.prototype.undo=function(e,t){var n,o=this,r=this.indexes.slice(0).sort(),i=function(e,t,n){return n[o.indexes.indexOf(r[t])]},s=[];m(0,this.data.length-1,function(e){s[e]=p(o.data[e],i)});var a=[];a=p(this.headers,i),m(0,this.data.length-1,function(t){n=e.getSourceDataAtRow(t),m(0,r.length-1,function(e){n.splice(r[e],0,s[t][e])})}),"undefined"!=typeof this.headers&&m(0,a.length-1,function(t){e.getSettings().colHeaders.splice(r[t],0,a[t])}),e.getPlugin("manualColumnMove")&&(e.getPlugin("manualColumnMove").columnPositions=this.columnPositions),e.addHookOnce("afterRender",t),e.render()},f.UndoRedo.RemoveColumnAction.prototype.redo=function(e,t){e.addHookOnce("afterRemoveCol",t),e.alter("remove_col",e.runHooks("unmodifyCol",this.indexes[0]),this.amount)},f.UndoRedo.FiltersAction=function(e){this.formulaStacks=e},w(f.UndoRedo.FiltersAction,f.UndoRedo.Action),f.UndoRedo.FiltersAction.prototype.undo=function(e,t){var n=e.getPlugin("filters");e.addHookOnce("afterRender",t),n.formulaCollection.importAllFormulas(this.formulaStacks.slice(0,this.formulaStacks.length-1)),n.filter()},f.UndoRedo.FiltersAction.prototype.redo=function(e,t){var n=e.getPlugin("filters");e.addHookOnce("afterRender",t),n.formulaCollection.importAllFormulas(this.formulaStacks),n.filter()},f.hooks.add("afterInit",o),f.hooks.add("afterUpdateSettings",o)},{browser:24,"helpers/array":43,"helpers/dom/event":48,"helpers/number":52,"helpers/object":53}],105:[function(e,t,n){"use strict";function o(e,t){var n;c[e]=t,n=u(e)+"Renderer",l.renderers[n]=t,l[n]=t,"base"===e&&(l.renderers.cellDecorator=t)}function r(e){if("function"==typeof e)return e;if("string"!=typeof e)throw Error('Only strings and functions can be passed as "renderer" parameter');if(!(e in c))throw Error('No editor registered under name "'+e+'"');return c[e]}function i(e){return e in c}Object.defineProperties(n,{registerRenderer:{get:function(){return o}},getRenderer:{get:function(){return r}},hasRenderer:{get:function(){return i}},__esModule:{value:!0}});var s,a,l=(s=e("browser"),s&&s.__esModule&&s||{default:s}).default,u=(a=e("helpers/string"),a&&a.__esModule&&a||{default:a}).toUpperCaseFirst,c={};l.renderers=l.renderers||{},l.renderers.registerRenderer=o,l.renderers.getRenderer=r},{browser:24,"helpers/string":55}],106:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,s){s.className&&(t.className?t.className=t.className+" "+s.className:t.className=s.className),s.readOnly&&a(t,s.readOnlyCellClassName),s.valid===!1&&s.invalidCellClassName?a(t,s.invalidCellClassName):l(t,s.invalidCellClassName),s.wordWrap===!1&&s.noWordWrapClassName&&a(t,s.noWordWrapClassName),!i&&s.placeholder&&a(t,s.placeholderCellClassName)}Object.defineProperties(n,{cellDecorator:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),a=s.addClass,l=s.removeClass,u=(i=e("renderers"),i&&i.__esModule&&i||{default:i}).registerRenderer;u("base",o)},{"helpers/dom/element":47,renderers:105}],107:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,s){var a=(g.cloneNode(!0),w.cloneNode(!0));if(f("text")(e,t,n,o,r,i,s),t.appendChild(a),u(t,"htAutocomplete"),t.firstChild||t.appendChild(document.createTextNode(String.fromCharCode(160))),!e.acArrowListener){var l=d(e);e.acArrowListener=function(r){c(r.target,"htAutocompleteArrow")&&e.view.wt.getSetting("onCellDblClick",null,new m(n,o),t)},l.addEventListener(e.rootElement,"mousedown",e.acArrowListener),e.addHookOnce("afterDestroy",function(){l.destroy()})}}Object.defineProperties(n,{autocompleteRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),u=l.addClass,c=l.hasClass,d=(l.empty,(i=e("eventManager"),i&&i.__esModule&&i||{default:i}).eventManager),h=(s=e("renderers"),s&&s.__esModule&&s||{default:s}),f=h.getRenderer,p=h.registerRenderer,m=(a=e("3rdparty/walkontable/src/cell/coords"),a&&a.__esModule&&a||{default:a}).WalkontableCellCoords,g=document.createElement("DIV");g.className="htAutocompleteWrapper";var w=document.createElement("DIV");w.className="htAutocompleteArrow",w.appendChild(document.createTextNode(String.fromCharCode(9660)));p("autocomplete",o)},{"3rdparty/walkontable/src/cell/coords":6,eventManager:42,"helpers/dom/element":47,renderers:105}],108:[function(e,t,n){"use strict";function o(e,t,n,o,a,l,u){function c(e){var t="SPACE|ENTER",n="DELETE|BACKSPACE",o=O(T,e.keyCode);o(t+"|"+n)&&!H(e)&&f(function(){x(e),e.preventDefault()}),o(t)&&d(),o(n)&&d(!1)}function d(){var e=void 0!==arguments[0]?arguments[0]:null;f(function(t){for(var n=0,o=t.length;n<o;n++){if(C(t[n],P)&&null===e)return;h(t[n],e)}})}function h(e){var t=void 0!==arguments[1]?arguments[1]:null;null===t?e.checked=!e.checked:e.checked=t,p.fireEvent(e,"change")}function f(t){var n=e.getSelectedRange();if(n)for(var o=n.getTopLeftCorner(),r=n.getBottomRightCorner(),i=o.row;i<=r.row;i++)for(var s=o.col;s<=r.col;s++){var a=e.getCell(i,s),l=e.getCellMeta(i,s),u=a.querySelectorAll("input[type=checkbox]");u.length>0&&!l.readOnly&&t(u)}}E("base").apply(this,arguments);var p=r(e),m=i(),g=u.label,w=!1;if("undefined"==typeof u.checkedTemplate&&(u.checkedTemplate=!0),
+"undefined"==typeof u.uncheckedTemplate&&(u.uncheckedTemplate=!1),y(t),l===u.checkedTemplate||_(l,u.checkedTemplate)?m.checked=!0:l===u.uncheckedTemplate||_(l,u.uncheckedTemplate)?m.checked=!1:null===l?b(m,"noValue"):(m.style.display="none",b(m,P),w=!0),m.setAttribute("data-row",n),m.setAttribute("data-col",o),!w&&g){var v="";g.value?v="function"==typeof g.value?g.value.call(this,n,o,a,l):g.value:g.property&&(v=e.getDataAtRowProp(n,g.property));var R=s(v);"before"===g.position?R.appendChild(m):R.insertBefore(m,R.firstChild),m=R}t.appendChild(m),w&&t.appendChild(document.createTextNode("#bad-value#")),D.has(e)||(D.set(e,!0),e.addHook("beforeKeyDown",c))}function r(e){var t=A.get(e);return t||(t=new R(e),t.addEventListener(e.rootElement,"click",function(t){return l(t,e)}),t.addEventListener(e.rootElement,"mouseup",function(t){return a(t,e)}),t.addEventListener(e.rootElement,"change",function(t){return u(t,e)}),A.set(e,t)),t}function i(){var e=document.createElement("input");return e.className="htCheckboxRendererInput",e.type="checkbox",e.setAttribute("autocomplete","off"),e.setAttribute("tabindex","-1"),e.cloneNode(!1)}function s(e){var t=document.createElement("label");return t.className="htCheckboxRendererLabel",t.appendChild(document.createTextNode(e)),t.cloneNode(!0)}function a(e,t){c(e.target)&&setTimeout(t.listen,10)}function l(e,t){if(!c(e.target))return!1;var n=parseInt(e.target.getAttribute("data-row"),10),o=parseInt(e.target.getAttribute("data-col"),10),r=t.getCellMeta(n,o);r.readOnly&&e.preventDefault()}function u(e,t){if(!c(e.target))return!1;var n=parseInt(e.target.getAttribute("data-row"),10),o=parseInt(e.target.getAttribute("data-col"),10),r=t.getCellMeta(n,o);r.readOnly||t.setDataAtCell(n,o,e.target.checked?r.checkedTemplate||!0:r.uncheckedTemplate||!1)}function c(e){return"INPUT"===e.tagName&&"checkbox"===e.getAttribute("type")}Object.defineProperties(n,{checkboxRenderer:{get:function(){return o}},__esModule:{value:!0}});var d,h,f,p,m,g,w,v=(d=e("helpers/dom/element"),d&&d.__esModule&&d||{default:d}),y=v.empty,b=v.addClass,C=v.hasClass,_=(h=e("helpers/string"),h&&h.__esModule&&h||{default:h}).equalsIgnoreCase,R=(f=e("eventManager"),f&&f.__esModule&&f||{default:f}).EventManager,S=(p=e("renderers"),p&&p.__esModule&&p||{default:p}),E=S.getRenderer,M=S.registerRenderer,T=(m=e("helpers/unicode"),m&&m.__esModule&&m||{default:m}).isKey,O=(g=e("helpers/function"),g&&g.__esModule&&g||{default:g}).partial,k=(w=e("helpers/dom/event"),w&&w.__esModule&&w||{default:w}),x=k.stopImmediatePropagation,H=k.isImmediatePropagationStopped,D=new WeakMap,A=new WeakMap,P="htBadValue";M("checkbox",o)},{eventManager:42,"helpers/dom/element":47,"helpers/dom/event":48,"helpers/function":50,"helpers/string":55,"helpers/unicode":56,renderers:105}],109:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,a){l("base").apply(this,arguments),null!==i&&void 0!==i||(i=""),s(t,i)}Object.defineProperties(n,{htmlRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}).fastInnerHTML,a=(i=e("renderers"),i&&i.__esModule&&i||{default:i}),l=a.getRenderer,u=a.registerRenderer;u("html",o)},{"helpers/dom/element":47,renderers:105}],110:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,s){if(d(i)){"undefined"!=typeof s.language&&a.culture(s.language),i=a(i).format(s.format||"0");var l=s.className||"",c=l.length?l.split(" "):[];c.indexOf("htLeft")<0&&c.indexOf("htCenter")<0&&c.indexOf("htRight")<0&&c.indexOf("htJustify")<0&&c.push("htRight"),c.indexOf("htNumeric")<0&&c.push("htNumeric"),s.className=c.join(" ")}u("text")(e,t,n,o,r,i,s)}Object.defineProperties(n,{numericRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e("numbro"),r&&r.__esModule&&r||{default:r}).default,l=(i=e("renderers"),i&&i.__esModule&&i||{default:i}),u=l.getRenderer,c=l.registerRenderer,d=(s=e("helpers/number"),s&&s.__esModule&&s||{default:s}).isNumeric;c("numeric",o)},{"helpers/number":52,numbro:"numbro",renderers:105}],111:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,a){l("text").apply(this,arguments),i=t.innerHTML;var u,c=a.hashLength||i.length,d=a.hashSymbol||"*";for(u="";u.split(d).length-1<c;u+=d);s(t,u)}Object.defineProperties(n,{passwordRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}).fastInnerHTML,a=(i=e("renderers"),i&&i.__esModule&&i||{default:i}),l=a.getRenderer,u=a.registerRenderer;u("password",o)},{"helpers/dom/element":47,renderers:105}],112:[function(e,t,n){"use strict";function o(e,t,n,o,r,i,s){h("base").apply(this,arguments),!i&&s.placeholder&&(i=s.placeholder);var a=c(i);if(e.getSettings().trimWhitespace||(a=a.replace(/ /g,String.fromCharCode(160))),s.rendererTemplate){l(t);var d=document.createElement("TEMPLATE");d.setAttribute("bind","{{}}"),d.innerHTML=s.rendererTemplate,HTMLTemplateElement.decorate(d),d.model=e.getSourceDataAtRow(n),t.appendChild(d)}else u(t,a)}Object.defineProperties(n,{textRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),l=a.empty,u=a.fastInnerText,c=(i=e("helpers/mixed"),i&&i.__esModule&&i||{default:i}).stringify,d=(s=e("renderers"),s&&s.__esModule&&s||{default:s}),h=d.getRenderer,f=d.registerRenderer;f("text",o)},{"helpers/dom/element":47,"helpers/mixed":51,renderers:105}],113:[function(e,t,n){!function(e){"use strict";function t(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}function n(){return"__$"+Math.floor(1e9*Math.random())+"$"+ ++D+"$__"}function o(e){return W[e]}function r(){var e=n();return W[e]=!0,e}function i(e){return"object"==typeof e&&e instanceof l}function s(e){return i(e)?"symbol":typeof e}function a(e){var t=new l(e);if(!(this instanceof a))return t;throw new TypeError("Symbol cannot be new'ed")}function l(e){var t=n();E(this,N,{value:this}),E(this,A,{value:t}),E(this,P,{value:e}),c(this),L[t]=this}function u(e){var t=e[I];return t&&t.self===e?t:x(e)?(V.hash.value=F++,V.self.value=e,j.value=R(null,V),E(e,I,j),j.value):void 0}function c(e){return u(e),M.apply(this,arguments)}function d(e){return L[e]||W[e]}function h(e){return i(e)?e[A]:e}function f(e){for(var t=[],n=O(e),o=0;o<n.length;o++){var r=L[n[o]];r&&t.push(r)}return t}function p(t){return e.traceur&&e.traceur.options[t]}function m(e){for(var t=1;t<arguments.length;t++)for(var n=O(arguments[t]),o=0;o<n.length;o++){var r=n[o];d(r)||!function(t,n){E(e,n,{get:function(){return t[n]},enumerable:!0})}(arguments[t],n[o])}return e}function g(e){return null!=e&&("object"==typeof e||"function"==typeof e)}function w(e){if(null==e)throw _();return C(e)}function v(e){if(null==e)throw new TypeError("Value cannot be converted to an Object");return e}function y(e,t){e.Symbol||(e.Symbol=t,Object.getOwnPropertySymbols=f),e.Symbol.iterator||(e.Symbol.iterator=t("Symbol.iterator"))}function b(e){y(e,a),e.Reflect=e.Reflect||{},e.Reflect.global=e.Reflect.global||e}if(!e.$traceurRuntime){var C=Object,_=TypeError,R=C.create,S=C.defineProperties,E=C.defineProperty,M=C.freeze,T=C.getOwnPropertyDescriptor,O=C.getOwnPropertyNames,k=C.keys,x=Object.isExtensible,H=t,D=0,A=n(),P=n(),N=n(),L=R(null),W=R(null);E(a.prototype,"constructor",t(a)),E(a.prototype,"toString",H(function(){var e=this[N];if(!p("symbols"))return e[A];if(!e)throw TypeError("Conversion from symbol to string");var t=e[P];return void 0===t&&(t=""),"Symbol("+t+")"})),E(a.prototype,"valueOf",H(function(){var e=this[N];if(!e)throw TypeError("Conversion from symbol to string");return p("symbols")?e:e[A]})),E(l.prototype,"constructor",t(a)),E(l.prototype,"toString",{value:a.prototype.toString,enumerable:!1}),E(l.prototype,"valueOf",{value:a.prototype.valueOf,enumerable:!1});var I=r(),j={value:void 0},V={hash:{value:void 0},self:{value:void 0}},F=0;c(l.prototype),b(e),e.$traceurRuntime={checkObjectCoercible:v,createPrivateName:r,defineProperties:S,defineProperty:E,exportStar:m,getOwnHashObject:u,getOwnPropertyDescriptor:T,getOwnPropertyNames:O,isObject:g,isPrivateName:o,isSymbolString:d,keys:k,setupGlobals:b,toObject:w,toProperty:h,typeof:s}}}(window),function(){"use strict";function e(){for(var e,n=[],o=0,r=0;r<arguments.length;r++){var i=$traceurRuntime.checkObjectCoercible(arguments[r]);"function"!=typeof i[t(Symbol.iterator)]&&(i[t(Symbol.iterator)]=function(){var e=this,t=e.length,n=0;return{next:function(){var o={done:!0};return n<t&&(o.done=!1,o.value=e[n],++n),o}}});for(var s=i[t(Symbol.iterator)]();!(e=s.next()).done;)n[o++]=e.value}return n}var t=$traceurRuntime.toProperty;$traceurRuntime.spread=e}(),function(){"use strict";function e(e,t){var n=m(e);do{var o=p(n,t);if(o)return o;n=m(n)}while(n)}function t(e){return e.__proto__}function n(e,t,n,r){return o(e,t,n).apply(e,r)}function o(t,n,o){var r=e(n,o);if(r)return r.get?r.get.call(t):r.value}function r(t,n,o,r){var i=e(n,o);if(i&&i.set)return i.set.call(t,r),r;throw c("super has no setter '"+o+"'.")}function i(e){for(var t={},n=v(e),o=0;o<n.length;o++){var r=n[o];t[r]=p(e,r)}for(var i=y(e),o=0;o<i.length;o++){var s=i[o];t[g(s)]=p(e,g(s))}return t}function s(e,t,n,o){return f(t,"constructor",{value:e,configurable:!0,enumerable:!1,writable:!0}),arguments.length>3?("function"==typeof o&&(e.__proto__=o),e.prototype=d(a(o),i(t))):e.prototype=t,f(e,"prototype",{configurable:!1,writable:!1}),h(e,i(n))}function a(e){if("function"==typeof e){var t=e.prototype;if(u(t)===t||null===t)return e.prototype;throw new c("super prototype must be an Object or null")}if(null===e)return null;throw new c("Super expression must either be null or a function, not "+typeof e+".")}function l(e,t,o){null!==m(t)&&n(e,t,"constructor",o)}var u=Object,c=TypeError,d=u.create,h=$traceurRuntime.defineProperties,f=$traceurRuntime.defineProperty,p=$traceurRuntime.getOwnPropertyDescriptor,m=Object.getPrototypeOf,g=$traceurRuntime.toProperty,w=Object,v=w.getOwnPropertyNames,y=w.getOwnPropertySymbols;$traceurRuntime.createClass=s,$traceurRuntime.defaultSuperCall=l,$traceurRuntime.superCall=n,$traceurRuntime.superConstructor=t,$traceurRuntime.superGet=o,$traceurRuntime.superSet=r}()},{}],114:[function(e,t,n){"use strict";function o(e){var t=this,n=this;this.eventManager=_(e),this.instance=e,this.settings=e.getSettings(),this.selectionMouseDown=!1;var o=e.rootElement.getAttribute("style");o&&e.rootElement.setAttribute("data-originalstyle",o),f(e.rootElement,"handsontable");var r=document.createElement("TABLE");f(r,"htCore"),e.getSettings().tableClassName&&f(r,e.getSettings().tableClassName),this.THEAD=document.createElement("THEAD"),r.appendChild(this.THEAD),this.TBODY=document.createElement("TBODY"),r.appendChild(this.TBODY),e.table=r,e.container.insertBefore(r,e.container.firstChild),this.eventManager.addEventListener(e.rootElement,"mousedown",function(e){this.selectionMouseDown=!0,n.isTextSelectionAllowed(e.target)||(s(),e.preventDefault(),window.focus())}),this.eventManager.addEventListener(e.rootElement,"mouseup",function(e){this.selectionMouseDown=!1}),this.eventManager.addEventListener(e.rootElement,"mousemove",function(e){this.selectionMouseDown&&!n.isTextSelectionAllowed(e.target)&&(s(),e.preventDefault())}),this.eventManager.addEventListener(document.documentElement,"keyup",function(t){e.selection.isInProgress()&&!t.shiftKey&&e.selection.finish()});var i;this.isMouseDown=function(){return i},this.eventManager.addEventListener(document.documentElement,"mouseup",function(t){e.selection.isInProgress()&&1===t.which&&e.selection.finish(),i=!1,C(document.activeElement)&&e.unlisten()}),this.eventManager.addEventListener(document.documentElement,"mousedown",function(t){var o=t.target,r=t.target,s=t.x||t.clientX,a=t.y||t.clientY;if(!i&&e.rootElement){if(r===e.view.wt.wtTable.holder){var l=w();if(document.elementFromPoint(s+l,a)!==e.view.wt.wtTable.holder||document.elementFromPoint(s,a+l)!==e.view.wt.wtTable.holder)return}else for(;r!==document.documentElement;){if(null===r){if(t.isTargetWebComponent)break;return}if(r===e.rootElement)return;r=r.parentNode}var u="function"==typeof n.settings.outsideClickDeselects?n.settings.outsideClickDeselects(o):n.settings.outsideClickDeselects;u?e.deselectCell():e.destroyEditor()}}),this.eventManager.addEventListener(r,"selectstart",function(e){n.settings.fragmentSelection||b(e.target)||e.preventDefault()});var s=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},a=[new k({className:"current",border:{width:2,color:"#5292F7",cornerVisible:function(){return n.settings.fillHandle&&!n.isCellEdited()&&!e.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!n.isCellEdited()&&!e.selection.isMultiple()}}}),new k({className:"area",border:{width:1,color:"#89AFF9",cornerVisible:function(){return n.settings.fillHandle&&!n.isCellEdited()&&e.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!n.isCellEdited()&&e.selection.isMultiple()}}}),new k({className:"highlight",highlightRowClassName:n.settings.currentRowClassName,highlightColumnClassName:n.settings.currentColClassName}),new k({className:"fill",border:{width:1,color:"red"}})];a.current=a[0],a.area=a[1],a.highlight=a[2],a.fill=a[3];var l={debug:function(){return n.settings.debug},externalRowCalculator:this.instance.getPlugin("autoRowSize")&&this.instance.getPlugin("autoRowSize").isEnabled(),table:r,preventOverflow:function(){return t.settings.preventOverflow},stretchH:function(){return n.settings.stretchH},data:e.getDataAtCell,totalRows:function(){return e.countRows()},totalColumns:function(){return e.countCols()},fixedColumnsLeft:function(){return n.settings.fixedColumnsLeft},fixedRowsTop:function(){return n.settings.fixedRowsTop},fixedRowsBottom:function(){return n.settings.fixedRowsBottom},minSpareRows:function(){return n.settings.minSpareRows},renderAllRows:n.settings.renderAllRows,rowHeaders:function(){var t=[];return e.hasRowHeaders()&&t.push(function(e,t){n.appendRowHeader(e,t)}),d.hooks.run(e,"afterGetRowHeaderRenderers",t),t},columnHeaders:function(){var t=[];return e.hasColHeaders()&&t.push(function(e,t){n.appendColHeader(e,t)}),d.hooks.run(e,"afterGetColumnHeaderRenderers",t),t},columnWidth:e.getColWidth,rowHeight:e.getRowHeight,cellRenderer:function(e,t,o){var r=n.instance.getCellMeta(e,t),i=n.instance.colToProp(t),s=n.instance.getDataAtRowProp(e,i);d.hooks.run(n.instance,"beforeRenderer",o,e,t,i,s,r),n.instance.getCellRenderer(r)(n.instance,o,e,t,i,s,r),d.hooks.run(n.instance,"afterRenderer",o,e,t,i,s,r)},selections:a,hideBorderOnMouseDownOver:function(){return n.settings.fragmentSelection},onCellMouseDown:function(t,o,r,s){if(e.listen(),n.activeWt=s,i=!0,d.hooks.run(e,"beforeOnCellMouseDown",t,o,r),!E(t)){var a=e.getSelectedRange(),l=e.selection,u=l.selectedHeader;if(t.shiftKey&&a)o.row>=0&&o.col>=0?(l.setRangeEnd(o),l.setSelectedHeaders(!1,!1)):(u.cols||u.rows)&&o.row>=0&&o.col>=0?(l.setRangeEnd(new O(o.row,o.col)),l.setSelectedHeaders(!1,!1)):u.cols&&o.row<0?l.setRangeEnd(new O(a.to.row,o.col)):u.rows&&o.col<0?l.setRangeEnd(new O(o.row,a.to.col)):!u.cols&&!u.rows&&o.col<0||u.cols&&o.col<0?(l.setRangeStartOnly(new O(a.from.row,0)),l.setRangeEnd(new O(o.row,e.countCols()-1)),l.setSelectedHeaders(!0,!1)):(!u.cols&&!u.rows&&o.row<0||u.rows&&o.row<0)&&(l.setRangeStartOnly(new O(0,a.from.col)),l.setRangeEnd(new O(e.countRows()-1,o.col)),l.setSelectedHeaders(!1,!0));else{var c=!0;if(a){var h=a,f=h.from,p=h.to,m=!l.inInSelection(o);if(o.row<0&&u.cols){var g=Math.min(f.col,p.col),w=Math.max(f.col,p.col);c=o.col<g||o.col>w}else if(o.col<0&&u.rows){var v=Math.min(f.row,p.row),y=Math.max(f.row,p.row);c=o.row<v||o.row>y}else c=m}var b=M(t),C=T(t);o.row<0&&o.col>=0?(l.setSelectedHeaders(!1,!0),(C||b&&c)&&(l.setRangeStartOnly(new O(0,o.col)),l.setRangeEnd(new O(Math.max(e.countRows()-1,0),o.col),!1))):o.col<0&&o.row>=0?(l.setSelectedHeaders(!0,!1),(C||b&&c)&&(l.setRangeStartOnly(new O(o.row,0)),l.setRangeEnd(new O(o.row,Math.max(e.countCols()-1,0)),!1))):(l.setSelectedHeaders(!1,!1,o.col<0&&o.row<0),o.row=o.row<0?0:o.row,o.col=o.col<0?0:o.col,(C||b&&c)&&l.setRangeStart(o))}d.hooks.run(e,"afterOnCellMouseDown",t,o,r),n.activeWt=n.wt}},onCellMouseOver:function(t,o,r,s){var a={row:!1,column:!1};n.activeWt=s,d.hooks.run(e,"beforeOnCellMouseOver",t,o,r,a),E(t)||(0===t.button&&(o.row>=0&&o.col>=0?i&&e.selection.setRangeEnd(o):i&&(o.row<0&&!a.column&&(e.selection.selectedHeader.cols?(e.selection.setRangeEnd(new O(e.countRows()-1,o.col),!1),e.selection.setSelectedHeaders(!1,!0)):e.selection.setRangeEnd(new O(o.row,o.col),!1)),o.col<0&&!a.row&&(e.selection.selectedHeader.rows?(e.selection.setRangeEnd(new O(o.row,e.countCols()-1),!1),e.selection.setSelectedHeaders(!0,!1)):e.selection.setRangeEnd(new O(o.row,o.col),!1)))),d.hooks.run(e,"afterOnCellMouseOver",t,o,r),n.activeWt=n.wt)},onCellCornerMouseDown:function(t){t.preventDefault(),d.hooks.run(e,"afterOnCellCornerMouseDown",t)},beforeDraw:function(e){n.beforeRender(e)},onDraw:function(e){n.onDraw(e)},onScrollVertically:function(){e.runHooks("afterScrollVertically")},onScrollHorizontally:function(){e.runHooks("afterScrollHorizontally")},onBeforeDrawBorders:function(t,n){e.runHooks("beforeDrawBorders",t,n)},onBeforeTouchScroll:function(){e.runHooks("beforeTouchScroll")},onAfterMomentumScroll:function(){e.runHooks("afterMomentumScroll")},onBeforeStretchingColumnWidth:function(t,n){return e.runHooks("beforeStretchingColumnWidth",t,n)},viewportRowCalculatorOverride:function(t){var o=e.countRows(),r=n.settings.viewportRowRenderingOffset;if("auto"===r&&n.settings.fixedRowsTop&&(r=10),"number"==typeof r&&(t.startRow=Math.max(t.startRow-r,0),t.endRow=Math.min(t.endRow+r,o-1)),"auto"===r){var i=t.startRow+t.endRow-t.startRow,s=Math.ceil(i/o*12);t.startRow=Math.max(t.startRow-s,0),t.endRow=Math.min(t.endRow+s,o-1)}e.runHooks("afterViewportRowCalculatorOverride",t)},viewportColumnCalculatorOverride:function(t){var o=e.countCols(),r=n.settings.viewportColumnRenderingOffset;if("auto"===r&&n.settings.fixedColumnsLeft&&(r=10),"number"==typeof r&&(t.startColumn=Math.max(t.startColumn-r,0),t.endColumn=Math.min(t.endColumn+r,o-1)),"auto"===r){var i=t.startColumn+t.endColumn-t.startColumn,s=Math.ceil(i/o*12);t.startRow=Math.max(t.startColumn-s,0),t.endColumn=Math.min(t.endColumn+s,o-1)}e.runHooks("afterViewportColumnCalculatorOverride",t)},rowHeaderWidth:function(){return n.settings.rowHeaderWidth},columnHeaderHeight:function(){var t=e.runHooks("modifyColumnHeaderHeight");return n.settings.columnHeaderHeight||t}};d.hooks.run(e,"beforeInitWalkontable",l),this.wt=new x(l),this.activeWt=this.wt,this.eventManager.addEventListener(n.wt.wtTable.spreader,"mousedown",function(e){e.target===n.wt.wtTable.spreader&&3===e.which&&S(e)}),this.eventManager.addEventListener(n.wt.wtTable.spreader,"contextmenu",function(e){e.target===n.wt.wtTable.spreader&&3===e.which&&S(e)}),this.eventManager.addEventListener(document.documentElement,"click",function(){n.settings.observeDOMVisibility&&n.wt.drawInterrupted&&(n.instance.forceFullRender=!0,n.render())})}Object.defineProperties(n,{TableView:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,h=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),f=h.addClass,p=h.empty,m=h.fastInnerHTML,g=h.fastInnerText,w=h.getScrollbarWidth,v=h.hasClass,y=h.isChildOf,b=h.isInput,C=h.isOutsideInput,_=(s=e("eventManager"),s&&s.__esModule&&s||{default:s}).eventManager,R=(a=e("helpers/dom/event"),a&&a.__esModule&&a||{default:a}),S=R.stopPropagation,E=R.isImmediatePropagationStopped,M=R.isRightClick,T=R.isLeftClick,O=(l=e("3rdparty/walkontable/src/cell/coords"),l&&l.__esModule&&l||{default:l}).WalkontableCellCoords,k=(u=e("3rdparty/walkontable/src/selection"),u&&u.__esModule&&u||{default:u}).WalkontableSelection,x=(c=e("3rdparty/walkontable/src/core"),c&&c.__esModule&&c||{default:c}).Walkontable;d.TableView=o,o.prototype.isTextSelectionAllowed=function(e){if(b(e))return!0;var t=y(e,this.instance.view.wt.wtTable.spreader);return!(this.settings.fragmentSelection!==!0||!t)||(!("cell"!==this.settings.fragmentSelection||!this.isSelectedOnlyCell()||!t)||!(this.settings.fragmentSelection||!this.isCellEdited()||!this.isSelectedOnlyCell()))},o.prototype.isSelectedOnlyCell=function(){var e=this.instance.getSelected()||[],t=e[0],n=e[1],o=e[2],r=e[3];return void 0!==t&&t===o&&n===r},o.prototype.isCellEdited=function(){var e=this.instance.getActiveEditor();return e&&e.isOpened()},o.prototype.beforeRender=function(e){e&&d.hooks.run(this.instance,"beforeRender",this.instance.forceFullRender)},o.prototype.onDraw=function(e){e&&d.hooks.run(this.instance,"afterRender",this.instance.forceFullRender)},o.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.forceFullRender=!1,this.instance.renderCall=!1},o.prototype.getCellAtCoords=function(e,t){var n=this.wt.getCell(e,t);return n<0?null:n},o.prototype.scrollViewport=function(e){this.wt.scrollViewport(e)},o.prototype.appendRowHeader=function(e,t){if(t.firstChild){var n=t.firstChild;if(!v(n,"relative"))return p(t),void this.appendRowHeader(e,t);this.updateCellHeader(n.querySelector(".rowHeader"),e,this.instance.getRowHeader)}else{var o=document.createElement("div"),r=document.createElement("span");o.className="relative",r.className="rowHeader",this.updateCellHeader(r,e,this.instance.getRowHeader),o.appendChild(r),t.appendChild(o)}d.hooks.run(this.instance,"afterGetRowHeader",e,t)},o.prototype.appendColHeader=function(e,t){if(t.firstChild){var n=t.firstChild;v(n,"relative")?this.updateCellHeader(n.querySelector(".colHeader"),e,this.instance.getColHeader):(p(t),this.appendColHeader(e,t))}else{var o=document.createElement("div"),r=document.createElement("span");o.className="relative",r.className="colHeader",this.updateCellHeader(r,e,this.instance.getColHeader),o.appendChild(r),t.appendChild(o)}d.hooks.run(this.instance,"afterGetColHeader",e,t)},o.prototype.updateCellHeader=function(e,t,n){var o=t,r=this.wt.wtOverlays.getParentOverlay(e)||this.wt;e.parentNode&&(v(e,"colHeader")?o=r.wtTable.columnFilter.sourceToRendered(t):v(e,"rowHeader")&&(o=r.wtTable.rowFilter.sourceToRendered(t))),o>-1?m(e,n(t)):(g(e,String.fromCharCode(160)),f(e,"cornerHeader"))},o.prototype.maximumVisibleElementWidth=function(e){var t=this.wt.wtViewport.getWorkspaceWidth(),n=t-e;return n>0?n:0},o.prototype.maximumVisibleElementHeight=function(e){var t=this.wt.wtViewport.getWorkspaceHeight(),n=t-e;return n>0?n:0},o.prototype.mainViewIsActive=function(){return this.wt===this.activeWt},o.prototype.destroy=function(){this.wt.destroy(),this.eventManager.destroy()}},{"3rdparty/walkontable/src/cell/coords":6,"3rdparty/walkontable/src/core":8,"3rdparty/walkontable/src/selection":19,browser:24,eventManager:42,"helpers/dom/element":47,"helpers/dom/event":48}],115:[function(e,t,n){"use strict";Object.defineProperties(n,{GhostTable:{get:function(){return m}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,c=(r=e("helpers/dom/element"),r&&r.__esModule&&r||{default:r}),d=c.addClass,h=c.outerHeight,f=c.outerWidth,p=(i=e("helpers/array"),i&&i.__esModule&&i||{default:i}).arrayEach,m=((s=e("helpers/object"),s&&s.__esModule&&s||{default:s}).objectEach,(a=e("helpers/number"),a&&a.__esModule&&a||{default:a}).rangeEach,(l=e("helpers/mixed"),l&&l.__esModule&&l||{default:l}).stringify,function(e){this.hot=e,this.container=null,this.injected=!1,this.rows=[],this.columns=[],this.samples=null,this.settings={useHeaders:!0}});$traceurRuntime.createClass(m,{addRow:function(e,t){if(this.columns.length)throw new Error("Doesn't support multi-dimensional table");this.rows.length||(this.container=this.createContainer(this.hot.rootElement.className));var n={row:e};this.rows.push(n),this.samples=t,this.table=this.createTable(this.hot.table.className),this.table.colGroup.appendChild(this.createColGroupsCol()),this.table.tr.appendChild(this.createRow(e)),this.container.container.appendChild(this.table.fragment),n.table=this.table.table},addColumnHeadersRow:function(e){if(null!=this.hot.getColHeader(0)){var t={row:-1};this.rows.push(t),this.container=this.createContainer(this.hot.rootElement.className),this.samples=e,this.table=this.createTable(this.hot.table.className),this.table.colGroup.appendChild(this.createColGroupsCol()),this.table.tHead.appendChild(this.createColumnHeadersRow()),this.container.container.appendChild(this.table.fragment),t.table=this.table.table}},addColumn:function(e,t){if(this.rows.length)throw new Error("Doesn't support multi-dimensional table");this.columns.length||(this.container=this.createContainer(this.hot.rootElement.className));var n={col:e};this.columns.push(n),this.samples=t,this.table=this.createTable(this.hot.table.className),this.getSetting("useHeaders")&&null!==this.hot.getColHeader(e)&&this.hot.view.appendColHeader(e,this.table.th),this.table.tBody.appendChild(this.createCol(e)),this.container.container.appendChild(this.table.fragment),n.table=this.table.table},getHeights:function(e){this.injected||this.injectTable(),p(this.rows,function(t){e(t.row,h(t.table)-1)})},getWidths:function(e){this.injected||this.injectTable(),p(this.columns,function(t){e(t.col,f(t.table))})},setSettings:function(e){this.settings=e},setSetting:function(e,t){this.settings||(this.settings={}),this.settings[e]=t},getSettings:function(){return this.settings},getSetting:function(e){return this.settings?this.settings[e]:null},createColGroupsCol:function(){var e=this,t=document,n=t.createDocumentFragment();return this.hot.hasRowHeaders()&&n.appendChild(this.createColElement(-1)),this.samples.forEach(function(t){p(t.strings,function(t){n.appendChild(e.createColElement(t.col))})}),n},createRow:function(e){var t=this,n=document,o=n.createDocumentFragment(),r=n.createElement("th");return this.hot.hasRowHeaders()&&(this.hot.view.appendRowHeader(e,r),o.appendChild(r)),this.samples.forEach(function(r){p(r.strings,function(r){var i=r.col,s=t.hot.getCellMeta(e,i);s.col=i,s.row=e;var a=t.hot.getCellRenderer(s),l=n.createElement("td");a(t.hot,l,e,i,t.hot.colToProp(i),r.value,s),o.appendChild(l)})}),o},createColumnHeadersRow:function(){var e=this,t=document,n=t.createDocumentFragment();if(this.hot.hasRowHeaders()){var o=t.createElement("th");this.hot.view.appendColHeader(-1,o),n.appendChild(o)}return this.samples.forEach(function(o){p(o.strings,function(o){var r=o.col,i=t.createElement("th");e.hot.view.appendColHeader(r,i),n.appendChild(i)})}),n},createCol:function(e){var t=this,n=document,o=n.createDocumentFragment();return this.samples.forEach(function(r){p(r.strings,function(r){var i=r.row,s=t.hot.getCellMeta(i,e);s.col=e,s.row=i;var a=t.hot.getCellRenderer(s),l=n.createElement("td"),u=n.createElement("tr");a(t.hot,l,i,e,t.hot.colToProp(e),r.value,s),u.appendChild(l),o.appendChild(u)})}),o},clean:function(){this.rows.length=0,this.rows[-1]=void 0,this.columns.length=0,this.samples&&this.samples.clear(),this.samples=null,this.removeTable()},injectTable:function(){var e=void 0!==arguments[0]?arguments[0]:null;this.injected||((e||this.hot.rootElement).appendChild(this.container.fragment),this.injected=!0)},removeTable:function(){this.injected&&this.container.container.parentNode&&(this.container.container.parentNode.removeChild(this.container.container),this.container=null,this.injected=!1)},createColElement:function(e){var t=document,n=t.createElement("col");return n.style.width=this.hot.view.wt.wtTable.getStretchedColumnWidth(e)+"px",n},createTable:function(){var e=void 0!==arguments[0]?arguments[0]:"",t=document,n=t.createDocumentFragment(),o=t.createElement("table"),r=t.createElement("thead"),i=t.createElement("tbody"),s=t.createElement("colgroup"),a=t.createElement("tr"),l=t.createElement("th");return this.isVertical()&&o.appendChild(s),this.isHorizontal()&&(a.appendChild(l),r.appendChild(a),o.style.tableLayout="auto",o.style.width="auto"),o.appendChild(r),this.isVertical()&&i.appendChild(a),o.appendChild(i),d(o,e),n.appendChild(o),{fragment:n,table:o,tHead:r,tBody:i,colGroup:s,tr:a,th:l}},createContainer:function(){var e=void 0!==arguments[0]?arguments[0]:"",t=document,n=t.createDocumentFragment(),o=t.createElement("div");return e="htGhostTable htAutoSize "+e.trim(),d(o,e),n.appendChild(o),{fragment:n,container:o}},isVertical:function(){return!(!this.rows.length||this.columns.length)},isHorizontal:function(){return!(!this.columns.length||this.rows.length)}},{}),u.utils.GhostTable=m},{browser:24,"helpers/array":43,"helpers/dom/element":47,"helpers/mixed":51,"helpers/number":52,"helpers/object":53}],116:[function(e,t,n){"use strict";function o(e){return"string"==typeof e&&/fps$/.test(e)&&(e=1e3/parseInt(e.replace("fps","")||0,10)),e}Object.defineProperties(n,{Interval:{get:function(){return p}},__esModule:{value:!0}});var r,i,s,a,l,u,c=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,d=(i=e("helpers/feature"),i&&i.__esModule&&i||{default:i}),h=d.requestAnimationFrame,f=d.cancelAnimationFrame,p=((s=e("helpers/array"),s&&s.__esModule&&s||{default:s}).arrayEach,(a=e("helpers/object"),a&&a.__esModule&&a||{default:a}).objectEach,(l=e("helpers/number"),l&&l.__esModule&&l||{default:l}).rangeEach,(u=e("helpers/mixed"),u&&u.__esModule&&u||{default:u}).stringify,function(e,t){var n=this;this.timer=null,this.func=e,this.delay=o(t),this.stopped=!0,this._then=null,this._callback=function(){return n.__callback()}}),m=p;$traceurRuntime.createClass(p,{start:function(){return this.stopped&&(this._then=Date.now(),this.stopped=!1,this.timer=h(this._callback)),this},stop:function(){return this.stopped||(this.stopped=!0,f(this.timer),this.timer=null),this},__callback:function(){if(this.timer=h(this._callback),this.delay){var e=Date.now(),t=e-this._then;t>this.delay&&(this._then=e-t%this.delay,this.func())}else this.func()}},{create:function(e,t){return new m(e,t)}}),c.utils.Interval=p},{browser:24,"helpers/array":43,"helpers/feature":49,"helpers/mixed":51,"helpers/number":52,"helpers/object":53}],117:[function(e,t,n){"use strict";var o;Object.defineProperties(n,{SamplesGenerator:{get:function(){return g}},__esModule:{value:!0}});var r,i,s,a,l,u,c=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,d=(i=e("helpers/dom/element"),i&&i.__esModule&&i||{default:i}),h=(d.addClass,d.outerHeight,d.outerWidth,(s=e("helpers/array"),s&&s.__esModule&&s||{default:s}).arrayEach,a=e("helpers/object"),a&&a.__esModule&&a||{default:a}),f=(h.objectEach,h.isObject),p=(l=e("helpers/number"),l&&l.__esModule&&l||{default:l}).rangeEach,m=(u=e("helpers/mixed"),u&&u.__esModule&&u||{default:u}).stringify,g=function(e){this.samples=null,this.dataFactory=e,this.customSampleCount=null},w=g;$traceurRuntime.createClass(g,(o={},Object.defineProperty(o,"getSampleCount",{value:function(){return this.customSampleCount?this.customSampleCount:w.SAMPLE_COUNT},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"generateRowSamples",{value:function(e,t){return this.generateSamples("row",t,e)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"generateColumnSamples",{value:function(e,t){return this.generateSamples("col",t,e)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"generateSamples",{value:function(e,t,n){var o=this,r=new Map;return"number"==typeof n&&(n={from:n,to:n}),p(n.from,n.to,function(n){var i=o.generateSample(e,t,n);r.set(n,i)}),r},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"generateSample",{value:function(e,t,n){var o,r=this,i=new Map,s=[];return p(t.from,t.to,function(t){var a,l;if("row"===e)l=r.dataFactory(n,t);else{if("col"!==e)throw new Error("Unsupported sample type");l=r.dataFactory(t,n)}o=f(l)?Object.keys(l).length:Array.isArray(l)?l.length:m(l).length,i.has(o)||i.set(o,{needed:r.getSampleCount(),strings:[]
+});var u=i.get(o);if(u.needed){var c=s.indexOf(l)>-1;if(!c){var d="row"===e?"col":"row";u.strings.push((a={},Object.defineProperty(a,"value",{value:l,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(a,d,{value:t,configurable:!0,enumerable:!0,writable:!0}),a)),s.push(l),u.needed--}}}),i},configurable:!0,enumerable:!0,writable:!0}),o),{get SAMPLE_COUNT(){return 3}}),c.utils.SamplesGenerator=g},{browser:24,"helpers/array":43,"helpers/dom/element":47,"helpers/mixed":51,"helpers/number":52,"helpers/object":53}],118:[function(e,t,n){"use strict";function o(e,t){var n=e,o="string"==typeof n?n.toLowerCase():null;return function(e){for(var r=!1,i=0,s=e.length;i<s;i++){if(n===e[i]){r=!0;break}if(o===a(e[i]).toLowerCase()){r=!0;break}}t(r)}}var r,i,s=(r=e("browser"),r&&r.__esModule&&r||{default:r}).default,a=(i=e("helpers/mixed"),i&&i.__esModule&&i||{default:i}).stringify;s.AutocompleteValidator=function(e,t){return null==e&&(e=""),this.allowEmpty&&""===e?void t(!0):void(this.strict&&this.source?"function"==typeof this.source?this.source(e,o(e,t)):o(e,t)(this.source):t(!0))}},{browser:24,"helpers/mixed":51}],119:[function(e,t,n){"use strict";var o,r,i,s,a=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,l=(r=e("moment"),r&&r.__esModule&&r||{default:r}).default,u=(i=e("../helpers/date"),i&&i.__esModule&&i||{default:i}).getNormalizedDate,c=(s=e("editors"),s&&s.__esModule&&s||{default:s}).getEditor;a.DateValidator=function(e,t){var n=!0,o=c("date",this.instance);null==e&&(e="");var r=l(new Date(e)).isValid(),i=l(e,this.dateFormat||o.defaultDateFormat,!0).isValid();if(this.allowEmpty&&""===e&&(r=!0,i=!0),r||(n=!1),!r&&i&&(n=!0),r&&!i)if(this.correctFormat===!0){var s=d(e,this.dateFormat);this.instance.setDataAtCell(this.row,this.col,s,"dateValidator"),n=!0}else n=!1;t(n)};var d=function(e,t){var n=l(u(e)),o=n.format("YYYY"),r=l().format("YYYY");return o.substr(0,2)!==r.substr(0,2)?e.match(new RegExp(o))||n.year(o.replace(o.substr(0,2),r.substr(0,2))):o.length>4&&n.year((n.year()+"").substr(0,4)),n.format(t)}},{"../helpers/date":46,browser:24,editors:30,moment:"moment"}],120:[function(e,t,n){"use strict";var o,r=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default;r.NumericValidator=function(e,t){null==e&&(e=""),t(this.allowEmpty&&""===e?!0:""===e?!1:/^-?\d*(\.|\,)?\d*$/.test(e))}},{browser:24}],121:[function(e,t,n){"use strict";var o,r,i=(o=e("browser"),o&&o.__esModule&&o||{default:o}).default,s=(r=e("moment"),r&&r.__esModule&&r||{default:r}).default,a=["YYYY-MM-DDTHH:mm:ss.SSSZ","X","x"];i.TimeValidator=function(e,t){var n=!0,o=this.timeFormat||"h:mm:ss a";null===e&&(e=""),e=/^\d{3,}$/.test(e)?parseInt(e,10):e;var r=/^\d{1,2}$/.test(e);r&&(e+=":00");var i=s(e,a,!0).isValid()?s(e):s(e,o),l=i.isValid(),u=s(e,o,!0).isValid()&&!r;if(this.allowEmpty&&""===e&&(l=!0,u=!0),l||(n=!1),!l&&u&&(n=!0),l&&!u)if(this.correctFormat===!0){var c=i.format(o);this.instance.setDataAtCell(this.row,this.col,c,"timeValidator"),n=!0}else n=!1;t(n)}},{browser:24,moment:"moment"}],SheetClip:[function(e,t,n){!function(e){"use strict";function t(e){return e.split('"').length-1}var o={parse:function(e){var n,o,r,i,s,a,l,u=[],c=0;for(r=e.split("\n"),r.length>1&&""===r[r.length-1]&&r.pop(),n=0,o=r.length;n<o;n+=1){for(r[n]=r[n].split("\t"),i=0,s=r[n].length;i<s;i+=1)u[c]||(u[c]=[]),a&&0===i?(l=u[c].length-1,u[c][l]=u[c][l]+"\n"+r[n][0],a&&1&t(r[n][0])&&(a=!1,u[c][l]=u[c][l].substring(0,u[c][l].length-1).replace(/""/g,'"'))):i===s-1&&0===r[n][i].indexOf('"')&&1&t(r[n][i])?(u[c].push(r[n][i].substring(1).replace(/""/g,'"')),a=!0):(u[c].push(r[n][i].replace(/""/g,'"')),a=!1);a||(c+=1)}return u},stringify:function(e){var t,n,o,r,i,s="";for(t=0,n=e.length;t<n;t+=1){for(r=e[t].length,o=0;o<r;o+=1)o>0&&(s+="\t"),i=e[t][o],s+="string"==typeof i?i.indexOf("\n")>-1?'"'+i.replace(/"/g,'""')+'"':i:null===i||void 0===i?"":i;s+="\n"}return s}};"undefined"!=typeof n?(n.parse=o.parse,n.stringify=o.stringify):e.SheetClip=o}(window)},{}],autoResize:[function(e,t,n){function o(){function e(e){return e.currentStyle||document.defaultView.getComputedStyle(e)}var t,n={minHeight:200,maxHeight:300,minWidth:100,maxWidth:300},o=document.body,r=document.createTextNode(""),i=document.createElement("SPAN"),s=function(e,t,n){window.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},a=function(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},l=function(s){var a,l;s?/^[a-zA-Z \.,\\\/\|0-9]$/.test(s)||(s="."):s="",void 0!==r.textContent?r.textContent=t.value+s:r.data=t.value+s,i.style.fontSize=e(t).fontSize,i.style.fontFamily=e(t).fontFamily,i.style.whiteSpace="pre",o.appendChild(i),a=i.clientWidth+2,o.removeChild(i),t.style.height=n.minHeight+"px",n.minWidth>a?t.style.width=n.minWidth+"px":a>n.maxWidth?t.style.width=n.maxWidth+"px":t.style.width=a+"px",l=t.scrollHeight?t.scrollHeight-1:0,n.minHeight>l?t.style.height=n.minHeight+"px":n.maxHeight<l?(t.style.height=n.maxHeight+"px",t.style.overflowY="visible"):t.style.height=l+"px"},u=function(){window.setTimeout(l,0)},c=function(e){if(e&&e.minHeight)if("inherit"==e.minHeight)n.minHeight=t.clientHeight;else{var o=parseInt(e.minHeight);isNaN(o)||(n.minHeight=o)}if(e&&e.maxHeight)if("inherit"==e.maxHeight)n.maxHeight=t.clientHeight;else{var s=parseInt(e.maxHeight);isNaN(s)||(n.maxHeight=s)}if(e&&e.minWidth)if("inherit"==e.minWidth)n.minWidth=t.clientWidth;else{var a=parseInt(e.minWidth);isNaN(a)||(n.minWidth=a)}if(e&&e.maxWidth)if("inherit"==e.maxWidth)n.maxWidth=t.clientWidth;else{var l=parseInt(e.maxWidth);isNaN(l)||(n.maxWidth=l)}i.firstChild||(i.className="autoResize",i.style.display="inline-block",i.appendChild(r))},d=function(e,o,r){t=e,c(o),"TEXTAREA"==t.nodeName&&(t.style.resize="none",t.style.overflowY="",t.style.height=n.minHeight+"px",t.style.minWidth=n.minWidth+"px",t.style.maxWidth=n.maxWidth+"px",t.style.overflowY="hidden"),r&&(s(t,"change",l),s(t,"cut",u),s(t,"paste",u),s(t,"drop",u),s(t,"keydown",u),s(t,"focus",l)),l()};return{init:function(e,t,n){d(e,t,n)},unObserve:function(){a(t,"change",l),a(t,"cut",u),a(t,"paste",u),a(t,"drop",u),a(t,"keydown",u),a(t,"focus",l)},resize:l}}"undefined"!=typeof n&&(t.exports=o)},{}],copyPaste:[function(e,t,n){function o(){return i?i.hasBeenDestroyed()&&i.init():i=new r,i.refCounter++,i}function r(){this.refCounter=0,this.init()}var i;"undefined"!=typeof n&&(t.exports=o),r.prototype.init=function(){var e,t;this.copyCallbacks=[],this.cutCallbacks=[],this.pasteCallbacks=[],t=document.body,document.getElementById("CopyPasteDiv")?(this.elDiv=document.getElementById("CopyPasteDiv"),this.elTextarea=this.elDiv.firstChild):(this.elDiv=document.createElement("div"),this.elDiv.id="CopyPasteDiv",e=this.elDiv.style,e.position="fixed",e.top="-10000px",e.left="-10000px",t.appendChild(this.elDiv),this.elTextarea=document.createElement("textarea"),this.elTextarea.className="copyPaste",this.elTextarea.onpaste=function(e){var t,n;"WebkitAppearance"in document.documentElement.style&&(t=e.clipboardData.getData("Text"),navigator.userAgent.indexOf("Safari")!==-1&&navigator.userAgent.indexOf("Chrome")===-1&&(n=t.split("\n"),""===n[n.length-1]&&n.pop(),t=n.join("\n")),this.value=t,e.preventDefault())},e=this.elTextarea.style,e.width="10000px",e.height="10000px",e.overflow="hidden",this.elDiv.appendChild(this.elTextarea),"undefined"!=typeof e.opacity&&(e.opacity=0)),this.onKeyDownRef=this.onKeyDown.bind(this),document.documentElement.addEventListener("keydown",this.onKeyDownRef,!1)},r.prototype.onKeyDown=function(e){function t(){var e=document.activeElement;return e.shadowRoot&&e.shadowRoot.activeElement&&(e=e.shadowRoot.activeElement),["INPUT","SELECT","TEXTAREA"].indexOf(e.nodeName)>-1||"true"===e.contentEditable}var n=this,o=!1;if(e.metaKey?o=!0:e.ctrlKey&&navigator.userAgent.indexOf("Mac")===-1&&(o=!0),o){if(document.activeElement!==this.elTextarea&&(""!==this.getSelectionText()||t()))return;this.selectNodeText(this.elTextarea),setTimeout(function(){document.activeElement!==n.elTextarea&&n.selectNodeText(n.elTextarea)},0)}e.isImmediatePropagationEnabled===!1||!o||67!==e.keyCode&&86!==e.keyCode&&88!==e.keyCode||(88===e.keyCode?setTimeout(function(){n.triggerCut(e)},0):86===e.keyCode&&setTimeout(function(){n.triggerPaste(e)},0))},r.prototype.selectNodeText=function(e){e&&e.select()},r.prototype.getSelectionText=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!==document.selection.type&&(e=document.selection.createRange().text),e},r.prototype.copyable=function(e){if("string"!=typeof e&&void 0===e.toString)throw new Error("copyable requires string parameter");this.elTextarea.value=e,this.selectNodeText(this.elTextarea)},r.prototype.onCut=function(e){this.cutCallbacks.push(e)},r.prototype.onPaste=function(e){this.pasteCallbacks.push(e)},r.prototype.removeCallback=function(e){var t,n;for(t=0,n=this.copyCallbacks.length;t<n;t++)if(this.copyCallbacks[t]===e)return this.copyCallbacks.splice(t,1),!0;for(t=0,n=this.cutCallbacks.length;t<n;t++)if(this.cutCallbacks[t]===e)return this.cutCallbacks.splice(t,1),!0;for(t=0,n=this.pasteCallbacks.length;t<n;t++)if(this.pasteCallbacks[t]===e)return this.pasteCallbacks.splice(t,1),!0;return!1},r.prototype.triggerCut=function(e){var t=this;t.cutCallbacks&&setTimeout(function(){for(var n=0,o=t.cutCallbacks.length;n<o;n++)t.cutCallbacks[n](e)},50)},r.prototype.triggerPaste=function(e,t){var n=this;n.pasteCallbacks&&setTimeout(function(){for(var o=t||n.elTextarea.value,r=0,i=n.pasteCallbacks.length;r<i;r++)n.pasteCallbacks[r](o,e)},50)},r.prototype.destroy=function(){this.hasBeenDestroyed()||0!==--this.refCounter||(this.elDiv&&this.elDiv.parentNode&&(this.elDiv.parentNode.removeChild(this.elDiv),this.elDiv=null,this.elTextarea=null),document.documentElement.removeEventListener("keydown",this.onKeyDownRef),this.onKeyDownRef=null)},r.prototype.hasBeenDestroyed=function(){return!this.refCounter}},{}],es6collections:[function(e,t,n){/*!
+ * Copyright (C) 2011 by Andrea Giammarchi, @WebReflection
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the "Software"), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in
+ * all copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+ * THE SOFTWARE.
+ */
+!function(e){"use strict";function t(e,t){function o(e){return this&&this.constructor===o?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=t,void(e&&n.call(this,e))):new o(e)}return t||y(e,"size",{get:g}),e.constructor=o,o.prototype=e,o}function n(e){this.add?e.forEach(this.add,this):e.forEach(function(e){this.set(e[0],e[1])},this)}function o(e){return this.has(e)&&(this._keys.splice(v,1),this._values.splice(v,1),this._itp.forEach(function(e){v<e[0]&&e[0]--})),-1<v}function r(e){return this.has(e)?this._values[v]:void 0}function i(e,t){if(this.objectOnly&&t!==Object(t))throw new TypeError("Invalid value used as weak collection key");if(t!=t||0===t)for(v=e.length;v--&&!b(e[v],t););else v=e.indexOf(t);return-1<v}function s(e){return i.call(this,this._values,e)}function a(e){return i.call(this,this._keys,e)}function l(e,t){return this.has(e)?this._values[v]=t:this._values[this._keys.push(e)-1]=t,this}function u(e){return this.has(e)||this._values.push(e),this}function c(){this._values.length=0}function d(){return m(this._itp,this._keys)}function h(){return m(this._itp,this._values)}function f(){return m(this._itp,this._keys,this._values)}function p(){return m(this._itp,this._values,this._values)}function m(e,t,n){var o=[0],r=!1;return e.push(o),{next:function(){var i,s=o[0];return!r&&s<t.length?(i=n?[t[s],n[s]]:t[s],o[0]++):(r=!0,e.splice(e.indexOf(o),1)),{done:r,value:i}}}}function g(){return this._values.length}function w(e,t){for(var n=this.entries();;){var o=n.next();if(o.done)break;e.call(t,o.value[1],o.value[0],this)}}var v,y=Object.defineProperty,b=function(e,t){return isNaN(e)?isNaN(t):e===t};"undefined"==typeof WeakMap&&(e.WeakMap=t({delete:o,clear:c,get:r,has:a,set:l},!0)),"undefined"==typeof Map&&(e.Map=t({delete:o,has:a,get:r,set:l,keys:d,values:h,entries:f,forEach:w,clear:c})),"undefined"==typeof Set&&(e.Set=t({has:s,add:u,delete:o,clear:c,keys:h,values:h,entries:p,forEach:w})),"undefined"==typeof WeakSet&&(e.WeakSet=t({delete:o,add:u,clear:c,has:s},!0))}("undefined"!=typeof n&&"undefined"!=typeof global?global:window)},{}],jsonpatch:[function(e,t,n){/*!
+ * https://github.com/Starcounter-Jack/JSON-Patch
+ * json-patch-duplex.js version: 0.5.7
+ * (c) 2013 Joachim Wester
+ * MIT license
+ */
+var o,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=Error;!function(e){function t(e,n){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===n;case"object":if(null===e)return null===n;if(M(e)){if(!M(n)||e.length!==n.length)return!1;for(var o=0,r=e.length;o<r;o++)if(!t(e[o],n[o]))return!1;return!0}var i=y(n),s=i.length;if(y(e).length!==s)return!1;for(var o=0;o<s;o++)if(!t(e[o],n[o]))return!1;return!0;default:return!1}}function n(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function o(e){for(var t=0,n=R.length;t<n;t++)if(R[t].obj===e)return R[t]}function s(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].callback===t)return e.observers[n].observer}function a(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}function l(e,t){t.unobserve()}function u(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function c(e,t){var n,r=[],l=o(e);if(l?n=s(l,t):(l=new S(e),R.push(l)),n)return n;if(n={},l.value=u(e),t){n.callback=t,n.next=null;var c=this.intervals||[100,1e3,1e4,6e4];if(void 0===c.push)throw new i("jsonpatch.intervals must be an array");var h=0,f=function(){d(n)},p=function(){clearTimeout(n.next),n.next=setTimeout(function(){f(),h=0,n.next=setTimeout(m,c[h++])},0)},m=function(){f(),h==c.length&&(h=c.length-1),n.next=setTimeout(m,c[h++])};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mousedown",p),window.addEventListener("mouseup",p),window.addEventListener("keydown",p)):(document.documentElement.attachEvent("onmousedown",p),document.documentElement.attachEvent("onmouseup",p),document.documentElement.attachEvent("onkeydown",p))),n.next=setTimeout(m,c[h++])}return n.patches=r,n.object=e,n.unobserve=function(){d(n),clearTimeout(n.next),a(l,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mousedown",p),window.removeEventListener("mouseup",p),window.removeEventListener("keydown",p)):(document.documentElement.detachEvent("onmousedown",p),document.documentElement.detachEvent("onmouseup",p),document.documentElement.detachEvent("onkeydown",p)))},l.observers.push(new E(t,n)),n}function d(e){for(var t,n=0,o=R.length;n<o;n++)if(R[n].obj===e.object){t=R[n];break}h(t.value,e.object,e.patches,""),e.patches.length&&p(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function h(e,t,o,r){for(var i=y(t),s=y(e),a=!1,l=!1,c=s.length-1;c>=0;c--){var d=s[c],f=e[d];if(t.hasOwnProperty(d)){var p=t[d];"object"==typeof f&&null!=f&&"object"==typeof p&&null!=p?h(f,p,o,r+"/"+n(d)):f!=p&&(a=!0,o.push({op:"replace",path:r+"/"+n(d),value:u(p)}))}else o.push({op:"remove",path:r+"/"+n(d)}),l=!0}if(l||i.length!=s.length)for(var c=0;c<i.length;c++){var d=i[c];e.hasOwnProperty(d)||o.push({op:"add",path:r+"/"+n(d),value:u(t[d])})}}function f(e){for(var t,n=0,o=e.length;n<o;){t=e.charCodeAt(n);{if(!(t>=48&&t<=57))return!1;n++}}return!0}function p(e,t,n){for(var o,r,i=!1,s=0,a=t.length;s<a;){o=t[s],s++;for(var l=o.path||"",u=l.split("/"),c=e,d=1,h=u.length,p=void 0;;){if(r=u[d],n&&void 0===p&&(void 0===c[r]?p=u.slice(0,d).join("/"):d==h-1&&(p=o.path),void 0!==p&&this.validator(o,s-1,e,p)),d++,void 0===r&&d>=h){i=_[o.op].call(o,c,r,e);break}if(M(c)){if("-"===r)r=c.length;else{if(n&&!f(r))throw new T("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s-1,o.path,o);r=parseInt(r,10)}if(d>=h){if(n&&"add"===o.op&&r>c.length)throw new T("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s-1,o.path,o);i=C[o.op].call(o,c,r,e);break}}else if(r&&r.indexOf("~")!=-1&&(r=r.replace(/~1/g,"/").replace(/~0/g,"~")),d>=h){i=b[o.op].call(o,c,r,e);break}c=c[r]}}return i}function m(e,t){var n=[];return h(e,t,n,""),n}function g(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(g(e[t]))return!0;return!1}function w(t,n,o,r){if("object"!=typeof t||null===t||M(t))throw new T("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,t,o);if(!b[t.op])throw new T("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,o);if("string"!=typeof t.path)throw new T("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,t,o);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new T("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new T("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,t,o);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&g(t.value))throw new T("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,t,o);if(o)if("add"==t.op){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new T("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,t,o)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new T("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,t,o)}else if("move"===t.op||"copy"===t.op){var a={op:"_get",path:t.from,value:void 0},l=e.validate([a],o);if(l&&"OPERATION_PATH_UNRESOLVABLE"===l.name)throw new T("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,t,o)}}function v(e,t){try{if(!M(e))throw new T("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),p.call(this,t,e,!0);else for(var n=0;n<e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof T)return e;throw e}}var y=function(e){if(M(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o);return t},b={add:function(e,t){return e[t]=this.value,!0},remove:function(e,t){return delete e[t],!0},replace:function(e,t){return e[t]=this.value,!0},move:function(e,t,n){var o={op:"_get",path:this.from};return p(n,[o]),p(n,[{op:"remove",path:this.from}]),p(n,[{op:"add",path:this.path,value:o.value}]),!0},copy:function(e,t,n){var o={op:"_get",path:this.from};return p(n,[o]),p(n,[{op:"add",path:this.path,value:o.value}]),!0},test:function(e,n){return t(e[n],this.value)},_get:function(e,t){this.value=e[t]}},C={add:function(e,t){return e.splice(t,0,this.value),!0},remove:function(e,t){return e.splice(t,1),!0},replace:function(e,t){return e[t]=this.value,!0},move:b.move,copy:b.copy,test:b.test,_get:b._get},_={add:function(e){_.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t]);return!0},remove:function(e){for(var t in e)e.hasOwnProperty(t)&&b.remove.call(this,e,t);return!0},replace:function(e){return p(e,[{op:"remove",path:this.path}]),p(e,[{op:"add",path:this.path,value:this.value}]),!0},move:b.move,copy:b.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}},R=[],S=function(){function e(e){this.observers=[],this.obj=e}return e}(),E=function(){function e(e,t){this.callback=e,this.observer=t}return e}();e.unobserve=l,e.observe=c,e.generate=d;var M;M=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},e.apply=p,e.compare=m;var T=function(e){function t(t,n,o,r,i){e.call(this,t),this.message=t,this.name=n,this.index=o,this.operation=r,this.tree=i}return r(t,e),t}(i);e.JsonPatchError=T,e.Error=T,e.validator=w,e.validate=v}(o||(o={})),"undefined"!=typeof n&&(n.apply=o.apply,n.observe=o.observe,n.unobserve=o.unobserve,n.generate=o.generate,n.compare=o.compare,n.validate=o.validate,n.validator=o.validator,n.JsonPatchError=o.JsonPatchError,n.Error=o.Error)},{}],moment:[function(t,n,o){!function(t,r){"object"==typeof o&&"undefined"!=typeof n?n.exports=r():"function"==typeof e&&e.amd?e(r):t.moment=r()}(this,function(){"use strict";function e(){return go.apply(null,arguments)}function o(e){go=e}function r(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){var t;for(t in e)return!1;return!0}function a(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function l(e,t){var n,o=[];for(n=0;n<e.length;++n)o.push(t(e[n],n));return o}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var n in t)u(t,n)&&(e[n]=t[n]);return u(t,"toString")&&(e.toString=t.toString),u(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t,n,o){return vt(e,t,n,o,!0).utc()}function h(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null}}function f(e){return null==e._pf&&(e._pf=h()),e._pf}function p(e){if(null==e._isValid){var t=f(e),n=wo.call(t.parsedDateParts,function(e){return null!=e});e._isValid=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n),e._strict&&(e._isValid=e._isValid&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)}return e._isValid}function m(e){var t=d(NaN);return null!=e?c(f(t),e):f(t).userInvalidated=!0,t}function g(e){return void 0===e}function w(e,t){var n,o,r;if(g(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),g(t._i)||(e._i=t._i),g(t._f)||(e._f=t._f),g(t._l)||(e._l=t._l),g(t._strict)||(e._strict=t._strict),g(t._tzm)||(e._tzm=t._tzm),g(t._isUTC)||(e._isUTC=t._isUTC),g(t._offset)||(e._offset=t._offset),g(t._pf)||(e._pf=f(t)),g(t._locale)||(e._locale=t._locale),vo.length>0)for(n in vo)o=vo[n],r=t[o],g(r)||(e[o]=r);return e}function v(t){w(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),yo===!1&&(yo=!0,e.updateOffset(this),yo=!1)}function y(e){return e instanceof v||null!=e&&null!=e._isAMomentObject}function b(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function C(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=b(t)),n}function _(e,t,n){var o,r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),s=0;for(o=0;o<r;o++)(n&&e[o]!==t[o]||!n&&C(e[o])!==C(t[o]))&&s++;return s+i}function R(t){e.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function S(t,n){var o=!0;return c(function(){return null!=e.deprecationHandler&&e.deprecationHandler(null,t),o&&(R(t+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),o=!1),n.apply(this,arguments)},n)}function E(t,n){null!=e.deprecationHandler&&e.deprecationHandler(t,n),bo[t]||(R(n),bo[t]=!0)}function M(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function T(e){var t,n;for(n in e)t=e[n],M(t)?this[n]=t:this["_"+n]=t;this._config=e,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function O(e,t){var n,o=c({},e);for(n in t)u(t,n)&&(i(e[n])&&i(t[n])?(o[n]={},c(o[n],e[n]),c(o[n],t[n])):null!=t[n]?o[n]=t[n]:delete o[n]);for(n in e)u(e,n)&&!u(t,n)&&i(e[n])&&(o[n]=c({},o[n]));return o}function k(e){null!=e&&this.set(e)}function x(e,t,n){var o=this._calendar[e]||this._calendar.sameElse;return M(o)?o.call(t,n):o}function H(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])}function D(){return this._invalidDate}function A(e){return this._ordinal.replace("%d",e)}function P(e,t,n,o){var r=this._relativeTime[n];return M(r)?r(e,t,n,o):r.replace(/%d/i,e)}function N(e,t){var n=this._relativeTime[e>0?"future":"past"];return M(n)?n(t):n.replace(/%s/i,t)}function L(e,t){var n=e.toLowerCase();ko[n]=ko[n+"s"]=ko[t]=e}function W(e){return"string"==typeof e?ko[e]||ko[e.toLowerCase()]:void 0}function I(e){var t,n,o={};for(n in e)u(e,n)&&(t=W(n),t&&(o[t]=e[n]));return o}function j(e,t){xo[e]=t}function V(e){var t=[];for(var n in e)t.push({unit:n,priority:xo[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}function F(t,n){return function(o){return null!=o?(z(this,t,o),e.updateOffset(this,n),this):B(this,t)}}function B(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function z(e,t,n){e.isValid()&&e._d["set"+(e._isUTC?"UTC":"")+t](n)}function Y(e){return e=W(e),M(this[e])?this[e]():this}function U(e,t){if("object"==typeof e){e=I(e);for(var n=V(e),o=0;o<n.length;o++)this[n[o].unit](e[n[o].unit])}else if(e=W(e),M(this[e]))return this[e](t);return this}function G(e,t,n){var o=""+Math.abs(e),r=t-o.length,i=e>=0;return(i?n?"+":"":"-")+Math.pow(10,Math.max(0,r)).toString().substr(1)+o}function $(e,t,n,o){var r=o;"string"==typeof o&&(r=function(){return this[o]()}),e&&(Po[e]=r),t&&(Po[t[0]]=function(){return G(r.apply(this,arguments),t[1],t[2])}),n&&(Po[n]=function(){return this.localeData().ordinal(r.apply(this,arguments),e)})}function K(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function X(e){var t,n,o=e.match(Ho);for(t=0,n=o.length;t<n;t++)Po[o[t]]?o[t]=Po[o[t]]:o[t]=K(o[t]);return function(t){var r,i="";for(r=0;r<n;r++)i+=o[r]instanceof Function?o[r].call(t,e):o[r];return i}}function q(e,t){return e.isValid()?(t=Z(t,e.localeData()),Ao[t]=Ao[t]||X(t),Ao[t](e)):e.localeData().invalidDate()}function Z(e,t){function n(e){return t.longDateFormat(e)||e}var o=5;for(Do.lastIndex=0;o>=0&&Do.test(e);)e=e.replace(Do,n),Do.lastIndex=0,o-=1;return e}function J(e,t,n){Jo[e]=M(t)?t:function(e,o){return e&&n?n:t}}function Q(e,t){return u(Jo,e)?Jo[e](t._strict,t._locale):new RegExp(ee(e))}function ee(e){return te(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,o,r){return t||n||o||r}))}function te(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ne(e,t){var n,o=t;for("string"==typeof e&&(e=[e]),"number"==typeof t&&(o=function(e,n){n[t]=C(e)}),n=0;n<e.length;n++)Qo[e[n]]=o}function oe(e,t){ne(e,function(e,n,o,r){o._w=o._w||{},t(e,o._w,o,r)})}function re(e,t,n){null!=t&&u(Qo,e)&&Qo[e](t,n._a,n,e)}function ie(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function se(e,t){return r(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||ur).test(t)?"format":"standalone"][e.month()]}function ae(e,t){return r(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[ur.test(t)?"format":"standalone"][e.month()]}function le(e,t,n){var o,r,i,s=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],o=0;o<12;++o)i=d([2e3,o]),this._shortMonthsParse[o]=this.monthsShort(i,"").toLocaleLowerCase(),this._longMonthsParse[o]=this.months(i,"").toLocaleLowerCase();return n?"MMM"===t?(r=_o.call(this._shortMonthsParse,s),r!==-1?r:null):(r=_o.call(this._longMonthsParse,s),r!==-1?r:null):"MMM"===t?(r=_o.call(this._shortMonthsParse,s),r!==-1?r:(r=_o.call(this._longMonthsParse,s),r!==-1?r:null)):(r=_o.call(this._longMonthsParse,s),r!==-1?r:(r=_o.call(this._shortMonthsParse,s),r!==-1?r:null))}function ue(e,t,n){var o,r,i;if(this._monthsParseExact)return le.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),o=0;o<12;o++){if(r=d([2e3,o]),n&&!this._longMonthsParse[o]&&(this._longMonthsParse[o]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i"),this._shortMonthsParse[o]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")),n||this._monthsParse[o]||(i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[o]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[o].test(e))return o;if(n&&"MMM"===t&&this._shortMonthsParse[o].test(e))return o;if(!n&&this._monthsParse[o].test(e))return o}}function ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=C(t);else if(t=e.localeData().monthsParse(t),"number"!=typeof t)return e;return n=Math.min(e.date(),ie(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function de(t){return null!=t?(ce(this,t),e.updateOffset(this,!0),this):B(this,"Month")}function he(){return ie(this.year(),this.month())}function fe(e){return this._monthsParseExact?(u(this,"_monthsRegex")||me.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(u(this,"_monthsShortRegex")||(this._monthsShortRegex=hr),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function pe(e){return this._monthsParseExact?(u(this,"_monthsRegex")||me.call(this),e?this._monthsStrictRegex:this._monthsRegex):(u(this,"_monthsRegex")||(this._monthsRegex=fr),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function me(){function e(e,t){return t.length-e.length}var t,n,o=[],r=[],i=[];for(t=0;t<12;t++)n=d([2e3,t]),o.push(this.monthsShort(n,"")),r.push(this.months(n,"")),i.push(this.months(n,"")),i.push(this.monthsShort(n,""));for(o.sort(e),r.sort(e),i.sort(e),t=0;t<12;t++)o[t]=te(o[t]),r[t]=te(r[t]);for(t=0;t<24;t++)i[t]=te(i[t]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+o.join("|")+")","i")}function ge(e){return we(e)?366:365}function we(e){return e%4===0&&e%100!==0||e%400===0}function ve(){return we(this.year())}function ye(e,t,n,o,r,i,s){var a=new Date(e,t,n,o,r,i,s);return e<100&&e>=0&&isFinite(a.getFullYear())&&a.setFullYear(e),a}function be(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ce(e,t,n){var o=7+t-n,r=(7+be(e,0,o).getUTCDay()-t)%7;return-r+o-1}function _e(e,t,n,o,r){var i,s,a=(7+n-o)%7,l=Ce(e,o,r),u=1+7*(t-1)+a+l;return u<=0?(i=e-1,s=ge(i)+u):u>ge(e)?(i=e+1,s=u-ge(e)):(i=e,s=u),{year:i,dayOfYear:s}}function Re(e,t,n){var o,r,i=Ce(e.year(),t,n),s=Math.floor((e.dayOfYear()-i-1)/7)+1;return s<1?(r=e.year()-1,o=s+Se(r,t,n)):s>Se(e.year(),t,n)?(o=s-Se(e.year(),t,n),r=e.year()+1):(r=e.year(),o=s),{week:o,year:r}}function Se(e,t,n){var o=Ce(e,t,n),r=Ce(e+1,t,n);return(ge(e)-o+r)/7}function Ee(e){return Re(e,this._week.dow,this._week.doy).week}function Me(){return this._week.dow}function Te(){return this._week.doy}function Oe(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function ke(e){var t=Re(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function xe(e,t){return"string"!=typeof e?e:isNaN(e)?(e=t.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10)}function He(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function De(e,t){return r(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]}function Ae(e){return this._weekdaysShort[e.day()]}function Pe(e){return this._weekdaysMin[e.day()]}function Ne(e,t,n){var o,r,i,s=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],o=0;o<7;++o)i=d([2e3,1]).day(o),this._minWeekdaysParse[o]=this.weekdaysMin(i,"").toLocaleLowerCase(),this._shortWeekdaysParse[o]=this.weekdaysShort(i,"").toLocaleLowerCase(),this._weekdaysParse[o]=this.weekdays(i,"").toLocaleLowerCase();return n?"dddd"===t?(r=_o.call(this._weekdaysParse,s),r!==-1?r:null):"ddd"===t?(r=_o.call(this._shortWeekdaysParse,s),r!==-1?r:null):(r=_o.call(this._minWeekdaysParse,s),r!==-1?r:null):"dddd"===t?(r=_o.call(this._weekdaysParse,s),r!==-1?r:(r=_o.call(this._shortWeekdaysParse,s),r!==-1?r:(r=_o.call(this._minWeekdaysParse,s),r!==-1?r:null))):"ddd"===t?(r=_o.call(this._shortWeekdaysParse,s),r!==-1?r:(r=_o.call(this._weekdaysParse,s),r!==-1?r:(r=_o.call(this._minWeekdaysParse,s),r!==-1?r:null))):(r=_o.call(this._minWeekdaysParse,s),r!==-1?r:(r=_o.call(this._weekdaysParse,s),r!==-1?r:(r=_o.call(this._shortWeekdaysParse,s),r!==-1?r:null)))}function Le(e,t,n){var o,r,i;if(this._weekdaysParseExact)return Ne.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),o=0;o<7;o++){if(r=d([2e3,1]).day(o),n&&!this._fullWeekdaysParse[o]&&(this._fullWeekdaysParse[o]=new RegExp("^"+this.weekdays(r,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[o]=new RegExp("^"+this.weekdaysShort(r,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[o]=new RegExp("^"+this.weekdaysMin(r,"").replace(".",".?")+"$","i")),this._weekdaysParse[o]||(i="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[o]=new RegExp(i.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[o].test(e))return o;if(n&&"ddd"===t&&this._shortWeekdaysParse[o].test(e))return o;if(n&&"dd"===t&&this._minWeekdaysParse[o].test(e))return o;if(!n&&this._weekdaysParse[o].test(e))return o}}function We(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=xe(e,this.localeData()),this.add(e-t,"d")):t}function Ie(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function je(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=He(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7}function Ve(e){return this._weekdaysParseExact?(u(this,"_weekdaysRegex")||ze.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(u(this,"_weekdaysRegex")||(this._weekdaysRegex=yr),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function Fe(e){return this._weekdaysParseExact?(u(this,"_weekdaysRegex")||ze.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(u(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=br),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Be(e){return this._weekdaysParseExact?(u(this,"_weekdaysRegex")||ze.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(u(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Cr),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function ze(){function e(e,t){return t.length-e.length}var t,n,o,r,i,s=[],a=[],l=[],u=[];for(t=0;t<7;t++)n=d([2e3,1]).day(t),o=this.weekdaysMin(n,""),r=this.weekdaysShort(n,""),i=this.weekdays(n,""),s.push(o),a.push(r),l.push(i),u.push(o),u.push(r),u.push(i);for(s.sort(e),a.sort(e),l.sort(e),u.sort(e),t=0;t<7;t++)a[t]=te(a[t]),l[t]=te(l[t]),u[t]=te(u[t]);this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ye(){return this.hours()%12||12}function Ue(){return this.hours()||24}function Ge(e,t){$(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function $e(e,t){return t._meridiemParse}function Ke(e){return"p"===(e+"").toLowerCase().charAt(0)}function Xe(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"}function qe(e){return e?e.toLowerCase().replace("_","-"):e}function Ze(e){for(var t,n,o,r,i=0;i<e.length;){for(r=qe(e[i]).split("-"),t=r.length,n=qe(e[i+1]),n=n?n.split("-"):null;t>0;){if(o=Je(r.slice(0,t).join("-")))return o;if(n&&n.length>=t&&_(r,n,!0)>=t-1)break;t--}i++}return null}function Je(e){var o=null;if(!Mr[e]&&"undefined"!=typeof n&&n&&n.exports)try{o=_r._abbr,t("./locale/"+e),Qe(o)}catch(e){}return Mr[e]}function Qe(e,t){var n;return e&&(n=g(t)?nt(e):et(e,t),n&&(_r=n)),_r._abbr}function et(e,t){if(null!==t){var n=Er;return t.abbr=e,null!=Mr[e]?(E("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=Mr[e]._config):null!=t.parentLocale&&(null!=Mr[t.parentLocale]?n=Mr[t.parentLocale]._config:E("parentLocaleUndefined","specified parentLocale is not defined yet. See http://momentjs.com/guides/#/warnings/parent-locale/")),Mr[e]=new k(O(n,t)),Qe(e),Mr[e]}return delete Mr[e],null}function tt(e,t){if(null!=t){var n,o=Er;null!=Mr[e]&&(o=Mr[e]._config),t=O(o,t),n=new k(t),n.parentLocale=Mr[e],Mr[e]=n,Qe(e)}else null!=Mr[e]&&(null!=Mr[e].parentLocale?Mr[e]=Mr[e].parentLocale:null!=Mr[e]&&delete Mr[e]);return Mr[e]}function nt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return _r;if(!r(e)){if(t=Je(e))return t;e=[e]}return Ze(e)}function ot(){return Co(Mr)}function rt(e){var t,n=e._a;return n&&f(e).overflow===-2&&(t=n[tr]<0||n[tr]>11?tr:n[nr]<1||n[nr]>ie(n[er],n[tr])?nr:n[or]<0||n[or]>24||24===n[or]&&(0!==n[rr]||0!==n[ir]||0!==n[sr])?or:n[rr]<0||n[rr]>59?rr:n[ir]<0||n[ir]>59?ir:n[sr]<0||n[sr]>999?sr:-1,f(e)._overflowDayOfYear&&(t<er||t>nr)&&(t=nr),f(e)._overflowWeeks&&t===-1&&(t=ar),f(e)._overflowWeekday&&t===-1&&(t=lr),f(e).overflow=t),e}function it(e){var t,n,o,r,i,s,a=e._i,l=Tr.exec(a)||Or.exec(a);if(l){for(f(e).iso=!0,t=0,n=xr.length;t<n;t++)if(xr[t][1].exec(l[1])){r=xr[t][0],o=xr[t][2]!==!1;break}if(null==r)return void(e._isValid=!1);if(l[3]){for(t=0,n=Hr.length;t<n;t++)if(Hr[t][1].exec(l[3])){i=(l[2]||" ")+Hr[t][0];break}if(null==i)return void(e._isValid=!1)}if(!o&&null!=i)return void(e._isValid=!1);if(l[4]){if(!kr.exec(l[4]))return void(e._isValid=!1);s="Z"}e._f=r+(i||"")+(s||""),dt(e)}else e._isValid=!1}function st(t){var n=Dr.exec(t._i);return null!==n?void(t._d=new Date((+n[1]))):(it(t),void(t._isValid===!1&&(delete t._isValid,e.createFromInputFallback(t))))}function at(e,t,n){return null!=e?e:null!=t?t:n}function lt(t){var n=new Date(e.now());return t._useUTC?[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()]:[n.getFullYear(),n.getMonth(),n.getDate()]}function ut(e){var t,n,o,r,i=[];if(!e._d){for(o=lt(e),e._w&&null==e._a[nr]&&null==e._a[tr]&&ct(e),e._dayOfYear&&(r=at(e._a[er],o[er]),e._dayOfYear>ge(r)&&(f(e)._overflowDayOfYear=!0),n=be(r,0,e._dayOfYear),e._a[tr]=n.getUTCMonth(),e._a[nr]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=i[t]=o[t];for(;t<7;t++)e._a[t]=i[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[or]&&0===e._a[rr]&&0===e._a[ir]&&0===e._a[sr]&&(e._nextDay=!0,e._a[or]=0),e._d=(e._useUTC?be:ye).apply(null,i),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[or]=24)}}function ct(e){var t,n,o,r,i,s,a,l;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(i=1,s=4,n=at(t.GG,e._a[er],Re(yt(),1,4).year),o=at(t.W,1),r=at(t.E,1),(r<1||r>7)&&(l=!0)):(i=e._locale._week.dow,s=e._locale._week.doy,n=at(t.gg,e._a[er],Re(yt(),i,s).year),o=at(t.w,1),null!=t.d?(r=t.d,(r<0||r>6)&&(l=!0)):null!=t.e?(r=t.e+i,(t.e<0||t.e>6)&&(l=!0)):r=i),o<1||o>Se(n,i,s)?f(e)._overflowWeeks=!0:null!=l?f(e)._overflowWeekday=!0:(a=_e(n,o,r,i,s),e._a[er]=a.year,e._dayOfYear=a.dayOfYear)}function dt(t){if(t._f===e.ISO_8601)return void it(t);t._a=[],f(t).empty=!0;var n,o,r,i,s,a=""+t._i,l=a.length,u=0;for(r=Z(t._f,t._locale).match(Ho)||[],n=0;n<r.length;n++)i=r[n],o=(a.match(Q(i,t))||[])[0],o&&(s=a.substr(0,a.indexOf(o)),s.length>0&&f(t).unusedInput.push(s),a=a.slice(a.indexOf(o)+o.length),u+=o.length),Po[i]?(o?f(t).empty=!1:f(t).unusedTokens.push(i),re(i,o,t)):t._strict&&!o&&f(t).unusedTokens.push(i);f(t).charsLeftOver=l-u,a.length>0&&f(t).unusedInput.push(a),t._a[or]<=12&&f(t).bigHour===!0&&t._a[or]>0&&(f(t).bigHour=void 0),f(t).parsedDateParts=t._a.slice(0),f(t).meridiem=t._meridiem,t._a[or]=ht(t._locale,t._a[or],t._meridiem),ut(t),rt(t)}function ht(e,t,n){var o;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(o=e.isPM(n),o&&t<12&&(t+=12),o||12!==t||(t=0),t):t}function ft(e){var t,n,o,r,i;if(0===e._f.length)return f(e).invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r<e._f.length;r++)i=0,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[r],dt(t),p(t)&&(i+=f(t).charsLeftOver,i+=10*f(t).unusedTokens.length,f(t).score=i,(null==o||i<o)&&(o=i,n=t));c(e,n||t)}function pt(e){if(!e._d){var t=I(e._i);e._a=l([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ut(e)}}function mt(e){var t=new v(rt(gt(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function gt(e){var t=e._i,n=e._f;return e._locale=e._locale||nt(e._l),null===t||void 0===n&&""===t?m({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),y(t)?new v(rt(t)):(r(n)?ft(e):a(t)?e._d=t:n?dt(e):wt(e),p(e)||(e._d=null),e))}function wt(t){var n=t._i;void 0===n?t._d=new Date(e.now()):a(n)?t._d=new Date(n.valueOf()):"string"==typeof n?st(t):r(n)?(t._a=l(n.slice(0),function(e){return parseInt(e,10)}),ut(t)):"object"==typeof n?pt(t):"number"==typeof n?t._d=new Date(n):e.createFromInputFallback(t)}function vt(e,t,n,o,a){var l={};return"boolean"==typeof n&&(o=n,n=void 0),(i(e)&&s(e)||r(e)&&0===e.length)&&(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=a,l._l=n,l._i=e,l._f=t,l._strict=o,mt(l)}function yt(e,t,n,o){return vt(e,t,n,o,!1)}function bt(e,t){var n,o;if(1===t.length&&r(t[0])&&(t=t[0]),!t.length)return yt();for(n=t[0],o=1;o<t.length;++o)t[o].isValid()&&!t[o][e](n)||(n=t[o]);return n}function Ct(){var e=[].slice.call(arguments,0);return bt("isBefore",e)}function _t(){var e=[].slice.call(arguments,0);return bt("isAfter",e)}function Rt(e){var t=I(e),n=t.year||0,o=t.quarter||0,r=t.month||0,i=t.week||0,s=t.day||0,a=t.hour||0,l=t.minute||0,u=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*u+6e4*l+1e3*a*60*60,this._days=+s+7*i,this._months=+r+3*o+12*n,this._data={},this._locale=nt(),this._bubble()}function St(e){return e instanceof Rt}function Et(e,t){$(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+G(~~(e/60),2)+t+G(~~e%60,2)})}function Mt(e,t){var n=(t||"").match(e)||[],o=n[n.length-1]||[],r=(o+"").match(Lr)||["-",0,0],i=+(60*r[1])+C(r[2]);return"+"===r[0]?i:-i}function Tt(t,n){var o,r;return n._isUTC?(o=n.clone(),r=(y(t)||a(t)?t.valueOf():yt(t).valueOf())-o.valueOf(),o._d.setTime(o._d.valueOf()+r),e.updateOffset(o,!1),o):yt(t).local()}function Ot(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function kt(t,n){var o,r=this._offset||0;return this.isValid()?null!=t?("string"==typeof t?t=Mt(Xo,t):Math.abs(t)<16&&(t=60*t),!this._isUTC&&n&&(o=Ot(this)),this._offset=t,this._isUTC=!0,null!=o&&this.add(o,"m"),r!==t&&(!n||this._changeInProgress?Gt(this,Vt(t-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?r:Ot(this):null!=t?this:NaN}function xt(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function Ht(e){return this.utcOffset(0,e)}function Dt(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ot(this),"m")),this}function At(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Mt(Ko,this._i)),this}function Pt(e){return!!this.isValid()&&(e=e?yt(e).utcOffset():0,(this.utcOffset()-e)%60===0)}function Nt(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Lt(){if(!g(this._isDSTShifted))return this._isDSTShifted;var e={};if(w(e,this),e=gt(e),e._a){var t=e._isUTC?d(e._a):yt(e._a);
+this._isDSTShifted=this.isValid()&&_(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Wt(){return!!this.isValid()&&!this._isUTC}function It(){return!!this.isValid()&&this._isUTC}function jt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function Vt(e,t){var n,o,r,i=e,s=null;return St(e)?i={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(i={},t?i[t]=e:i.milliseconds=e):(s=Wr.exec(e))?(n="-"===s[1]?-1:1,i={y:0,d:C(s[nr])*n,h:C(s[or])*n,m:C(s[rr])*n,s:C(s[ir])*n,ms:C(s[sr])*n}):(s=Ir.exec(e))?(n="-"===s[1]?-1:1,i={y:Ft(s[2],n),M:Ft(s[3],n),w:Ft(s[4],n),d:Ft(s[5],n),h:Ft(s[6],n),m:Ft(s[7],n),s:Ft(s[8],n)}):null==i?i={}:"object"==typeof i&&("from"in i||"to"in i)&&(r=zt(yt(i.from),yt(i.to)),i={},i.ms=r.milliseconds,i.M=r.months),o=new Rt(i),St(e)&&u(e,"_locale")&&(o._locale=e._locale),o}function Ft(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Bt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(e,t){var n;return e.isValid()&&t.isValid()?(t=Tt(t,e),e.isBefore(t)?n=Bt(e,t):(n=Bt(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function Yt(e){return e<0?Math.round(-1*e)*-1:Math.round(e)}function Ut(e,t){return function(n,o){var r,i;return null===o||isNaN(+o)||(E(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=o,o=i),n="string"==typeof n?+n:n,r=Vt(n,o),Gt(this,r,e),this}}function Gt(t,n,o,r){var i=n._milliseconds,s=Yt(n._days),a=Yt(n._months);t.isValid()&&(r=null==r||r,i&&t._d.setTime(t._d.valueOf()+i*o),s&&z(t,"Date",B(t,"Date")+s*o),a&&ce(t,B(t,"Month")+a*o),r&&e.updateOffset(t,s||a))}function $t(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"}function Kt(t,n){var o=t||yt(),r=Tt(o,this).startOf("day"),i=e.calendarFormat(this,r)||"sameElse",s=n&&(M(n[i])?n[i].call(this,o):n[i]);return this.format(s||this.localeData().calendar(i,this,yt(o)))}function Xt(){return new v(this)}function qt(e,t){var n=y(e)?e:yt(e);return!(!this.isValid()||!n.isValid())&&(t=W(g(t)?"millisecond":t),"millisecond"===t?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())}function Zt(e,t){var n=y(e)?e:yt(e);return!(!this.isValid()||!n.isValid())&&(t=W(g(t)?"millisecond":t),"millisecond"===t?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())}function Jt(e,t,n,o){return o=o||"()",("("===o[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===o[1]?this.isBefore(t,n):!this.isAfter(t,n))}function Qt(e,t){var n,o=y(e)?e:yt(e);return!(!this.isValid()||!o.isValid())&&(t=W(t||"millisecond"),"millisecond"===t?this.valueOf()===o.valueOf():(n=o.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))}function en(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function tn(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function nn(e,t,n){var o,r,i,s;return this.isValid()?(o=Tt(e,this),o.isValid()?(r=6e4*(o.utcOffset()-this.utcOffset()),t=W(t),"year"===t||"month"===t||"quarter"===t?(s=on(this,o),"quarter"===t?s/=3:"year"===t&&(s/=12)):(i=this-o,s="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-r)/864e5:"week"===t?(i-r)/6048e5:i),n?s:b(s)):NaN):NaN}function on(e,t){var n,o,r=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(r,"months");return t-i<0?(n=e.clone().add(r-1,"months"),o=(t-i)/(i-n)):(n=e.clone().add(r+1,"months"),o=(t-i)/(n-i)),-(r+o)||0}function rn(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function sn(){var e=this.clone().utc();return 0<e.year()&&e.year()<=9999?M(Date.prototype.toISOString)?this.toDate().toISOString():q(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):q(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function an(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var n=q(this,t);return this.localeData().postformat(n)}function ln(e,t){return this.isValid()&&(y(e)&&e.isValid()||yt(e).isValid())?Vt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function un(e){return this.from(yt(),e)}function cn(e,t){return this.isValid()&&(y(e)&&e.isValid()||yt(e).isValid())?Vt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function dn(e){return this.to(yt(),e)}function hn(e){var t;return void 0===e?this._locale._abbr:(t=nt(e),null!=t&&(this._locale=t),this)}function fn(){return this._locale}function pn(e){switch(e=W(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this}function mn(e){return e=W(e),void 0===e||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))}function gn(){return this._d.valueOf()-6e4*(this._offset||0)}function wn(){return Math.floor(this.valueOf()/1e3)}function vn(){return new Date(this.valueOf())}function yn(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function bn(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function Cn(){return this.isValid()?this.toISOString():null}function _n(){return p(this)}function Rn(){return c({},f(this))}function Sn(){return f(this).overflow}function En(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Mn(e,t){$(0,[e,e.length],0,t)}function Tn(e){return Hn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function On(e){return Hn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function kn(){return Se(this.year(),1,4)}function xn(){var e=this.localeData()._week;return Se(this.year(),e.dow,e.doy)}function Hn(e,t,n,o,r){var i;return null==e?Re(this,o,r).year:(i=Se(e,o,r),t>i&&(t=i),Dn.call(this,e,t,n,o,r))}function Dn(e,t,n,o,r){var i=_e(e,t,n,o,r),s=be(i.year,0,i.dayOfYear);return this.year(s.getUTCFullYear()),this.month(s.getUTCMonth()),this.date(s.getUTCDate()),this}function An(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}function Pn(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}function Nn(e,t){t[sr]=C(1e3*("0."+e))}function Ln(){return this._isUTC?"UTC":""}function Wn(){return this._isUTC?"Coordinated Universal Time":""}function In(e){return yt(1e3*e)}function jn(){return yt.apply(null,arguments).parseZone()}function Vn(e){return e}function Fn(e,t,n,o){var r=nt(),i=d().set(o,t);return r[n](i,e)}function Bn(e,t,n){if("number"==typeof e&&(t=e,e=void 0),e=e||"",null!=t)return Fn(e,t,n,"month");var o,r=[];for(o=0;o<12;o++)r[o]=Fn(e,o,n,"month");return r}function zn(e,t,n,o){"boolean"==typeof e?("number"==typeof t&&(n=t,t=void 0),t=t||""):(t=e,n=t,e=!1,"number"==typeof t&&(n=t,t=void 0),t=t||"");var r=nt(),i=e?r._week.dow:0;if(null!=n)return Fn(t,(n+i)%7,o,"day");var s,a=[];for(s=0;s<7;s++)a[s]=Fn(t,(s+i)%7,o,"day");return a}function Yn(e,t){return Bn(e,t,"months")}function Un(e,t){return Bn(e,t,"monthsShort")}function Gn(e,t,n){return zn(e,t,n,"weekdays")}function $n(e,t,n){return zn(e,t,n,"weekdaysShort")}function Kn(e,t,n){return zn(e,t,n,"weekdaysMin")}function Xn(){var e=this._data;return this._milliseconds=qr(this._milliseconds),this._days=qr(this._days),this._months=qr(this._months),e.milliseconds=qr(e.milliseconds),e.seconds=qr(e.seconds),e.minutes=qr(e.minutes),e.hours=qr(e.hours),e.months=qr(e.months),e.years=qr(e.years),this}function qn(e,t,n,o){var r=Vt(t,n);return e._milliseconds+=o*r._milliseconds,e._days+=o*r._days,e._months+=o*r._months,e._bubble()}function Zn(e,t){return qn(this,e,t,1)}function Jn(e,t){return qn(this,e,t,-1)}function Qn(e){return e<0?Math.floor(e):Math.ceil(e)}function eo(){var e,t,n,o,r,i=this._milliseconds,s=this._days,a=this._months,l=this._data;return i>=0&&s>=0&&a>=0||i<=0&&s<=0&&a<=0||(i+=864e5*Qn(no(a)+s),s=0,a=0),l.milliseconds=i%1e3,e=b(i/1e3),l.seconds=e%60,t=b(e/60),l.minutes=t%60,n=b(t/60),l.hours=n%24,s+=b(n/24),r=b(to(s)),a+=r,s-=Qn(no(r)),o=b(a/12),a%=12,l.days=s,l.months=a,l.years=o,this}function to(e){return 4800*e/146097}function no(e){return 146097*e/4800}function oo(e){var t,n,o=this._milliseconds;if(e=W(e),"month"===e||"year"===e)return t=this._days+o/864e5,n=this._months+to(t),"month"===e?n:n/12;switch(t=this._days+Math.round(no(this._months)),e){case"week":return t/7+o/6048e5;case"day":return t+o/864e5;case"hour":return 24*t+o/36e5;case"minute":return 1440*t+o/6e4;case"second":return 86400*t+o/1e3;case"millisecond":return Math.floor(864e5*t)+o;default:throw new Error("Unknown unit "+e)}}function ro(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*C(this._months/12)}function io(e){return function(){return this.as(e)}}function so(e){return e=W(e),this[e+"s"]()}function ao(e){return function(){return this._data[e]}}function lo(){return b(this.days()/7)}function uo(e,t,n,o,r){return r.relativeTime(t||1,!!n,e,o)}function co(e,t,n){var o=Vt(e).abs(),r=hi(o.as("s")),i=hi(o.as("m")),s=hi(o.as("h")),a=hi(o.as("d")),l=hi(o.as("M")),u=hi(o.as("y")),c=r<fi.s&&["s",r]||i<=1&&["m"]||i<fi.m&&["mm",i]||s<=1&&["h"]||s<fi.h&&["hh",s]||a<=1&&["d"]||a<fi.d&&["dd",a]||l<=1&&["M"]||l<fi.M&&["MM",l]||u<=1&&["y"]||["yy",u];return c[2]=t,c[3]=+e>0,c[4]=n,uo.apply(null,c)}function ho(e){return void 0===e?hi:"function"==typeof e&&(hi=e,!0)}function fo(e,t){return void 0!==fi[e]&&(void 0===t?fi[e]:(fi[e]=t,!0))}function po(e){var t=this.localeData(),n=co(this,!e,t);return e&&(n=t.pastFuture(+this,n)),t.postformat(n)}function mo(){var e,t,n,o=pi(this._milliseconds)/1e3,r=pi(this._days),i=pi(this._months);e=b(o/60),t=b(e/60),o%=60,e%=60,n=b(i/12),i%=12;var s=n,a=i,l=r,u=t,c=e,d=o,h=this.asSeconds();return h?(h<0?"-":"")+"P"+(s?s+"Y":"")+(a?a+"M":"")+(l?l+"D":"")+(u||c||d?"T":"")+(u?u+"H":"")+(c?c+"M":"")+(d?d+"S":""):"P0D"}var go,wo;wo=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,o=0;o<n;o++)if(o in t&&e.call(this,t[o],o,t))return!0;return!1};var vo=e.momentProperties=[],yo=!1,bo={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;var Co;Co=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)u(e,t)&&n.push(t);return n};var _o,Ro={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},So={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Eo="Invalid date",Mo="%d",To=/\d{1,2}/,Oo={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ko={},xo={},Ho=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Do=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ao={},Po={},No=/\d/,Lo=/\d\d/,Wo=/\d{3}/,Io=/\d{4}/,jo=/[+-]?\d{6}/,Vo=/\d\d?/,Fo=/\d\d\d\d?/,Bo=/\d\d\d\d\d\d?/,zo=/\d{1,3}/,Yo=/\d{1,4}/,Uo=/[+-]?\d{1,6}/,Go=/\d+/,$o=/[+-]?\d+/,Ko=/Z|[+-]\d\d:?\d\d/gi,Xo=/Z|[+-]\d\d(?::?\d\d)?/gi,qo=/[+-]?\d+(\.\d{1,3})?/,Zo=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Jo={},Qo={},er=0,tr=1,nr=2,or=3,rr=4,ir=5,sr=6,ar=7,lr=8;_o=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},$("M",["MM",2],"Mo",function(){return this.month()+1}),$("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),$("MMMM",0,0,function(e){return this.localeData().months(this,e)}),L("month","M"),j("month",8),J("M",Vo),J("MM",Vo,Lo),J("MMM",function(e,t){return t.monthsShortRegex(e)}),J("MMMM",function(e,t){return t.monthsRegex(e)}),ne(["M","MM"],function(e,t){t[tr]=C(e)-1}),ne(["MMM","MMMM"],function(e,t,n,o){var r=n._locale.monthsParse(e,o,n._strict);null!=r?t[tr]=r:f(n).invalidMonth=e});var ur=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,cr="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),dr="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),hr=Zo,fr=Zo;$("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),$(0,["YY",2],0,function(){return this.year()%100}),$(0,["YYYY",4],0,"year"),$(0,["YYYYY",5],0,"year"),$(0,["YYYYYY",6,!0],0,"year"),L("year","y"),j("year",1),J("Y",$o),J("YY",Vo,Lo),J("YYYY",Yo,Io),J("YYYYY",Uo,jo),J("YYYYYY",Uo,jo),ne(["YYYYY","YYYYYY"],er),ne("YYYY",function(t,n){n[er]=2===t.length?e.parseTwoDigitYear(t):C(t)}),ne("YY",function(t,n){n[er]=e.parseTwoDigitYear(t)}),ne("Y",function(e,t){t[er]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return C(e)+(C(e)>68?1900:2e3)};var pr=F("FullYear",!0);$("w",["ww",2],"wo","week"),$("W",["WW",2],"Wo","isoWeek"),L("week","w"),L("isoWeek","W"),j("week",5),j("isoWeek",5),J("w",Vo),J("ww",Vo,Lo),J("W",Vo),J("WW",Vo,Lo),oe(["w","ww","W","WW"],function(e,t,n,o){t[o.substr(0,1)]=C(e)});var mr={dow:0,doy:6};$("d",0,"do","day"),$("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),$("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),$("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),$("e",0,0,"weekday"),$("E",0,0,"isoWeekday"),L("day","d"),L("weekday","e"),L("isoWeekday","E"),j("day",11),j("weekday",11),j("isoWeekday",11),J("d",Vo),J("e",Vo),J("E",Vo),J("dd",function(e,t){return t.weekdaysMinRegex(e)}),J("ddd",function(e,t){return t.weekdaysShortRegex(e)}),J("dddd",function(e,t){return t.weekdaysRegex(e)}),oe(["dd","ddd","dddd"],function(e,t,n,o){var r=n._locale.weekdaysParse(e,o,n._strict);null!=r?t.d=r:f(n).invalidWeekday=e}),oe(["d","e","E"],function(e,t,n,o){t[o]=C(e)});var gr="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),wr="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),vr="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),yr=Zo,br=Zo,Cr=Zo;$("H",["HH",2],0,"hour"),$("h",["hh",2],0,Ye),$("k",["kk",2],0,Ue),$("hmm",0,0,function(){return""+Ye.apply(this)+G(this.minutes(),2)}),$("hmmss",0,0,function(){return""+Ye.apply(this)+G(this.minutes(),2)+G(this.seconds(),2)}),$("Hmm",0,0,function(){return""+this.hours()+G(this.minutes(),2)}),$("Hmmss",0,0,function(){return""+this.hours()+G(this.minutes(),2)+G(this.seconds(),2)}),Ge("a",!0),Ge("A",!1),L("hour","h"),j("hour",13),J("a",$e),J("A",$e),J("H",Vo),J("h",Vo),J("HH",Vo,Lo),J("hh",Vo,Lo),J("hmm",Fo),J("hmmss",Bo),J("Hmm",Fo),J("Hmmss",Bo),ne(["H","HH"],or),ne(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ne(["h","hh"],function(e,t,n){t[or]=C(e),f(n).bigHour=!0}),ne("hmm",function(e,t,n){var o=e.length-2;t[or]=C(e.substr(0,o)),t[rr]=C(e.substr(o)),f(n).bigHour=!0}),ne("hmmss",function(e,t,n){var o=e.length-4,r=e.length-2;t[or]=C(e.substr(0,o)),t[rr]=C(e.substr(o,2)),t[ir]=C(e.substr(r)),f(n).bigHour=!0}),ne("Hmm",function(e,t,n){var o=e.length-2;t[or]=C(e.substr(0,o)),t[rr]=C(e.substr(o))}),ne("Hmmss",function(e,t,n){var o=e.length-4,r=e.length-2;t[or]=C(e.substr(0,o)),t[rr]=C(e.substr(o,2)),t[ir]=C(e.substr(r))});var _r,Rr=/[ap]\.?m?\.?/i,Sr=F("Hours",!0),Er={calendar:Ro,longDateFormat:So,invalidDate:Eo,ordinal:Mo,ordinalParse:To,relativeTime:Oo,months:cr,monthsShort:dr,week:mr,weekdays:gr,weekdaysMin:vr,weekdaysShort:wr,meridiemParse:Rr},Mr={},Tr=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,Or=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,kr=/Z|[+-]\d\d(?::?\d\d)?/,xr=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Hr=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Dr=/^\/?Date\((\-?\d+)/i;e.createFromInputFallback=S("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),e.ISO_8601=function(){};var Ar=S("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=yt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:m()}),Pr=S("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=yt.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:m()}),Nr=function(){return Date.now?Date.now():+new Date};Et("Z",":"),Et("ZZ",""),J("Z",Xo),J("ZZ",Xo),ne(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Mt(Xo,e)});var Lr=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var Wr=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/,Ir=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;Vt.fn=Rt.prototype;var jr=Ut(1,"add"),Vr=Ut(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Fr=S("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});$(0,["gg",2],0,function(){return this.weekYear()%100}),$(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Mn("gggg","weekYear"),Mn("ggggg","weekYear"),Mn("GGGG","isoWeekYear"),Mn("GGGGG","isoWeekYear"),L("weekYear","gg"),L("isoWeekYear","GG"),j("weekYear",1),j("isoWeekYear",1),J("G",$o),J("g",$o),J("GG",Vo,Lo),J("gg",Vo,Lo),J("GGGG",Yo,Io),J("gggg",Yo,Io),J("GGGGG",Uo,jo),J("ggggg",Uo,jo),oe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,o){t[o.substr(0,2)]=C(e)}),oe(["gg","GG"],function(t,n,o,r){n[r]=e.parseTwoDigitYear(t)}),$("Q",0,"Qo","quarter"),L("quarter","Q"),j("quarter",7),J("Q",No),ne("Q",function(e,t){t[tr]=3*(C(e)-1)}),$("D",["DD",2],"Do","date"),L("date","D"),j("date",9),J("D",Vo),J("DD",Vo,Lo),J("Do",function(e,t){return e?t._ordinalParse:t._ordinalParseLenient}),ne(["D","DD"],nr),ne("Do",function(e,t){t[nr]=C(e.match(Vo)[0],10)});var Br=F("Date",!0);$("DDD",["DDDD",3],"DDDo","dayOfYear"),L("dayOfYear","DDD"),j("dayOfYear",4),J("DDD",zo),J("DDDD",Wo),ne(["DDD","DDDD"],function(e,t,n){n._dayOfYear=C(e)}),$("m",["mm",2],0,"minute"),L("minute","m"),j("minute",14),J("m",Vo),J("mm",Vo,Lo),ne(["m","mm"],rr);var zr=F("Minutes",!1);$("s",["ss",2],0,"second"),L("second","s"),j("second",15),J("s",Vo),J("ss",Vo,Lo),ne(["s","ss"],ir);var Yr=F("Seconds",!1);$("S",0,0,function(){return~~(this.millisecond()/100)}),$(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),$(0,["SSS",3],0,"millisecond"),$(0,["SSSS",4],0,function(){return 10*this.millisecond()}),$(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),$(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),$(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),$(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),$(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),L("millisecond","ms"),j("millisecond",16),J("S",zo,No),J("SS",zo,Lo),J("SSS",zo,Wo);var Ur;for(Ur="SSSS";Ur.length<=9;Ur+="S")J(Ur,Go);for(Ur="S";Ur.length<=9;Ur+="S")ne(Ur,Nn);var Gr=F("Milliseconds",!1);$("z",0,0,"zoneAbbr"),$("zz",0,0,"zoneName");var $r=v.prototype;$r.add=jr,$r.calendar=Kt,$r.clone=Xt,$r.diff=nn,$r.endOf=mn,$r.format=an,$r.from=ln,$r.fromNow=un,$r.to=cn,$r.toNow=dn,$r.get=Y,$r.invalidAt=Sn,$r.isAfter=qt,$r.isBefore=Zt,$r.isBetween=Jt,$r.isSame=Qt,$r.isSameOrAfter=en,$r.isSameOrBefore=tn,$r.isValid=_n,$r.lang=Fr,$r.locale=hn,$r.localeData=fn,$r.max=Pr,$r.min=Ar,$r.parsingFlags=Rn,$r.set=U,$r.startOf=pn,$r.subtract=Vr,$r.toArray=yn,$r.toObject=bn,$r.toDate=vn,$r.toISOString=sn,$r.toJSON=Cn,$r.toString=rn,$r.unix=wn,$r.valueOf=gn,$r.creationData=En,$r.year=pr,$r.isLeapYear=ve,$r.weekYear=Tn,$r.isoWeekYear=On,$r.quarter=$r.quarters=An,$r.month=de,$r.daysInMonth=he,$r.week=$r.weeks=Oe,$r.isoWeek=$r.isoWeeks=ke,$r.weeksInYear=xn,$r.isoWeeksInYear=kn,$r.date=Br,$r.day=$r.days=We,$r.weekday=Ie,$r.isoWeekday=je,$r.dayOfYear=Pn,$r.hour=$r.hours=Sr,$r.minute=$r.minutes=zr,$r.second=$r.seconds=Yr,$r.millisecond=$r.milliseconds=Gr,$r.utcOffset=kt,$r.utc=Ht,$r.local=Dt,$r.parseZone=At,$r.hasAlignedHourOffset=Pt,$r.isDST=Nt,$r.isLocal=Wt,$r.isUtcOffset=It,$r.isUtc=jt,$r.isUTC=jt,$r.zoneAbbr=Ln,$r.zoneName=Wn,$r.dates=S("dates accessor is deprecated. Use date instead.",Br),$r.months=S("months accessor is deprecated. Use month instead",de),$r.years=S("years accessor is deprecated. Use year instead",pr),$r.zone=S("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",xt),$r.isDSTShifted=S("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Lt);var Kr=$r,Xr=k.prototype;Xr.calendar=x,Xr.longDateFormat=H,Xr.invalidDate=D,Xr.ordinal=A,Xr.preparse=Vn,Xr.postformat=Vn,Xr.relativeTime=P,Xr.pastFuture=N,Xr.set=T,Xr.months=se,Xr.monthsShort=ae,Xr.monthsParse=ue,Xr.monthsRegex=pe,Xr.monthsShortRegex=fe,Xr.week=Ee,Xr.firstDayOfYear=Te,Xr.firstDayOfWeek=Me,Xr.weekdays=De,Xr.weekdaysMin=Pe,Xr.weekdaysShort=Ae,Xr.weekdaysParse=Le,Xr.weekdaysRegex=Ve,Xr.weekdaysShortRegex=Fe,Xr.weekdaysMinRegex=Be,Xr.isPM=Ke,Xr.meridiem=Xe,Qe("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===C(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),e.lang=S("moment.lang is deprecated. Use moment.locale instead.",Qe),e.langData=S("moment.langData is deprecated. Use moment.localeData instead.",nt);var qr=Math.abs,Zr=io("ms"),Jr=io("s"),Qr=io("m"),ei=io("h"),ti=io("d"),ni=io("w"),oi=io("M"),ri=io("y"),ii=ao("milliseconds"),si=ao("seconds"),ai=ao("minutes"),li=ao("hours"),ui=ao("days"),ci=ao("months"),di=ao("years"),hi=Math.round,fi={s:45,m:45,h:22,d:26,M:11},pi=Math.abs,mi=Rt.prototype;mi.abs=Xn,mi.add=Zn,mi.subtract=Jn,mi.as=oo,mi.asMilliseconds=Zr,mi.asSeconds=Jr,mi.asMinutes=Qr,mi.asHours=ei,mi.asDays=ti,mi.asWeeks=ni,mi.asMonths=oi,mi.asYears=ri,mi.valueOf=ro,mi._bubble=eo,mi.get=so,mi.milliseconds=ii,mi.seconds=si,mi.minutes=ai,mi.hours=li,mi.days=ui,mi.weeks=lo,mi.months=ci,mi.years=di,mi.humanize=po,mi.toISOString=mo,mi.toString=mo,mi.toJSON=mo,mi.locale=hn,mi.localeData=fn,mi.toIsoString=S("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",mo),mi.lang=Fr,$("X",0,0,"unix"),$("x",0,0,"valueOf"),J("x",$o),J("X",qo),ne("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),ne("x",function(e,t,n){n._d=new Date(C(e))}),e.version="2.14.1",o(yt),e.fn=Kr,e.min=Ct,e.max=_t,e.now=Nr,e.utc=d,e.unix=In,e.months=Yn,e.isDate=a,e.locale=Qe,e.invalid=m,e.duration=Vt,e.isMoment=y,e.weekdays=Gn,e.parseZone=jn,e.localeData=nt,e.isDuration=St,e.monthsShort=Un,e.weekdaysMin=Kn,e.defineLocale=et,e.updateLocale=tt,e.locales=ot,e.weekdaysShort=$n,e.normalizeUnits=W,e.relativeTimeRounding=ho,e.relativeTimeThreshold=fo,e.calendarFormat=$t,e.prototype=Kr;var gi=e;return gi})},{}],numbro:[function(t,n,o){/*!
+ * numbro.js
+ * version : 1.9.2
+ * author : Företagsplatsen AB
+ * license : MIT
+ * http://www.foretagsplatsen.se
+ */
+(function(){"use strict";function o(e){this._value=e}function r(e){var t,n="";for(t=0;t<e;t++)n+="0";return n}function i(e,t){var n,o,i,s,a,l,u,c;return c=e.toString(),n=c.split("e")[0],s=c.split("e")[1],o=n.split(".")[0],i=n.split(".")[1]||"",+s>0?c=o+i+r(s-i.length):(a=+o<0?"-0":"0",t>0&&(a+="."),u=r(-1*s-1),l=(u+Math.abs(o)+i).substr(0,t),c=a+l),+s>0&&t>0&&(c+="."+r(t)),c}function s(e,t,n,o){var r,s,a=Math.pow(10,t);return e.toString().indexOf("e")>-1?(s=i(e,t),"-"===s.charAt(0)&&+s>=0&&(s=s.substr(1))):s=(n(e+"e+"+t)/a).toFixed(t),o&&(r=new RegExp("0{1,"+o+"}$"),s=s.replace(r,"")),s}function a(e,t,n){var o,r=t.replace(/\{[^\{\}]*\}/g,"");return o=r.indexOf("$")>-1?u(e,T[k].currency.symbol,t,n):r.indexOf("%")>-1?d(e,t,n):r.indexOf(":")>-1?h(e,t):m(e._value,t,n)}function l(e,t){var n,o,r,i,s,a=t,l=!1;if(t.indexOf(":")>-1)e._value=f(t);else if(t===x)e._value=0;else{for("."!==T[k].delimiters.decimal&&(t=t.replace(/\./g,"").replace(T[k].delimiters.decimal,".")),n=new RegExp("[^a-zA-Z]"+T[k].abbreviations.thousand+"(?:\\)|(\\"+T[k].currency.symbol+")?(?:\\))?)?$"),o=new RegExp("[^a-zA-Z]"+T[k].abbreviations.million+"(?:\\)|(\\"+T[k].currency.symbol+")?(?:\\))?)?$"),r=new RegExp("[^a-zA-Z]"+T[k].abbreviations.billion+"(?:\\)|(\\"+T[k].currency.symbol+")?(?:\\))?)?$"),i=new RegExp("[^a-zA-Z]"+T[k].abbreviations.trillion+"(?:\\)|(\\"+T[k].currency.symbol+")?(?:\\))?)?$"),s=1;s<R.length&&!l;++s)t.indexOf(R[s])>-1?l=Math.pow(1024,s):t.indexOf(S[s])>-1&&(l=Math.pow(1e3,s));var u=t.replace(/[^0-9\.]+/g,"");""===u?e._value=NaN:(e._value=(l?l:1)*(a.match(n)?Math.pow(10,3):1)*(a.match(o)?Math.pow(10,6):1)*(a.match(r)?Math.pow(10,9):1)*(a.match(i)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(u),e._value=l?Math.ceil(e._value):e._value)}return e._value}function u(e,t,n,o){var r,i,s=n,a=s.indexOf("$"),l=s.indexOf("("),u=s.indexOf("+"),c=s.indexOf("-"),d="",h="";if(s.indexOf("$")===-1?"infix"===T[k].currency.position?(h=t,T[k].currency.spaceSeparated&&(h=" "+h+" ")):T[k].currency.spaceSeparated&&(d=" "):s.indexOf(" $")>-1?(d=" ",s=s.replace(" $","")):s.indexOf("$ ")>-1?(d=" ",s=s.replace("$ ","")):s=s.replace("$",""),i=m(e._value,s,o,h),n.indexOf("$")===-1)switch(T[k].currency.position){case"postfix":i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,d+t),i=i.join("")):i=i+d+t;break;case"infix":break;case"prefix":i.indexOf("(")>-1||i.indexOf("-")>-1?(i=i.split(""),r=Math.max(l,c)+1,i.splice(r,0,t+d),i=i.join("")):i=t+d+i;break;default:throw Error('Currency position should be among ["prefix", "infix", "postfix"]')}else a<=1?i.indexOf("(")>-1||i.indexOf("+")>-1||i.indexOf("-")>-1?(i=i.split(""),r=1,(a<l||a<u||a<c)&&(r=0),i.splice(r,0,t+d),i=i.join("")):i=t+d+i:i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,d+t),i=i.join("")):i=i+d+t;return i}function c(e,t,n,o){return u(e,t,n,o)}function d(e,t,n){var o,r="",i=100*e._value;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),o=m(i,t,n),o.indexOf(")")>-1?(o=o.split(""),o.splice(-1,0,r+"%"),o=o.join("")):o=o+r+"%",o}function h(e){var t=Math.floor(e._value/60/60),n=Math.floor((e._value-60*t*60)/60),o=Math.round(e._value-60*t*60-60*n);return t+":"+(n<10?"0"+n:n)+":"+(o<10?"0"+o:o)}function f(e){var t=e.split(":"),n=0;return 3===t.length?(n+=60*Number(t[0])*60,n+=60*Number(t[1]),n+=Number(t[2])):2===t.length&&(n+=60*Number(t[0]),n+=Number(t[1])),Number(n)}function p(e,t,n){var o,r,i,s=t[0],a=Math.abs(e);if(a>=n){for(o=1;o<t.length;++o)if(r=Math.pow(n,o),i=Math.pow(n,o+1),a>=r&&a<i){s=t[o],e/=r;break}s===t[0]&&(e/=Math.pow(n,t.length-1),s=t[t.length-1])}return{value:e,suffix:s}}function m(e,t,n,o){var i,a,l,u,c,d,h,f,m,g,w,v,y,b,C,_,R,S=!1,E=!1,O=!1,H="",D=!1,A=!1,P=!1,N=!1,L=!1,W="",I="",j=Math.abs(e),V="",F=!1,B=!1,z="";if(0===e&&null!==x)return x;if(!isFinite(e))return""+e;if(0===t.indexOf("{")){var Y=t.indexOf("}");if(Y===-1)throw Error('Format should also contain a "}"');g=t.slice(1,Y),t=t.slice(Y+1)}else g="";if(t.indexOf("}")===t.length-1){var U=t.indexOf("{");if(U===-1)throw Error('Format should also contain a "{"');w=t.slice(U+1,-1),t=t.slice(0,U+1)}else w="";var G;for(G=t.indexOf(".")===-1?t.match(/([0-9]+).*/):t.match(/([0-9]+)\..*/),_=null===G?-1:G[1].length,t.indexOf("-")!==-1&&(F=!0),t.indexOf("(")>-1?(S=!0,t=t.slice(1,-1)):t.indexOf("+")>-1&&(E=!0,t=t.replace(/\+/g,"")),t.indexOf("a")>-1&&(f=t.split(".")[0].match(/[0-9]+/g)||["0"],f=parseInt(f[0],10),D=t.indexOf("aK")>=0,A=t.indexOf("aM")>=0,P=t.indexOf("aB")>=0,N=t.indexOf("aT")>=0,L=D||A||P||N,t.indexOf(" a")>-1?(H=" ",t=t.replace(" a","")):t=t.replace("a",""),l=Math.floor(Math.log(j)/Math.LN10)+1,c=l%3,c=0===c?3:c,f&&0!==j&&(u=Math.floor(Math.log(j)/Math.LN10)+1-f,d=3*~~((Math.min(f,l)-c)/3),j/=Math.pow(10,d),t.indexOf(".")===-1&&f>3&&(t+="[.]",b=0===u?0:3*~~(u/3)-u,b=b<0?b+3:b,t+=r(b))),Math.floor(Math.log(Math.abs(e))/Math.LN10)+1!==f&&(j>=Math.pow(10,12)&&!L||N?(H+=T[k].abbreviations.trillion,e/=Math.pow(10,12)):j<Math.pow(10,12)&&j>=Math.pow(10,9)&&!L||P?(H+=T[k].abbreviations.billion,e/=Math.pow(10,9)):j<Math.pow(10,9)&&j>=Math.pow(10,6)&&!L||A?(H+=T[k].abbreviations.million,e/=Math.pow(10,6)):(j<Math.pow(10,6)&&j>=Math.pow(10,3)&&!L||D)&&(H+=T[k].abbreviations.thousand,e/=Math.pow(10,3)))),R=0;R<M.length;++R)if(i=M[R],t.indexOf(i.marker)>-1){t.indexOf(" "+i.marker)>-1&&(W=" "),t=t.replace(W+i.marker,""),a=p(e,i.suffixes,i.scale),e=a.value,W+=a.suffix;break}if(t.indexOf("o")>-1&&(t.indexOf(" o")>-1?(I=" ",t=t.replace(" o","")):t=t.replace("o",""),T[k].ordinal&&(I+=T[k].ordinal(e))),t.indexOf("[.]")>-1&&(O=!0,t=t.replace("[.]",".")),h=e.toString().split(".")[0],m=t.split(".")[1],v=t.indexOf(","),m){if(m.indexOf("*")!==-1?V=s(e,e.toString().split(".")[1].length,n):m.indexOf("[")>-1?(m=m.replace("]",""),m=m.split("["),V=s(e,m[0].length+m[1].length,n,m[1].length)):V=s(e,m.length,n),h=V.split(".")[0],V.split(".")[1].length){var $=o?H+o:T[k].delimiters.decimal;V=$+V.split(".")[1]}else V="";O&&0===Number(V.slice(1))&&(V="")}else h=s(e,0,n);return h.indexOf("-")>-1&&(h=h.slice(1),B=!0),h.length<_&&(h=r(_-h.length)+h),v>-1&&(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+T[k].delimiters.thousands)),0===t.indexOf(".")&&(h=""),y=t.indexOf("("),C=t.indexOf("-"),z=y<C?(S&&B?"(":"")+(F&&B||!S&&B?"-":""):(F&&B||!S&&B?"-":"")+(S&&B?"(":""),g+z+(!B&&E&&0!==e?"+":"")+h+V+(I?I:"")+(H&&!o?H:"")+(W?W:"")+(S&&B?")":"")+w}function g(e,t){T[e]=t}function w(e){k=e;var t=T[e].defaults;t&&t.format&&C.defaultFormat(t.format),t&&t.currencyFormat&&C.defaultCurrencyFormat(t.currencyFormat)}function v(){return"undefined"!=typeof process&&void 0===process.browser&&process.title&&(0===process.title.indexOf("node")||"grunt"===process.title||"gulp"===process.title)&&"undefined"!=typeof t}function y(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function b(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var n=y(e),o=y(t);return n>o?n:o},-(1/0))}var C,_="1.9.2",R=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],S=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],E={general:{scale:1024,suffixes:S,marker:"bd"},binary:{scale:1024,suffixes:R,marker:"b"},decimal:{scale:1e3,suffixes:S,marker:"d"}},M=[E.general,E.binary,E.decimal],T={},O=T,k="en-US",x=null,H="0,0",D="0$",A="undefined"!=typeof n&&n.exports,P={delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$",position:"prefix"},defaults:{currencyFormat:",0000 a"},formats:{fourDigits:"0000 a",fullWithTwoDecimals:"$ ,0.00",fullWithTwoDecimalsNoCurrency:",0.00"}};C=function(e){return C.isNumbro(e)?e=e.value():0===e||"undefined"==typeof e?e=0:Number(e)||(e=C.fn.unformat(e)),new o(Number(e))},C.version=_,C.isNumbro=function(e){return e instanceof o},C.setLanguage=function(e,t){console.warn("`setLanguage` is deprecated since version 1.6.0. Use `setCulture` instead");var n=e,o=e.split("-")[0],r=null;O[n]||(Object.keys(O).forEach(function(e){r||e.split("-")[0]!==o||(r=e)}),n=r||t||"en-US"),w(n)},C.setCulture=function(e,t){var n=e,o=e.split("-")[1],r=null;T[n]||(o&&Object.keys(T).forEach(function(e){r||e.split("-")[1]!==o||(r=e)}),n=r||t||"en-US"),w(n)},C.language=function(e,t){if(console.warn("`language` is deprecated since version 1.6.0. Use `culture` instead"),!e)return k;if(e&&!t){if(!O[e])throw new Error("Unknown language : "+e);w(e)}return!t&&O[e]||g(e,t),C},C.culture=function(e,t){if(!e)return k;if(e&&!t){if(!T[e])throw new Error("Unknown culture : "+e);w(e)}return!t&&T[e]||g(e,t),C},C.languageData=function(e){if(console.warn("`languageData` is deprecated since version 1.6.0. Use `cultureData` instead"),!e)return O[k];if(!O[e])throw new Error("Unknown language : "+e);return O[e]},C.cultureData=function(e){if(!e)return T[k];if(!T[e])throw new Error("Unknown culture : "+e);return T[e]},C.culture("en-US",P),C.languages=function(){return console.warn("`languages` is deprecated since version 1.6.0. Use `cultures` instead"),O},C.cultures=function(){return T},C.zeroFormat=function(e){x="string"==typeof e?e:null},C.defaultFormat=function(e){H="string"==typeof e?e:"0.0"},C.defaultCurrencyFormat=function(e){D="string"==typeof e?e:"0$"},C.validate=function(e,t){var n,o,r,i,s,a,l,u;if("string"!=typeof e&&(e+="",console.warn&&console.warn("Numbro.js: Value is not string. It has been co-erced to: ",e)),e=e.trim(),e=e.replace(/^[+-]?/,""),e.match(/^\d+$/))return!0;if(""===e)return!1;try{l=C.cultureData(t)}catch(e){l=C.cultureData(C.culture())}return r=l.currency.symbol,s=l.abbreviations,n=l.delimiters.decimal,o="."===l.delimiters.thousands?"\\.":l.delimiters.thousands,u=e.match(/^[^\d\.\,]+/),(null===u||(e=e.substr(1),u[0]===r))&&(u=e.match(/[^\d]+$/),(null===u||(e=e.slice(0,-1),u[0]===s.thousand||u[0]===s.million||u[0]===s.billion||u[0]===s.trillion))&&(a=new RegExp(o+"{2}"),!e.match(/[^\d.,]/g)&&(i=e.split(n),!(i.length>2)&&(i.length<2?!!i[0].match(/^\d+.*\d$/)&&!i[0].match(a):""===i[0]?!i[0].match(a)&&!!i[1].match(/^\d+$/):1===i[0].length?!!i[0].match(/^\d+$/)&&!i[0].match(a)&&!!i[1].match(/^\d+$/):!!i[0].match(/^\d+.*\d$/)&&!i[0].match(a)&&!!i[1].match(/^\d+$/)))))},C.loadLanguagesInNode=function(){console.warn("`loadLanguagesInNode` is deprecated since version 1.6.0. Use `loadCulturesInNode` instead"),C.loadCulturesInNode()},C.loadCulturesInNode=function(){var e=t("./languages");for(var n in e)n&&C.culture(n,e[n])},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,o,r=this.length>>>0,i=!1;for(1<arguments.length&&(o=t,i=!0),n=0;r>n;++n)this.hasOwnProperty(n)&&(i?o=e(o,this[n],n,this):(o=this[n],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return o}),C.fn=o.prototype={clone:function(){return C(this)},format:function(e,t){return a(this,e?e:H,void 0!==t?t:Math.round)},formatCurrency:function(e,t){return u(this,T[k].currency.symbol,e?e:D,void 0!==t?t:Math.round)},formatForeignCurrency:function(e,t,n){return c(this,e,t?t:D,void 0!==n?n:Math.round)},unformat:function(e){if("number"==typeof e)return e;if("string"==typeof e){var t=l(this,e);return isNaN(t)?void 0:t}},binaryByteUnits:function(){return p(this._value,E.binary.suffixes,E.binary.scale).suffix},byteUnits:function(){return p(this._value,E.general.suffixes,E.general.scale).suffix},decimalByteUnits:function(){return p(this._value,E.decimal.suffixes,E.decimal.scale).suffix},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function t(e,t){return e+n*t}var n=b.call(null,this._value,e);return this._value=[this._value,e].reduce(t,0)/n,this},subtract:function(e){function t(e,t){return e-n*t}var n=b.call(null,this._value,e);return this._value=[e].reduce(t,this._value*n)/n,this},multiply:function(e){function t(e,t){var n=b(e,t),o=e*n;return o*=t*n,o/=n*n}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t){var n=b(e,t);return e*n/(t*n)}return this._value=[this._value,e].reduce(t),this},difference:function(e){return Math.abs(C(this._value).subtract(e).value())}},v()&&C.loadCulturesInNode(),A?n.exports=C:("undefined"==typeof ender&&(this.numbro=C),"function"==typeof e&&e.amd&&e([],function(){return C}))}).call("undefined"==typeof window?this:window)},{languages:1}],pikaday:[function(t,n,o){/*!
+ * Pikaday
+ *
+ * Copyright © 2014 David Bushell | BSD & MIT license | https://github.com/dbushell/Pikaday
+ */
+!function(r,i){"use strict";var s;if("object"==typeof o){try{s=t("moment")}catch(e){}n.exports=i(s)}else"function"==typeof e&&e.amd?e(function(e){var t="moment";try{s=e(t)}catch(e){}return i(s)}):r.Pikaday=i(r.moment)}(this,function(e){"use strict";var t="function"==typeof e,n=!!window.addEventListener,o=window.document,r=window.setTimeout,i=function(e,t,o,r){n?e.addEventListener(t,o,!!r):e.attachEvent("on"+t,o)},s=function(e,t,o,r){n?e.removeEventListener(t,o,!!r):e.detachEvent("on"+t,o)},a=function(e,t,n){var r;o.createEvent?(r=o.createEvent("HTMLEvents"),r.initEvent(t,!0,!1),r=y(r,n),e.dispatchEvent(r)):o.createEventObject&&(r=o.createEventObject(),r=y(r,n),e.fireEvent("on"+t,r))},l=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},u=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!==-1},c=function(e,t){u(e,t)||(e.className=""===e.className?t:e.className+" "+t)},d=function(e,t){e.className=l((" "+e.className+" ").replace(" "+t+" "," "))},h=function(e){return/Array/.test(Object.prototype.toString.call(e))},f=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},p=function(e){var t=e.getDay();return 0===t||6===t},m=function(e){return e%4===0&&e%100!==0||e%400===0},g=function(e,t){return[31,m(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},w=function(e){f(e)&&e.setHours(0,0,0,0)},v=function(e,t){return e.getTime()===t.getTime()},y=function(e,t,n){var o,r;for(o in t)r=void 0!==e[o],r&&"object"==typeof t[o]&&null!==t[o]&&void 0===t[o].nodeName?f(t[o])?n&&(e[o]=new Date(t[o].getTime())):h(t[o])?n&&(e[o]=t[o].slice(0)):e[o]=y({},t[o],n):!n&&r||(e[o]=t[o]);return e},b=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},C={field:null,bound:void 0,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,onSelect:null,onOpen:null,onClose:null,onDraw:null},_=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},R=function(e){if(e.isEmpty)return'<td class="is-empty"></td>';var t=[];return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&t.push("is-selected"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"},S=function(e,t,n){var o=new Date(n,0,1),r=Math.ceil(((new Date(n,t,e)-o)/864e5+o.getDay()+1)/7);return'<td class="pika-week">'+r+"</td>"},E=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},M=function(e){return"<tbody>"+e.join("")+"</tbody>"},T=function(e){var t,n=[];for(e.showWeekNumber&&n.push("<th></th>"),t=0;t<7;t++)n.push('<th scope="col"><abbr title="'+_(e,t)+'">'+_(e,t,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?n.reverse():n).join("")+"</thead>"},O=function(e,t,n,o,r){var i,s,a,l,u,c=e._o,d=n===c.minYear,f=n===c.maxYear,p='<div class="pika-title">',m=!0,g=!0;for(a=[],i=0;i<12;i++)a.push('<option value="'+(n===r?i-t:12+i-t)+'"'+(i===o?" selected":"")+(d&&i<c.minMonth||f&&i>c.maxMonth?"disabled":"")+">"+c.i18n.months[i]+"</option>");for(l='<div class="pika-label">'+c.i18n.months[o]+'<select class="pika-select pika-select-month" tabindex="-1">'+a.join("")+"</select></div>",h(c.yearRange)?(i=c.yearRange[0],s=c.yearRange[1]+1):(i=n-c.yearRange,s=1+n+c.yearRange),a=[];i<s&&i<=c.maxYear;i++)i>=c.minYear&&a.push('<option value="'+i+'"'+(i===n?" selected":"")+">"+i+"</option>");return u='<div class="pika-label">'+n+c.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+a.join("")+"</select></div>",p+=c.showMonthAfterYear?u+l:l+u,d&&(0===o||c.minMonth>=o)&&(m=!1),f&&(11===o||c.maxMonth<=o)&&(g=!1),0===t&&(p+='<button class="pika-prev'+(m?"":" is-disabled")+'" type="button">'+c.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(p+='<button class="pika-next'+(g?"":" is-disabled")+'" type="button">'+c.i18n.nextMonth+"</button>"),p+="</div>"},k=function(e,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+T(e)+M(t)+"</table>"},x=function(s){var a=this,l=a.config(s);a._onMouseDown=function(e){if(a._v){e=e||window.event;var t=e.target||e.srcElement;if(t)if(u(t,"is-disabled")||(u(t,"pika-button")&&!u(t,"is-empty")?(a.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),l.bound&&r(function(){a.hide(),l.field&&l.field.blur()},100)):u(t,"pika-prev")?a.prevMonth():u(t,"pika-next")&&a.nextMonth()),u(t,"pika-select"))a._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}},a._onChange=function(e){e=e||window.event;var t=e.target||e.srcElement;t&&(u(t,"pika-select-month")?a.gotoMonth(t.value):u(t,"pika-select-year")&&a.gotoYear(t.value))},a._onInputChange=function(n){var o;n.firedBy!==a&&(t?(o=e(l.field.value,l.format),o=o&&o.isValid()?o.toDate():null):o=new Date(Date.parse(l.field.value)),f(o)&&a.setDate(o),a._v||a.show())},a._onInputFocus=function(){a.show()},a._onInputClick=function(){a.show()},a._onInputBlur=function(){var e=o.activeElement;do if(u(e,"pika-single"))return;while(e=e.parentNode);a._c||(a._b=r(function(){a.hide()},50)),a._c=!1},a._onClick=function(e){e=e||window.event;var t=e.target||e.srcElement,o=t;if(t){!n&&u(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),i(t,"change",a._onChange)));do if(u(o,"pika-single")||o===l.trigger)return;while(o=o.parentNode);a._v&&t!==l.trigger&&o!==l.trigger&&a.hide()}},a.el=o.createElement("div"),a.el.className="pika-single"+(l.isRTL?" is-rtl":"")+(l.theme?" "+l.theme:""),i(a.el,"mousedown",a._onMouseDown,!0),i(a.el,"touchend",a._onMouseDown,!0),i(a.el,"change",a._onChange),l.field&&(l.container?l.container.appendChild(a.el):l.bound?o.body.appendChild(a.el):l.field.parentNode.insertBefore(a.el,l.field.nextSibling),i(l.field,"change",a._onInputChange),l.defaultDate||(t&&l.field.value?l.defaultDate=e(l.field.value,l.format).toDate():l.defaultDate=new Date(Date.parse(l.field.value)),l.setDefaultDate=!0));var c=l.defaultDate;f(c)?l.setDefaultDate?a.setDate(c,!0):a.gotoDate(c):a.gotoDate(new Date),l.bound?(this.hide(),a.el.className+=" is-bound",i(l.trigger,"click",a._onInputClick),i(l.trigger,"focus",a._onInputFocus),i(l.trigger,"blur",a._onInputBlur)):this.show()};return x.prototype={config:function(e){this._o||(this._o=y({},C,!0));var t=y(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n>4?4:n,f(t.minDate)||(t.minDate=!1),f(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),h(t.yearRange)){var o=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||o,t.yearRange[1]=parseInt(t.yearRange[1],10)||o}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||C.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(n){return f(this._d)?t?e(this._d).format(n||this._o.format):this._d.toDateString():""},getMoment:function(){return t?e(this._d):null},setMoment:function(n,o){t&&e.isMoment(n)&&this.setDate(n.toDate(),o)},getDate:function(){return f(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",a(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),f(e)){var n=this._o.minDate,o=this._o.maxDate;f(n)&&e<n?e=n:f(o)&&e>o&&(e=o),this._d=new Date(e.getTime()),w(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),a(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(f(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),o=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),r=e.getTime();o.setMonth(o.getMonth()+1),o.setDate(o.getDate()-1),t=r<n.getTime()||o.getTime()<r}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=b(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=b({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){w(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth(),this.draw()},setMaxDate:function(e){w(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth(),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t=this._o,n=t.minYear,o=t.maxYear,i=t.minMonth,s=t.maxMonth,a="";this._y<=n&&(this._y=n,!isNaN(i)&&this._m<i&&(this._m=i)),this._y>=o&&(this._y=o,!isNaN(s)&&this._m>s&&(this._m=s));for(var l=0;l<t.numberOfMonths;l++)a+='<div class="pika-lendar">'+O(this,l,this.calendars[l].year,this.calendars[l].month,this.calendars[0].year)+this.render(this.calendars[l].year,this.calendars[l].month)+"</div>";if(this.el.innerHTML=a,t.bound&&"hidden"!==t.field.type&&r(function(){t.trigger.focus()},1),"function"==typeof this._o.onDraw){var u=this;r(function(){u._o.onDraw.call(u)},0)}}},adjustPosition:function(){var e,t,n,r,i,s,a,l,u,c;if(!this._o.container){if(this.el.style.position="absolute",e=this._o.trigger,t=e,n=this.el.offsetWidth,r=this.el.offsetHeight,i=window.innerWidth||o.documentElement.clientWidth,s=window.innerHeight||o.documentElement.clientHeight,a=window.pageYOffset||o.body.scrollTop||o.documentElement.scrollTop,"function"==typeof e.getBoundingClientRect)c=e.getBoundingClientRect(),l=c.left+window.pageXOffset,u=c.bottom+window.pageYOffset;else for(l=t.offsetLeft,u=t.offsetTop+t.offsetHeight;t=t.offsetParent;)l+=t.offsetLeft,u+=t.offsetTop;(this._o.reposition&&l+n>i||this._o.position.indexOf("right")>-1&&l-n+e.offsetWidth>0)&&(l=l-n+e.offsetWidth),(this._o.reposition&&u+r>s+a||this._o.position.indexOf("top")>-1&&u-r-e.offsetHeight>0)&&(u=u-r-e.offsetHeight),this.el.style.left=l+"px",this.el.style.top=u+"px"}},render:function(e,t){var n=this._o,o=new Date,r=g(e,t),i=new Date(e,t,1).getDay(),s=[],a=[];w(o),n.firstDay>0&&(i-=n.firstDay,i<0&&(i+=7));for(var l=r+i,u=l;u>7;)u-=7;l+=7-u;for(var c=0,d=0;c<l;c++){var h=new Date(e,t,1+(c-i)),m=!!f(this._d)&&v(h,this._d),y=v(h,o),b=c<i||c>=r+i,C=n.startRange&&v(n.startRange,h),_=n.endRange&&v(n.endRange,h),M=n.startRange&&n.endRange&&n.startRange<h&&h<n.endRange,T=n.minDate&&h<n.minDate||n.maxDate&&h>n.maxDate||n.disableWeekends&&p(h)||n.disableDayFn&&n.disableDayFn(h),O={day:1+(c-i),month:t,year:e,isSelected:m,isToday:y,isDisabled:T,isEmpty:b,isStartRange:C,isEndRange:_,isInRange:M};a.push(R(O)),7===++d&&(n.showWeekNumber&&a.unshift(S(c-i,t,e)),s.push(E(a,n.isRTL)),a=[],d=0)}return k(n,s)},isVisible:function(){return this._v},show:function(){this._v||(d(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(i(o,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;e!==!1&&(this._o.bound&&s(o,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",c(this.el,"is-hidden"),this._v=!1,void 0!==e&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),s(this.el,"mousedown",this._onMouseDown,!0),s(this.el,"touchend",this._onMouseDown,!0),s(this.el,"change",this._onChange),this._o.field&&(s(this._o.field,"change",this._onInputChange),this._o.bound&&(s(this._o.trigger,"click",this._onInputClick),s(this._o.trigger,"focus",this._onInputFocus),s(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},x})},{moment:"moment"}],zeroclipboard:[function(t,n,o){/*!
+ * ZeroClipboard
+ * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
+ * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
+ * Licensed MIT
+ * http://zeroclipboard.org/
+ * v2.2.0
+ */
+!function(t,o){"use strict";var r,i,s,a=t,l=a.document,u=a.navigator,c=a.setTimeout,d=a.clearTimeout,h=a.setInterval,f=a.clearInterval,p=a.getComputedStyle,m=a.encodeURIComponent,g=a.ActiveXObject,w=a.Error,v=a.Number.parseInt||a.parseInt,y=a.Number.parseFloat||a.parseFloat,b=a.Number.isNaN||a.isNaN,C=a.Date.now,_=a.Object.keys,R=a.Object.defineProperty,S=a.Object.prototype.hasOwnProperty,E=a.Array.prototype.slice,M=function(){var e=function(e){return e};if("function"==typeof a.wrap&&"function"==typeof a.unwrap)try{var t=l.createElement("div"),n=a.unwrap(t);1===t.nodeType&&n&&1===n.nodeType&&(e=a.unwrap)}catch(e){}return e}(),T=function(e){return E.call(e,0)},O=function(){var e,t,n,r,i,s,a=T(arguments),l=a[0]||{};for(e=1,t=a.length;e<t;e++)if(null!=(n=a[e]))for(r in n)S.call(n,r)&&(i=l[r],s=n[r],l!==s&&s!==o&&(l[r]=s));return l},k=function(e){var t,n,o,r;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if("number"==typeof e.length)for(t=[],n=0,o=e.length;n<o;n++)S.call(e,n)&&(t[n]=k(e[n]));else{t={};for(r in e)S.call(e,r)&&(t[r]=k(e[r]))}return t},x=function(e,t){for(var n={},o=0,r=t.length;o<r;o++)t[o]in e&&(n[t[o]]=e[t[o]]);return n},H=function(e,t){var n={};for(var o in e)t.indexOf(o)===-1&&(n[o]=e[o]);return n},D=function(e){if(e)for(var t in e)S.call(e,t)&&delete e[t];return e},A=function(e,t){if(e&&1===e.nodeType&&e.ownerDocument&&t&&(1===t.nodeType&&t.ownerDocument&&t.ownerDocument===e.ownerDocument||9===t.nodeType&&!t.ownerDocument&&t===e.ownerDocument))do{if(e===t)return!0;e=e.parentNode}while(e);return!1},P=function(e){var t;return"string"==typeof e&&e&&(t=e.split("#")[0].split("?")[0],t=e.slice(0,e.lastIndexOf("/")+1)),t},N=function(e){var t,n;return"string"==typeof e&&e&&(n=e.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]?t=n[1]:(n=e.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]&&(t=n[1]))),t},L=function(){var e,t;try{throw new w}catch(e){t=e}return t&&(e=t.sourceURL||t.fileName||N(t.stack)),e},W=function(){var e,t,n;if(l.currentScript&&(e=l.currentScript.src))return e;if(t=l.getElementsByTagName("script"),1===t.length)return t[0].src||o;if("readyState"in t[0])for(n=t.length;n--;)if("interactive"===t[n].readyState&&(e=t[n].src))return e;return"loading"===l.readyState&&(e=t[t.length-1].src)?e:(e=L())?e:o},I=function(){var e,t,n,r=l.getElementsByTagName("script");for(e=r.length;e--;){if(!(n=r[e].src)){t=null;break}if(n=P(n),null==t)t=n;else if(t!==n){t=null;break}}return t||o},j=function(){var e=P(W())||I()||"";return e+"ZeroClipboard.swf"},V=function(){return null==t.opener&&(!!t.top&&t!=t.top||!!t.parent&&t!=t.parent)}(),F={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},B="11.0.0",z={},Y={},U=null,G=0,$=0,K={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},X=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],q=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],Z=new RegExp("^flash-("+q.map(function(e){return e.replace(/^flash-/,"")}).join("|")+")$"),J=new RegExp("^flash-("+q.slice(1).map(function(e){return e.replace(/^flash-/,"")}).join("|")+")$"),Q={swfPath:j(),trustedDomains:t.location.host?[t.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},ee=function(e){if("object"==typeof e&&null!==e)for(var t in e)if(S.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))Q[t]=e[t];else if(null==F.bridge)if("containerId"===t||"swfObjectId"===t){if(!me(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");Q[t]=e[t]}else Q[t]=e[t];{if("string"!=typeof e||!e)return k(Q);if(S.call(Q,e))return Q[e]}},te=function(){return $e(),{browser:x(u,["userAgent","platform","appName"]),flash:H(F,["bridge"]),zeroclipboard:{version:Xe.version,config:Xe.config()}}},ne=function(){return!!(F.disabled||F.outdated||F.sandboxed||F.unavailable||F.degraded||F.deactivated)},oe=function(e,t){var n,i,s,a={};if("string"==typeof e&&e)s=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)S.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&Xe.on(n,e[n]);if(s&&s.length){for(n=0,i=s.length;n<i;n++)e=s[n].replace(/^on/,""),a[e]=!0,z[e]||(z[e]=[]),z[e].push(t);if(a.ready&&F.ready&&Xe.emit({type:"ready"}),a.error){for(n=0,i=q.length;n<i;n++)if(F[q[n].replace(/^flash-/,"")]===!0){Xe.emit({type:"error",name:q[n]});break}r!==o&&Xe.version!==r&&Xe.emit({type:"error",name:"version-mismatch",jsVersion:Xe.version,swfVersion:r})}}return Xe},re=function(e,t){var n,o,r,i,s;if(0===arguments.length)i=_(z);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)S.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&Xe.off(n,e[n]);if(i&&i.length)for(n=0,o=i.length;n<o;n++)if(e=i[n].toLowerCase().replace(/^on/,""),s=z[e],s&&s.length)if(t)for(r=s.indexOf(t);r!==-1;)s.splice(r,1),r=s.indexOf(t,r);else s.length=0;return Xe},ie=function(e){var t;return t="string"==typeof e&&e?k(z[e])||null:k(z)},se=function(e){var t,n,o;if(e=ge(e),e&&!Re(e))return"ready"===e.type&&F.overdue===!0?Xe.emit({type:"error",name:"flash-overdue"}):(t=O({},e),Ce.call(this,t),"copy"===e.type&&(o=He(Y),n=o.data,U=o.formatMap),n)},ae=function(){var e=F.sandboxed;if($e(),"boolean"!=typeof F.ready&&(F.ready=!1),F.sandboxed!==e&&F.sandboxed===!0)F.ready=!1,Xe.emit({type:"error",name:"flash-sandboxed"});else if(!Xe.isFlashUnusable()&&null===F.bridge){var t=Q.flashLoadTimeout;"number"==typeof t&&t>=0&&(G=c(function(){"boolean"!=typeof F.deactivated&&(F.deactivated=!0),F.deactivated===!0&&Xe.emit({type:"error",name:"flash-deactivated"})},t)),F.overdue=!1,ke()}},le=function(){Xe.clearData(),Xe.blur(),Xe.emit("destroy"),xe(),Xe.off()},ue=function(e,t){var n;if("object"==typeof e&&e&&"undefined"==typeof t)n=e,Xe.clearData();else{if("string"!=typeof e||!e)return;n={},n[e]=t}for(var o in n)"string"==typeof o&&o&&S.call(n,o)&&"string"==typeof n[o]&&n[o]&&(Y[o]=n[o])},ce=function(e){"undefined"==typeof e?(D(Y),U=null):"string"==typeof e&&S.call(Y,e)&&delete Y[e]},de=function(e){return"undefined"==typeof e?k(Y):"string"==typeof e&&S.call(Y,e)?Y[e]:void 0},he=function(e){if(e&&1===e.nodeType){i&&(je(i,Q.activeClass),i!==e&&je(i,Q.hoverClass)),i=e,Ie(e,Q.hoverClass);var t=e.getAttribute("title")||Q.title;if("string"==typeof t&&t){var n=Oe(F.bridge);n&&n.setAttribute("title",t)}var o=Q.forceHandCursor===!0||"pointer"===Ve(e,"cursor");Ue(o),Ye()}},fe=function(){var e=Oe(F.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px"),i&&(je(i,Q.hoverClass),je(i,Q.activeClass),i=null)},pe=function(){return i||null},me=function(e){return"string"==typeof e&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},ge=function(e){var t;if("string"==typeof e&&e?(t=e,e={}):"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(t=e.type),t){t=t.toLowerCase(),!e.target&&(/^(copy|aftercopy|_click)$/.test(t)||"error"===t&&"clipboard-error"===e.name)&&(e.target=s),O(e,{type:t,target:e.target||i||null,relatedTarget:e.relatedTarget||null,currentTarget:F&&F.bridge||null,timeStamp:e.timeStamp||C()||null});var n=K[e.type];return"error"===e.type&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),"ready"===e.type&&O(e,{target:null,version:F.version}),"error"===e.type&&(Z.test(e.name)&&O(e,{target:null,minimumVersion:B}),J.test(e.name)&&O(e,{version:F.version})),"copy"===e.type&&(e.clipboardData={setData:Xe.setData,clearData:Xe.clearData}),"aftercopy"===e.type&&(e=De(e,U)),e.target&&!e.relatedTarget&&(e.relatedTarget=we(e.target)),ve(e)}},we=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?l.getElementById(t):null},ve=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,n="_mouseover"===e.type&&e.relatedTarget?e.relatedTarget:o,r="_mouseout"===e.type&&e.relatedTarget?e.relatedTarget:o,i=Fe(t),s=a.screenLeft||a.screenX||0,u=a.screenTop||a.screenY||0,c=l.body.scrollLeft+l.documentElement.scrollLeft,d=l.body.scrollTop+l.documentElement.scrollTop,h=i.left+("number"==typeof e._stageX?e._stageX:0),f=i.top+("number"==typeof e._stageY?e._stageY:0),p=h-c,m=f-d,g=s+p,w=u+m,v="number"==typeof e.movementX?e.movementX:0,y="number"==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,O(e,{srcElement:t,fromElement:n,toElement:r,screenX:g,screenY:w,pageX:h,pageY:f,clientX:p,clientY:m,x:p,y:m,movementX:v,movementY:y,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},ye=function(e){var t=e&&"string"==typeof e.type&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},be=function(e,t,n,o){o?c(function(){e.apply(t,n)},0):e.apply(t,n)},Ce=function(e){if("object"==typeof e&&e&&e.type){var t=ye(e),n=z["*"]||[],o=z[e.type]||[],r=n.concat(o);if(r&&r.length){var i,s,l,u,c,d=this;for(i=0,s=r.length;i<s;i++)l=r[i],u=d,"string"==typeof l&&"function"==typeof a[l]&&(l=a[l]),"object"==typeof l&&l&&"function"==typeof l.handleEvent&&(u=l,l=l.handleEvent),"function"==typeof l&&(c=O({},e),be(l,u,[c],t))}return this}},_e=function(e){var t=null;return(V===!1||e&&"error"===e.type&&e.name&&X.indexOf(e.name)!==-1)&&(t=!1),t},Re=function(e){var t=e.target||i||null,n="swf"===e._source;switch(delete e._source,e.type){case"error":var o="flash-sandboxed"===e.name||_e(e);"boolean"==typeof o&&(F.sandboxed=o),q.indexOf(e.name)!==-1?O(F,{disabled:"flash-disabled"===e.name,outdated:"flash-outdated"===e.name,unavailable:"flash-unavailable"===e.name,degraded:"flash-degraded"===e.name,deactivated:"flash-deactivated"===e.name,overdue:"flash-overdue"===e.name,ready:!1}):"version-mismatch"===e.name&&(r=e.swfVersion,O(F,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),ze();break;case"ready":r=e.swfVersion;var a=F.deactivated===!0;O(F,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:a,ready:!a}),ze();break;case"beforecopy":s=t;break;case"copy":var l,u,c=e.relatedTarget;!Y["text/html"]&&!Y["text/plain"]&&c&&(u=c.value||c.outerHTML||c.innerHTML)&&(l=c.value||c.textContent||c.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",l),u!==l&&e.clipboardData.setData("text/html",u)):!Y["text/plain"]&&e.target&&(l=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",l));break;case"aftercopy":Se(e),Xe.clearData(),t&&t!==We()&&t.focus&&t.focus();break;case"_mouseover":Xe.focus(t),Q.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!A(e.relatedTarget,t)&&Ee(O({},e,{type:"mouseenter",bubbles:!1,cancelable:!1})),Ee(O({},e,{type:"mouseover"})));break;case"_mouseout":Xe.blur(),Q.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!A(e.relatedTarget,t)&&Ee(O({},e,{type:"mouseleave",bubbles:!1,cancelable:!1})),Ee(O({},e,{type:"mouseout"})));break;case"_mousedown":Ie(t,Q.activeClass),Q.bubbleEvents===!0&&n&&Ee(O({},e,{type:e.type.slice(1)}));break;case"_mouseup":je(t,Q.activeClass),Q.bubbleEvents===!0&&n&&Ee(O({},e,{type:e.type.slice(1)}));break;case"_click":s=null,Q.bubbleEvents===!0&&n&&Ee(O({},e,{type:e.type.slice(1)}));break;case"_mousemove":Q.bubbleEvents===!0&&n&&Ee(O({},e,{type:e.type.slice(1)}))}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type))return!0},Se=function(e){if(e.errors&&e.errors.length>0){var t=k(e);O(t,{type:"error",name:"clipboard-error"}),delete t.success,c(function(){Xe.emit(t)},0)}},Ee=function(e){if(e&&"string"==typeof e.type&&e){var t,n=e.target||null,o=n&&n.ownerDocument||l,r={view:o.defaultView||a,canBubble:!0,cancelable:!0,detail:"click"===e.type?1:0,button:"number"==typeof e.which?e.which-1:"number"==typeof e.button?e.button:o.createEvent?0:1},i=O(r,e);n&&o.createEvent&&n.dispatchEvent&&(i=[i.type,i.canBubble,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget],t=o.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,i),t._source="js",n.dispatchEvent(t)))}},Me=function(){var e=Q.flashLoadTimeout;if("number"==typeof e&&e>=0){var t=Math.min(1e3,e/10),n=Q.swfObjectId+"_fallbackContent";$=h(function(){var e=l.getElementById(n);Be(e)&&(ze(),F.deactivated=null,Xe.emit({type:"error",name:"swf-not-found"}))},t)}},Te=function(){var e=l.createElement("div");return e.id=Q.containerId,e.className=Q.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+Ge(Q.zIndex),e},Oe=function(e){for(var t=e&&e.parentNode;t&&"OBJECT"===t.nodeName&&t.parentNode;)t=t.parentNode;return t||null},ke=function(){var e,t=F.bridge,n=Oe(t);if(!t){var o=Le(a.location.host,Q),r="never"===o?"none":"all",i=Pe(O({jsVersion:Xe.version},Q)),s=Q.swfPath+Ae(Q.swfPath,Q);n=Te();var u=l.createElement("div");n.appendChild(u),l.body.appendChild(n);var c=l.createElement("div"),d="activex"===F.pluginType;c.innerHTML='<object id="'+Q.swfObjectId+'" name="'+Q.swfObjectId+'" width="100%" height="100%" '+(d?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+s+'"')+">"+(d?'<param name="movie" value="'+s+'"/>':"")+'<param name="allowScriptAccess" value="'+o+'"/><param name="allowNetworking" value="'+r+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+i+'"/><div id="'+Q.swfObjectId+'_fallbackContent">&nbsp;</div></object>',t=c.firstChild,c=null,M(t).ZeroClipboard=Xe,n.replaceChild(t,u),Me()}return t||(t=l[Q.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&n&&(t=n.firstChild)),F.bridge=t||null,t},xe=function(){var e=F.bridge;if(e){var t=Oe(e);t&&("activex"===F.pluginType&&"readyState"in e?(e.style.display="none",function n(){if(4===e.readyState){for(var o in e)"function"==typeof e[o]&&(e[o]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else c(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),ze(),F.ready=null,F.bridge=null,F.deactivated=null,r=o}},He=function(e){var t={},n={};if("object"==typeof e&&e){for(var o in e)if(o&&S.call(e,o)&&"string"==typeof e[o]&&e[o])switch(o.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[o],n.text=o;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[o],n.html=o;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[o],n.rtf=o}return{data:t,formatMap:n}}},De=function(e,t){if("object"!=typeof e||!e||"object"!=typeof t||!t)return e;var n={};for(var o in e)if(S.call(e,o))if("errors"===o){n[o]=e[o]?e[o].slice():[];for(var r=0,i=n[o].length;r<i;r++)n[o][r].format=t[n[o][r].format]}else if("success"!==o&&"data"!==o)n[o]=e[o];else{n[o]={};var s=e[o];for(var a in s)a&&S.call(s,a)&&S.call(t,a)&&(n[o][t[a]]=s[a])}return n},Ae=function(e,t){var n=null==t||t&&t.cacheBust===!0;return n?(e.indexOf("?")===-1?"?":"&")+"noCache="+C():""},Pe=function(e){var t,n,o,r,i="",s=[];if(e.trustedDomains&&("string"==typeof e.trustedDomains?r=[e.trustedDomains]:"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(r=e.trustedDomains)),r&&r.length)for(t=0,n=r.length;t<n;t++)if(S.call(r,t)&&r[t]&&"string"==typeof r[t]){if(o=Ne(r[t]),!o)continue;if("*"===o){s.length=0,s.push(o);break}s.push.apply(s,[o,"//"+o,a.location.protocol+"//"+o])}return s.length&&(i+="trustedOrigins="+m(s.join(","))),e.forceEnhancedClipboard===!0&&(i+=(i?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof e.swfObjectId&&e.swfObjectId&&(i+=(i?"&":"")+"swfObjectId="+m(e.swfObjectId)),"string"==typeof e.jsVersion&&e.jsVersion&&(i+=(i?"&":"")+"jsVersion="+m(e.jsVersion)),i},Ne=function(e){if(null==e||""===e)return null;if(e=e.replace(/^\s+|\s+$/g,""),""===e)return null;var t=e.indexOf("//");e=t===-1?e:e.slice(t+2);var n=e.indexOf("/");return e=n===-1?e:t===-1||0===n?null:e.slice(0,n),e&&".swf"===e.slice(-4).toLowerCase()?null:e||null},Le=function(){var e=function(e){var t,n,o,r=[];if("string"==typeof e&&(e=[e]),"object"!=typeof e||!e||"number"!=typeof e.length)return r;for(t=0,n=e.length;t<n;t++)if(S.call(e,t)&&(o=Ne(e[t]))){if("*"===o){r.length=0,r.push("*");break}r.indexOf(o)===-1&&r.push(o)}return r};return function(t,n){var o=Ne(n.swfPath);null===o&&(o=t);var r=e(n.trustedDomains),i=r.length;if(i>0){if(1===i&&"*"===r[0])return"always";if(r.indexOf(t)!==-1)return 1===i&&t===o?"sameDomain":"always"}return"never"}}(),We=function(){try{return l.activeElement}catch(e){return null}},Ie=function(e,t){var n,o,r,i=[];if("string"==typeof t&&t&&(i=t.split(/\s+/)),e&&1===e.nodeType&&i.length>0)if(e.classList)for(n=0,o=i.length;n<o;n++)e.classList.add(i[n]);else if(e.hasOwnProperty("className")){for(r=" "+e.className+" ",n=0,o=i.length;n<o;n++)r.indexOf(" "+i[n]+" ")===-1&&(r+=i[n]+" ");e.className=r.replace(/^\s+|\s+$/g,"")}return e},je=function(e,t){var n,o,r,i=[];if("string"==typeof t&&t&&(i=t.split(/\s+/)),e&&1===e.nodeType&&i.length>0)if(e.classList&&e.classList.length>0)for(n=0,o=i.length;n<o;n++)e.classList.remove(i[n]);else if(e.className){for(r=(" "+e.className+" ").replace(/[\r\n\t]/g," "),n=0,o=i.length;n<o;n++)r=r.replace(" "+i[n]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}return e},Ve=function(e,t){var n=p(e,null).getPropertyValue(t);return"cursor"!==t||n&&"auto"!==n||"A"!==e.nodeName?n:"pointer"},Fe=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n=e.getBoundingClientRect(),o=a.pageXOffset,r=a.pageYOffset,i=l.documentElement.clientLeft||0,s=l.documentElement.clientTop||0,u=0,c=0;if("relative"===Ve(l.body,"position")){var d=l.body.getBoundingClientRect(),h=l.documentElement.getBoundingClientRect();u=d.left-h.left||0,c=d.top-h.top||0}t.left=n.left+o-i-u,t.top=n.top+r-s-c,t.width="width"in n?n.width:n.right-n.left,t.height="height"in n?n.height:n.bottom-n.top}return t},Be=function(e){if(!e)return!1;var t=p(e,null),n=y(t.height)>0,o=y(t.width)>0,r=y(t.top)>=0,i=y(t.left)>=0,s=n&&o&&r&&i,a=s?null:Fe(e),l="none"!==t.display&&"collapse"!==t.visibility&&(s||!!a&&(n||a.height>0)&&(o||a.width>0)&&(r||a.top>=0)&&(i||a.left>=0));return l},ze=function(){d(G),G=0,f($),$=0},Ye=function(){var e;if(i&&(e=Oe(F.bridge))){var t=Fe(i);O(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+Ge(Q.zIndex)})}},Ue=function(e){F.ready===!0&&(F.bridge&&"function"==typeof F.bridge.setHandCursor?F.bridge.setHandCursor(e):F.ready=!1)},Ge=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return"number"!=typeof e||b(e)?"string"==typeof e&&(t=Ge(v(e,10))):t=e,"number"==typeof t?t:"auto"},$e=function(e){var n,o,r,i=F.sandboxed,s=null;if(e=e===!0,V===!1)s=!1;else{try{o=t.frameElement||null}catch(e){r={name:e.name,message:e.message}}if(o&&1===o.nodeType&&"IFRAME"===o.nodeName)try{s=o.hasAttribute("sandbox")}catch(e){s=null}else{try{n=document.domain||null}catch(e){n=null}(null===n||r&&"SecurityError"===r.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(r.message.toLowerCase()))&&(s=!0)}}return F.sandboxed=s,i===s||e||Ke(g),s},Ke=function(e){function t(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function n(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||"chrome.plugin"===e.slice(-13))}function o(e){e&&(a=!0,e.version&&(d=t(e.version)),!d&&e.description&&(d=t(e.description)),e.filename&&(c=n(e.filename)))}var r,i,s,a=!1,l=!1,c=!1,d="";if(u.plugins&&u.plugins.length)r=u.plugins["Shockwave Flash"],o(r),u.plugins["Shockwave Flash 2.0"]&&(a=!0,d="2.0.0.11");else if(u.mimeTypes&&u.mimeTypes.length)s=u.mimeTypes["application/x-shockwave-flash"],r=s&&s.enabledPlugin,o(r);else if("undefined"!=typeof e){l=!0;try{i=new e("ShockwaveFlash.ShockwaveFlash.7"),a=!0,d=t(i.GetVariable("$version"))}catch(n){try{i=new e("ShockwaveFlash.ShockwaveFlash.6"),a=!0,d="6.0.21"}catch(n){try{i=new e("ShockwaveFlash.ShockwaveFlash"),a=!0,d=t(i.GetVariable("$version"))}catch(e){l=!1}}}}F.disabled=a!==!0,F.outdated=d&&y(d)<y(B),F.version=d||"0.0.0",F.pluginType=c?"pepper":l?"activex":a?"netscape":"unknown"};Ke(g),$e(!0);var Xe=function(){return this instanceof Xe?void("function"==typeof Xe._createClient&&Xe._createClient.apply(this,T(arguments))):new Xe};R(Xe,"version",{value:"2.2.0",writable:!1,configurable:!0,enumerable:!0}),Xe.config=function(){return ee.apply(this,T(arguments))},Xe.state=function(){return te.apply(this,T(arguments))},Xe.isFlashUnusable=function(){return ne.apply(this,T(arguments))},Xe.on=function(){return oe.apply(this,T(arguments))},Xe.off=function(){return re.apply(this,T(arguments))},Xe.handlers=function(){return ie.apply(this,T(arguments))},Xe.emit=function(){return se.apply(this,T(arguments))},Xe.create=function(){return ae.apply(this,T(arguments))},Xe.destroy=function(){return le.apply(this,T(arguments))},Xe.setData=function(){return ue.apply(this,T(arguments))},Xe.clearData=function(){return ce.apply(this,T(arguments))},Xe.getData=function(){return de.apply(this,T(arguments))},Xe.focus=Xe.activate=function(){return he.apply(this,T(arguments))},Xe.blur=Xe.deactivate=function(){return fe.apply(this,T(arguments))},Xe.activeElement=function(){return pe.apply(this,T(arguments))};var qe=0,Ze={},Je=0,Qe={},et={};O(Q,{autoActivate:!0});var tt=function(e){var t=this;t.id=""+qe++,Ze[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),Xe.on("*",function(e){return t.emit(e)}),Xe.on("destroy",function(){t.destroy()}),Xe.create()},nt=function(e,t){var n,i,s,a={},l=Ze[this.id],u=l&&l.handlers;if(!l)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof e&&e)s=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)S.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.on(n,e[n]);if(s&&s.length){for(n=0,i=s.length;n<i;n++)e=s[n].replace(/^on/,""),a[e]=!0,u[e]||(u[e]=[]),u[e].push(t);if(a.ready&&F.ready&&this.emit({type:"ready",client:this}),a.error){for(n=0,i=q.length;n<i;n++)if(F[q[n].replace(/^flash-/,"")]){this.emit({type:"error",name:q[n],client:this});break}r!==o&&Xe.version!==r&&this.emit({type:"error",name:"version-mismatch",jsVersion:Xe.version,swfVersion:r})}}return this},ot=function(e,t){var n,o,r,i,s,a=Ze[this.id],l=a&&a.handlers;if(!l)return this;if(0===arguments.length)i=_(l);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)S.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(i&&i.length)for(n=0,o=i.length;n<o;n++)if(e=i[n].toLowerCase().replace(/^on/,""),s=l[e],s&&s.length)if(t)for(r=s.indexOf(t);r!==-1;)s.splice(r,1),r=s.indexOf(t,r);else s.length=0;return this},rt=function(e){var t=null,n=Ze[this.id]&&Ze[this.id].handlers;return n&&(t="string"==typeof e&&e?n[e]?n[e].slice(0):[]:k(n)),t},it=function(e){if(ct.call(this,e)){"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(e=O({},e));var t=O({},ge(e),{client:this});dt.call(this,t)}return this},st=function(e){if(!Ze[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");e=ht(e);for(var t=0;t<e.length;t++)if(S.call(e,t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?Qe[e[t].zcClippingId].indexOf(this.id)===-1&&Qe[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+Je++,Qe[e[t].zcClippingId]=[this.id],Q.autoActivate===!0&&ft(e[t]));var n=Ze[this.id]&&Ze[this.id].elements;n.indexOf(e[t])===-1&&n.push(e[t])}return this},at=function(e){var t=Ze[this.id];if(!t)return this;var n,o=t.elements;e="undefined"==typeof e?o.slice(0):ht(e);for(var r=e.length;r--;)if(S.call(e,r)&&e[r]&&1===e[r].nodeType){for(n=0;(n=o.indexOf(e[r],n))!==-1;)o.splice(n,1);var i=Qe[e[r].zcClippingId];if(i){for(n=0;(n=i.indexOf(this.id,n))!==-1;)i.splice(n,1);0===i.length&&(Q.autoActivate===!0&&pt(e[r]),delete e[r].zcClippingId)}}return this},lt=function(){var e=Ze[this.id];return e&&e.elements?e.elements.slice(0):[]},ut=function(){Ze[this.id]&&(this.unclip(),this.off(),delete Ze[this.id])},ct=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=Ze[this.id],n=t&&t.elements,o=!!n&&n.length>0,r=!e.target||o&&n.indexOf(e.target)!==-1,i=e.relatedTarget&&o&&n.indexOf(e.relatedTarget)!==-1,s=e.client&&e.client===this;return!(!t||!(r||i||s))},dt=function(e){var t=Ze[this.id];if("object"==typeof e&&e&&e.type&&t){var n=ye(e),o=t&&t.handlers["*"]||[],r=t&&t.handlers[e.type]||[],i=o.concat(r);if(i&&i.length){var s,l,u,c,d,h=this;for(s=0,l=i.length;s<l;s++)u=i[s],c=h,"string"==typeof u&&"function"==typeof a[u]&&(u=a[u]),"object"==typeof u&&u&&"function"==typeof u.handleEvent&&(c=u,u=u.handleEvent),"function"==typeof u&&(d=O({},e),be(u,c,[d],n))}}},ht=function(e){return"string"==typeof e&&(e=[]),"number"!=typeof e.length?[e]:e},ft=function(e){if(e&&1===e.nodeType){var t=function(e){(e||(e=a.event))&&("js"!==e._source&&(e.stopImmediatePropagation(),e.preventDefault()),delete e._source)},n=function(n){(n||(n=a.event))&&(t(n),Xe.focus(e))};e.addEventListener("mouseover",n,!1),e.addEventListener("mouseout",t,!1),e.addEventListener("mouseenter",t,!1),e.addEventListener("mouseleave",t,!1),e.addEventListener("mousemove",t,!1),et[e.zcClippingId]={mouseover:n,mouseout:t,mouseenter:t,mouseleave:t,mousemove:t}}},pt=function(e){if(e&&1===e.nodeType){var t=et[e.zcClippingId];if("object"==typeof t&&t){for(var n,o,r=["move","leave","enter","out","over"],i=0,s=r.length;i<s;i++)n="mouse"+r[i],o=t[n],"function"==typeof o&&e.removeEventListener(n,o,!1);delete et[e.zcClippingId]}}};Xe._createClient=function(){tt.apply(this,T(arguments))},Xe.prototype.on=function(){return nt.apply(this,T(arguments))},Xe.prototype.off=function(){return ot.apply(this,T(arguments))},Xe.prototype.handlers=function(){return rt.apply(this,T(arguments))},Xe.prototype.emit=function(){return it.apply(this,T(arguments))},Xe.prototype.clip=function(){return st.apply(this,T(arguments))},Xe.prototype.unclip=function(){return at.apply(this,T(arguments))},Xe.prototype.elements=function(){return lt.apply(this,T(arguments))},Xe.prototype.destroy=function(){return ut.apply(this,T(arguments))},Xe.prototype.setText=function(e){if(!Ze[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.setData("text/plain",e),this},Xe.prototype.setHtml=function(e){if(!Ze[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.setData("text/html",e),this},Xe.prototype.setRichText=function(e){if(!Ze[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.setData("application/rtf",e),this},Xe.prototype.setData=function(){if(!Ze[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.setData.apply(this,T(arguments)),this},Xe.prototype.clearData=function(){if(!Ze[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.clearData.apply(this,T(arguments)),this},Xe.prototype.getData=function(){if(!Ze[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return Xe.getData.apply(this,T(arguments))},"function"==typeof e&&e.amd?e(function(){return Xe}):"object"==typeof n&&n&&"object"==typeof n.exports&&n.exports?n.exports=Xe:t.ZeroClipboard=Xe}(function(){return this||window}())},{}]},{},[24,62,64,63,65,98,99,100,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,101,102,103,104,118,119,120,121,107,108,109,110,111,112,32,36,33,34,41,35,37,38,39,40])(24)});
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/styles/gradebook-gbgrade-table.css b/gradebookng/tool/src/webapp/styles/gradebook-gbgrade-table.css
new file mode 100644
index 0000000000..8ce7827d81
--- /dev/null
+++ b/gradebookng/tool/src/webapp/styles/gradebook-gbgrade-table.css
@@ -0,0 +1,580 @@
+ /* Fonts */
+ @font-face {
+    font-family:"gradebook-icons";
+    src:url(../fonts/gradebook-icons.eot);
+    src:url(../fonts/gradebook-icons.eot?#iefix) format("embedded-opentype"),url(../fonts/gradebook-icons.woff) format("woff"),url(../fonts/gradebook-icons.ttf) format("truetype"),url(../fonts/gradebook-icons.svg#gradebook-icons) format("svg");
+    font-weight:400;
+    font-style:normal
+}
+#gradebookSpreadsheet,
+#gradebookGradesToolbar {
+  margin-top: 15px;
+}
+#gradeTableWrapper {
+  position: relative;
+  overflow: visible;
+}
+
+#gradeTableWrapper {
+  font-size: 0.9em;
+}
+#gradeTableWrapper td {
+  text-align: center;
+  vertical-align: middle;
+}
+#gradeTableWrapper tbody th {
+  text-align: left;
+  vertical-align: middle;
+}
+#gradeTableWrapper .handsontableInputHolder {
+  text-align: center;
+}
+#gradeTableWrapper .handsontableInputHolder .out-of {
+  position: absolute;
+  right: 2px;
+  background-color: #FAFAFA;
+  font-size: 0.8em;
+  top: 2px;
+  border-left: 1px solid #EEE;
+  height: 28px;
+  line-height: 28px;
+  padding: 0 14px;
+}
+#gradeTableWrapper .handsontableInput {
+  line-height: 30px;
+  text-align: center;
+}
+
+#gradeTableWrapper .handsontable tr > *:nth-child(1){
+  text-align: left;
+}
+#gradeTableWrapper .handsontable tbody tr > *:nth-child(1) .relative,
+#gradeTableWrapper .handsontable tbody tr > *:nth-child(2) .relative {
+  padding: 2px 8px;
+}
+#gradeTableWrapper .handsontable tbody tr > *:nth-child(1) .relative .gb-value {
+  overflow: hidden;
+}
+#gradeTableWrapper .handsontable tr > *:nth-child(2){
+  border-right: 1px solid #BBB;
+}
+#gradeTableWrapper .handsontable thead th {
+  color: #666;
+  border-bottom: 1px solid #BBB;
+}
+#gradeTableWrapper .handsontable tbody tr:nth-child(2n) td,
+#gradeTableWrapper .handsontable tbody tr:nth-child(2n) td .relative {
+    background: #F9F9F9;
+}
+#gradeTableWrapper .handsontable th,
+#gradeTableWrapper .handsontable td {
+  border-color: #EAEAEA;
+  padding: 0;
+}
+#gradeTableWrapper .handsontable th > .relative,
+#gradeTableWrapper .handsontable td > .relative {
+  padding: 2px 4px;
+}
+#gradeTableWrapper .handsontable th > .relative > * {
+  white-space: normal;
+}
+#gradeTableWrapper .handsontable th {
+  background-color: #F6f6f6;
+  height: 102px;
+}
+
+#gradeTableWrapper thead th {
+  text-align: left;
+}
+#gradeTableWrapper thead th .relative {
+  height: 100%;
+}
+#gradeTableWrapper tbody td .relative {
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  height: 32px;
+}
+#gradeTableWrapper tbody td .gb-student-cell {
+  justify-content: flex-start;
+}
+#gradeTableWrapper tbody td .gb-student-cell .gb-value {
+  line-height: 1.2em;
+}
+#gradeTableWrapper tbody td .gb-student-cell .gb-view-grade-summary {
+  display: block;
+  font-weight: normal;
+}
+#gradeTableWrapper .relative {
+  border-top: 1px solid transparent;
+  border-bottom: 1px solid transparent;
+}
+#gradeTableWrapper .currentRow .relative {
+  border-top: 1px solid rgb(82, 146, 247);
+  border-bottom: 1px solid rgb(82, 146, 247);
+}
+
+#gradeTableWrapper .handsontable td {
+  white-space: nowrap;
+}
+#gradeTableWrapper .gb-title {
+  font-weight: bold;
+  white-space: normal;
+  text-align: left;
+  line-height: 1.2em;
+  display: inline-block;
+  cursor: pointer;
+  width: calc(100% - 16px);
+}
+#gradeTableWrapper .gb-title:hover:after {
+  font-family: 'gradebook-icons';
+  content: '\f0dc';
+  position: absolute;
+  right: 5px;
+  top: 5px;
+}
+#gradeTableWrapper .gb-title.gb-sorted-asc:after {
+  font-family: 'gradebook-icons';
+  content: '\f0de';
+  position: absolute;
+  right: 5px;
+  top: 5px;
+}
+#gradeTableWrapper .gb-title.gb-sorted-desc:after {
+  font-family: 'gradebook-icons';
+  content: '\f0dd';
+  position: absolute;
+  right: 5px;
+  top: 5px;
+}
+#gradeTableWrapper .gb-title .gb-category {
+  font-style: italic;
+}
+#gradeTableWrapper .gb-title .gb-category .gb-category-weight-label {
+  padding-left: 18px;
+}
+#gradeTableWrapper .gb-title .gb-category .gb-category-weight {
+  font-style: normal;
+}
+#gradeTableWrapper .gb-grade-section,
+#gradeTableWrapper .gb-due-date,
+#gradeTableWrapper .gb-category {
+  text-align: left;
+  font-size: 0.9em;
+  line-height: 1.3em;
+}
+#gradeTableWrapper .gb-grade-item-flags {
+  position: absolute;
+  bottom: 0;
+  left: 5px;
+}
+#gradeTableWrapper th .btn-group,
+#gradeTableWrapper td .btn-group {
+  position: absolute;
+  bottom: 5px;
+  right: 5px;
+}
+#gradeTableWrapper .btn-group > a {
+  line-height: 10px;
+  padding: 0 10px;
+  opacity: 0.2;
+  border-color: #EEE;
+}
+#gradeTableWrapper th:hover .btn-group > a,
+#gradeTableWrapper td:hover .btn-group > a,
+#gradeTableWrapper .highlight .btn-group > a {
+  opacity: 1;
+}
+
+#gradeTableWrapper .highlight {
+  color: inherit;
+  font-weight: inherit;
+}
+
+#gradebookSpreadsheet.gb-grouped-by-category #gradeTableWrapper th.gb-categorized {
+  border-top: 10px solid #F0F0F0;
+}
+#gradeTableWrapper .swatch {
+  width: 1em;
+  height: 1em;
+  display: inline-block;
+  margin-right: 4px;
+  box-shadow: 1px 1px 2px #CCC;
+}
+#gradeTableWrapper .gb-category-weight {
+  color: #999;
+  font-weight: normal;
+}
+#gradeTableWrapper .gb-uncategorized {
+  text-align: left;
+  color: #999;
+}
+#gradeTableWrapper tbody td .gb-value {
+  line-height: 30px;
+}
+#gradeTableWrapper tbody td .gb-value.gb-overridden {
+  font-weight: bold;
+}
+#gradeTableWrapper tbody td .btn-group {
+  position: absolute;
+  right: 0;
+  bottom: 2px;
+}
+#gradeTableWrapper .gb-comment-notification {
+  position: absolute;
+  top: 4px;
+  right: 8px;
+  font-size: 16px;
+  min-width: 16px;
+  height: 20px;
+  color: #AAA;
+}
+#gradeTableWrapper .gb-comment-notification:before,
+.gb-flag-comment:before {
+  font-family: "gradebook-icons";
+  content: '\f075';
+}
+
+#gradeTableWrapper .gb-notification {
+  position: absolute;
+  top: 50%;
+  left: 10px;
+  font-size: 16px;
+  min-width: 16px;
+  height: 20px;
+  margin-top: -10px;
+}
+[class*="gb-flag"] {
+  color: #999;
+  font-family: 'gradebook-icons';
+  display: inline-block;
+  min-width: 16px;
+  text-align: center;
+  font-style: normal;
+}
+.gb-flag-not-counted:before {
+  content: '\e600';
+}
+.gb-flag-not-released:before {
+  content: '\e601';
+}
+.gb-flag-not-released:before {
+  content: '\e601';
+}
+.gb-flag-counted,
+.gb-flag-released {
+  display: none;
+}
+#gradeTableWrapper .gb-extra-credit,
+#gradeTableWrapper .currentRow .gb-extra-credit,
+#gradeTableWrapper .currentCol .gb-extra-credit {
+  background-color: #FCF8E3 !important;
+}
+.gb-flag-extra-credit:before {
+  content: '\f0fe';
+  color: rgb(200,144,0);
+}
+.gb-flag-external:before {
+  content: '\f045';
+}
+.gb-flag-read-only:before {
+  content: '\f023';
+}
+#gradeTableWrapper th .gb-flag-extra-credit,
+#gradeTableWrapper th .gb-external-app {
+  font-size: 1.1em;
+  vertical-align: baseline;
+  display: inline-block;
+}
+#gradeTableWrapper th .relative > .gb-flag-extra-credit,
+#gradeTableWrapper th .relative > .gb-external-app {
+  float: left;
+  vertical-align: top;
+  line-height: inherit;
+  margin-right: 4px;
+}
+#gradeTableWrapper th .gb-flag-extra-credit:before {
+  color: #999;
+}
+#gradeTableWrapper .gb-save-success,
+#gradeTableWrapper .currentCol .gb-save-success,
+#gradeTableWrapper .currentRow .gb-save-success {
+  background-color: #DFF0D8 !important;
+}
+#gradeTableWrapper .gb-save-success .gb-notification:before {
+  font-family: "gradebook-icons";
+  content: "\f05d" !important;
+  color: green;
+}
+#gradeTableWrapper .gb-just-synced,
+#gradeTableWrapper .currentCol .gb-just-synced,
+#gradeTableWrapper .currentRow .gb-just-synced {
+  background-color: #DFF0D8 !important;
+}
+#gradeTableWrapper .gb-save-error,
+#gradeTableWrapper .currentCol .gb-save-error,
+#gradeTableWrapper .currentRow .gb-save-error {
+	background-color: #FFBBBB !important;
+}
+#gradeTableWrapper .gb-save-error .gb-notification:before,
+.gb-flag-save-error:before {
+  font-family: "gradebook-icons";
+  content: "\f06a" !important;
+  color: rgb(204,0,0) !important;
+}
+#gradeTableWrapper .gb-save-invalid {
+  background-color: #FCF8E3 !important;
+}
+#gradeTableWrapper .gb-save-invalid .gb-notification:before,
+.gb-flag-save-invalid:before {
+  font-family: "gradebook-icons";
+  content: "\f071" !important;
+  color: rgb(200,144,0) !important;
+}
+#gradeTableWrapper .gb-read-only {
+  color: #777;
+}
+#gradeTableWrapper .gb-read-only .gb-notification:before {
+  font-family: "gradebook-icons";
+  content: '\f023';
+  color: #DDD;
+}
+#gradeTableWrapper .gb-read-only .gb-notification.gb-flag-extra-credit:after {
+  font-family: "gradebook-icons";
+  content: '\f0fe';
+  color: rgb(200,144,0);
+  font-size: 10px;
+  position: absolute;
+  right: -5px;
+  bottom: -5px;
+}
+#gradeTableWrapper .gb-concurrent-edit .gb-notification:before,
+.gb-flag-concurrent-edit:before {
+  font-family: "gradebook-icons";
+  content: '\f040';
+  color: rgb(204,0,0);
+}
+
+/* Cell Metadata Summary */
+.gb-metadata {
+  position: absolute;
+  width: 300px;
+  padding: 10px;
+  font-size: 0.9em;
+  background: #FAFAFA;
+  color: #212121;
+  z-index: 1000;
+  border-radius: 5px;
+  box-shadow: 1px 1px 5px 1px #999;
+}
+.gb-metadata p,
+.gb-metadata dl,
+.gb-metadata ul,
+.gb-metadata blockquote {
+  margin: 0;
+}
+.gb-metadata dt {
+  width: 80px !important;
+  color: #555;
+}
+.gb-metadata dd {
+  margin-left: 90px !important;
+}
+.gb-metadata blockquote {
+  font-size: 1em;
+  padding: 5px;
+  color: #666;
+}
+.gb-metadata:after, .gb-metadata:before {
+  bottom: 100%;
+  left: 50%;
+  border: solid transparent;
+  content: " ";
+  height: 0;
+  width: 0;
+  position: absolute;
+  pointer-events: none;
+}
+.gb-metadata:after {
+  border-color: transparent;
+  border-bottom-color: #FAFAFA;
+  border-width: 10px;
+  margin-left: -10px;
+}
+.gb-metadata:before {
+  border-color: transparent;
+  border-bottom-color: #DDD;
+  border-width: 10px;
+  margin-left: -10px;
+}
+.gb-metadata .gb-metadata-close:before {
+  position: absolute;
+  right: 5px;
+  top: 5px;
+  font-family: 'gradebook-icons';
+  content: '\f00d';
+}
+.gb-metadata .gb-metadata-notifications ul {
+  list-style: none;
+  padding-left: 0;
+}
+#gradebookGradesToolbar {
+  border-top: 1px solid #F6f6f6;
+}
+#gradebookGradesToolbar button {
+  margin: 0;
+}
+.gb-student-filter {
+  position: relative;
+}
+.gb-student-filter #studentFilterInput {
+  height: 28px;
+  font-size: 12px;
+}
+.gb-student-filter .gb-student-filter-clear-button {
+  position: absolute;
+  top: 50%;
+  margin-top: -8px;
+  height: 16px;
+  right: 8px;
+  color: #999;
+}
+.gb-grade-item-summary .gb-item-summary-counts.warn-items-hidden,
+.gb-student-summary .gb-student-summary-counts.warn-students-hidden {
+  color: #CA7311;
+  font-weight: bold;
+}
+/* table caption and toggle */
+#captionToggle {
+  color: #777;
+  vertical-align: middle;
+  text-decoration: none;
+  font-size: 25px;
+  margin-left: 10px;
+}
+#captionToggle:before {
+  font-family: 'gradebook-icons';
+  content: '\f11c';
+}
+#captionToggle:hover {
+  text-shadow: 0 0 5px #AAA;
+}
+#gradeTableWrapper #gradeTableCaption {
+  /* hide the caption from users, but retain for screen readers */
+  position: absolute;
+  width: 1px;
+  height: 1px;
+  margin: -1px;
+  padding: 0;
+  overflow: hidden;
+  clip: rect(0, 0, 0, 0);
+  border: 0;
+}
+#gradeTableWrapper #gradeTableCaption.maximized {
+  position: fixed;
+  width: 80%;
+  height: 60%;
+  background: #FAFAFA;
+  color: #212121;
+  z-index: 1000;
+  top: 20%;
+  left: 150px;
+  padding: 10px;
+  margin: 0;
+  border-radius: 5px;
+  box-shadow: 1px 1px 20px 5px #999;
+  overflow: auto;
+  clip: auto;
+}
+.handsontable th {
+  overflow: visible; /* to allow visual cue to be rendered nicely */
+}
+.gb-hidden-column-visual-cue {
+  position: absolute;
+  top: 0;
+  right: -10px;
+  cursor: pointer;
+  width: 19px;
+  border: 1px solid transparent;
+  height: 15px;
+  line-height: 14px;
+  padding: 0 1px;
+  border-radius: 2px;
+}
+.gb-grouped-by-category .gb-hidden-column-visual-cue {
+  top: -10px;
+}
+.gb-hidden-column-visual-cue:hover,
+.gb-hidden-column-visual-cue:active,
+.gb-hidden-column-visual-cue:focus {
+  text-decoration: none;
+  background-color: #FFF;
+  background-color: rgba(255,255,255,0.5);
+  border-color: #43a7c8;
+  border-color: rgba(67, 167, 200, 0.5);
+}
+.gb-hidden-column-visual-cue:before {
+  font-family: 'gradebook-icons';
+  content: '\f0d9';
+  float: left;
+}
+.gb-hidden-column-visual-cue:after {
+  font-family: 'gradebook-icons';
+  content: '\f0da';
+  float: right;
+}
+.gb-category-average {
+    background-color: #FCFCFC;
+}
+.gb-category-average .gb-value {
+    font-weight: bold;
+    color: #666;
+}
+
+/* For Webkit browsers, force the scrollbars to be visible
+   (due to hidden scroll bars in OS X)
+*/
+.ht_clone_left.handsontable {
+  height: calc(100% - 10px) !important;
+}
+.ht_clone_left.handsontable .wtHolder .wtHider {
+  padding-bottom: 10px;
+}
+.ht_clone_top.handsontable {
+  width: calc(100% - 10px) !important;
+}
+.ht_clone_top.handsontable .wtHolder .wtHider {
+  padding-right: 10px;
+}
+.wtHolder::-webkit-scrollbar {
+  width: 10px;
+  height: 10px;
+}
+.wtHolder::-webkit-scrollbar-track {
+  background-color: #EEE;
+}
+.wtHolder::-webkit-scrollbar-thumb {
+  border-radius: 10px;
+  background-color: rgba(170,170,170,0.5);
+}
+.wtHolder::-webkit-scrollbar-thumb:hover {
+  background-color: #AAA;
+}
+/* drop z-index so they don't interfere with site menu dropdowns */
+.ht_clone_top {
+  z-index: 96; /* was 101 */
+}
+.ht_clone_left {
+  z-index: 97; /* was 102 */
+}
+.ht_clone_top_left_corner,
+.ht_clone_bottom_left_corner {
+  z-index: 98; /* was 103 */
+}
+
+/* We want the original table header to take up space, but it doesn't need to be
+   visible.  Otherwise we see it show up as a "ghost" in firefox when scrolling
+   upwards. */
+.handsontable.ht_master thead {
+    visibility: hidden;
+}
diff --git a/gradebookng/tool/src/webapp/styles/gradebook-grades.css b/gradebookng/tool/src/webapp/styles/gradebook-grades.css
index f749fd89d0..0dbad7ec65 100644
--- a/gradebookng/tool/src/webapp/styles/gradebook-grades.css
+++ b/gradebookng/tool/src/webapp/styles/gradebook-grades.css
@@ -19,468 +19,6 @@
   margin-right: 4px;
 }
 
-/* Container */
-#gradebookSpreadsheet {
-  margin-top: 10px;
-}
-#gradebookGrades {
-  position: relative;
-  overflow: hidden;
-  width: 100%;
-  font-size: 0.9em;
-}
-#gradebookHorizontalOverflowWrapper {
-  width: 100%;
-  padding-bottom: 160px;
-  overflow: auto;
-  position: relative;
-  -webkit-overflow-scrolling: touch;
-}
-
-/* Table */
-#gradebookGrades table {
-  width: 0; /* Foo-width to fix display issue in Morpheus */
-  display: block;
-  margin: 0;
-}
-#gradebookGrades table.table-bordered {
-  border: none;
-}
-#gradebookGrades table.table-bordered>thead>tr>td,
-#gradebookGrades table.table-bordered>thead>tr>th {
-  border-bottom-width: 1px;
-}
-#gradebookGrades table.table-striped>tbody>tr:nth-of-type(even) {
-  background-color: #FFF;
-}
-#gradebookGrades table.table-striped>tbody>tr:nth-of-type(even):hover {
-  background-color: #f5f5f5;
-}
-#gradebookGrades th input[type='text'],
-#gradebookGrades th select {
-  width: 100%;
-  font-size: 0.9em;
-}
-#gradebookGrades fieldset td {
-  height: 2em;
-  line-height: 2em;
-}
-/* Table cell heights, widths and positioning */
-/* Known issue: as table cells don't support position:relative
- * consistently, we fudge the inner span/div of the cell to
- * provide a container for any absolutely positioned children.
- * This div is given a fixed height to ensure a cross browser
- * solution.
- */
-#gradebookGrades th,
-#gradebookGrades td {
-  width: 180px;
-  max-width: 180px;
-  min-width: 180px;
-  min-height: 2.6em;
-}
-#gradebookGrades .gb-course-grade {
-  width: 120px;
-  max-width: 120px;
-  min-width: 120px;
-}
-#gradebookGrades .gb-course-grade.gb-cg-override {
-  font-weight: bold;
-}
-#gradebookGrades .gb-student-cell {
-  width: 220px;
-  max-width: 220px;
-  min-width: 220px;
-}
-#gradebookGrades thead th > div,
-#gradebookGrades tbody td > div {
-  position: relative;
-  display: block;
-}
-#gradebookGrades thead th,
-#gradebookGrades thead th > div {
-  min-height: 100px;
-  height: 100px;
-}
-#gradebookGrades thead th > div,
-#gradebookGrades tbody td > div {
-  min-height: 2.6em;
-}
- 
- /* Table Header */
-#gradebookGrades thead th {
-  vertical-align: top;
-  background: #F0f0f0;
-  text-shadow: 1px 1px 2px #FFF;
-  font-weight: normal;
-}
-#gradebookGrades thead th .gb-title {
-  font-weight: bold;
-  max-height: 2.8em;
-  overflow: hidden;
-  line-height: 1.4em;
-  margin-right: 4px;
-}
-#gradebookGrades thead th .gb-title > a {
-  text-decoration: none;
-  color: #414141;
-}
-#gradebookGrades thead th .gb-title > a:hover,
-#gradebookGrades thead th .gb-title > a:focus {
-  text-decoration: underline;
-  color: #2a94c0;
-}
-#gradebookGrades thead th .gb-title > a:after {
-  font-family: 'gradebook-icons';
-  position: absolute;
-  right: 0;
-  top: 0;
-  font-style: normal;
-}
-#gradebookGrades thead th .gb-title > a:hover:after,
-#gradebookGrades thead th .gb-title > a:focus:after {
-  content: '\f0dc';
-}
-#gradebookGrades thead th .gb-title > a.gb-sort-descending:after,
-#gradebookGrades thead th .gb-title > a.gb-sort-descending:hover:after,
-#gradebookGrades thead th .gb-title > a.gb-sort-descending:focus:after {
-  font-family: 'gradebook-icons';
-  content: '\f0d7';
-}
-#gradebookGrades thead th .gb-title > a.gb-sort-ascending:after,
-#gradebookGrades thead th .gb-title > a.gb-sort-ascending:hover:after,
-#gradebookGrades thead th .gb-title > a.gb-sort-ascending:focus:after {
-  font-family: 'gradebook-icons';
-  content: '\f0d8';
-}
-#gradebookGrades thead th .gb-title > a:before {
-  margin-right: 4px;
-}
-#gradebookGrades thead th .gb-title .gb-external-app-flag {
-  font-size: 1.2em;
-}
-#gradebookGrades thead th .gb-title .gb-external-app-flag:before {
-  margin-right: 4px;
-}
-#gradebookGrades thead th .gb-grade-section,
-#gradebookGrades thead th .gb-due-date {
-  font-size: 0.9em;
-  color: #999;
-  line-height: 1.4em;
-}
-#gradebookGrades thead th.gb-category-item-column-cell .gb-title {
-  font-style: italic;
-}
-#gradebookGrades thead th.gb-category-item-column-cell .gb-category-score-swatch {
-  float: left;
-  height: 1em;
-  width: 1em;
-  margin: 3px 5px 0 0;
-  box-shadow: 1px 1px 1px #AAA;
-}
-
-/* Dropdown Menus */
-#gradebookGrades td .btn-group {
-  position: absolute;
-  bottom: 2px;
-  right: 1px;
-  display: none;
-}
-#gradebookGrades td:focus .btn-group,
-#gradebookGrades td:hover .btn-group,
-#gradebookGrades td.gb-cell-editing .btn-group,
-#gradebookGrades .gb-highlighted-row .btn-group {
-  display: block;
-}
-#gradebookGrades table td,
-#gradebookGrades table .gb-headers th {
-  cursor: pointer;
-}
-#gradebookGrades tbody .btn.dropdown-toggle {
-  opacity: 0.3;
-  border-color: #EEE;
-}
-#gradebookGrades tbody .btn.dropdown-toggle:focus,
-#gradebookGrades tbody .btn.dropdown-toggle:active,
-#gradebookGrades tbody .btn.dropdown-toggle:hover,
-#gradebookGrades tbody .open .btn.dropdown-toggle {
-    opacity: 1;
-    border-color: #DDD;
-}
-#gradebookGrades thead th .btn-group {
-  position: absolute;
-  bottom: 2px;
-  right: -3px;
-}
-#gradebookGrades .btn.dropdown-toggle {
-  padding: 0 8px;
-  line-height: 1em;
-  border-radius: 4px;
-}
-#gradebookGrades .btn.dropdown-toggle:focus {
-  border: 1px solid #DDD;
-}
-#gradebookGrades #gradebookGradesTable caption {
-  /* hide the caption from users, but retain for screen readers */
-  position: absolute;
-  width: 1px;
-  height: 1px;
-  margin: -1px;
-  padding: 0;
-  overflow: hidden;
-  clip: rect(0, 0, 0, 0);
-  border: 0;
-}
-#gradebookGrades #gradebookGradesTable tfoot .gb-cell-inner {
-  /* ensure there's enough room at the bottom of the scrollable div
-     so that the bottom-most menus display without being cropped */
-  min-height: 40px;
-}
-/* Distinguish Headers and Fixed Columns */
-#gradebookGrades table thead tr > *:nth-child(3),
-#gradebookGrades table tbody tr > *:nth-child(3) {
-  border-right: 1px solid #BBB !important;
-}
-#gradebookGrades table tr.gb-headers th {
-  border-bottom-color: #BBB;
-}
-#gradebookGrades table.table-striped tbody td,
-#gradebookGrades table.table-striped tbody th {
-  border-color: #EEE;
-}
-/* Categories */
-#gradebookGrades table tr.gb-categories-row th {
-  height: 26px;
-  line-height: 16px;
-  font-size: 16px;
-}
-#gradebookGrades table tr.gb-categories-row > th:nth-child(1) {
-  border-right: 1px solid #AAA !important;
-}
-#gradebookGrades table tr.gb-categories-row > th:nth-child(3) {
-  border-right: 1px solid #DDD !important;
-}
-#gradebookGrades .gb-categories-row th {
-  background: #e6e6e6;
-  overflow: hidden;
-}
-#gradebookGrades .gb-category-label {
-  display: block;
-  text-align: center;
-  white-space: nowrap;
-}
-#gradebookSpreadsheet.gb-grouped-by-category .dragtable-sortable {
-  margin-top: 30px;
-}
-#gradebookGrades .gb-fixed-column-headers-table .gb-categories-row {
-  display: none;
-}
-#gradebookSpreadsheet.gb-grouped-by-category .gb-fixed-column-headers-table .gb-categories-row {
-  display: table-row;
-}
-#gradebookGrades .gb-category-weight {
-  color: #777;
-}
-#gradebookGrades .gb-category-weight:before {
-  content: "[";
-}
-#gradebookGrades .gb-category-weight:after {
-  content: "]";
-}
-#gradebookGrades .gb-category-label .gb-category-extra-credit:before {
-  font-family: 'gradebook-icons';
-  content: '\f0fe';
-  vertical-align: bottom;
-  margin-right: 4px;
-  color: #999;
-}
-/* Table Cells */
-#gradebookGrades .gb-grade-item-cell,
-#gradebookGrades .gb-external-item-cell,
-#gradebookGrades .gb-readonly-item-cell,
-#gradebookGrades td.gb-category-item-column-cell {
-  text-align: center;
-  white-space: nowrap;
-}
-#gradebookGrades .gb-readonly-item-cell,
-#gradebookGrades .gb-external-item-cell {
-  color: #777;
-  font-style: italic;
-}
-#gradebookGrades .gb-readonly-grade {
-  line-height: 1em;
-  display: block;
-  padding-top: 10px;
-}
-#gradebookGrades .gb-grade-item-cell > span {
-  display: block;
-}
-#gradebookGrades .gb-grade-item-cell {
-  text-align:center;
-}
-#gradebookGrades .gb-grade-item-cell input {
-  text-align: center;
-  line-height: 1em;
-  display: inline;
-  border-color: transparent;
-  background-color: transparent;
-  font-size: inherit;
-}
-#gradebookGrades .gb-grade-item-cell input:focus {
-  background-color: #FFF;
-  width: 40px;
-  text-align: right;
-}
-#gradebookGrades .gb-grade-item-cell .gb-out-of {
-  display: inline;
-  padding-left: 6px;
-  font-size: 0.9em;
-  color: #999;
-}
-#gradebookGrades thead th {
-  padding: 4px 4px 0 8px;
-}
-#gradebookGrades .gb-ajax-editable-label {
-  width: 100%;
-  position: absolute;
-  top: 50%;
-  margin-top: -0.75em;
-}
-#gradebookGrades .gb-student-label {
-  padding: 4px;
-  display: block;
-  font-weight: normal;
-}
-#gradebookGrades .gb-course-grade {
-  text-align: center;
-}
-#gradebookGrades .gb-grade-item-cell > div,
-#gradebookGrades .gb-course-grade > div,
-#gradebookGrades .gb-category-item-column-cell > div {
-  line-height: 2.6em;
-}
-#gradebookGrades .gb-course-grade.points > div > span {
-  display: block;
-  line-height: 1.25em;
-}
-
-
-#gradebookGrades .gb-due-date {
-  margin-bottom: 1.2em;
-}
-#gradebookGradesTable td:focus,
-#gradebookGradesTable th:focus {
-  outline: 2px solid #3698DB;
-  outline-color: rgba(54, 152, 219, 0.8);
-  outline-offset: -1px;
-}
-/* Row selector/highlights */
-#gradebookGrades .gb-row-selector {
-  width: 14px;
-  min-width: 14px;
-  background-color: #EEE;
-  cursor: pointer;
-  vertical-align: middle;
-}
-#gradebookGrades .gb-row-selector > div:before {
-  font-family: 'gradebook-icons';
-  content: '\f054';
-  color: #E0E0E0;
-  margin-left: 4px;
-  font-size: 8px;
-  text-shadow: none;
-  position: absolute;
-  top: 50%;
-  margin-top: -4px;
-}
-#gradebookGrades .gb-row-selector:hover:before {
-  color: #FFF;
-}
-#gradebookGrades .gb-highlighted-row .gb-row-selector {
-  background-color: #3698DB;
-  border-color: #3698DB;
-}
-#gradebookGrades tbody .gb-highlighted-row {
-  outline: 1px solid #3698DB;
-  outline-color: rgba(54, 152, 219, 0.8);
-  outline-offset: 0px;
-}
-/* Fixed header/column */
-#gradebookGrades .gb-fixed-header-table,
-#gradebookGrades .gb-fixed-columns-table,
-#gradebookGrades .gb-fixed-column-headers-table {
-  border-collapse: collapse;
-  width: auto;
-}
-#gradebookGrades .gb-fixed-columns-table,
-#gradebookGrades .gb-fixed-column-headers-table {
-  position: fixed;
-}
-#gradebookGrades .gb-fixed-header-table {
-  position: absolute;
-}
-#gradebookGrades .gb-fixed-columns-table,
-#gradebookGrades .gb-fixed-column-headers-table {
-  border-right: none;
-}
-#gradebookGrades .gb-fixed-column-headers-table {
-  z-index: 30;
-}
-#gradebookGrades .gb-fixed-header-table {
-  z-index: 20;
-}
-#gradebookGrades .gb-fixed-columns-table {
-  z-index: 10;
-  background-color: white;
-}
-#gradebookGrades .gb-fixed-columns-table.table-striped > tbody > tr:nth-of-type(even) {
-  background-color: white;
-}
-#gradebookGrades .gb-fixed-columns-table.table-hover tr.hovered {
-  background-color: #f5f5f5 !important;
-}
-/* Fix ghosting of the dragtable helper */
-#gradebookGrades .dragtable-sortable {
-  z-index: 10;
-}
-/* Grade Item Flags */
-[class*="gb-flag"] {
-  color: #999;
-  font-family: 'gradebook-icons';
-  display: inline-block;
-}
-#gradebookGrades .gb-grade-item-flags {
-  position: absolute;
-  bottom: 0;
-  left: 5px;
-}
-#gradebookGrades .gb-grade-item-flags span {
-  margin-right: 4px;
-}
-#gradebookGrades .gb-grade-item-flags .gb-flag-is-released,
-#gradebookGrades .gb-grade-item-flags .gb-flag-is-counted {
-  display: none; /* don't show these flags */
-}
-.gb-flag-not-counted:before {
-  content: '\e600';
-}
-.gb-flag-not-released:before {
-  content: '\e601';
-}
-.gb-flag-extra-credit:before {
-  content: '\f0fe';
-}
-/* Drag and Drop */
-#gradebookGrades .gb-grade-item-drag-hover {
-  background-color: #DED;
-  border-color: #393;
-}
-#gradebookGrades .gb-grade-item-drag-source {
-  box-shadow: 2px 2px 3px #AAA inset, -2px -2px 3px #AAA inset;
-}
-#gradebookGrades .gb-grade-item-drag-source > * {
-  visibility: hidden;
-}
 /* Toolbar */
 #gradebookGradesToolbar {
   position: relative;
@@ -489,8 +27,7 @@
   overflow: visible;
   padding: 0 0.4em;
   width: 100%;
-  white-space: nowrap; /* don't wrap so it stays on one line */
-  height: 40px;
+  margin: 0;
 }
 #gradebookGradesToolbar ul {
   list-style: none;
@@ -525,8 +62,9 @@
 #toggleCategoriesToolbarItem:before {
   font-family: 'gradebook-icons';
   content: '\f096';
-  font-size: 0.9em;
-  margin-right: 6px
+  font-size: 15px;
+  margin-right: 6px;
+  vertical-align: middle;
 }
 #toggleCategories.on:before,
 #toggleCategoriesToolbarItem.on:before {
@@ -534,6 +72,10 @@
 }
 #filterByGroup {
   line-height: 1em;
+  max-width: 80%;
+  max-width: calc(100% - 50px);
+  margin-top: 10px;
+  font-size: 12px;
 }
 #gradebookGradesToolbar .gb-item-summary.warn-items-hidden .gb-item-summary-counts {
   color: #CA7311;
@@ -544,11 +86,15 @@
   position: absolute;
   border: 1px solid #bdbdbd;
   min-width: 200px;
+  max-width: 240px;
   min-height: 100px;
+  max-height: 340px;
   top: 38px;
   background-color: #FFF;
   box-shadow: 1px 1px 2px #AAA;
-  z-index: 40;
+  z-index: 200;
+  overflow: auto;
+  padding-right: 14px;
 } 
 #gradeItemsTogglePanel .hide-me {
   display: none;
@@ -585,14 +131,19 @@
   font-weight: 200;
   color: #999;
 }
-#gradeItemsTogglePanel .gb-item-category-filter-signal {
+#gradeItemsTogglePanel .gb-item-filter-signal {
   height: 1.2em;
   width: 1.2em;
   border: 1px solid #EEE;
   background-color: #EEE;
-  margin-top: 0.3em;
   position: absolute;
   right: 0;
+  top: 50%;
+  margin-top: -0.6em;
+}
+#gradeItemsTogglePanel .off .gb-item-filter-signal,
+#gradeItemsTogglePanel .partial .gb-item-filter-signal {
+  background-color: #FFF !important;
 }
 #gradeItemsTogglePanel .gb-item-category-filter,
 #gradeItemsTogglePanel .gb-item-filter,
@@ -600,6 +151,9 @@
   clear: both;
   margin-left: 10px;
   position: relative;
+  min-height: 24px;
+  display: flex;
+  align-items: center;
 }
 #gradeItemsTogglePanel .gb-item-filter,
 #gradeItemsTogglePanel .gb-item-category-score-filter {
@@ -616,13 +170,15 @@
   width: 90%;
   width: calc(100% - 20px);
 }
-#gradeItemsTogglePanel .gradebook-filter-partial-signal {
+#gradeItemsTogglePanel .gb-filter-partial-signal {
   display: block;
 
   border-left: 1.2em solid transparent;
   border-right: 0px solid transparent;
   border-bottom: 1.2em solid;
   border-bottom-color: inherit;
+  margin-top: -1px;
+  margin-left: -1px;
 }
 #gradeItemsTogglePanel #showAllGradeItems,
 #gradeItemsTogglePanel #hideAllGradeItems {
@@ -640,6 +196,9 @@
   border-bottom: none;
   margin: 0;
 }
+#gradeItemsTogglePanel .gb-item-filter-group .btn-group {
+  padding-left: 5px;
+}
 #gradeItemsTogglePanel .gb-item-filter-group .btn-group .btn.dropdown-toggle {
   padding: 0 4px;
 }
@@ -656,95 +215,14 @@
 #gradeItemsTogglePanel .gb-item-category-score-filter.off .gb-show-this-category-score {
   display: block;
 }
-/* Student filter */
-#gradebookGrades .filtered-by-studentFilter {
-  display: none;
-}
-#gradebookGrades .gb-student-filter {
-  position: relative;
-}
-#gradebookGrades .gb-student-filter input {
-  height: 2em;
-}
-#gradebookGrades .gb-student-filter-clear,
-#gradebookGrades .gb-student-filter-clear:hover {
-  text-decoration: none;
-}
-#gradebookGrades .gb-student-filter-clear:before {
-  position: absolute;
-  top: 2px;
-  right: 2px;
-  font-family: 'gradebook-icons';
-  content: '\f057';
-  color: #CCC;
-  font-size: 1em;
-  width: 1.2em;
-  text-align: right;
-  height: 2em;
-}
-/* Popover Notifications */
-.gb-grade-item-flags .popover {
-  min-width: 180px;
-}
-.gb-popover-notifications {
-  min-width: 200px;
-  max-width: 300px;
-  list-style: none;
-  padding: 0;
-}
-.gb-popover-notifications li {
-  clear: both;
-  margin-bottom: 10px;
-}
-.gb-popover-notifications li:before {
-  margin-right: 5px;
-}
-.gb-popover-notifications .gb-popover-notification-error:before,
-.gb-popover-notifications .gb-popover-notification-invalid:before {
-  font-family: "gradebook-icons";
-  content: "\f06a";
-}
-.gb-popover-notifications .gb-popover-notification-overlimit:before {
-  font-family: "gradebook-icons";
-  content: "\f0fe";
-}
-.gb-popover-notifications .gb-popover-notification-has-comment:before {
-  font-family: "gradebook-icons";
-  content: '\f075';
-}
-.gb-popover-notifications .gb-popover-notification-concurrentedit:before {
-  font-family: "gradebook-icons";
-  content: '\f040';
-}
-.gb-popover-notification-is-external:before,
-.gb-popover-notification-is-readonly {
-  font-family: "gradebook-icons";
-  content: '\f023';
-}
-.gb-popover-notifications .gb-popover-link {
-  float: right;
-  font-size: 0.9em;
-  margin: 0 0 1em;
-}
-.gb-popover-notifications .gb-popover-notification-has-comment blockquote {
-  margin: 1em 0;
-  padding: 5px 10px;
-  font-size: 0.9em;
-}
-.gb-popover-notifications .gb-revert-score {
-  margin-top: 20px;
+#gradeItemsTogglePanel .dropdown-menu {
+  max-width: 140px;
 }
-.gb-popover-close {
-  float: right;
-  text-decoration: none;
-}
-.gb-popover-close:hover {
-  text-decoration: none;
-}
-.gb-popover-close:before {
-  font-family: "gradebook-icons";
-  content: "\f00d";
+#gradeItemsTogglePanel .dropdown-menu a {
+  white-space: normal;
+  padding: 3px 10px;
 }
+
 /* Wicket Overrides */
 div.wicket-modal div.w_content_3 {
   border: none; /** don't want border wrapping content inside the modal **/
@@ -821,108 +299,7 @@ div.wicket-modal div.w_caption {
 div.wicket-modal div.w_right > div {
   box-shadow: 0 0 5px 2px #444;
 }
-.gb-cell-notification {
-  position: absolute;
-  left: 20px;
-  font-size: 1.4em;
-  height: 1.1em;
-  width: 1.1em;
-  line-height: 1.1em;
-  top: 50%;
-  margin-top: -0.55em;
-}
-.grade-save-error,
-.grade-save-warning {
-	background-color: #ffbbbb !important;
-}
-.gb-cell-notification-error:before,
-.gb-cell-notification-warning:before {
-  font-family: "gradebook-icons";
-  content: "\f06a";
-  color: rgb(204,0,0);
-}
-.gb-readonly-item-cell .gb-cell-notification-warning,
-.gb-external-item-cell .gb-cell-notification-warning {
-  opacity: 0.2;
-  font-style: normal;
-}
-.gb-readonly-item-cell .gb-cell-notification-warning:before,
-.gb-external-item-cell .gb-cell-notification-warning:before {
-  color: #CCC;
-  content: '\f023';
-}
-.gb-readonly-item-cell.grade-save-over-limit .gb-cell-notification-warning:after,
-.gb-external-item-cell.grade-save-over-limit .gb-cell-notification-warning:after {
-  font-family: "gradebook-icons";
-  content: '\f0fe';
-  color: rgb(200,144,0);
-  font-size: 10px;
-  left: 12px;
-  position: absolute;
-  top: 6px;
-}
-.gb-readonly-item-cell:focus .gb-cell-notification-warning,
-.gb-readonly-item-cell .gb-cell-notification-warning:focus,
-.gb-external-item-cell:focus .gb-cell-notification-warning,
-.gb-external-item-cell .gb-cell-notification-warning:focus {
-  display:block;
-  opacity: 1;
-}
-.grade-save-over-limit {
-  background-color: #fcf8e3 !important;
-}
-.gb-cell-notification-over-limit:before {
-  font-family: "gradebook-icons";
-  content: '\f0fe';
-  color: rgb(200,144,0);
-}
-.gb-cell-notification-comment {
-  position: absolute;
-  right: 4px;
-  top: 0;
-  width: 18px;
-  color: #CCC;
-  line-height: 18px;
-}
-.gb-cell-notification-comment:before {
-  font-family: "gradebook-icons";
-  content: '\f075';
-  font-size: 1em;
-  font-style: normal;
-}
-.gb-cell-out-of-date .gb-cell-notification {
-  display: none;
-}
-.gb-cell-out-of-date .gb-cell-notification.gb-cell-notification-out-of-date {
-  display: block;
-}
-.grade-save-error .gb-cell-notification-error {
-  display: block !important;
-}
-.grade-save-error .gb-cell-notification.gb-cell-notification-out-of-date {
-  display: none;
-}
-/* feedback styles for the grade saving state */
-.gb-score-dynamically-updated,
-.grade-save-success {
-  background-color: #dff0d8 !important;
-}
-.grade-save-success > div:before {
-  font-family: "gradebook-icons";
-  content: "\f05d" !important;
-  color: green !important;
-  position: absolute;
-  left: 20px;
-  font-size: 1.4em;
-  height: 1.1em;
-  width: 1.1em;
-  line-height: 1.1em;
-  top: 50%;
-  margin-top: -0.55em;
-}
-.grade-save-success .gb-cell-notification {
-    display: none;
-}
+
 /** temporary override for page width **/
 .Mrphs-pageColumns--single {
 	max-width: none !important;
@@ -937,23 +314,63 @@ div.wicket-modal div.w_right > div {
 .grade-log-item {
 	margin-bottom: 5px;
 }
-/* Concurrent Users Warning */
-.gb-cell-notification-out-of-date:before {
-  font-family: "gradebook-icons";
-  content: "\f040";
-  color: #ccc;
-}
-#gradebookGrades .gb-cell:focus .gb-cell-notification-out-of-date:before,
-#gradebookGrades .gb-ready-for-edit .gb-cell-notification-out-of-date:before,
-#gradebookGrades .gb-cell-editing .gb-cell-notification-out-of-date:before {
-  color: #a94442;
-}
+
 /* Datepicker */
 .ui-datepicker {
   z-index: 50000 !important;
 }
 
-/* Student Grade Summary */
+
+/* Update Ungraded modal */
+.gb-update-ungraded-confirmation.in {
+  position: absolute;
+  right:0;
+  bottom: auto;
+  left: 0;
+  overflow: auto;
+  -webkit-overflow-scrolling: touch;
+}
+.gb-update-ungraded-confirmation {
+  z-index: 50000 !important;
+}
+.gb-update-ungraded-confirmation .modal-dialog {
+  z-index: 50001 !important;
+}
+
+.gb-group-title {
+	font-weight: bold;
+	line-height: 3em;
+}
+
+/* Live feedback message container */
+.gb-live-feedback {
+  display: inline-block;
+  padding: 4px;
+  font-size: 12px;
+  line-height: 35px;
+  color: #666;
+  margin: 0 0 0 10px;
+}
+
+/* Connection Poll message */
+#gbConnectionTimeoutFeedback {
+  position: fixed;
+  z-index: 99999999;
+  top: 80px;
+  padding: 5px;
+  box-shadow: 1px 1px 5px #999;
+  font-size: 12px;
+  width: 350px;
+  margin-left: -175px;
+  left: 50%;
+}
+
+#gbConnectionTimeoutFeedback:before {
+  font-family: "gradebook-icons";
+  content: "\f071";
+}
+
+/* Summary styles */
 #instructorView.tab-pane,
 #studentView.tab-pane {
   border-top: 1px dotted #EEE;
@@ -1085,115 +502,6 @@ div.wicket-modal div.w_right > div {
 .gb-summary-category-row th {
   background-color: #F4F4F4;
 }
-/* Hidden column visual cue */
-.gb-hidden-column-visual-cue {
-  position: absolute;
-  top: 0;
-  right: -14px;
-  cursor: pointer;
-  width: 19px;
-  border: 1px solid transparent;
-  height: 15px;
-  line-height: 14px;
-  padding: 0 1px;
-  border-radius: 2px;
-}
-.gb-hidden-column-visual-cue:hover,
-.gb-hidden-column-visual-cue:active,
-.gb-hidden-column-visual-cue:focus {
-  text-decoration: none;
-  background-color: #FFF;
-  background-color: rgba(255,255,255,0.5);
-  border-color: #43a7c8;
-  border-color: rgba(67, 167, 200, 0.5);
-}
-.gb-hidden-column-visual-cue:before {
-  font-family: 'gradebook-icons';
-  content: '\f0d9';
-  float: left;
-}
-.gb-hidden-column-visual-cue:after {
-  font-family: 'gradebook-icons';
-  content: '\f0da';
-  float: right;
-}
-/* Update Ungraded modal */
-.gb-update-ungraded-confirmation.in {
-  position: absolute;
-  right:0;
-  bottom: auto;
-  left: 0;
-  overflow: auto;
-  -webkit-overflow-scrolling: touch;
-}
-.gb-update-ungraded-confirmation {
-  z-index: 50000 !important;
-}
-.gb-update-ungraded-confirmation .modal-dialog {
-  z-index: 50001 !important;
-}
-
-/* Bootstrap > Morpheus overrides */
-.dropdown-menu>li>a,
-.nav>li>a {
-  text-decoration: none;
-}
-.checkbox input[type="checkbox"][disabled],
-.radio input[type="radio"][disabled]{
-  background-color: #eee;
-}
-.checkbox input[type="checkbox"][disabled]+span,
-.radio input[type="radio"][disabled]+span,
-.checkbox input[type="checkbox"][disabled]+label,
-.radio input[type="radio"][disabled]+label{
-  color: #999;
-}
-
-/* Mobile bits and pieces */
-/* Disable fixed columns and headers for small devices */
-@media only screen
-and (min-device-width : 375px)
-and (max-device-width : 736px) {
-  .gb-fixed-column-headers-table,
-  .gb-fixed-columns-table,
-  .gb-fixed-header-table {
-    display: none !important;
-  }
-}
-
-.gb-group-title {
-	font-weight: bold;
-	line-height: 3em;
-}
-
-/* Live feedback message container */
-.gb-live-feedback {
-  padding: 4px;
-  font-size: 12px;
-  line-height: 35px;
-  color: #666;
-  margin: 0 0 0 10px;
-}
-
-/* Connection Poll message */
-#gbConnectionTimeoutFeedback {
-  position: fixed;
-  z-index: 99999999;
-  top: 80px;
-  padding: 5px;
-  box-shadow: 1px 1px 5px #999;
-  font-size: 12px;
-  width: 350px;
-  margin-left: -175px;
-  left: 50%;
-}
-
-#gbConnectionTimeoutFeedback:before {
-  font-family: "gradebook-icons";
-  content: "\f071";
-}
-
-/* GradeSummayTablePanel - comments column */
 .gb-summary-grade-comments div{
   overflow-y: scroll;
   overflow-x: hidden;
diff --git a/gradebookng/tool/src/webapp/styles/gradebook-help-popup.css b/gradebookng/tool/src/webapp/styles/gradebook-help-popup.css
new file mode 100644
index 0000000000..a8adeb0bf8
--- /dev/null
+++ b/gradebookng/tool/src/webapp/styles/gradebook-help-popup.css
@@ -0,0 +1,70 @@
+#gradebookHelpPopup {
+    position: absolute;
+    max-width: 400px;
+    width: 100%;
+    background: #FFF;
+    z-index: 1000;
+    right: 80px;
+    margin-top: 10px;
+    padding: 100px 20px 20px;
+    box-shadow: 2px 2px 20px 1px #666;
+    background-image: url(/gradebookng-tool/images/gradebook-help-check.png);
+    background-repeat: no-repeat;
+    background-position: center 20px;
+}
+
+#gradebookHelpPopup:after {
+    bottom: 100%;
+    right: 20px;
+    border: solid transparent;
+    content: " ";
+    height: 0;
+    width: 0;
+    position: absolute;
+    pointer-events: none;
+    border-color: transparent;
+    border-bottom-color: #FAFAFA;
+    border-width: 7px;
+    outline: 0;
+}
+
+#gradebookHelpPopup a.gradebookHelpSoftDismiss {
+    position: absolute;
+    top: 10px;
+    right: 15px;
+    font-size: 20px;
+    color: #666;
+}
+
+#gradebookHelpPopup h3 {
+    color: #666;
+    font-size: 1.5em;
+    font-variant-caps: small-caps;
+    text-align: center;
+}
+
+#gradebookHelpPopup .help-popup-actions {
+    float: right;
+}
+
+#gradebookHelpMask {
+  height: 100%;
+  background: transparent;
+  width: 100%;
+  position: absolute;
+  top: 0;
+  left: 0;
+  z-index: 99;
+}
+
+@media only screen and (max-width : 800px) {
+  #gradebookHelpPopup {
+    right: 30px;
+  }
+}
+
+@media only screen and (max-width : 500px) {
+  #gradebookHelpPopup {
+    right: 0;
+  }
+}
diff --git a/gradebookng/tool/src/webapp/styles/gradebook-shared.css b/gradebookng/tool/src/webapp/styles/gradebook-shared.css
index 2ebafc1a3b..0334edcffa 100644
--- a/gradebookng/tool/src/webapp/styles/gradebook-shared.css
+++ b/gradebookng/tool/src/webapp/styles/gradebook-shared.css
@@ -9,4 +9,20 @@
  }
  ul.feedbackPanel li span {
    display: block;
+ }
+ 
+ /* Bootstrap > Morpheus overrides */
+ .dropdown-menu>li>a,
+ .nav>li>a {
+   text-decoration: none;
+ }
+ .checkbox input[type="checkbox"][disabled],
+ .radio input[type="radio"][disabled]{
+   background-color: #eee;
+ }
+ .checkbox input[type="checkbox"][disabled]+span,
+ .radio input[type="radio"][disabled]+span,
+ .checkbox input[type="checkbox"][disabled]+label,
+ .radio input[type="radio"][disabled]+label{
+   color: #999;
  }
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/styles/gradebook-sorter.css b/gradebookng/tool/src/webapp/styles/gradebook-sorter.css
new file mode 100644
index 0000000000..c7e44cea28
--- /dev/null
+++ b/gradebookng/tool/src/webapp/styles/gradebook-sorter.css
@@ -0,0 +1,81 @@
+/* **************************************************************** *
+ *                      Gradebook Sorter styles                     *
+ * **************************************************************** */
+
+ /* Fonts */
+ @font-face {
+    font-family:"gradebook-icons";
+    src:url(../fonts/gradebook-icons.eot);
+    src:url(../fonts/gradebook-icons.eot?#iefix) format("embedded-opentype"),url(../fonts/gradebook-icons.woff) format("woff"),url(../fonts/gradebook-icons.ttf) format("truetype"),url(../fonts/gradebook-icons.svg#gradebook-icons) format("svg");
+    font-weight:400;
+    font-style:normal
+}
+
+#gradebookSorter {
+  padding-top: 10px;
+}
+
+#gradebookSorter .gb-sorter-sortable {
+  border: 1px solid #EEE;
+  padding: 4px 10px;
+  background-color: #FAFAFA;
+  margin-bottom: 4px;
+  cursor: move;
+  position: relative;
+  margin-right: 40px;
+}
+
+#gradebookSorter .gb-sorter-sortable:before {
+  font-family: "gradebook-icons";
+  content: '\f0c9';
+}
+
+#gradebookSorter .gb-sorter-placeholder {
+  border: 1px dashed #CCC;
+  padding: 4px 10px;
+  margin-bottom: 4px;
+}
+
+#gradebookSorter .gb-sorter-category {
+  border-left: 3px solid transparent;
+  padding-left: 10px;
+}
+
+#gradebookSorter .gb-sort-up {
+  position: absolute;
+  right: -50px;
+  top: -7px;
+  height: 6px;
+  line-height: 3px;
+}
+
+#gradebookSorter .gb-sort-up:before {
+  font-family: 'gradebook-icons';
+  content: '\f106';
+}
+
+#gradebookSorter .gb-sort-down {
+  position: absolute;
+  right: -50px;
+  bottom: -7px;
+  height: 6px;
+  line-height: 3px;
+}
+
+#gradebookSorter .gb-sort-down:before {
+  font-family: 'gradebook-icons';
+  content: '\f107';
+}
+
+#gradebookSorter .gb-sorter-sortable:first-child .gb-sort-up {
+  display: none;
+}
+
+#gradebookSorter .gb-sorter-sortable:last-child .gb-sort-down {
+  display: none;
+}
+
+#gradebookSorter ul {
+  list-style: none;
+  padding: 0;
+}
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/styles/handsontable.full.min.css b/gradebookng/tool/src/webapp/styles/handsontable.full.min.css
new file mode 100644
index 0000000000..14a6ce54ac
--- /dev/null
+++ b/gradebookng/tool/src/webapp/styles/handsontable.full.min.css
@@ -0,0 +1,28 @@
+/*!
+(The MIT License)
+
+Copyright (c) 2012-2014 Marcin Warpechowski
+Copyright (c) 2015 Handsoncode sp. z o.o. <hello@handsoncode.net>
+
+Permission is hereby granted, free of charge, to any person obtaining
+a copy of this software and associated documentation files (the
+'Software'), to deal in the Software without restriction, including
+without limitation the rights to use, copy, modify, merge, publish,
+distribute, sublicense, and/or sell copies of the Software, and to
+permit persons to whom the Software is furnished to do so, subject to
+the following conditions:
+
+The above copyright notice and this permission notice shall be
+included in all copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
+EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
+IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
+CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
+TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
+SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+*/.handsontable{position:relative}.handsontable .hide{display:none}.handsontable .relative{position:relative}.handsontable.htAutoSize{visibility:hidden;left:-99000px;position:absolute;top:-99000px}.handsontable .wtHider{width:0}.handsontable .wtSpreader{position:relative;width:0;height:auto}.handsontable table,.handsontable tbody,.handsontable thead,.handsontable td,.handsontable th,.handsontable input,.handsontable textarea,.handsontable div{box-sizing:content-box;-webkit-box-sizing:content-box;-moz-box-sizing:content-box}.handsontable input,.handsontable textarea{min-height:initial}.handsontable table.htCore{border-collapse:separate;border-spacing:0;margin:0;border-width:0;table-layout:fixed;width:0;outline-width:0;max-width:none;max-height:none}.handsontable col{width:50px}.handsontable col.rowHeader{width:50px}.handsontable th,.handsontable td{border-top-width:0;border-left-width:0;border-right:1px solid #CCC;border-bottom:1px solid #CCC;height:22px;empty-cells:show;line-height:21px;padding:0 4px 0 4px;background-color:#FFF;vertical-align:top;overflow:hidden;outline-width:0;white-space:pre-line}.handsontable td.htInvalid{background-color:#ff4c42!important}.handsontable td.htNoWrap{white-space:nowrap}.handsontable th:last-child{border-right:1px solid #CCC;border-bottom:1px solid #CCC}.handsontable tr:first-child th.htNoFrame,.handsontable th:first-child.htNoFrame,.handsontable th.htNoFrame{border-left-width:0;background-color:white;border-color:#FFF}.handsontable th:first-child,.handsontable td:first-of-type,.handsontable .htNoFrame+th,.handsontable .htNoFrame+td{border-left:1px solid #CCC}.handsontable.htRowHeaders thead tr th:nth-child(2){border-left:1px solid #CCC}.handsontable tr:first-child th,.handsontable tr:first-child td{border-top:1px solid #CCC}.ht_master:not(.innerBorderLeft):not(.emptyColumns) ~ .handsontable tbody tr th,.ht_master:not(.innerBorderLeft):not(.emptyColumns) ~ .handsontable:not(.ht_clone_top) thead tr th:first-child{border-right-width:0}.ht_master:not(.innerBorderTop) thead tr:last-child th,.ht_master:not(.innerBorderTop) ~ .handsontable thead tr:last-child th,.ht_master:not(.innerBorderTop) thead tr.lastChild th,.ht_master:not(.innerBorderTop) ~ .handsontable thead tr.lastChild th{border-bottom-width:0}.handsontable th{background-color:#EEE;color:#222;text-align:center;font-weight:normal;white-space:nowrap}.handsontable thead th{padding:0}.handsontable th.active{background-color:#CCC}.handsontable thead th .relative{padding:2px 4px}.handsontable .manualColumnMover{position:fixed;left:0;top:0;background-color:transparent;width:5px;height:25px;z-index:999;cursor:move}.handsontable .manualRowMover{position:fixed;left:-4px;top:0;background-color:transparent;height:5px;width:50px;z-index:999;cursor:move}.handsontable .manualColumnMoverGuide,.handsontable .manualRowMoverGuide{position:fixed;left:0;top:0;background-color:#CCC;width:25px;height:25px;opacity:.7;display:none}.handsontable .manualColumnMoverGuide.active,.handsontable .manualRowMoverGuide.active{display:block;z-index:199}.handsontable .manualColumnMover:hover,.handsontable .manualColumnMover.active,.handsontable .manualRowMover:hover,.handsontable .manualRowMover.active{background-color:#88F}.handsontable .manualColumnResizer{position:fixed;top:0;cursor:col-resize;z-index:110;width:5px;height:25px}.handsontable .manualRowResizer{position:fixed;left:0;cursor:row-resize;z-index:110;height:5px;width:50px}.handsontable .manualColumnResizer:hover,.handsontable .manualColumnResizer.active,.handsontable .manualRowResizer:hover,.handsontable .manualRowResizer.active{background-color:#AAB}.handsontable .manualColumnResizerGuide{position:fixed;right:0;top:0;background-color:#AAB;display:none;width:0;border-right:1px dashed #777;margin-left:5px}.handsontable .manualRowResizerGuide{position:fixed;left:0;bottom:0;background-color:#AAB;display:none;height:0;border-bottom:1px dashed #777;margin-top:5px}.handsontable .manualColumnResizerGuide.active,.handsontable .manualRowResizerGuide.active{display:block;z-index:199}.handsontable .columnSorting{position:relative}.handsontable .columnSorting:hover{text-decoration:underline;cursor:pointer}.handsontable .columnSorting.ascending::after{content:'\25B2';color:#5f5f5f;position:absolute;right:-15px}.handsontable .columnSorting.descending::after{content:'\25BC';color:#5f5f5f;position:absolute;right:-15px}.handsontable th.beforeHiddenColumn{position:relative}.handsontable th.beforeHiddenColumn::after,.handsontable th.afterHiddenColumn::before{content:'\25C0';color:#bbb;position:absolute;right:1px;top:2px;font-size:5pt}.handsontable th.afterHiddenColumn{position:relative}.handsontable th.afterHiddenColumn::before{left:1px;top:2px;right:auto;content:'\25B6'}.handsontable td.afterHiddenColumn.firstVisible{border-left:1px solid #CCC}.handsontable thead th.hiddenHeader{display:none}.handsontable .wtBorder{position:absolute;font-size:0}.handsontable .wtBorder.hidden{display:none!important}.handsontable td.area{background:-moz-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(181,209,255,0.34)),color-stop(100%,rgba(181,209,255,0.34)));background:-webkit-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-o-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-ms-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:linear-gradient(to bottom,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#57b5d1ff',endColorstr='#57b5d1ff',GradientType=0);background-color:#fff}.handsontable .wtBorder.corner{font-size:0;cursor:crosshair}.handsontable .htBorder.htFillBorder{background:red;width:1px;height:1px}.handsontableInput{border:0;outline-width:0;margin:0;padding:1px 5px 0 5px;font-family:inherit;line-height:21px;font-size:inherit;box-shadow:0 0 0 2px #5292f7 inset;resize:none;display:inline-block;color:#000;border-radius:0;background-color:#FFF}.handsontableInputHolder{position:absolute;top:0;left:0;z-index:100}.htSelectEditor{-webkit-appearance:menulist-button!important;position:absolute;width:auto}.handsontable .htDimmed{color:#777}.handsontable .htSubmenu{position:relative}.handsontable .htSubmenu :after{content:'▶';color:#777;position:absolute;right:5px}.handsontable .htLeft{text-align:left}.handsontable .htCenter{text-align:center}.handsontable .htRight{text-align:right}.handsontable .htJustify{text-align:justify}.handsontable .htTop{vertical-align:top}.handsontable .htMiddle{vertical-align:middle}.handsontable .htBottom{vertical-align:bottom}.handsontable .htPlaceholder{color:#999}.handsontable .htAutocompleteArrow{float:right;font-size:10px;color:#EEE;cursor:default;width:16px;text-align:center}.handsontable td .htAutocompleteArrow:hover{color:#777}.handsontable td.area .htAutocompleteArrow{color:#d3d3d3}.handsontable .htCheckboxRendererInput{display:inline-block;vertical-align:middle}.handsontable .htCheckboxRendererInput.noValue{opacity:.5}.handsontable .htCheckboxRendererLabel{cursor:pointer;display:inline-block;width:100%}.htCommentCell{position:relative}.htCommentCell:after{content:'';position:absolute;top:0;right:0;border-left:6px solid transparent;border-top:6px solid red}@-webkit-keyframes opacity-hide{from{opacity:1}to{opacity:0}}@keyframes opacity-hide{from{opacity:1}to{opacity:0}}@-webkit-keyframes opacity-show{from{opacity:0}to{opacity:1}}@keyframes opacity-show{from{opacity:0}to{opacity:1}}.handsontable .handsontable.ht_clone_top .wtHider{padding:0 0 5px 0}.handsontable .autocompleteEditor.handsontable{padding-right:17px}.handsontable .autocompleteEditor.handsontable.htMacScroll{padding-right:15px}.handsontable.listbox{margin:0}.handsontable.listbox .ht_master table{border:1px solid #ccc;border-collapse:separate;background:white}.handsontable.listbox th,.handsontable.listbox tr:first-child th,.handsontable.listbox tr:last-child th,.handsontable.listbox tr:first-child td,.handsontable.listbox td{border-color:transparent}.handsontable.listbox th,.handsontable.listbox td{white-space:nowrap;text-overflow:ellipsis}.handsontable.listbox td.htDimmed{cursor:default;color:inherit;font-style:inherit}.handsontable.listbox .wtBorder{visibility:hidden}.handsontable.listbox tr td.current,.handsontable.listbox tr:hover td{background:#eee}.ht_clone_top{z-index:101}.ht_clone_left{z-index:102}.ht_clone_top_left_corner,.ht_clone_bottom_left_corner{z-index:103}.ht_clone_debug{z-index:103}.handsontable td.htSearchResult{background:#fcedd9;color:#583707}.htBordered{border-width:1px}.htBordered.htTopBorderSolid{border-top-style:solid;border-top-color:#000}.htBordered.htRightBorderSolid{border-right-style:solid;border-right-color:#000}.htBordered.htBottomBorderSolid{border-bottom-style:solid;border-bottom-color:#000}.htBordered.htLeftBorderSolid{border-left-style:solid;border-left-color:#000}.htCommentTextArea{-moz-box-shadow:1px 1px 2px #bbb;-webkit-box-shadow:1px 1px 2px #bbb;background-color:#fffacd;border:1px solid #999;box-shadow:1px 1px 2px #bbb;font-family:'Arial'}.handsontable tbody tr th:nth-last-child(2){border-right:1px solid #CCC}.handsontable thead tr:nth-last-child(2) th.htGroupIndicatorContainer{border-bottom:1px solid #CCC;padding-bottom:5px}.ht_clone_top_left_corner thead tr th:nth-last-child(2){border-right:1px solid #CCC}.htCollapseButton{width:10px;height:10px;line-height:10px;text-align:center;border-radius:5px;border:1px solid #f3f3f3;-webkit-box-shadow:1px 1px 3px rgba(0,0,0,0.4);box-shadow:1px 1px 3px rgba(0,0,0,0.4);cursor:pointer;margin-bottom:3px;position:relative}.htCollapseButton:after{content:"";height:300%;width:1px;display:block;background:#ccc;margin-left:4px;position:absolute;bottom:10px}thead .htCollapseButton{right:5px;position:absolute;top:5px;background:#fff}thead .htCollapseButton:after{height:1px;width:700%;right:10px;top:4px}.handsontable tr th .htExpandButton{position:absolute;width:10px;height:10px;line-height:10px;text-align:center;border-radius:5px;border:1px solid #f3f3f3;-webkit-box-shadow:1px 1px 3px rgba(0,0,0,0.4);box-shadow:1px 1px 3px rgba(0,0,0,0.4);cursor:pointer;top:0;display:none}.handsontable thead tr th .htExpandButton{top:5px}.handsontable tr th .htExpandButton.clickable{display:block}.collapsibleIndicator{position:absolute;top:50%;transform:translate(0%,-50%);right:5px;border:1px solid #a6a6a6;line-height:10px;color:#222;border-radius:10px;font-size:10px;width:10px;height:10px;cursor:pointer;-webkit-box-shadow:0 0 0 6px rgba(238,238,238,1);-moz-box-shadow:0 0 0 6px rgba(238,238,238,1);box-shadow:0 0 0 6px rgba(238,238,238,1);background:#eee}.handsontable col.hidden{width:0!important}.handsontable table tr th.lightRightBorder{border-right:1px solid #e6e6e6}.handsontable tr.hidden,.handsontable tr.hidden td,.handsontable tr.hidden th{display:none}.ht_master,.ht_clone_left,.ht_clone_top,.ht_clone_bottom{overflow:hidden}.ht_master .wtHolder{overflow:auto}.ht_clone_left .wtHolder{overflow-x:hidden;overflow-y:auto}.ht_clone_top .wtHolder,.ht_clone_bottom .wtHolder{overflow-x:auto;overflow-y:hidden}.wtDebugHidden{display:none}.wtDebugVisible{display:block;-webkit-animation-duration:.5s;-webkit-animation-name:wtFadeInFromNone;animation-duration:.5s;animation-name:wtFadeInFromNone}@keyframes wtFadeInFromNone{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}@-webkit-keyframes wtFadeInFromNone{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}.handsontable.mobile,.handsontable.mobile .wtHolder{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-overflow-scrolling:touch}.htMobileEditorContainer{display:none;position:absolute;top:0;width:70%;height:54pt;background:#f8f8f8;border-radius:20px;border:1px solid #ebebeb;z-index:999;box-sizing:border-box;-webkit-box-sizing:border-box;-webkit-text-size-adjust:none}.topLeftSelectionHandle:not(.ht_master .topLeftSelectionHandle),.topLeftSelectionHandle-HitArea:not(.ht_master .topLeftSelectionHandle-HitArea){z-index:9999}.topLeftSelectionHandle,.topLeftSelectionHandle-HitArea,.bottomRightSelectionHandle,.bottomRightSelectionHandle-HitArea{left:-10000px;top:-10000px}.htMobileEditorContainer.active{display:block}.htMobileEditorContainer .inputs{position:absolute;right:210pt;bottom:10pt;top:10pt;left:14px;height:34pt}.htMobileEditorContainer .inputs textarea{font-size:13pt;border:1px solid #a1a1a1;-webkit-appearance:none;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;position:absolute;left:14px;right:14px;top:0;bottom:0;padding:7pt}.htMobileEditorContainer .cellPointer{position:absolute;top:-13pt;height:0;width:0;left:30px;border-left:13pt solid transparent;border-right:13pt solid transparent;border-bottom:13pt solid #ebebeb}.htMobileEditorContainer .cellPointer.hidden{display:none}.htMobileEditorContainer .cellPointer:before{content:'';display:block;position:absolute;top:2px;height:0;width:0;left:-13pt;border-left:13pt solid transparent;border-right:13pt solid transparent;border-bottom:13pt solid #f8f8f8}.htMobileEditorContainer .moveHandle{position:absolute;top:10pt;left:5px;width:30px;bottom:0;cursor:move;z-index:9999}.htMobileEditorContainer .moveHandle:after{content:"..\a..\a..\a..";white-space:pre;line-height:10px;font-size:20pt;display:inline-block;margin-top:-8px;color:#ebebeb}.htMobileEditorContainer .positionControls{width:205pt;position:absolute;right:5pt;top:0;bottom:0}.htMobileEditorContainer .positionControls>div{width:50pt;height:100%;float:left}.htMobileEditorContainer .positionControls>div:after{content:" ";display:block;width:15pt;height:15pt;text-align:center;line-height:50pt}.htMobileEditorContainer .leftButton:after,.htMobileEditorContainer .rightButton:after,.htMobileEditorContainer .upButton:after,.htMobileEditorContainer .downButton:after{transform-origin:5pt 5pt;-webkit-transform-origin:5pt 5pt;margin:21pt 0 0 21pt}.htMobileEditorContainer .leftButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(-45deg)}.htMobileEditorContainer .leftButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .rightButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(135deg)}.htMobileEditorContainer .rightButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .upButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(45deg)}.htMobileEditorContainer .upButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .downButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(225deg)}.htMobileEditorContainer .downButton:active:after{border-color:#cfcfcf}.handsontable.hide-tween{-webkit-animation:opacity-hide .3s;animation:opacity-hide .3s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}.handsontable.show-tween{-webkit-animation:opacity-show .3s;animation:opacity-show .3s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}/*!
+ * Handsontable ContextMenu
+ */.htContextMenu{display:none;position:absolute;z-index:1060}.htContextMenu .ht_clone_top,.htContextMenu .ht_clone_left,.htContextMenu .ht_clone_corner,.htContextMenu .ht_clone_debug{display:none}.htContextMenu table.htCore{border:1px solid #bbb;border-bottom-width:2px;border-right-width:2px}.htContextMenu .wtBorder{visibility:hidden}.htContextMenu table tbody tr td{background:white;border-width:0;padding:4px 6px 0 6px;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.htContextMenu table tbody tr td:first-child{border:0}.htContextMenu table tbody tr td.htDimmed{font-style:normal;color:#323232}.htContextMenu table tbody tr td.current,.htContextMenu table tbody tr td.zeroclipboard-is-hover{background:#e9e9e9}.htContextMenu table tbody tr td.htSeparator{border-top:1px solid #bbb;height:0;padding:0;cursor:default}.htContextMenu table tbody tr td.htDisabled{color:#999}.htContextMenu table tbody tr td.htDisabled:hover{background:#fff;color:#999;cursor:default}.htContextMenu table tbody tr.htHidden{display:none}.htContextMenu table tbody tr td .htItemWrapper{margin-left:10px;margin-right:6px}.htContextMenu table tbody tr td div span.selected{margin-top:-2px;position:absolute;left:4px}.htContextMenu .ht_master .wtHolder{overflow:hidden}
\ No newline at end of file
diff --git a/gradebookng/tool/src/webapp/WEB-INF/tools/sakai.gradebookng.xml b/gradebookng/tool/src/webapp/tools/sakai.gradebookng.xml
similarity index 96%
rename from gradebookng/tool/src/webapp/WEB-INF/tools/sakai.gradebookng.xml
rename to gradebookng/tool/src/webapp/tools/sakai.gradebookng.xml
index ee9b265da6..cea6e5eda5 100644
--- a/gradebookng/tool/src/webapp/WEB-INF/tools/sakai.gradebookng.xml
+++ b/gradebookng/tool/src/webapp/tools/sakai.gradebookng.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0"?>
 <registration>
 	<tool id="sakai.gradebookng" 
-		title="Gradebook" 
+		title="New Gradebook"
 		description="The next generation gradebook tool for the Sakai CLE">
 
 		<!--  This tool will be made available to the following site types via Site Info > Edit Tools -->
